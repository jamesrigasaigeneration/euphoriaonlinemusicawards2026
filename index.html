<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Euphoria Intro → Neon Awards</title>
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <style>
    html,body{position:relative;height:100%; margin:0; background:#000; overflow:hidden; touch-action:auto;}
    body{overscroll-behavior-y:none; -webkit-overflow-scrolling:touch;}
    iframe{display:block; border:0;}

    .layer{position:absolute; inset:0; width:100%; height:100%; border:0; overflow:auto; -webkit-overflow-scrolling:touch; touch-action:pan-y;}
    #introFrame{z-index:10;}
    #mainFrame{z-index:1; opacity:0; pointer-events:none; transition:opacity .8s ease; background:#070817;}
    body.main-on #mainFrame{opacity:1; pointer-events:auto;}
    body.main-on #introFrame{opacity:0; pointer-events:none; transition:opacity .6s ease;}
    #fx{position:fixed; inset:0; z-index:20; pointer-events:none; opacity:0;}
    body.fx-on #fx{opacity:1; animation:fxFlash 1.2s ease forwards;}
    @keyframes fxFlash{
      0%{opacity:0; filter:none;}
      10%{opacity:1; filter:contrast(1.35) saturate(1.4) blur(0px);}
      35%{opacity:1; filter:contrast(1.55) saturate(1.8) blur(1px);}
      65%{opacity:.75; filter:contrast(1.2) saturate(1.25) blur(0.5px);}
      100%{opacity:0; filter:none;}
    }
    #startOverlay{position:fixed; inset:0; z-index:40; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,65); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding:18px;}
    #startOverlay.hidden{display:none;}
    #startOverlay .startCard{width:min(520px, 92vw); border-radius:22px; padding:18px 18px 16px;
      background:rgba(10,10,18,72); border:1px solid rgba(255,255,255,10);}
    #startOverlay .startTitle{font:700 20px/1.2 system-ui; color:rgba(255,255,255,92); margin-bottom:8px;}
    #startOverlay .startSub{font:13px/1.35 system-ui; color:rgba(255,255,255,70);}
  

  /* ===== Desktop layout everywhere (scale to fit) ===== */
#viewport{
  position:fixed;
  inset:0;
  width:100vw;
  height:100dvh;
  overflow:hidden;
  display:grid;
  place-items:center;
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
}

/* Σταθερός “PC καμβάς” 16:9 που κλιμακώνεται */
#stage{
  position:relative;
  width:1920px;
  height:1080px;
  overflow:hidden;
  transform-origin:center center;
  transform: scale(var(--s, 1));
  border-radius: 0; /* ίδιο look με PC */
}
#stage .layer{position:absolute; inset:0; width:100%; height:100%;}
</style>
</head>
<body>
  <div id="viewport"><div id="stage">
  <iframe id="introFrame" class="layer" title="Euphoria Intro" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen scrolling="yes"></iframe>
  <iframe id="mainFrame" class="layer" title="Neon Awards" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen scrolling="yes"></iframe>
  <div id="fx" aria-hidden="true"></div>

  <div id="startOverlay" role="button" aria-label="Tap to start" tabindex="0">
    <div class="startCard">
      <div class="startTitle">Tap to start</div>
      <div class="startSub">Βελτιστοποιημένο για κινητό — ξεκινάει το intro &amp; το timer.</div>
    </div>
  </div>

<script>
  // ---- Seed data (από το Excel) ----
  (function(){
    const SEED_MARK = "neon-awards:seed:v1";
    try{
      if (!localStorage.getItem(SEED_MARK)){
        localStorage.setItem("neon-awards:teri-vi-sentio", "{\"Best gr song\": [{\"id\": \"Best gr song__0__seed\", \"text\": \"Χρόνια πολλά φουρειρα\"}, {\"id\": \"Best gr song__1__seed\", \"text\": \"Alleluia φουρειρα\"}, {\"id\": \"Best gr song__2__seed\", \"text\": \"Εξαίρεση βισση\"}, {\"id\": \"Best gr song__3__seed\", \"text\": \"Ανεξάρτητη καλιμανη\"}, {\"id\": \"Best gr song__4__seed\", \"text\": \"Χόρεψε χατζηγιαννης\"}, {\"id\": \"Best gr song__5__seed\", \"text\": \"Αχ καρδιά μου αργυρός\"}, {\"id\": \"Best gr song__6__seed\", \"text\": \"Καλά να περνάτε δέσποινα Βανδή\"}, {\"id\": \"Best gr song__7__seed\", \"text\": \"Κάτι ξερις ρια ελληνιδου\"}, {\"id\": \"Best gr song__8__seed\", \"text\": \"Βοριάς απόν\"}, {\"id\": \"Best gr song__9__seed\", \"text\": \"Μπορώ και εγώ μέλισσες\"}], \"Best foreign song\": [{\"id\": \"Best foreign song__0__seed\", \"text\": \"Not like us\"}, {\"id\": \"Best foreign song__1__seed\", \"text\": \"Dancing in the flames\"}, {\"id\": \"Best foreign song__2__seed\", \"text\": \"Death dance\"}, {\"id\": \"Best foreign song__3__seed\", \"text\": \"Golden\"}, {\"id\": \"Best foreign song__4__seed\", \"text\": \"Bad dreams\"}, {\"id\": \"Best foreign song__5__seed\", \"text\": \"Feels like I m falling in love\"}, {\"id\": \"Best foreign song__6__seed\", \"text\": \"Abracadabra\"}, {\"id\": \"Best foreign song__7__seed\", \"text\": \"Messy\"}, {\"id\": \"Best foreign song__8__seed\", \"text\": \"I had some help\"}, {\"id\": \"Best foreign song__9__seed\", \"text\": \"Texas hold em\"}], \"Best GR Male Artist\": [{\"id\": \"Best GR Male Artist__0__seed\", \"text\": \"Ρεμος\"}, {\"id\": \"Best GR Male Artist__1__seed\", \"text\": \"Αργυρός\"}, {\"id\": \"Best GR Male Artist__2__seed\", \"text\": \"Φέρρης\"}, {\"id\": \"Best GR Male Artist__3__seed\", \"text\": \"Ιακωβιδης\"}, {\"id\": \"Best GR Male Artist__4__seed\", \"text\": \"Απόν\"}, {\"id\": \"Best GR Male Artist__5__seed\", \"text\": \"Σικαρο\"}, {\"id\": \"Best GR Male Artist__6__seed\", \"text\": \"Μάστορας\"}, {\"id\": \"Best GR Male Artist__7__seed\", \"text\": \"Οικονομόπουλος\"}, {\"id\": \"Best GR Male Artist__8__seed\", \"text\": \"Σαμπάνης\"}, {\"id\": \"Best GR Male Artist__9__seed\", \"text\": \"Μαζωνάκης\"}], \"Best GR Female Artsis\": [{\"id\": \"Best GR Female Artsis__0__seed\", \"text\": \"Βανδή\"}, {\"id\": \"Best GR Female Artsis__1__seed\", \"text\": \"Βισση\"}, {\"id\": \"Best GR Female Artsis__2__seed\", \"text\": \"Παπαριζου\"}, {\"id\": \"Best GR Female Artsis__3__seed\", \"text\": \"Σαττι\"}, {\"id\": \"Best GR Female Artsis__4__seed\", \"text\": \"Θεοδωριδου\"}, {\"id\": \"Best GR Female Artsis__5__seed\", \"text\": \"Ελληνιδου\"}, {\"id\": \"Best GR Female Artsis__6__seed\", \"text\": \"Καλλιμάνη\"}, {\"id\": \"Best GR Female Artsis__7__seed\", \"text\": \"Κλαυδια\"}, {\"id\": \"Best GR Female Artsis__8__seed\", \"text\": \"Γαρμπή\"}, {\"id\": \"Best GR Female Artsis__9__seed\", \"text\": \"Αδάμου\"}], \"Best Foreign Male Artist\": [{\"id\": \"Best Foreign Male Artist__0__seed\", \"text\": \"Ted swims\"}, {\"id\": \"Best Foreign Male Artist__1__seed\", \"text\": \"Drake\"}, {\"id\": \"Best Foreign Male Artist__2__seed\", \"text\": \"Lamar\"}, {\"id\": \"Best Foreign Male Artist__3__seed\", \"text\": \"Alex warren\"}, {\"id\": \"Best Foreign Male Artist__4__seed\", \"text\": \"Ed sheeran\"}, {\"id\": \"Best Foreign Male Artist__5__seed\", \"text\": \"Bad bunny\"}, {\"id\": \"Best Foreign Male Artist__6__seed\", \"text\": \"Bruno mars\"}, {\"id\": \"Best Foreign Male Artist__7__seed\", \"text\": \"Weekend\"}, {\"id\": \"Best Foreign Male Artist__8__seed\", \"text\": \"Benson boone\"}, {\"id\": \"Best Foreign Male Artist__9__seed\", \"text\": \"Post malone\"}], \"Best Foreign Female Artist\": [{\"id\": \"Best Foreign Female Artist__0__seed\", \"text\": \"Lady gaga\"}, {\"id\": \"Best Foreign Female Artist__1__seed\", \"text\": \"Sabrina carpenter\"}, {\"id\": \"Best Foreign Female Artist__2__seed\", \"text\": \"Taylor swift\"}, {\"id\": \"Best Foreign Female Artist__3__seed\", \"text\": \"Day lipa\"}, {\"id\": \"Best Foreign Female Artist__4__seed\", \"text\": \"Billie eilish\"}, {\"id\": \"Best Foreign Female Artist__5__seed\", \"text\": \"Lola young\"}, {\"id\": \"Best Foreign Female Artist__6__seed\", \"text\": \"Chappell roan\"}, {\"id\": \"Best Foreign Female Artist__7__seed\", \"text\": \"Doja cat\"}, {\"id\": \"Best Foreign Female Artist__8__seed\", \"text\": \"Olivia Rodrigo\"}, {\"id\": \"Best Foreign Female Artist__9__seed\", \"text\": \"Shakira\"}], \"Best GR music Video\": [{\"id\": \"Best GR music Video__0__seed\", \"text\": \"Αστεροματα κλαδιά\"}, {\"id\": \"Best GR music Video__1__seed\", \"text\": \"Λολα σαττι\"}, {\"id\": \"Best GR music Video__2__seed\", \"text\": \"Μηχανική καρδιά μάστορας\"}, {\"id\": \"Best GR music Video__3__seed\", \"text\": \"Κάτι ξέρεις ρια ελληνιδου\"}, {\"id\": \"Best GR music Video__4__seed\", \"text\": \"Το βάλε λιολιου\"}, {\"id\": \"Best GR music Video__5__seed\", \"text\": \"Αχ καρδιά μου αργυρός\"}, {\"id\": \"Best GR music Video__6__seed\", \"text\": \"Χόρεψε χατζηγιαννης\"}, {\"id\": \"Best GR music Video__7__seed\", \"text\": \"Καλέ ποιος είναι αυτός Ανδρομάχης\"}, {\"id\": \"Best GR music Video__8__seed\", \"text\": \"Αποτυπώματα λιλα\"}, {\"id\": \"Best GR music Video__9__seed\", \"text\": \"Λόγια ΗΒΗ Αδάμου\"}], \"Best Foreign Music Video\": [{\"id\": \"Best Foreign Music Video__0__seed\", \"text\": \"Neon dreams\"}, {\"id\": \"Best Foreign Music Video__1__seed\", \"text\": \"Texas hold em\"}, {\"id\": \"Best Foreign Music Video__2__seed\", \"text\": \"Abracadabra\"}, {\"id\": \"Best Foreign Music Video__3__seed\", \"text\": \"Midnight sun\"}, {\"id\": \"Best Foreign Music Video__4__seed\", \"text\": \"Death dance\"}, {\"id\": \"Best Foreign Music Video__5__seed\", \"text\": \"Golden\"}, {\"id\": \"Best Foreign Music Video__6__seed\", \"text\": \"Door\"}, {\"id\": \"Best Foreign Music Video__7__seed\", \"text\": \"Bad dreams\"}, {\"id\": \"Best Foreign Music Video__8__seed\", \"text\": \"Training seadon\"}, {\"id\": \"Best Foreign Music Video__9__seed\", \"text\": \"Fortnight\"}], \"Best ESC 2025 perfomance\": [{\"id\": \"Best ESC 2025 perfomance__0__seed\", \"text\": \"Sweden\"}, {\"id\": \"Best ESC 2025 perfomance__1__seed\", \"text\": \"Spain\"}, {\"id\": \"Best ESC 2025 perfomance__2__seed\", \"text\": \"Estonia\"}, {\"id\": \"Best ESC 2025 perfomance__3__seed\", \"text\": \"Φιλανδια\"}, {\"id\": \"Best ESC 2025 perfomance__4__seed\", \"text\": \"Ελλάδα\"}, {\"id\": \"Best ESC 2025 perfomance__5__seed\", \"text\": \"Γαλλία\"}, {\"id\": \"Best ESC 2025 perfomance__6__seed\", \"text\": \"Αυστρία\"}, {\"id\": \"Best ESC 2025 perfomance__7__seed\", \"text\": \"Ισραήλ\"}, {\"id\": \"Best ESC 2025 perfomance__8__seed\", \"text\": \"Γερμανία\"}, {\"id\": \"Best ESC 2025 perfomance__9__seed\", \"text\": \"Μαλτα\"}], \"Best Album of the Year\": [{\"id\": \"Best Album of the Year__0__seed\", \"text\": \"Comboy carter\"}, {\"id\": \"Best Album of the Year__1__seed\", \"text\": \"Radical optimism\"}, {\"id\": \"Best Album of the Year__2__seed\", \"text\": \"The tortured poets departmet\"}, {\"id\": \"Best Album of the Year__3__seed\", \"text\": \"Hit me hard and soft\"}, {\"id\": \"Best Album of the Year__4__seed\", \"text\": \"Hurry up tomorrow\"}, {\"id\": \"Best Album of the Year__5__seed\", \"text\": \"Not like us\"}, {\"id\": \"Best Album of the Year__6__seed\", \"text\": \"We cant be friends\"}, {\"id\": \"Best Album of the Year__7__seed\", \"text\": \"I had some help\"}, {\"id\": \"Best Album of the Year__8__seed\", \"text\": \"Feels like I m falling in love\"}, {\"id\": \"Best Album of the Year__9__seed\", \"text\": \"Saturn\"}]}");
        localStorage.setItem(SEED_MARK, "1");
      }
    }catch(e){}
  })();

  const INTRO_B64 = "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVsIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiIC8+Cjx0aXRsZT5FdXBob3JpYSDigJQgTmVvbiBTbW9vdGggKFB1bHNlICsgR3JhaW4pPC90aXRsZT4KPHN0eWxlPgogIDpyb290ewogICAgLS1iZy1kZWVwOiMwMjAzMGE7CiAgICAtLWJnLWJsdWU6IzA1MGEyMjsKICAgIC0tYmctYmx1ZTI6IzA2MGIxZTsKCiAgICAtLXdoaXRlOiNmZmY7CiAgICAtLW5lb24tY3lhbjojMmJkOWZmOwogICAgLS1uZW9uLXBpbms6I2ZmMmJkNjsKCiAgICAtLWdsYXNzOiByZ2JhKDEyLCAyNCwgNTAsIC4zOCk7CiAgICAtLXN0cm9rZTogcmdiYSg0MSwxODIsMjU1LC41NSk7CgogICAgLyogc3luYyBrbm9icyAqLwogICAgLS1wdWxzZUR1cjogMy42czsgICAgIC8qIGtlZXAgc2FtZSBhcyBsb2dvIG5lb25CcmVhdGggKi8KICAgIC0tcHVsc2VEZWxheTogMS4yczsgICAvKiBtYXRjaGVzIGxvZ28gbmVvbkJyZWF0aCBkZWxheSAqLwogIH0KCiAgKnsgYm94LXNpemluZzpib3JkZXItYm94OyB9CiAgaHRtbCxib2R5eyBoZWlnaHQ6MTAwJTsgfQoKICAvKiA9PT09PSBCQVNFIEJBQ0tHUk9VTkQgKGRhcmsgbmVvbikgPT09PT0gKi8KICBib2R5ewogICAgbWFyZ2luOjA7CiAgICBvdmVyZmxvdzpoaWRkZW47CiAgICBjb2xvcjp2YXIoLS13aGl0ZSk7CiAgICBmb250LWZhbWlseTogc3lzdGVtLXVpLCAtYXBwbGUtc3lzdGVtLCBTZWdvZSBVSSwgUm9ib3RvLCBIZWx2ZXRpY2EsIEFyaWFsLCAiQnJ1c2ggU2NyaXB0IE1UIiwgY3Vyc2l2ZTsKCiAgICBiYWNrZ3JvdW5kOgogICAgICByYWRpYWwtZ3JhZGllbnQoMTIwMHB4IDYwMHB4IGF0IDE4JSAyMiUsIHJnYmEoMjU1LDQzLDIxNCwwLjE4KSwgdHJhbnNwYXJlbnQgNjIlKSwKICAgICAgcmFkaWFsLWdyYWRpZW50KDExMDBweCA2NTBweCBhdCA3OCUgNzIlLCByZ2JhKDQzLDIxNywyNTUsMC4xNiksIHRyYW5zcGFyZW50IDY2JSksCiAgICAgIGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHZhcigtLWJnLWJsdWUpIDAlLCB2YXIoLS1iZy1kZWVwKSA0NSUsIHZhcigtLWJnLWJsdWUyKSAxMDAlKTsKICB9CgogIC8qID09PT09IFNMT1cgTkVPTiBNT1RJT04gTEFZRVIgKHZlcnkgc2xvdyBkcmlmdCkgPT09PT0gKi8KICAuYmctZHJpZnR7CiAgICBwb3NpdGlvbjpmaXhlZDsKICAgIGluc2V0Oi0yMiU7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgei1pbmRleDowOwogICAgYmFja2dyb3VuZDoKICAgICAgcmFkaWFsLWdyYWRpZW50KDk4MHB4IDU2MHB4IGF0IDMwJSAzMCUsIHJnYmEoMjU1LDQzLDIxNCwwLjIwKSwgdHJhbnNwYXJlbnQgNjAlKSwKICAgICAgcmFkaWFsLWdyYWRpZW50KDkyMHB4IDU2MHB4IGF0IDcwJSA3MCUsIHJnYmEoNDMsMjE3LDI1NSwwLjE4KSwgdHJhbnNwYXJlbnQgNjIlKTsKICAgIGZpbHRlcjogYmx1cigyMHB4KSBzYXR1cmF0ZSgxLjIpOwogICAgb3BhY2l0eTouODU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsMCwwKTsKICAgIGFuaW1hdGlvbjogYmdEcmlmdCAyMnMgZWFzZS1pbi1vdXQgaW5maW5pdGUgYWx0ZXJuYXRlOwogICAgbWl4LWJsZW5kLW1vZGU6IHNjcmVlbjsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm0sIG9wYWNpdHk7CiAgfQoKICBAa2V5ZnJhbWVzIGJnRHJpZnR7CiAgICAwJSAgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTIuNSUsIC0xLjUlKSBzY2FsZSgxLjAyKTsgfQogICAgNTAlICB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDIuNSUsICAxLjIlKSBzY2FsZSgxLjA1KTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC0xLjIlLCAyLjIlKSBzY2FsZSgxLjAzKTsgfQogIH0KCiAgLyogPT09PT0gUFVMU0UgTEFZRVIgKHN5bmNlZCB0byBsb2dvKSA9PT09PSAqLwogIC5iZy1wdWxzZXsKICAgIHBvc2l0aW9uOmZpeGVkOwogICAgaW5zZXQ6MDsKICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICB6LWluZGV4OjE7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC42cyBlYXNlOwogICAgbWl4LWJsZW5kLW1vZGU6IHNjcmVlbjsKICB9CgogIC8qIG9ubHkgc3RhcnQgcHVsc2luZyBvbmNlIGxvZ28gaXMgInJlYWR5IiAqLwogIGJvZHkubG9nby1vbiAuYmctcHVsc2V7CiAgICBvcGFjaXR5OjE7CiAgICBhbmltYXRpb246IGJnUHVsc2UgdmFyKC0tcHVsc2VEdXIpIGVhc2UtaW4tb3V0IGluZmluaXRlIHZhcigtLXB1bHNlRGVsYXkpOwogIH0KCiAgQGtleWZyYW1lcyBiZ1B1bHNlewogICAgMCUsMTAwJXsKICAgICAgZmlsdGVyOiBibHVyKDBweCkgc2F0dXJhdGUoMS4wNSk7CiAgICAgIG9wYWNpdHk6LjU1OwogICAgfQogICAgNTAlewogICAgICBmaWx0ZXI6IGJsdXIoMHB4KSBzYXR1cmF0ZSgxLjI1KTsKICAgICAgb3BhY2l0eTouODU7CiAgICB9CiAgfQoKICAuYmctcHVsc2U6OmJlZm9yZXsKICAgIGNvbnRlbnQ6IiI7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIGluc2V0Oi0xMCU7CiAgICBiYWNrZ3JvdW5kOgogICAgICByYWRpYWwtZ3JhZGllbnQoOTAwcHggNTIwcHggYXQgNTAlIDQ1JSwgcmdiYSgyNTUsNDMsMjE0LDAuMTEpLCB0cmFuc3BhcmVudCA2OCUpLAogICAgICByYWRpYWwtZ3JhZGllbnQoODYwcHggNTIwcHggYXQgNTIlIDUwJSwgcmdiYSg0MywyMTcsMjU1LDAuMTApLCB0cmFuc3BhcmVudCA3MCUpOwogICAgZmlsdGVyOiBibHVyKDE4cHgpOwogIH0KCiAgLyogPT09PT0gQ0lORU1BVElDIE5PSVNFIC8gR1JBSU4gPT09PT0gKi8KICAuZ3JhaW57CiAgICBwb3NpdGlvbjpmaXhlZDsKICAgIGluc2V0Oi0xNSU7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgei1pbmRleDozOwogICAgb3BhY2l0eTouMzI7CiAgICBtaXgtYmxlbmQtbW9kZTogb3ZlcmxheTsKICAgIGJhY2tncm91bmQ6CiAgICAgIHJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoMGRlZywgcmdiYSgyNTUsMjU1LDI1NSwwLjAyOCkgMCAxcHgsIHRyYW5zcGFyZW50IDFweCAzcHgpLAogICAgICByZXBlYXRpbmctbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDI1NSwyNTUsMjU1LDAuMDIwKSAwIDFweCwgdHJhbnNwYXJlbnQgMXB4IDRweCksCiAgICAgIHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgNTAlIDUwJSwgcmdiYSgyNTUsMjU1LDI1NSwwLjAzKSwgdHJhbnNwYXJlbnQgNzAlKTsKICAgIGZpbHRlcjogY29udHJhc3QoMTE1JSkgYnJpZ2h0bmVzcygxMDUlKTsKICAgIGFuaW1hdGlvbjogZ3JhaW5Nb3ZlIDZzIHN0ZXBzKDgpIGluZmluaXRlOwogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsKICB9CgogIEBrZXlmcmFtZXMgZ3JhaW5Nb3ZlewogICAgMCUgICB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDAsMCkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICAxMCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTIlLCAxJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICAyMCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTQlLCAtMiUpIHJvdGF0ZSgwLjAxZGVnKTsgfQogICAgMzAlICB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDMlLCAyJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICA0MCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMSUsIC0zJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICA1MCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTMlLCAzJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICA2MCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoNCUsIDElKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDcwJSAgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgyJSwgLTIlKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDgwJSAgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtMiUsIDIlKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDkwJSAgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgzJSwgLTElKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgwLDApIHJvdGF0ZSgwLjAxZGVnKTsgfQogIH0KCiAgLyogPT09PT0gSU5UUk8gUE9QVVAgPT09PT0gKi8KICAuaW50cm8tbGF5ZXJ7CiAgICBwb3NpdGlvbjpmaXhlZDsgaW5zZXQ6MDsgei1pbmRleDoxMDsKICAgIGRpc3BsYXk6Z3JpZDsgcGxhY2UtaXRlbXM6Y2VudGVyOwogICAgYmFja2dyb3VuZDoKICAgICAgcmFkaWFsLWdyYWRpZW50KDEyMDBweCA4MDBweCBhdCA1MCUgNTAlLCByZ2JhKDAsMCwwLC40OCksIHRyYW5zcGFyZW50IDcwJSksCiAgICAgIGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoNCwxMCwzMiwuOTApIDAlLCByZ2JhKDAsMCwwLC45NSkgMTAwJSk7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNnB4KSBzYXR1cmF0ZSgxLjA1KTsKICAgIHRyYW5zaXRpb246IG9wYWNpdHkgLjdzIGVhc2UsIHRyYW5zZm9ybSAuN3MgY3ViaWMtYmV6aWVyKC4yLC44LC4yLDEpLCBmaWx0ZXIgLjdzIGVhc2U7CiAgfQoKICAuaW50cm8tY2FyZHsKICAgIHdpZHRoOm1pbig4NnZ3LDUyMHB4KTsKICAgIGJvcmRlci1yYWRpdXM6MjBweDsKICAgIHBhZGRpbmc6MjhweCAyNHB4IDIycHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCB2YXIoLS1nbGFzcyksIHJnYmEoMCwwLDAsLjE4KSk7CiAgICBib3JkZXI6MXB4IHNvbGlkIHJnYmEoNDEsMTgyLDI1NSwuNTUpOwogICAgYm94LXNoYWRvdzoKICAgICAgMCAwIDI0cHggcmdiYSg0MSwxODIsMjU1LC4xOCksCiAgICAgIDAgMCA4MHB4IHJnYmEoMjU1LDQzLDIxNCwuMTApLAogICAgICAwIDAgMTMwcHggcmdiYSg0MywyMTcsMjU1LC4wOCk7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTZweCkgc2NhbGUoLjk4KTsKICAgIG9wYWNpdHk6MDsKICAgIGZpbHRlcjogYmx1cig4cHgpOwogICAgdHJhbnNpdGlvbjoKICAgICAgb3BhY2l0eSAuNjVzIGVhc2UsCiAgICAgIHRyYW5zZm9ybSAuNzVzIGN1YmljLWJlemllciguMiwuOCwuMiwxKSwKICAgICAgZmlsdGVyIC43NXMgZWFzZTsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm0sIG9wYWNpdHksIGZpbHRlcjsKICB9CiAgLmludHJvLWNhcmQuc2hvd3sKICAgIG9wYWNpdHk6MTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKSBzY2FsZSgxKTsKICAgIGZpbHRlcjogYmx1cigwKTsKICB9CgogIC5oZXJvLW5hbWV7CiAgICBtYXJnaW46NnB4IDAgMnB4OwogICAgdGV4dC1hbGlnbjpjZW50ZXI7CiAgICBmb250LXNpemU6Y2xhbXAoMThweCw0LjZ2dyw0MHB4KTsKICAgIGZvbnQtd2VpZ2h0OjY1MDsKICAgIGxldHRlci1zcGFjaW5nOi0uMDJlbTsKICAgIGNvbG9yOnJnYmEoMjU1LDI1NSwyNTUsLjkyKTsKICAgIHRleHQtc2hhZG93OiAwIDAgMTBweCByZ2JhKDI1NSwyNTUsMjU1LC4xOCk7CiAgfQoKICAuc3VibGluZXsKICAgIHRleHQtYWxpZ246Y2VudGVyOwogICAgbWFyZ2luOjhweCAwIDE4cHg7CiAgICBmb250LWZhbWlseToiTW9udHNlcnJhdCIsIHN5c3RlbS11aSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICBmb250LXdlaWdodDo4MDA7CiAgICBsZXR0ZXItc3BhY2luZzoxLjFlbTsKICAgIGZvbnQtc2l6ZTpjbGFtcCgxMHB4LDJ2dywxNHB4KTsKICAgIGNvbG9yOnJnYmEoMjU1LDI1NSwyNTUsLjUwKTsKICAgIHRleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTsKICB9CgogIC5jdGF7IGRpc3BsYXk6ZmxleDsganVzdGlmeS1jb250ZW50OmNlbnRlcjsgfQogIC5jdGEgYnV0dG9uewogICAgY3Vyc29yOnBvaW50ZXI7CiAgICBib3JkZXI6bm9uZTsKICAgIHBhZGRpbmc6MTJweCAyMnB4OwogICAgYm9yZGVyLXJhZGl1czoxNnB4OwogICAgZm9udC13ZWlnaHQ6ODUwOwogICAgbGV0dGVyLXNwYWNpbmc6LjMyZW07CiAgICBmb250LWZhbWlseToiTW9udHNlcnJhdCIsIHN5c3RlbS11aSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICB0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7CiAgICBjb2xvcjp2YXIoLS13aGl0ZSk7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHZhcigtLW5lb24tcGluayksIHZhcigtLW5lb24tY3lhbikpOwogICAgYm94LXNoYWRvdzoKICAgICAgMCAwIDEycHggcmdiYSgyNTUsNDMsMjE0LC42MCksCiAgICAgIDAgMCAyNnB4IHJnYmEoNDMsMjE3LDI1NSwuNDUpLAogICAgICAwIDAgNjBweCByZ2JhKDQzLDIxNywyNTUsLjI1KTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKSBzY2FsZSgxKTsKICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAuMjJzIGVhc2UsIGZpbHRlciAuMjJzIGVhc2UsIGJveC1zaGFkb3cgLjIycyBlYXNlOwogICAgcG9zaXRpb246cmVsYXRpdmU7CiAgICBpc29sYXRpb246aXNvbGF0ZTsKICB9CiAgLmN0YSBidXR0b246OmJlZm9yZXsKICAgIGNvbnRlbnQ6IiI7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIGluc2V0Oi0ycHg7CiAgICBib3JkZXItcmFkaXVzOjE4cHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMjU1LDQzLDIxNCwuODUpLCByZ2JhKDQzLDIxNywyNTUsLjc1KSk7CiAgICBmaWx0ZXI6IGJsdXIoMTJweCk7CiAgICBvcGFjaXR5Oi41NTsKICAgIHotaW5kZXg6LTE7CiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC4yMnMgZWFzZSwgZmlsdGVyIC4yMnMgZWFzZTsKICB9CiAgLmN0YSBidXR0b246aG92ZXJ7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCkgc2NhbGUoMS4wMSk7CiAgICBmaWx0ZXI6IGJyaWdodG5lc3MoMS4xKTsKICAgIGJveC1zaGFkb3c6CiAgICAgIDAgMCAxOHB4IHJnYmEoMjU1LDQzLDIxNCwuODApLAogICAgICAwIDAgMzhweCByZ2JhKDQzLDIxNywyNTUsLjU1KSwKICAgICAgMCAwIDkwcHggcmdiYSg0MywyMTcsMjU1LC4zNSk7CiAgfQogIC5jdGEgYnV0dG9uOmhvdmVyOjpiZWZvcmV7IG9wYWNpdHk6Ljg7IGZpbHRlcjogYmx1cigxNHB4KTsgfQogIC5jdGEgYnV0dG9uOmFjdGl2ZXsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApIHNjYWxlKC45OSk7IH0KCiAgLmludHJvLWxheWVyLmV4aXR7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMDIpOwogICAgZmlsdGVyOiBibHVyKDEwcHgpIGJyaWdodG5lc3MoMS4xNSk7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogIH0KCiAgLyogPT09PT0gTUFJTiBTVEFHRSA9PT09PSAqLwogIC5zdGFnZXsKICAgIHBvc2l0aW9uOmZpeGVkOyBpbnNldDowOwogICAgZGlzcGxheTpncmlkOyBwbGFjZS1pdGVtczpjZW50ZXI7CiAgICB6LWluZGV4OjI7CiAgICBwYWRkaW5nOiA2dmggNHZ3OwogICAgb3BhY2l0eTowOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDhweCk7CiAgICBmaWx0ZXI6IGJsdXIoOHB4KTsKICAgIHRyYW5zaXRpb246CiAgICAgIG9wYWNpdHkgLjc1cyBlYXNlLAogICAgICB0cmFuc2Zvcm0gLjg1cyBjdWJpYy1iZXppZXIoLjIsLjgsLjIsMSksCiAgICAgIGZpbHRlciAuODVzIGVhc2UsCiAgICAgIHBhZGRpbmcgLjg1cyBlYXNlOwogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybSwgb3BhY2l0eSwgZmlsdGVyLCBwYWRkaW5nOwogIH0KICAuc3RhZ2UuYWN0aXZlewogICAgb3BhY2l0eToxOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOwogICAgZmlsdGVyOiBibHVyKDApOwogIH0KCiAgLmxvZ297CiAgICBwb3NpdGlvbjpyZWxhdGl2ZTsKICAgIHRleHQtYWxpZ246Y2VudGVyOwogICAgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDAgMjZweCByZ2JhKDI1NSw0MywyMTQsLjU1KSk7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVooMCk7CiAgICB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOwogIH0KCiAgLnRpdGxlewogICAgbWFyZ2luOjA7CiAgICBmb250LXNpemU6IGNsYW1wKDQ4cHgsIDIwdncsIDgwMHB4KTsKICAgIGxpbmUtaGVpZ2h0Oi44ODsKICAgIHdoaXRlLXNwYWNlOm5vd3JhcDsKICAgIGZvbnQtZmFtaWx5OiJCcnVzaCBTY3JpcHQgTVQiLCJCcnVzaCBTY3JpcHQgU3RkIixjdXJzaXZlOwogICAgZm9udC13ZWlnaHQ6NjAwOwogICAgbGV0dGVyLXNwYWNpbmc6LS4wM2VtOwogICAgY29sb3I6dmFyKC0td2hpdGUpOwogICAgLXdlYmtpdC10ZXh0LXN0cm9rZTouNHB4IHJnYmEoMjU1LDI1NSwyNTUsLjUpOwogICAgdGV4dC1zaGFkb3c6CiAgICAgIDAgMCAxOHB4IHJnYmEoMjU1LDQzLDIxNCwuODUpLAogICAgICAwIDAgNDBweCByZ2JhKDQzLDIxNywyNTUsLjU1KSwKICAgICAgMCAwIDRweCByZ2JhKDI1NSwyNTUsMjU1LC45NSk7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMThweCkgc2NhbGUoLjk4NSk7CiAgICB0cmFuc2l0aW9uOiBmb250LXNpemUgLjlzIGVhc2UsIGxldHRlci1zcGFjaW5nIC45cyBlYXNlOwogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybSwgb3BhY2l0eTsKICB9CgogIEBrZXlmcmFtZXMgbmVvbkJyZWF0aHsKICAgIDAlLDEwMCV7CiAgICAgIHRleHQtc2hhZG93OgogICAgICAgIDAgMCAxOHB4IHJnYmEoMjU1LDQzLDIxNCwuODUpLAogICAgICAgIDAgMCA0MHB4IHJnYmEoNDMsMjE3LDI1NSwuNTUpLAogICAgICAgIDAgMCA0cHggcmdiYSgyNTUsMjU1LDI1NSwxKTsKICAgICAgZmlsdGVyOiBzYXR1cmF0ZSgxLjA1KTsKICAgIH0KICAgIDUwJXsKICAgICAgdGV4dC1zaGFkb3c6CiAgICAgICAgMCAwIDMycHggcmdiYSgyNTUsNDMsMjE0LDEpLAogICAgICAgIDAgMCA3OHB4IHJnYmEoNDMsMjE3LDI1NSwuNzUpLAogICAgICAgIDAgMCA1cHggcmdiYSgyNTUsMjU1LDI1NSwxKTsKICAgICAgZmlsdGVyOiBzYXR1cmF0ZSgxLjIpOwogICAgfQogIH0KICAudGl0bGUucmVhZHl7CiAgICBvcGFjaXR5OjE7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCkgc2NhbGUoMSk7CiAgICBhbmltYXRpb246IG5lb25CcmVhdGggdmFyKC0tcHVsc2VEdXIpIGVhc2UtaW4tb3V0IGluZmluaXRlIHZhcigtLXB1bHNlRGVsYXkpOwogIH0KCiAgLnRpdGxlIC5sZXR0ZXJ7CiAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICAgIG9wYWNpdHk6MDsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgyNnB4KSBzY2FsZSguOTYpIHNrZXdZKDEuNWRlZyk7CiAgICBmaWx0ZXI6IGJsdXIoN3B4KTsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm0sIG9wYWNpdHksIGZpbHRlcjsKICB9CiAgLnRpdGxlIC5sZXR0ZXIuc2hvd3sKICAgIG9wYWNpdHk6MTsKICAgIHRyYW5zZm9ybTpub25lOwogICAgZmlsdGVyOiBibHVyKDApOwogICAgdHJhbnNpdGlvbjoKICAgICAgb3BhY2l0eSAuNjJzIGN1YmljLWJlemllciguMjIsLjYxLC4zNiwxKSwKICAgICAgdHJhbnNmb3JtIC43NHMgY3ViaWMtYmV6aWVyKC4yMiwuNjEsLjM2LDEpLAogICAgICBmaWx0ZXIgLjc0cyBlYXNlOwogIH0KICBAa2V5ZnJhbWVzIGZsb2F0eXsKICAgIDAleyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0KICAgIDUwJXsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0ycHgpOyB9CiAgICAxMDAleyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0KICB9CiAgLnRpdGxlIC5sZXR0ZXIuZmxvd3sgYW5pbWF0aW9uOiBmbG9hdHkgMy44cyBlYXNlLWluLW91dCBpbmZpbml0ZTsgfQoKICAuc3VidGl0bGV7CiAgICBmb250LWZhbWlseToiTW9udHNlcnJhdCIsIlNlZ29lIFVJIixBcmlhbCxzYW5zLXNlcmlmOwogICAgZm9udC13ZWlnaHQ6OTAwOwogICAgbGV0dGVyLXNwYWNpbmc6M3B4OwogICAgbWFyZ2luLXRvcDowOwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgdG9wOi0zNnB4OyAvKiBPTkxZIHN1YnRpdGxlIG1vdmVzIHVwICovCiAgICBmb250LXNpemU6Y2xhbXAoMTZweCwzdncsNDhweCk7CiAgICB0ZXh0LXNoYWRvdzoKICAgICAgMCAwIDEwcHggcmdiYSgyNTUsNDMsMjE0LC4zNSksCiAgICAgIDAgMCAxNHB4IHJnYmEoMjU1LDI1NSwyNTUsLjM1KSwKICAgICAgMCAwIDMwcHggcmdiYSg0MywyMTcsMjU1LC42NSk7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTJweCk7CiAgICB0cmFuc2l0aW9uOgogICAgICBvcGFjaXR5IC45NXMgZWFzZSwKICAgICAgdHJhbnNmb3JtIDFzIGVhc2UsCiAgICAgIHRvcCAuODVzIGVhc2UsCiAgICAgIGZvbnQtc2l6ZSAuOXMgZWFzZSwKICAgICAgbGV0dGVyLXNwYWNpbmcgLjlzIGVhc2U7Cn0KICAuc3VidGl0bGUuc2hvd3sgb3BhY2l0eToxOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0KCiAgLyogPT09PT0gQ09NUEFDVCBTVEFURSA9PT09PSAqLwogIC5zdGFnZS5jb21wYWN0ewogICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAganVzdGlmeS1pdGVtczpjZW50ZXI7CiAgICBwYWRkaW5nLXRvcDogMDsKICAgIHBhZGRpbmctbGVmdDogNHZ3OwogICAgcGFkZGluZy1yaWdodDogNHZ3Owp9CiAgLnRpdGxlLmNvbXBhY3R7CiAgZm9udC1zaXplOiBpbmhlcml0OwogIGxldHRlci1zcGFjaW5nOiBpbmhlcml0Owp9CiAgLnN1YnRpdGxlLmNvbXBhY3R7CiAgdG9wOi0xNHB4OwogIGZvbnQtc2l6ZTogaW5oZXJpdDsKICBsZXR0ZXItc3BhY2luZzogaW5oZXJpdDsKfQoKICAubG9nby5jb21wYWN0TGlmdHsKICAgIGFuaW1hdGlvbjogbGlmdEdsb3cgLjg1cyBjdWJpYy1iZXppZXIoLjIsLjgsLjIsMSkgYm90aDsKICB9CiAgQGtleWZyYW1lcyBsaWZ0R2xvd3sKICAgIDAleyBmaWx0ZXI6IGRyb3Atc2hhZG93KDAgMCAyNnB4IHJnYmEoMjU1LDQzLDIxNCwuNTUpKTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApIHNjYWxlKDEpOyB9CiAgICA2MCV7IGZpbHRlcjogZHJvcC1zaGFkb3coMCAwIDQ0cHggcmdiYSgyNTUsNDMsMjE0LC43MikpIGRyb3Atc2hhZG93KDAgMCAzNHB4IHJnYmEoNDMsMjE3LDI1NSwuNDUpKTsgfQogICAgMTAwJXsgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDAgMzBweCByZ2JhKDI1NSw0MywyMTQsLjU1KSkgZHJvcC1zaGFkb3coMCAwIDIwcHggcmdiYSg0MywyMTcsMjU1LC4zMikpOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCkgc2NhbGUoMSk7IH0KICB9CgogIC8qIGFjY2Vzc2liaWxpdHkgKi8KICBAbWVkaWEgKHByZWZlcnMtcmVkdWNlZC1tb3Rpb246IHJlZHVjZSl7CiAgICAqeyBhbmltYXRpb246bm9uZSAhaW1wb3J0YW50OyB0cmFuc2l0aW9uOm5vbmUgIWltcG9ydGFudDsgfQogICAgLmJnLWRyaWZ0LCAuZ3JhaW57IGFuaW1hdGlvbjpub25lICFpbXBvcnRhbnQ7IH0KICAgIC5iZy1wdWxzZXsgb3BhY2l0eTowICFpbXBvcnRhbnQ7IH0KICB9CgogIC8qID09PT09IElNUEFDVCBMSU5FUyBCVVJTVCAob24gSU5TRVJUKSA9PT09PSAqLwogICNidXJzdENhbnZhc3sKICAgIHBvc2l0aW9uOmZpeGVkOwogICAgaW5zZXQ6MDsKICAgIHdpZHRoOjEwMHZ3OwogICAgaGVpZ2h0OjEwMHZoOwogICAgei1pbmRleDogMTsKICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC4yNXMgZWFzZTsKICB9CiAgYm9keS5idXJzdC1vbiAjYnVyc3RDYW52YXN7IG9wYWNpdHk6MTsgfQoKPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KCiAgPCEtLSBiYWNrZ3JvdW5kIGxheWVycyAtLT4KICA8ZGl2IGNsYXNzPSJiZy1kcmlmdCIgYXJpYS1oaWRkZW49InRydWUiPjwvZGl2PgogIDxkaXYgY2xhc3M9ImJnLXB1bHNlIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9kaXY+CiAgPGRpdiBjbGFzcz0iZ3JhaW4iIGFyaWEtaGlkZGVuPSJ0cnVlIj48L2Rpdj4KICA8Y2FudmFzIGlkPSJidXJzdENhbnZhcyIgYXJpYS1oaWRkZW49InRydWUiPjwvY2FudmFzPgoKCiAgPCEtLSBJTlRSTyAtLT4KICA8ZGl2IGNsYXNzPSJpbnRyby1sYXllciIgaWQ9ImludHJvIj4KICAgIDxkaXYgY2xhc3M9ImludHJvLWNhcmQiIGlkPSJpbnRyb0NhcmQiPgogICAgICA8aDIgY2xhc3M9Imhlcm8tbmFtZSI+SkFNRVMgUklHQVM8L2gyPgogICAgICA8ZGl2IGNsYXNzPSJzdWJsaW5lIj5QUkVTRU5UUzwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjdGEiPjxidXR0b24gaWQ9ImdvQnRuIj5JTlNFUlQ8L2J1dHRvbj48L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8IS0tIE1BSU4gLS0+CiAgPGRpdiBjbGFzcz0ic3RhZ2UiIGlkPSJzdGFnZSIgYXJpYS1oaWRkZW49InRydWUiPgogICAgPGRpdiBjbGFzcz0ibG9nbyIgaWQ9ImxvZ28iPgogICAgICA8aDEgY2xhc3M9InRpdGxlIiBpZD0idGl0bGUiPkV1cGhvcmlhPC9oMT4KICAgICAgPGRpdiBjbGFzcz0ic3VidGl0bGUiIGlkPSJzdWJ0aXRsZSI+T05MSU5FIE1VU0lDIEFXQVJEUyAyMDI2PC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCjxzY3JpcHQ+CigoKSA9PiB7CiAgY29uc3QgaW50cm8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW50cm8nKTsKICBjb25zdCBjYXJkICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnRyb0NhcmQnKTsKICBjb25zdCBnb0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb0J0bicpOwoKICBjb25zdCBzdGFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFnZScpOwogIGNvbnN0IGxvZ28gID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ28nKTsKICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZScpOwogIGNvbnN0IHN1YnRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1YnRpdGxlJyk7CgogIC8vIHNob3cgcG9wdXAgYWZ0ZXIgMnMKICBzZXRUaW1lb3V0KCgpID0+IGNhcmQuY2xhc3NMaXN0LmFkZCgnc2hvdycpLCAyMDAwKTsKCiAgZnVuY3Rpb24gbGF1bmNoTWFpbigpewogICAgCiAgICBzdGFydEJ1cnN0KCk7CmdvQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgIGludHJvLmNsYXNzTGlzdC5hZGQoJ2V4aXQnKTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgaW50cm8uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgc3RhZ2UuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgIHN0YWdlLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTsKICAgICAgc3RhcnRMb2dvKCk7CgogICAgICAvLyBjb21wYWN0IG1vZGUgZGlzYWJsZWQg4oCTIGxvZ28gc2l6ZSBsb2NrZWQKCiAgICB9LCA2NTApOwogIH0KICBnb0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGxhdW5jaE1haW4pOwogIC8vIEFVVE8tU1RBUlQgKGZvciBjb21iaW5lZCBpbnRybykKICBzZXRUaW1lb3V0KCgpID0+IHsgdHJ5eyBpZihnb0J0biAmJiAhZ29CdG4uZGlzYWJsZWQpIGxhdW5jaE1haW4oKTsgfWNhdGNoKGUpe30gfSwgMjQwMCk7CgoKICAKICAvKiA9PT09PSAxMDAgTElORVMgQlVSU1QgKHNwYXduIGF0IGNlbnRlciwgYm91bmNlL3JlZmxlY3Qgb24gZWRnZXMpID09PT09ICovCiAgY29uc3QgYnVyc3RDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVyc3RDYW52YXMnKTsKICBjb25zdCBiY3R4ID0gYnVyc3RDYW52YXMuZ2V0Q29udGV4dCgnMmQnLCB7IGFscGhhOiB0cnVlIH0pOwoKICBsZXQgYnVyc3RSdW5uaW5nID0gZmFsc2U7CiAgbGV0IGJ1cnN0UGFydHMgPSBbXTsKICBsZXQgYnVyc3RSQUYgPSAwOwogIGxldCBidXJzdFN0YXJ0VCA9IDA7CgogIGZ1bmN0aW9uIHJlc2l6ZUJ1cnN0KCl7CiAgICBjb25zdCBkcHIgPSBNYXRoLm1heCgxLCBNYXRoLm1pbigyLCB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxKSk7CiAgICBidXJzdENhbnZhcy53aWR0aCAgPSBNYXRoLmZsb29yKHdpbmRvdy5pbm5lcldpZHRoICAqIGRwcik7CiAgICBidXJzdENhbnZhcy5oZWlnaHQgPSBNYXRoLmZsb29yKHdpbmRvdy5pbm5lckhlaWdodCAqIGRwcik7CiAgICBidXJzdENhbnZhcy5zdHlsZS53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoICsgJ3B4JzsKICAgIGJ1cnN0Q2FudmFzLnN0eWxlLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCArICdweCc7CiAgICBiY3R4LnNldFRyYW5zZm9ybShkcHIsIDAsIDAsIGRwciwgMCwgMCk7CiAgfQogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCByZXNpemVCdXJzdCwgeyBwYXNzaXZlOnRydWUgfSk7CiAgcmVzaXplQnVyc3QoKTsKCiAgZnVuY3Rpb24gcmFuZChtaW4sIG1heCl7IHJldHVybiBtaW4gKyBNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbik7IH0KCiAgZnVuY3Rpb24gbWFrZVBhcnQoKXsKICAgIGNvbnN0IGN4ID0gd2luZG93LmlubmVyV2lkdGggKiAwLjU7CiAgICBjb25zdCBjeSA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuNTsKCiAgICAvLyByYW5kb20gZGlyZWN0aW9uIGZyb20gY2VudGVyCiAgICBjb25zdCBhbmcgPSByYW5kKDAsIE1hdGguUEkgKiAyKTsKICAgIGNvbnN0IHNwZWVkID0gcmFuZCg1MjAsIDk4MCk7IC8vIHB4L3NlYwogICAgY29uc3QgdnggPSBNYXRoLmNvcyhhbmcpICogc3BlZWQ7CiAgICBjb25zdCB2eSA9IE1hdGguc2luKGFuZykgKiBzcGVlZDsKCiAgICByZXR1cm4gewogICAgICB4OiBjeCwgeTogY3ksCiAgICAgIHZ4LCB2eSwKICAgICAgbGVuOiByYW5kKDE4LCA1NiksCiAgICAgIHc6IHJhbmQoMS4wLCAyLjQpLAogICAgICBnbG93OiByYW5kKDAuMTgsIDAuNDIpLAogICAgICBhbHBoYTogMSwKICAgICAgaHVlTWl4OiBNYXRoLnJhbmRvbSgpIDwgMC41ID8gJ3BpbmsnIDogJ2N5YW4nCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gZHJhd1BhcnQocCl7CiAgICAvLyBkcmF3IGEgc2hvcnQgbGluZSBvcmllbnRlZCBhbG9uZyB2ZWxvY2l0eSBkaXJlY3Rpb24KICAgIGNvbnN0IGEgPSBNYXRoLmF0YW4yKHAudnksIHAudngpOwogICAgY29uc3QgZHggPSBNYXRoLmNvcyhhKSAqIHAubGVuICogMC41OwogICAgY29uc3QgZHkgPSBNYXRoLnNpbihhKSAqIHAubGVuICogMC41OwoKICAgIC8vIG5lb24taXNoIHN0cm9rZSArIHNvZnQgZ2xvdyAod2l0aG91dCBjaGFuZ2luZyBnbG9iYWwgcGFsZXR0ZSkKICAgIGJjdHgubGluZVdpZHRoID0gcC53OwogICAgYmN0eC5nbG9iYWxBbHBoYSA9IHAuYWxwaGE7CgogICAgLy8gbWFpbiBsaW5lCiAgICBiY3R4LnNoYWRvd0JsdXIgPSAxODsKICAgIGJjdHguc2hhZG93Q29sb3IgPSBwLmh1ZU1peCA9PT0gJ3BpbmsnID8gJ3JnYmEoMjU1LDQzLDIxNCwuODUpJyA6ICdyZ2JhKDQzLDIxNywyNTUsLjg1KSc7CiAgICBiY3R4LnN0cm9rZVN0eWxlID0gcC5odWVNaXggPT09ICdwaW5rJyA/ICdyZ2JhKDI1NSw0MywyMTQsLjg1KScgOiAncmdiYSg0MywyMTcsMjU1LC44NSknOwogICAgYmN0eC5iZWdpblBhdGgoKTsKICAgIGJjdHgubW92ZVRvKHAueCAtIGR4LCBwLnkgLSBkeSk7CiAgICBiY3R4LmxpbmVUbyhwLnggKyBkeCwgcC55ICsgZHkpOwogICAgYmN0eC5zdHJva2UoKTsKCiAgICAvLyB3aGl0ZSBob3QgY29yZQogICAgYmN0eC5zaGFkb3dCbHVyID0gMTA7CiAgICBiY3R4LnNoYWRvd0NvbG9yID0gJ3JnYmEoMjU1LDI1NSwyNTUsLjc1KSc7CiAgICBiY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMjU1LDI1NSwyNTUsLjc1KSc7CiAgICBiY3R4LmxpbmVXaWR0aCA9IE1hdGgubWF4KDAuOCwgcC53ICogMC41NSk7CiAgICBiY3R4LmJlZ2luUGF0aCgpOwogICAgYmN0eC5tb3ZlVG8ocC54IC0gZHggKiAwLjksIHAueSAtIGR5ICogMC45KTsKICAgIGJjdHgubGluZVRvKHAueCArIGR4ICogMC45LCBwLnkgKyBkeSAqIDAuOSk7CiAgICBiY3R4LnN0cm9rZSgpOwogIH0KCiAgZnVuY3Rpb24gc3RlcEJ1cnN0KHQpewogICAgaWYoIWJ1cnN0UnVubmluZykgcmV0dXJuOwoKICAgIGNvbnN0IG5vdyA9IHQgfHwgcGVyZm9ybWFuY2Uubm93KCk7CiAgICBjb25zdCBkdCA9IE1hdGgubWluKDAuMDIyLCAobm93IC0gKHN0ZXBCdXJzdC5fbHQgfHwgbm93KSkgLyAxMDAwKTsKICAgIHN0ZXBCdXJzdC5fbHQgPSBub3c7CgogICAgLy8gZmFkZSB0cmFpbAogICAgYmN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLW92ZXInOwogICAgYmN0eC5nbG9iYWxBbHBoYSA9IDE7CiAgICBiY3R4LmNsZWFyUmVjdCgwLCAwLCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTsKCiAgICBjb25zdCBXID0gd2luZG93LmlubmVyV2lkdGgsIEggPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CgogICAgZm9yKGNvbnN0IHAgb2YgYnVyc3RQYXJ0cyl7CiAgICAgIHAueCArPSBwLnZ4ICogZHQ7CiAgICAgIHAueSArPSBwLnZ5ICogZHQ7CgogICAgICAvLyBib3VuY2UvcmVmbGVjdCBvbiBlZGdlcwogICAgICBjb25zdCBwYWQgPSAyOwogICAgICBpZihwLnggPD0gcGFkKXsgcC54ID0gcGFkOyBwLnZ4ICo9IC0xOyB9CiAgICAgIGlmKHAueCA+PSBXIC0gcGFkKXsgcC54ID0gVyAtIHBhZDsgcC52eCAqPSAtMTsgfQogICAgICBpZihwLnkgPD0gcGFkKXsgcC55ID0gcGFkOyBwLnZ5ICo9IC0xOyB9CiAgICAgIGlmKHAueSA+PSBIIC0gcGFkKXsgcC55ID0gSCAtIHBhZDsgcC52eSAqPSAtMTsgfQoKICAgICAgLy8gc3VidGxlIGVuZXJneSBsb3NzCiAgICAgIHAudnggKj0gMC45OTg7CiAgICAgIHAudnkgKj0gMC45OTg7CgogICAgICBkcmF3UGFydChwKTsKICAgIH0KICAgIGJ1cnN0UkFGID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHN0ZXBCdXJzdCk7CiAgfQoKICBmdW5jdGlvbiBzdGFydEJ1cnN0KCl7CiAgICAvLyByZXNwZWN0IHJlZHVjZWQgbW90aW9uCiAgICBpZiAod2luZG93Lm1hdGNoTWVkaWEgJiYgd2luZG93Lm1hdGNoTWVkaWEoJyhwcmVmZXJzLXJlZHVjZWQtbW90aW9uOiByZWR1Y2UpJykubWF0Y2hlcykgcmV0dXJuOwoKICAgIHJlc2l6ZUJ1cnN0KCk7CiAgICBidXJzdFBhcnRzID0gW107CiAgICBmb3IobGV0IGk9MDsgaTwxMDA7IGkrKykgYnVyc3RQYXJ0cy5wdXNoKG1ha2VQYXJ0KCkpOwoKICAgIGJ1cnN0UnVubmluZyA9IHRydWU7CiAgICBidXJzdFN0YXJ0VCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgc3RlcEJ1cnN0Ll9sdCA9IGJ1cnN0U3RhcnRUOwoKICAgIC8vIGNsZWFyCiAgICBiY3R4LmNsZWFyUmVjdCgwLDAsd2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2J1cnN0LW9uJyk7CiAgICBidXJzdFJBRiA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShzdGVwQnVyc3QpOwogIH0KCiAgZnVuY3Rpb24gc3RvcEJ1cnN0KCl7CiAgICBidXJzdFJ1bm5pbmcgPSBmYWxzZTsKICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGJ1cnN0UkFGKTsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnYnVyc3Qtb24nKTsKCiAgICAvLyBmYWRlIG91dCBxdWlja2x5IHRoZW4gY2xlYXIKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICBiY3R4LmNsZWFyUmVjdCgwLDAsd2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7CiAgICB9LCAyMjApOwogIH0KCgogIGZ1bmN0aW9uIHN0YXJ0TG9nbygpewogICAgY29uc3QgdGV4dCA9IHRpdGxlLnRleHRDb250ZW50LnRyaW0oKTsKICAgIHRpdGxlLnRleHRDb250ZW50ID0gJyc7CgogICAgY29uc3QgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgIGZvciAobGV0IGk9MDsgaTx0ZXh0Lmxlbmd0aDsgaSsrKXsKICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgc3Bhbi5jbGFzc05hbWUgPSAnbGV0dGVyJzsKICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IHRleHRbaV07CiAgICAgIGZyYWcuYXBwZW5kQ2hpbGQoc3Bhbik7CiAgICB9CiAgICB0aXRsZS5hcHBlbmRDaGlsZChmcmFnKTsKCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gewogICAgICB0aXRsZS5jbGFzc0xpc3QuYWRkKCdyZWFkeScpOwoKICAgICAgLy8gU1RBUlQgYmFja2dyb3VuZCBwdWxzZSBzeW5jZWQgd2l0aCBsb2dvCiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnbG9nby1vbicpOwogICAgfSk7CgogICAgY29uc3QgbGV0dGVycyA9IEFycmF5LmZyb20odGl0bGUucXVlcnlTZWxlY3RvckFsbCgnLmxldHRlcicpKTsKICAgIGNvbnN0IEJBU0VfREVMQVkgPSA0MiwgUkFORE9NX0pJVFRFUiA9IDkwLCBPVkVSTEFQX09GRlNFVCA9IDE4MDsKCiAgICBsZXR0ZXJzLmZvckVhY2goKGVsLCBpZHgpID0+IHsKICAgICAgY29uc3QgZGVsYXkgPSBpZHggKiBCQVNFX0RFTEFZICsgTWF0aC5yYW5kb20oKSAqIFJBTkRPTV9KSVRURVIgLSBPVkVSTEFQX09GRlNFVDsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gZWwuY2xhc3NMaXN0LmFkZCgnZmxvdycpLCAxODApOwogICAgICB9LCBNYXRoLm1heCgwLCBkZWxheSkpOwogICAgfSk7CgogICAgc2V0VGltZW91dCgoKSA9PiBzdWJ0aXRsZS5jbGFzc0xpc3QuYWRkKCdzaG93JyksCiAgICAgIE1hdGgubWF4KDkwMCwgbGV0dGVycy5sZW5ndGggKiBCQVNFX0RFTEFZICogMC43MikKICAgICk7CiAgfQoKICAKICAKICAvLyA9PT09PSBLRVlCT0FSRCBDT05UUk9MUyAoRU5URVIgPSBJTlNFUlQsIEVTQyA9IEZVTExTQ1JFRU4gVE9HR0xFKSA9PT09PQogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gewoKICAgIC8vIEVOVEVSID0gSU5TRVJUCiAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicpIHsKICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvQnRuJyk7CiAgICAgIGlmIChidG4gJiYgIWJ0bi5kaXNhYmxlZCkgewogICAgICAgIGJ0bi5jbGljaygpOwogICAgICB9CiAgICB9CgogICAgLy8gRVNDID0gRlVMTFNDUkVFTiBUT0dHTEUKICAgIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHsKICAgICAgLy8gTm90ZTogc29tZSBicm93c2VycyBtYXkgc3RpbGwgdXNlIEVTQyB0byBleGl0IGZ1bGxzY3JlZW4sIGJ1dCB0aGlzIHdvcmtzIHJlbGlhYmx5IHRvIEVOVEVSIGZ1bGxzY3JlZW4gd2hlbiBub3QgZnVsbHNjcmVlbi4KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCiAgICAgIGlmICghZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHsKICAgICAgICBpZiAoZWwucmVxdWVzdEZ1bGxzY3JlZW4pIGVsLnJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKSBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpOwogICAgICB9CiAgICB9CgogIH0pOwpmdW5jdGlvbiB0b2dnbGVGdWxsc2NyZWVuKCl7CiAgICBjb25zdCBkb2MgPSBkb2N1bWVudDsKICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgaWYgKCFkb2MuZnVsbHNjcmVlbkVsZW1lbnQgJiYKICAgICAgICAhZG9jLndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50ICYmCiAgICAgICAgIWRvYy5tb3pGdWxsU2NyZWVuRWxlbWVudCAmJgogICAgICAgICFkb2MubXNGdWxsc2NyZWVuRWxlbWVudCkgewoKICAgICAgaWYgKGVsLnJlcXVlc3RGdWxsc2NyZWVuKSBlbC5yZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICBlbHNlIGlmIChlbC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikgZWwud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4oKTsKICAgICAgZWxzZSBpZiAoZWwubW96UmVxdWVzdEZ1bGxTY3JlZW4pIGVsLm1velJlcXVlc3RGdWxsU2NyZWVuKCk7CiAgICAgIGVsc2UgaWYgKGVsLm1zUmVxdWVzdEZ1bGxzY3JlZW4pIGVsLm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTsKCiAgICB9IGVsc2UgewogICAgICBpZiAoZG9jLmV4aXRGdWxsc2NyZWVuKSBkb2MuZXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgZWxzZSBpZiAoZG9jLndlYmtpdEV4aXRGdWxsc2NyZWVuKSBkb2Mud2Via2l0RXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgZWxzZSBpZiAoZG9jLm1vekNhbmNlbEZ1bGxTY3JlZW4pIGRvYy5tb3pDYW5jZWxGdWxsU2NyZWVuKCk7CiAgICAgIGVsc2UgaWYgKGRvYy5tc0V4aXRGdWxsc2NyZWVuKSBkb2MubXNFeGl0RnVsbHNjcmVlbigpOwogICAgfQogIH0KCn0pKCk7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K";
  const MAIN_B64  = "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVsIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xIiAvPgogIDx0aXRsZT5OZW9uIEF3YXJkcyBGb3JtPC90aXRsZT4KICAKICA8c3R5bGU+CiAgICA6cm9vdHsKICAgICAgLS1iZzojMDcwODE3OwogICAgICAtLWJnMjojMDUwNjEyOwogICAgICAtLWNhcmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjA2KTsKICAgICAgLS1jYXJkMjogcmdiYSgyNTUsMjU1LDI1NSwuMDQpOwogICAgICAtLWJvcmRlcjogcmdiYSgyNTUsMjU1LDI1NSwuMTApOwogICAgICAtLXRleHQ6I2ZmZmZmZjsKICAgICAgLS1tdXRlZDogcmdiYSgyNTUsMjU1LDI1NSwuNzApOwogICAgICAtLW11dGVkMjogcmdiYSgyNTUsMjU1LDI1NSwuNTApOwoKICAgICAgLS1waW5rOiNmZjJlYTY7CiAgICAgIC0tYmx1ZTojMDBkMWZmOwoKICAgICAgLS1yaW5nOiAwIDAgMCAycHggcmdiYSgwLDIwOSwyNTUsLjMwKSwgMCAwIDI0cHggcmdiYSgyNTUsNDYsMTY2LC4xOCk7CiAgICAgIC0tc2hhZG93OiAwIDE0cHggNDBweCByZ2JhKDAsMCwwLC40NSk7CiAgICAgIC0tZ2xvdzogMCAwIDIwcHggcmdiYSgwLDIwOSwyNTUsLjIyKSwgMCAwIDI2cHggcmdiYSgyNTUsNDYsMTY2LC4xOCk7CiAgICAgIC0tcmFkaXVzOiAxOHB4OwogICAgfQoKICAgICp7IGJveC1zaXppbmc6Ym9yZGVyLWJveDsgfQogICAgaHRtbCxib2R5e292ZXJzY3JvbGwtYmVoYXZpb3IteTogY29udGFpbjsgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoOyBoZWlnaHQ6MTAwJTsgLXdlYmtpdC10ZXh0LXNpemUtYWRqdXN0OjEwMCU7IH0KICAgIGJvZHl7b3ZlcnNjcm9sbC1iZWhhdmlvci15OiBjb250YWluOyAtd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZzogdG91Y2g7CiAgICAgIG1hcmdpbjowOwogICAgICBjb2xvcjp2YXIoLS10ZXh0KTsKICAgICAgZm9udC1mYW1pbHk6IHVpLXNhbnMtc2VyaWYsIHN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgU2Vnb2UgVUksIFJvYm90bywgIkhlbHZldGljYSBOZXVlIiwgQXJpYWwsICJOb3RvIFNhbnMiLCAiQXBwbGUgQ29sb3IgRW1vamkiLCAiU2Vnb2UgVUkgRW1vamkiOwogICAgICBiYWNrZ3JvdW5kOgogICAgICAgIHJhZGlhbC1ncmFkaWVudCg5MDBweCA0MjBweCBhdCAxNSUgMTUlLCByZ2JhKDI1NSw0NiwxNjYsLjE4KSwgdHJhbnNwYXJlbnQgNjAlKSwKICAgICAgICByYWRpYWwtZ3JhZGllbnQoOTAwcHggNDIwcHggYXQgODUlIDIwJSwgcmdiYSgwLDIwOSwyNTUsLjE2KSwgdHJhbnNwYXJlbnQgNjAlKSwKICAgICAgICBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCB2YXIoLS1iZykgMCUsIHZhcigtLWJnMikgMTAwJSk7CiAgICAgIG92ZXJmbG93LXg6aGlkZGVuOwogICAgfQoKICAgIC8qIGNsZWFuIG5lb24gc2Nyb2xsYmFyICovCiAgICA6Oi13ZWJraXQtc2Nyb2xsYmFyeyB3aWR0aDoxMHB4OyBoZWlnaHQ6MTBweDsgfQogICAgOjotd2Via2l0LXNjcm9sbGJhci10aHVtYnsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgcmdiYSgyNTUsNDYsMTY2LC43NSksIHJnYmEoMCwyMDksMjU1LC43NSkpOwogICAgICBib3JkZXItcmFkaXVzOjk5OXB4OwogICAgfQogICAgOjotd2Via2l0LXNjcm9sbGJhci10cmFja3sgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwuMDYpOyB9CgogICAgYXsgY29sb3I6aW5oZXJpdDsgfQogICAgYnV0dG9uLCBpbnB1dHsgZm9udDppbmhlcml0OyBjb2xvcjppbmhlcml0OyB9CgogICAgLndyYXB7CiAgICAgIG1heC13aWR0aDogOTgwcHg7CiAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICBwYWRkaW5nOiAyNnB4IDE2cHggNjRweDsKICAgIH0KCiAgICAvKiA9PT09PSBIZWFkZXIgPT09PT0gKi8KICAgIC5oZWFkZXJ7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZ2FwOjE0cHg7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgbWFyZ2luLWJvdHRvbTogMTRweDsKICAgIH0KICAgIC5sb2dvewogICAgICB3aWR0aDo0MHB4OwogICAgICBoZWlnaHQ6NDBweDsKICAgICAgYm9yZGVyLXJhZGl1czogMTRweDsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSgyNTUsNDYsMTY2LC45NSksIHJnYmEoMCwyMDksMjU1LC45NSkpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1nbG93KTsKICAgIH0KICAgIGgxewogICAgICBtYXJnaW46MDsKICAgICAgZm9udC1zaXplOiBjbGFtcCgyMnB4LCAzdncsIDM0cHgpOwogICAgICBsZXR0ZXItc3BhY2luZzotMC4wMmVtOwogICAgfQogICAgLnN1YnRpdGxlewogICAgICBtYXJnaW46OHB4IDAgMDsKICAgICAgY29sb3I6IHZhcigtLW11dGVkKTsKICAgICAgbWF4LXdpZHRoOiA3NWNoOwogICAgICBsaW5lLWhlaWdodDogMS40NTsKICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgfQoKICAgIC8qID09PT09IFNpbXBsZSBzaGVsbC9jYXJkID09PT09ICovCiAgICAuY2FyZHsKICAgICAgYm9yZGVyLXJhZGl1czogMjJweDsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgdmFyKC0tY2FyZCkgMCUsIHZhcigtLWNhcmQyKSAxMDAlKTsKICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyKTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93KTsKICAgICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEycHgpOwogICAgfQoKICAgIC8qID09PT09IEhvbWUgZ3JpZCA9PT09PSAqLwogICAgLmdyaWQ0ewogICAgICBkaXNwbGF5OmdyaWQ7CiAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOwogICAgICBnYXA6IDEycHg7CiAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICB9CiAgICBAbWVkaWEgKG1pbi13aWR0aDogNjQwcHgpeyAuZ3JpZDR7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDIsIG1pbm1heCgwLDFmcikpOyB9IH0KICAgIEBtZWRpYSAobWluLXdpZHRoOiA5ODBweCl7IC5ncmlkNHsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoMywgbWlubWF4KDAsMWZyKSk7IH0gfQoKICAgIC5wZXJzb24tdGlsZXsgcG9zaXRpb246cmVsYXRpdmU7IH0KICAgIC5wZXJzb24tYnRuewogICAgICB3aWR0aDoxMDAlOwogICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LC4wNCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cyk7CiAgICAgIHBhZGRpbmc6IDE2cHggMTRweDsKICAgICAgY3Vyc29yOnBvaW50ZXI7CiAgICAgIHRleHQtYWxpZ246bGVmdDsKICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIC4xNHMgZWFzZSwgYm9yZGVyLWNvbG9yIC4xNHMgZWFzZSwgYmFja2dyb3VuZCAuMTRzIGVhc2UsIGJveC1zaGFkb3cgLjE0cyBlYXNlOwogICAgfQogICAgLnBlcnNvbi1idG46aG92ZXJ7CiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwuMDYpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjE2KTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tZ2xvdyk7CiAgICB9CiAgICAucGVyc29uLXRpdGxleyBmb250LXdlaWdodDo4MDA7IGZvbnQtc2l6ZToxNnB4OyB9CiAgICAucGVyc29uLXN1YnsgbWFyZ2luLXRvcDo2cHg7IGZvbnQtc2l6ZToxMnB4OyBjb2xvcjogdmFyKC0tbXV0ZWQyKTsgfQoKICAgIC5zeW5jLW1pbml7CiAgICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgICB0b3A6MTBweDsgcmlnaHQ6MTBweDsKICAgICAgcGFkZGluZzogOHB4IDEwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjE0KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwuMjUpOwogICAgICBjdXJzb3I6cG9pbnRlcjsKICAgICAgZm9udC1zaXplOjEycHg7CiAgICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxMHB4KTsKICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIC4xNHMgZWFzZSwgYm9yZGVyLWNvbG9yIC4xNHMgZWFzZSwgYmFja2dyb3VuZCAuMTRzIGVhc2UsIGJveC1zaGFkb3cgLjE0cyBlYXNlOwogICAgfQogICAgLnN5bmMtbWluaTpob3ZlcnsKICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjIyKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwuMzUpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1nbG93KTsKICAgIH0KICAgIC5zeW5jLW1pbmk6Zm9jdXN7IG91dGxpbmU6IG5vbmU7IGJveC1zaGFkb3c6IHZhcigtLXJpbmcpOyB9CgogICAgLyogPT09PT0gUGVyc29uIHZpZXcgdG9wYmFyID09PT09ICovCiAgICAudG9wYmFyewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGZsZXgtd3JhcDp3cmFwOwogICAgICBnYXA6IDEycHg7CiAgICAgIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7CiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgbWFyZ2luOiA4cHggMCAxNHB4OwogICAgfQoKICAgIC5iYWNrewogICAgICBib3JkZXI6bm9uZTsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgIHBhZGRpbmc6IDZweCAwOwogICAgICBjb2xvcjogdmFyKC0tbXV0ZWQpOwogICAgICBjdXJzb3I6cG9pbnRlcjsKICAgIH0KICAgIC5iYWNrOmhvdmVyeyBjb2xvcjogI2ZmZjsgfQoKICAgIC5hY3Rpb25zewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgZ2FwOiAxMHB4OwogICAgICBmbGV4LXdyYXA6d3JhcDsKICAgIH0KCiAgICAucGlsbHsKICAgICAgZGlzcGxheTppbmxpbmUtZmxleDsKICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICBnYXA6IDhweDsKICAgICAgcGFkZGluZzogMTBweCAxMnB4OwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwuMTgpOwogICAgICBjb2xvcjogdmFyKC0tbXV0ZWQpOwogICAgICBmb250LXNpemU6IDEycHg7CiAgICB9CiAgICAucGlsbCBzdHJvbmd7IGNvbG9yOiNmZmY7IGZvbnQtd2VpZ2h0OjgwMDsgfQoKICAgIC5hY3Rpb257CiAgICAgIHBhZGRpbmc6IDEwcHggMTJweDsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjE0KTsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSgyNTUsNDYsMTY2LC4xNiksIHJnYmEoMCwyMDksMjU1LC4xNCkpOwogICAgICBjdXJzb3I6cG9pbnRlcjsKICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIC4xNHMgZWFzZSwgYm94LXNoYWRvdyAuMTRzIGVhc2UsIGJvcmRlci1jb2xvciAuMTRzIGVhc2U7CiAgICB9CiAgICAuYWN0aW9uOmhvdmVyeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7IGJveC1zaGFkb3c6IHZhcigtLWdsb3cpOyBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjIyKTsgfQogICAgLmFjdGlvbjpmb2N1c3sgb3V0bGluZTpub25lOyBib3gtc2hhZG93OiB2YXIoLS1yaW5nKTsgfQoKICAgIC8qID09PT09IENhdGVnb3JpZXMgPT09PT0gKi8KICAgIC5jYXRzewogICAgICBkaXNwbGF5OmdyaWQ7CiAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOwogICAgICBnYXA6IDE0cHg7CiAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICB9CiAgICBAbWVkaWEgKG1pbi13aWR0aDogOTgwcHgpeyAuY2F0c3sgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOyB9IH0KCiAgICAuY2F0ewogICAgICBib3JkZXItcmFkaXVzOiAyMHB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LC4wNCk7CiAgICAgIHBhZGRpbmc6IDE0cHg7CiAgICB9CiAgICAuY2F0IGgyeyBtYXJnaW46MDsgZm9udC1zaXplOiAxNHB4OyBmb250LXdlaWdodDogODAwOyBsZXR0ZXItc3BhY2luZzogLjAxZW07IH0KICAgIC5zdGF0dXN7CiAgICAgIG1hcmdpbi10b3A6IDZweDsKICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICBjb2xvcjogdmFyKC0tbXV0ZWQyKTsKICAgIH0KICAgIC5zdGF0dXMub257IGNvbG9yOiByZ2JhKDAsMjA5LDI1NSwuOTApOyB9CgogICAgLmNhdC1oZWFkewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgZ2FwOiAxMHB4OwogICAgICBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OwogICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgfQoKICAgIC5taW5pewogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMTQpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4xOCk7CiAgICAgIHBhZGRpbmc6IDhweCAxMHB4OwogICAgICBmb250LXNpemU6IDEycHg7CiAgICAgIGN1cnNvcjpwb2ludGVyOwogICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gLjE0cyBlYXNlLCBib3gtc2hhZG93IC4xNHMgZWFzZSwgYmFja2dyb3VuZCAuMTRzIGVhc2UsIGJvcmRlci1jb2xvciAuMTRzIGVhc2U7CiAgICB9CiAgICAubWluaTpob3ZlcnsKICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4yOCk7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuMjIpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1nbG93KTsKICAgIH0KICAgIC5taW5pOmZvY3VzeyBvdXRsaW5lOm5vbmU7IGJveC1zaGFkb3c6IHZhcigtLXJpbmcpOyB9CgogICAgLmxpc3R7IGRpc3BsYXk6ZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgZ2FwOiA4cHg7IH0KICAgIC8qIFNjcm9sbCBpbnNpZGUgZWFjaCBjYXRlZ29yeSBib3ggKi8KICAgIC5saXN0eyBvdmVyZmxvdzphdXRvOyBtYXgtaGVpZ2h0OiBjbGFtcCgyNDBweCwgNTV2aCwgNTYwcHgpOyBwYWRkaW5nLXJpZ2h0OjRweDsgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoOyB0b3VjaC1hY3Rpb246IHBhbi15OyB9CiAgICAubGlzdC5ncmFieyBjdXJzb3I6IGdyYWI7IH0KICAgIC5saXN0LmdyYWJiaW5neyBjdXJzb3I6IGdyYWJiaW5nOyB9CiAgICAubGlzdDo6LXdlYmtpdC1zY3JvbGxiYXJ7IHdpZHRoOiAxMHB4OyB9CiAgICAubGlzdDo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWJ7IGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjE4KTsgYm9yZGVyLXJhZGl1czogOTk5cHg7IH0KCgogICAgLnJvd3sKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIGdhcDogMTBweDsKICAgICAgcGFkZGluZzogMTBweCAxMnB4OwogICAgICBib3JkZXItcmFkaXVzOiAxNnB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LC4xMCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsLjE2KTsKICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIC4xMnMgZWFzZSwgYm9yZGVyLWNvbG9yIC4xMnMgZWFzZSwgYm94LXNoYWRvdyAuMTJzIGVhc2UsIGJhY2tncm91bmQgLjEycyBlYXNlOwogICAgICBwb3NpdGlvbjpyZWxhdGl2ZTsKICAgIH0KICAgIC5yb3cuZHJhZy1lbmFibGVkOmhvdmVyewogICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuMTgpOwogICAgICBib3gtc2hhZG93OiAwIDAgMCAxcHggcmdiYSgwLDIwOSwyNTUsLjE1KSwgMCAwIDE4cHggcmdiYSgyNTUsNDYsMTY2LC4xMik7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsLjIwKTsKICAgIH0KICAgIC5yb3cuZHJhZ2dpbmd7CiAgICAgIG91dGxpbmU6IG5vbmU7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLXJpbmcpOwogICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMDEpOwogICAgfQoKICAgIC5oYW5kbGV7CiAgICAgIHdpZHRoOiAzNHB4OwogICAgICBoZWlnaHQ6IDM0cHg7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LC4xMik7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjA0KTsKICAgICAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjc1KTsKICAgICAgdXNlci1zZWxlY3Q6bm9uZTsKICAgIH0KICAgIC5yb3cuZHJhZy1lbmFibGVkIC5oYW5kbGV7IGN1cnNvcjogZ3JhYjsgfQogICAgLnJvdy5kcmFnLWVuYWJsZWQgLmhhbmRsZTphY3RpdmV7IGN1cnNvcjogZ3JhYmJpbmc7IH0KICAgIC5oYW5kbGUub2ZmeyBvcGFjaXR5OiAuNDU7IH0KCiAgICAubnVtewogICAgICB3aWR0aDogMjZweDsKICAgICAgdGV4dC1hbGlnbjpjZW50ZXI7CiAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjU1KTsKICAgICAgZm9udC12YXJpYW50LW51bWVyaWM6IHRhYnVsYXItbnVtczsKICAgIH0KCiAgICBpbnB1dC50ZXh0ewogICAgICBmbGV4OiAxOwogICAgICB3aWR0aDoxMDAlOwogICAgICBib3JkZXItcmFkaXVzOiAxNHB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LC4xMik7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjA0KTsKICAgICAgcGFkZGluZzogMTBweCAxMnB4OwogICAgICBvdXRsaW5lOm5vbmU7CiAgICB9CiAgICBpbnB1dC50ZXh0OjpwbGFjZWhvbGRlcnsgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjM1KTsgfQogICAgaW5wdXQudGV4dDpmb2N1c3sgYm94LXNoYWRvdzogdmFyKC0tcmluZyk7IGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQ7IH0KCiAgICAuc2NvcmV7CiAgICAgIHdpZHRoOiA2NHB4OwogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsKICAgIH0KICAgIC5iYWRnZXsKICAgICAgbWluLXdpZHRoOiA0NnB4OwogICAgICB0ZXh0LWFsaWduOmNlbnRlcjsKICAgICAgcGFkZGluZzogOHB4IDEwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LC4xMik7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjA0KTsKICAgICAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjcwKTsKICAgICAgZm9udC13ZWlnaHQ6IDgwMDsKICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICBmb250LXZhcmlhbnQtbnVtZXJpYzogdGFidWxhci1udW1zOwogICAgfQogICAgLnJvdy5kcmFnLWVuYWJsZWQgLmJhZGdlewogICAgICBjb2xvcjojZmZmOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjE4KTsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSgyNTUsNDYsMTY2LC43NSksIHJnYmEoMCwyMDksMjU1LC43NSkpOwogICAgICBib3gtc2hhZG93OiAwIDAgMTRweCByZ2JhKDAsMjA5LDI1NSwuMjIpLCAwIDAgMTRweCByZ2JhKDI1NSw0NiwxNjYsLjE4KTsKICAgIH0KCiAgICAuZ3JpZC1iZ3sgZGlzcGxheTpub25lOyB9CgogICAgLmhpbnR7CiAgICAgIG1hcmdpbi10b3A6IDEycHg7CiAgICAgIGNvbG9yOiB2YXIoLS1tdXRlZDIpOwogICAgICBmb250LXNpemU6IDEycHg7CiAgICAgIHBhZGRpbmc6IDAgMnB4OwogICAgfQoKICAgIC5oaWRkZW57IGRpc3BsYXk6bm9uZSAhaW1wb3J0YW50OyB9CiAgPC9zdHlsZT4KCjxzY3JpcHQ+CihmdW5jdGlvbigpewogIGZ1bmN0aW9uIHNhZmVXcmFwKGZuKXsKICAgIHJldHVybiBmdW5jdGlvbigpewogICAgICB0cnl7IHJldHVybiBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9Y2F0Y2goZSl7IHJldHVybiBudWxsOyB9CiAgICB9OwogIH0KICB0cnl7CiAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZSA9IHNhZmVXcmFwKGhpc3RvcnkucmVwbGFjZVN0YXRlKTsKICAgIGhpc3RvcnkucHVzaFN0YXRlID0gc2FmZVdyYXAoaGlzdG9yeS5wdXNoU3RhdGUpOwogIH1jYXRjaChlKXt9Cn0pKCk7Cjwvc2NyaXB0PgoKPC9oZWFkPgoKPGJvZHk+CiAgPGRpdiBjbGFzcz0id3JhcCI+CiAgICA8ZGl2IGlkPSJob21lVmlldyI+CiAgICAgIDxkaXYgY2xhc3M9ImhlYWRlciI+CiAgICAgICAgPGRpdiBjbGFzcz0ibG9nbyI+PC9kaXY+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxoMT5OZW9uIEF3YXJkcyBGb3JtPC9oMT4KICAgICAgICAgIDxwIGNsYXNzPSJzdWJ0aXRsZSI+CiAgICAgICAgICAgIM6UzrnOrM67zrXOvs61IM6sz4TOv868zr8uIM6azqzOuM61IM+DzrXOu86vzrTOsSDOrc+HzrXOuSAxMCDOus6xz4TOt86zzr/Pgc6vzrXPgiDOus6xzrkgzr/OuSDOs8+BzrHOvM68zq3PgiDPgM+Bzr/Pg86xz4HOvM+MzrbOv869z4TOsc65IM6xz4XPhM+MzrzOsc+EzrEgKM6xz4DPjCBFeGNlbCDOriDPh861zrnPgc6/zrrOr869zrfPhM6xKS4KICAgICAgICAgICAgzpzPjM67zrnPgiDPhc+AzqzPgc+Hzr/Phc69IDxzdHJvbmc+z4TOv8+FzrvOrM+HzrnPg8+Ezr/OvSAyPC9zdHJvbmc+IM+Dz4XOvM+AzrvOt8+Bz4nOvM6tzr3Ov865IM+Ezq/PhM67zr/OuSDPg861IM68zrnOsSDOus6xz4TOt86zzr/Pgc6vzrEsIM61zr3Otc+BzrPOv8+Azr/Ouc61zq/PhM6xzrkgZHJhZyAmIGRyb3AgzrrOsc+EzqzPhM6xzr7OtwogICAgICAgICAgICDOus6xzrkgzrzPgM6xzq/Ovc61zrkgzrHPhc+Ez4zOvM6xz4TOsSBzY29yZSAoMTLigJMxKS4KICAgICAgICAgIDwvcD4KICAgICAgICA8L2Rpdj4KICAgICAgICAKPGJ1dHRvbiBjbGFzcz0iYWN0aW9uIiBpZD0ic3RhdHNCdG4iIHRpdGxlPSLOo8+FzrPOus61zr3PhM+Bz4nPhM65zrrOrCDPg8+EzrHPhM65z4PPhM65zrrOrCAmIEV4cG9ydCBFeGNlbCI+CiAg8J+TiiBKYW1lcyBSaWdhcwo8L2J1dHRvbj4KCiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzcz0iIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImdyaWQ0IiBpZD0icGVvcGxlR3JpZCI+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzcz0iZ3JpZC1iZyI+PC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGlkPSJwZXJzb25WaWV3IiBjbGFzcz0iaGlkZGVuIj4KICAgICAgPGRpdiBjbGFzcz0idG9wYmFyIj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYmFjayIgaWQ9ImJhY2tCdG4iPuKGkCDOoM6vz4PPiTwvYnV0dG9uPgogICAgICAgICAgPGRpdiBjbGFzcz0iaGVhZGVyIiBzdHlsZT0ibWFyZ2luOjZweCAwIDA7Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9nbyIgc3R5bGU9IndpZHRoOjM0cHg7aGVpZ2h0OjM0cHg7Ij48L2Rpdj4KICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICA8aDEgaWQ9InBlcnNvblRpdGxlIiBzdHlsZT0iZm9udC1zaXplOiBjbGFtcCgyNHB4LCAzLjh2dywgMzhweCk7IG1hcmdpbjowOyI+PC9oMT4KICAgICAgICAgICAgICA8cCBjbGFzcz0ic3VidGl0bGUiIHN0eWxlPSJtYXJnaW4tdG9wOjZweDsiPgogICAgICAgICAgICAgICAgzqPPhc68z4DOu86uz4HPic+DzrUgz4TOuc+CIM6zz4HOsc68zrzOrc+CLiDOjM+EzrHOvSDPhc+AzqzPgc+Hzr/Phc69IDxzdHJvbmc+z4TOv8+FzrvOrM+HzrnPg8+Ezr/OvSAyPC9zdHJvbmc+IM+Dz4XOvM+AzrvOt8+Bz4nOvM6tzr3Ov865IM+Ezq/PhM67zr/OuSDPg861IM68zrnOsSDOus6xz4TOt86zzr/Pgc6vzrEsCiAgICAgICAgICAgICAgICDOvM+Azr/Pgc61zq/PgiDOvc6xIM66zqzOvc61zrnPgiBkcmFnICYgZHJvcCDOs865zrEgzrrOsc+EzqzPhM6xzr7OtyDOus6xzrkgz4TOvyBzY29yZSDOtc69zrfOvM61z4HPjs69zrXPhM6xzrkgzrHPhc+Ez4zOvM6xz4TOsSAoMc63PTEyLCAyzrc9MTAsIDPOtz04LCA0zrc9NywgLi4uKS4KICAgICAgICAgICAgICA8L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJwaWxsIiB0aXRsZT0iQXV0b3NhdmUgz4POtSBsb2NhbFN0b3JhZ2UiPgogICAgICAgICAgICA8c3Bhbj5BdXRvc2F2ZTo8L3NwYW4+IDxzdHJvbmc+T048L3N0cm9uZz4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYWN0aW9uIiBpZD0icmVzZXRBbGxCdG4iPlJlc2V0IM+MzrvOsTwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9IiI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXRzIiBpZD0iY2F0ZWdvcmllcyI+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzcz0iaGludCI+VGlwOiDOpM6/IGRyYWcgzrXOvc61z4HOs86/z4DOv865zrXOr8+EzrHOuSDOsc69zqwgzrrOsc+EzrfOs86/z4HOr86xIM+Mz4TOsc69IM+Fz4DOrM+Bz4fOv8+Fzr0gz4TOv8+FzrvOrM+HzrnPg8+Ezr/OvSAyIM+Dz4XOvM+AzrvOt8+Bz4nOvM6tzr3Ov865IM+Ezq/PhM67zr/OuS4gzqTOsSBzY29yZXMgzrzPgM6xzq/Ovc6/z4XOvSDOvM+Mzr3OvyDPg8+EzrnPgiDPg8+FzrzPgM67zrfPgc+JzrzOrc69zrXPgiDOs8+BzrHOvM68zq3Pgi48L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PgoKPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0veGxzeEAwLjE4LjUvZGlzdC94bHN4LmZ1bGwubWluLmpzIj48L3NjcmlwdD4KPHNjcmlwdD4KKCgpID0+IHsKICBjb25zdCBQRU9QTEUgPSBbCiAgICB7IGxhYmVsOiAiVGVyaSBWaSBTZW50aW8iLCBzbHVnOiAidGVyaS12aS1zZW50aW8iIH0sCiAgICB7IGxhYmVsOiAiTW9uaGlhIiwgc2x1ZzogIm1vbmhpYSIgfSwKICAgIHsgbGFiZWw6ICJMaXNqYW5zaSIsIHNsdWc6ICJsaXNqYW5zaSIgfSwKICBdOwoKICBjb25zdCBDQVRFR09SSUVTID0gWwogICAgIkJlc3QgZ3Igc29uZyIsCiAgICAiQmVzdCBmb3JlaWduIHNvbmciLAogICAgIkJlc3QgR1IgTWFsZSBBcnRpc3QiLAogICAgIkJlc3QgR1IgRmVtYWxlIEFydHNpcyIsCiAgICAiQmVzdCBGb3JlaWduIE1hbGUgQXJ0aXN0IiwKICAgICJCZXN0IEZvcmVpZ24gRmVtYWxlIEFydGlzdCIsCiAgICAiQmVzdCBHUiBtdXNpYyBWaWRlbyIsCiAgICAiQmVzdCBGb3JlaWduIE11c2ljIFZpZGVvIiwKICAgICJCZXN0IEVTQyAyMDI1IHBlcmZvbWFuY2UiLAogICAgIkJlc3QgQWxidW0gb2YgdGhlIFllYXIiLAogIF07CgogIC8vIFNjb3JpbmcgZm9yIHVwIHRvIDEwIHJhbmtlZCBpdGVtcyAoYXBwbGllcyB0byBmaWxsZWQgcm93cyBvbmx5KQogIGNvbnN0IFNDT1JFUyA9IFsxMiwgMTAsIDgsIDcsIDYsIDUsIDQsIDMsIDIsIDFdOwoKICBjb25zdCBxcyA9IChzZWwsIGVsPWRvY3VtZW50KSA9PiBlbC5xdWVyeVNlbGVjdG9yKHNlbCk7CgogIGNvbnN0IGhvbWVWaWV3ID0gcXMoIiNob21lVmlldyIpOwogIGNvbnN0IHBlcnNvblZpZXcgPSBxcygiI3BlcnNvblZpZXciKTsKICBjb25zdCBwZW9wbGVHcmlkID0gcXMoIiNwZW9wbGVHcmlkIik7CiAgY29uc3QgY2F0ZWdvcmllc0VsID0gcXMoIiNjYXRlZ29yaWVzIik7CiAgY29uc3QgcGVyc29uVGl0bGUgPSBxcygiI3BlcnNvblRpdGxlIik7CiAgY29uc3QgYmFja0J0biA9IHFzKCIjYmFja0J0biIpOwogIGNvbnN0IHJlc2V0QWxsQnRuID0gcXMoIiNyZXNldEFsbEJ0biIpOwoKICBsZXQgY3VycmVudFBlcnNvbiA9IG51bGw7CiAgbGV0IHN0YXRlID0gbnVsbDsgLy8geyBbY2F0ZWdvcnldOiBbIHtpZCx0ZXh0fSAuLi4gXSB9CiAgbGV0IGRyYWdDdHggPSB7IGNhdDogbnVsbCwgZHJhZ2dpbmdJZDogbnVsbCB9OwoKICAvLyBFeGNlbCBpbXBvcnQgKHBlciBwZXJzb24pCiAgbGV0IHBlbmRpbmdJbXBvcnRQZXJzb24gPSBudWxsOwoKICBjb25zdCBleGNlbElucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKICBleGNlbElucHV0LnR5cGUgPSAiZmlsZSI7CiAgZXhjZWxJbnB1dC5hY2NlcHQgPSAiLnhsc3gsLnhscyI7CiAgZXhjZWxJbnB1dC5jbGFzc05hbWUgPSAiaGlkZGVuIjsKICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGV4Y2VsSW5wdXQpOwoKICBleGNlbElucHV0LmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGFzeW5jICgpID0+IHsKICAgIGNvbnN0IGZpbGUgPSBleGNlbElucHV0LmZpbGVzICYmIGV4Y2VsSW5wdXQuZmlsZXNbMF07CiAgICBleGNlbElucHV0LnZhbHVlID0gIiI7IC8vIHJlc2V0IHNvIHRoZSBzYW1lIGZpbGUgY2FuIGJlIHBpY2tlZCBhZ2FpbgogICAgaWYgKCFmaWxlIHx8ICFwZW5kaW5nSW1wb3J0UGVyc29uKSByZXR1cm47CiAgICB0cnl7CiAgICAgIGF3YWl0IGltcG9ydEV4Y2VsRm9yUGVyc29uKGZpbGUsIHBlbmRpbmdJbXBvcnRQZXJzb24pOwogICAgICBhbGVydChgzojOs865zr3OtSDPg8+FzrPPh8+Bzr/Ovc65z4POvM+Mz4IgzrPOuc6xOiAke3BlbmRpbmdJbXBvcnRQZXJzb24ubGFiZWx9YCk7CiAgICB9Y2F0Y2goZXJyKXsKICAgICAgY29uc29sZS5lcnJvcihlcnIpOwogICAgICBhbGVydCgizpHPgM6/z4TPhc+Hzq/OsSDPg8+FzrPPh8+Bzr/Ovc65z4POvM6/z40uIM6SzrXOss6xzrnPjs+Dzr/PhSDPjM+Ezrkgz4TOvyBFeGNlbCDOtc6vzr3Osc65IM+Dz4nPg8+Ez4wgKC54bHN4KSDOus6xzrkgzrTOv866zq/OvM6xz4POtSDOvs6xzr3OrC4iKTsKICAgIH1maW5hbGx5ewogICAgICBwZW5kaW5nSW1wb3J0UGVyc29uID0gbnVsbDsKICAgIH0KICB9KTsKCiAgZnVuY3Rpb24gc3RhcnRFeGNlbEltcG9ydEZvcihwZXJzb24pewogICAgaWYgKHR5cGVvZiBYTFNYID09PSAidW5kZWZpbmVkIil7CiAgICAgIGFsZXJ0KCLOlM61zr0gzrLPgc6tzrjOt866zrUgzrcgzrLOuc6yzrvOuc6/zrjOrs66zrcgWExTWC4gzojOu861zrPOvs61IM+Mz4TOuSDOrc+HzrXOuc+CIM+Dz43Ovc60zrXPg863IM6uIM+Mz4TOuSDPhs6/z4HPhM+Ozr3Otc+EzrHOuSDPg8+Jz4PPhM6sIM+Ezr8geGxzeC5mdWxsLm1pbi5qcy4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgcGVuZGluZ0ltcG9ydFBlcnNvbiA9IHBlcnNvbjsKICAgIGV4Y2VsSW5wdXQuY2xpY2soKTsKICB9CgogIGZ1bmN0aW9uIG5vcm0ocyl7CiAgICByZXR1cm4gU3RyaW5nKHMgPz8gIiIpCiAgICAgIC50b0xvd2VyQ2FzZSgpCiAgICAgIC5yZXBsYWNlKC9bXFx1MjAwQi1cXHUyMDBEXFx1RkVGRl0vZywgIiIpCiAgICAgIC5yZXBsYWNlKC9bXmEtejAtOc6xLc+JzqzOrc6uzq/PjM+Nz47Pis+LzpDOsFxcc10vZ2ksICIgIikKICAgICAgLnJlcGxhY2UoL1xccysvZywgIiAiKQogICAgICAudHJpbSgpOwogIH0KCiAgZnVuY3Rpb24gbWFwRXhjZWxDYXRlZ29yeShyYXcpewogICAgY29uc3QgbiA9IG5vcm0ocmF3KTsKCiAgICBmb3IgKGNvbnN0IGMgb2YgQ0FURUdPUklFUyl7CiAgICAgIGlmIChub3JtKGMpID09PSBuKSByZXR1cm4gYzsKICAgIH0KCiAgICBpZiAobi5pbmNsdWRlcygiYmVzdCBncmVlayBzb25nIikgfHwgbi5pbmNsdWRlcygiYmVzdCBnciBzb25nIikgfHwgKG4uaW5jbHVkZXMoIs61zrvOu863zr0iKSAmJiBuLmluY2x1ZGVzKCLPhM+BzrHOs86/z4XOtCIpKSkKICAgICAgcmV0dXJuICJCZXN0IGdyIHNvbmciOwogICAgaWYgKG4uaW5jbHVkZXMoImJlc3QgZm9yZWlnbiBzb25nIikgfHwgKG4uaW5jbHVkZXMoIs6+zrXOvSIpICYmIG4uaW5jbHVkZXMoIs+Ez4HOsc6zzr/Phc60IikpKQogICAgICByZXR1cm4gIkJlc3QgZm9yZWlnbiBzb25nIjsKCiAgICBpZiAobi5pbmNsdWRlcygiYmVzdCBncmVlayBtYWxlIGFydGlzdCIpIHx8IG4uaW5jbHVkZXMoImJlc3QgZ3IgbWFsZSIpIHx8IChuLmluY2x1ZGVzKCLOtc67zrvOt869IikgJiYgbi5pbmNsdWRlcygizrHOvc60z4EiKSkpCiAgICAgIHJldHVybiAiQmVzdCBHUiBNYWxlIEFydGlzdCI7CiAgICBpZiAobi5pbmNsdWRlcygiYmVzdCBncmVlayBmZW1hbGUgYXJ0aXN0IikgfHwgbi5pbmNsdWRlcygiYmVzdCBnciBmZW1hbGUiKSB8fCAobi5pbmNsdWRlcygizrXOu867zrfOvSIpICYmIG4uaW5jbHVkZXMoIs6zz4XOvSIpKSkKICAgICAgcmV0dXJuICJCZXN0IEdSIEZlbWFsZSBBcnRzaXMiOwoKICAgIGlmIChuLmluY2x1ZGVzKCJiZXN0IGZvcmVpZ24gbWFsZSBhcnRpc3QiKSB8fCBuLmluY2x1ZGVzKCJiZXN0IGZvcmVpZ24gbWFsZSIpIHx8IChuLmluY2x1ZGVzKCLOvs61zr0iKSAmJiBuLmluY2x1ZGVzKCLOsc69zrTPgSIpKSkKICAgICAgcmV0dXJuICJCZXN0IEZvcmVpZ24gTWFsZSBBcnRpc3QiOwogICAgaWYgKG4uaW5jbHVkZXMoImJlc3QgZm9yZWlnbiBmZW1hbGUgYXJ0aXN0IikgfHwgbi5pbmNsdWRlcygiYmVzdCBmb3JlaWduIGZlbWFsZSIpIHx8IChuLmluY2x1ZGVzKCLOvs61zr0iKSAmJiBuLmluY2x1ZGVzKCLOs8+Fzr0iKSkpCiAgICAgIHJldHVybiAiQmVzdCBGb3JlaWduIEZlbWFsZSBBcnRpc3QiOwoKICAgIGlmIChuLmluY2x1ZGVzKCJiZXN0IGdyZWVrIG11c2ljIHZpZGVvIikgfHwgbi5pbmNsdWRlcygiYmVzdCBnciBtdXNpYyB2aWRlbyIpIHx8IChuLmluY2x1ZGVzKCLOtc67zrvOt869IikgJiYgbi5pbmNsdWRlcygizrLOuc69z4TOtSIpKSkKICAgICAgcmV0dXJuICJCZXN0IEdSIG11c2ljIFZpZGVvIjsKICAgIGlmIChuLmluY2x1ZGVzKCJiZXN0IGZvcmVpZ24gbXVzaWMgdmlkZW8iKSB8fCAobi5pbmNsdWRlcygizr7Otc69IikgJiYgbi5pbmNsdWRlcygizrLOuc69z4TOtSIpKSkKICAgICAgcmV0dXJuICJCZXN0IEZvcmVpZ24gTXVzaWMgVmlkZW8iOwoKICAgIGlmIChuLmluY2x1ZGVzKCJlc2MiKSAmJiAobi5pbmNsdWRlcygicGVyZm9ybWFuY2UiKSB8fCBuLmluY2x1ZGVzKCJwZXJmb21hbmNlIikgfHwgbi5pbmNsdWRlcygicGVyZiIpKSkKICAgICAgcmV0dXJuICJCZXN0IEVTQyAyMDI1IHBlcmZvbWFuY2UiOwoKICAgIGlmIChuLmluY2x1ZGVzKCJhbGJ1bSBvZiB0aGUgeWVhciIpIHx8IG4gPT09ICJhbGJ1bSIgfHwgbi5pbmNsdWRlcygizqzOu868z4AiKSkKICAgICAgcmV0dXJuICJCZXN0IEFsYnVtIG9mIHRoZSBZZWFyIjsKCiAgICByZXR1cm4gbnVsbDsKICB9CgogIGZ1bmN0aW9uIHN0b3JhZ2VLZXkoc2x1Zyl7IHJldHVybiBgbmVvbi1hd2FyZHM6JHtzbHVnfWA7IH0KCiAgZnVuY3Rpb24gdXVpZCgpIHsKICAgIGlmICh0eXBlb2YgY3J5cHRvICE9PSAidW5kZWZpbmVkIiAmJiBjcnlwdG8ucmFuZG9tVVVJRCkgcmV0dXJuIGNyeXB0by5yYW5kb21VVUlEKCk7CiAgICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygxNikuc2xpY2UoMikgKyAiLSIgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDE2KTsKICB9CgogIGZ1bmN0aW9uIG1ha2VEZWZhdWx0U3RhdGUoKXsKICAgIGNvbnN0IG9iaiA9IHt9OwogICAgZm9yIChjb25zdCBjYXQgb2YgQ0FURUdPUklFUyl7CiAgICAgIG9ialtjYXRdID0gQXJyYXkuZnJvbSh7bGVuZ3RoOjEwfSwgKF8saSkgPT4gKHsgaWQ6IGAke2NhdH1fXyR7aX1fXyR7dXVpZCgpfWAsIHRleHQ6ICIiIH0pKTsKICAgIH0KICAgIHJldHVybiBvYmo7CiAgfQoKICBmdW5jdGlvbiBlbnN1cmVDYXRlZ29yeUxlbmd0aChzdCwgY2F0LCBsZW4pewogICAgaWYgKCFBcnJheS5pc0FycmF5KHN0W2NhdF0pIHx8IHN0W2NhdF0ubGVuZ3RoIDwgMSl7CiAgICAgIHN0W2NhdF0gPSBBcnJheS5mcm9tKHtsZW5ndGg6MTB9LCAoXyxpKSA9PiAoeyBpZDogYCR7Y2F0fV9fJHtpfV9fJHt1dWlkKCl9YCwgdGV4dDogIiIgfSkpOwogICAgfQogICAgY29uc3QgY3VyID0gc3RbY2F0XS5sZW5ndGg7CgogICAgaWYgKGxlbiA+IGN1cil7CiAgICAgIGZvciAobGV0IGk9Y3VyOyBpPGxlbjsgaSsrKXsKICAgICAgICBzdFtjYXRdLnB1c2goeyBpZDogYCR7Y2F0fV9fJHtpfV9fJHt1dWlkKCl9YCwgdGV4dDogIiIgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChsZW4gPCBjdXIpewogICAgICBjb25zdCB0YWlsSGFzVGV4dCA9IHN0W2NhdF0uc2xpY2UobGVuKS5zb21lKHIgPT4gKHIudGV4dCB8fCAiIikudHJpbSgpLmxlbmd0aCA+IDApOwogICAgICBpZiAoIXRhaWxIYXNUZXh0KXsKICAgICAgICBzdFtjYXRdID0gc3RbY2F0XS5zbGljZSgwLCBsZW4pOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBsb2FkU3RhdGUoc2x1Zyl7CiAgICB0cnl7CiAgICAgIGNvbnN0IHJhdyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VLZXkoc2x1ZykpOwogICAgICBpZiAoIXJhdykgcmV0dXJuIG1ha2VEZWZhdWx0U3RhdGUoKTsKICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShyYXcpOwoKICAgICAgZm9yIChjb25zdCBjYXQgb2YgQ0FURUdPUklFUyl7CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBhcnNlZD8uW2NhdF0pIHx8IHBhcnNlZFtjYXRdLmxlbmd0aCA8IDEpewogICAgICAgICAgcGFyc2VkW2NhdF0gPSBBcnJheS5mcm9tKHtsZW5ndGg6MTB9LCAoXyxpKSA9PiAoeyBpZDogYCR7Y2F0fV9fJHtpfV9fJHt1dWlkKCl9YCwgdGV4dDogIiIgfSkpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHBhcnNlZFtjYXRdID0gcGFyc2VkW2NhdF0ubWFwKChyLGkpID0+ICh7CiAgICAgICAgICBpZDogU3RyaW5nKHI/LmlkIHx8IGAke2NhdH1fXyR7aX1fXyR7dXVpZCgpfWApLAogICAgICAgICAgdGV4dDogU3RyaW5nKHI/LnRleHQgPz8gIiIpCiAgICAgICAgfSkpOwogICAgICB9CiAgICAgIHJldHVybiBwYXJzZWQ7CiAgICB9Y2F0Y2h7CiAgICAgIHJldHVybiBtYWtlRGVmYXVsdFN0YXRlKCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzYXZlU3RhdGUoKXsKICAgIHRyeXsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oc3RvcmFnZUtleShjdXJyZW50UGVyc29uLnNsdWcpLCBKU09OLnN0cmluZ2lmeShzdGF0ZSkpOwogICAgfWNhdGNoe30KICB9CgogIGZ1bmN0aW9uIGhhc1RleHRSb3cocil7CiAgICByZXR1cm4gKHIudGV4dCB8fCAiIikudHJpbSgpLmxlbmd0aCA+IDA7CiAgfQoKICBmdW5jdGlvbiBmaWxsZWRDb3VudChjYXQpewogICAgcmV0dXJuIHN0YXRlW2NhdF0uZmlsdGVyKGhhc1RleHRSb3cpLmxlbmd0aDsKICB9CgogIC8vIOKchSBEcmFnICYgZHJvcCArIHJhbmtpbmcgYWN0aXZhdGUgd2l0aCBhdCBsZWFzdCAyIGZpbGxlZCByb3dzCiAgZnVuY3Rpb24gaXNEcmFnRW5hYmxlZChjYXQpewogICAgcmV0dXJuIGZpbGxlZENvdW50KGNhdCkgPj0gMjsKICB9CgogIGFzeW5jIGZ1bmN0aW9uIGltcG9ydEV4Y2VsRm9yUGVyc29uKGZpbGUsIHBlcnNvbil7CiAgICBjb25zdCBidWYgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7CiAgICBjb25zdCB3YiA9IFhMU1gucmVhZChidWYsIHsgdHlwZTogImFycmF5IiB9KTsKICAgIGNvbnN0IHNoZWV0TmFtZSA9IHdiLlNoZWV0TmFtZXM/LlswXTsKICAgIGlmICghc2hlZXROYW1lKSB0aHJvdyBuZXcgRXJyb3IoIk5vIHNoZWV0cyIpOwogICAgY29uc3Qgd3MgPSB3Yi5TaGVldHNbc2hlZXROYW1lXTsKCiAgICBjb25zdCByb3dzID0gWExTWC51dGlscy5zaGVldF90b19qc29uKHdzLCB7IGhlYWRlcjogMSwgcmF3OiBmYWxzZSwgZGVmdmFsOiAiIiB9KTsKICAgIGlmICghcm93cyB8fCByb3dzLmxlbmd0aCA8IDIpIHRocm93IG5ldyBFcnJvcigiRW1wdHkgc2hlZXQiKTsKCiAgICBjb25zdCBoZWFkZXIgPSByb3dzWzBdLm1hcCh4ID0+IFN0cmluZyh4ID8/ICIiKSk7CiAgICBjb25zdCBoZWFkZXJOID0gaGVhZGVyLm1hcChub3JtKTsKCiAgICBsZXQgY2F0SWR4ID0gaGVhZGVyTi5maW5kSW5kZXgoaCA9PiBoID09PSAizrrOsc+EzrfOs86/z4HOr86xIiB8fCBoID09PSAiY2F0ZWdvcnkiKTsKICAgIGxldCBwb3NJZHggPSBoZWFkZXJOLmZpbmRJbmRleChoID0+IGggPT09ICLOuM6tz4POtyIgfHwgaCA9PT0gIs64zrXPg863IiB8fCBoID09PSAicG9zaXRpb24iIHx8IGggPT09ICJyYW5rIik7CiAgICBpZiAoY2F0SWR4IDwgMCkgY2F0SWR4ID0gMDsKICAgIGlmIChwb3NJZHggPCAwKSBwb3NJZHggPSAxOwoKICAgIGxldCBwZXJzb25JZHggPSAtMTsKICAgIGNvbnN0IGxhYmVsTiA9IG5vcm0ocGVyc29uLmxhYmVsKTsKICAgIGZvciAobGV0IGk9MDtpPGhlYWRlck4ubGVuZ3RoO2krKyl7CiAgICAgIGlmIChoZWFkZXJOW2ldID09PSBsYWJlbE4pIHsgcGVyc29uSWR4ID0gaTsgYnJlYWs7IH0KICAgIH0KICAgIGlmIChwZXJzb25JZHggPCAwKXsKICAgICAgaWYgKGhlYWRlci5sZW5ndGggPT09IDMpIHBlcnNvbklkeCA9IDI7CiAgICAgIGVsc2UgcGVyc29uSWR4ID0gTWF0aC5tYXgocG9zSWR4ICsgMSwgMik7CiAgICB9CgogICAgY29uc3QgaW1wb3J0ZWRTdGF0ZSA9IGxvYWRTdGF0ZShwZXJzb24uc2x1Zyk7CgogICAgbGV0IGN1cnJlbnRDYXRSYXcgPSAiIjsKICAgIGZvciAobGV0IHIgPSAxOyByIDwgcm93cy5sZW5ndGg7IHIrKyl7CiAgICAgIGNvbnN0IHJvdyA9IHJvd3Nbcl07CiAgICAgIGNvbnN0IGNhdENlbGwgPSByb3dbY2F0SWR4XTsKICAgICAgaWYgKFN0cmluZyhjYXRDZWxsID8/ICIiKS50cmltKCkubGVuZ3RoID4gMCl7CiAgICAgICAgY3VycmVudENhdFJhdyA9IFN0cmluZyhjYXRDZWxsKS50cmltKCk7CiAgICAgIH0KICAgICAgY29uc3QgbWFwcGVkQ2F0ID0gbWFwRXhjZWxDYXRlZ29yeShjdXJyZW50Q2F0UmF3KTsKICAgICAgaWYgKCFtYXBwZWRDYXQpIGNvbnRpbnVlOwoKICAgICAgY29uc3QgcG9zID0gTnVtYmVyKHJvd1twb3NJZHhdKTsKICAgICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUocG9zKSB8fCBwb3MgPCAxKSBjb250aW51ZTsKCiAgICAgIGVuc3VyZUNhdGVnb3J5TGVuZ3RoKGltcG9ydGVkU3RhdGUsIG1hcHBlZENhdCwgTWF0aC5tYXgoaW1wb3J0ZWRTdGF0ZVttYXBwZWRDYXRdLmxlbmd0aCwgcG9zKSk7CgogICAgICBjb25zdCB2YWx1ZSA9IFN0cmluZyhyb3dbcGVyc29uSWR4XSA/PyAiIikudHJpbSgpOwogICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCl7CiAgICAgICAgaW1wb3J0ZWRTdGF0ZVttYXBwZWRDYXRdW3Bvcy0xXS50ZXh0ID0gdmFsdWU7CiAgICAgIH0KICAgIH0KCiAgICB0cnl7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHN0b3JhZ2VLZXkocGVyc29uLnNsdWcpLCBKU09OLnN0cmluZ2lmeShpbXBvcnRlZFN0YXRlKSk7CiAgICB9Y2F0Y2h7fQoKICAgIGlmIChjdXJyZW50UGVyc29uPy5zbHVnID09PSBwZXJzb24uc2x1Zyl7CiAgICAgIHN0YXRlID0gaW1wb3J0ZWRTdGF0ZTsKICAgICAgcmVuZGVyQ2F0ZWdvcmllcygpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gc2hvd0hvbWUoKXsKICAgIGN1cnJlbnRQZXJzb24gPSBudWxsOwogICAgc3RhdGUgPSBudWxsOwogICAgcGVyc29uVmlldy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgIGhvbWVWaWV3LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOwogICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUobnVsbCwgIiIsIGxvY2F0aW9uLnBhdGhuYW1lICsgbG9jYXRpb24uc2VhcmNoICsgIiMvIik7CiAgfQoKICBmdW5jdGlvbiBzaG93UGVyc29uKHNsdWcpewogICAgY29uc3QgcCA9IFBFT1BMRS5maW5kKHggPT4geC5zbHVnID09PSBzbHVnKTsKICAgIGlmICghcCkgcmV0dXJuIHNob3dIb21lKCk7CiAgICBjdXJyZW50UGVyc29uID0gcDsKICAgIHN0YXRlID0gbG9hZFN0YXRlKHNsdWcpOwogICAgaG9tZVZpZXcuY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICBwZXJzb25WaWV3LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOwogICAgcGVyc29uVGl0bGUudGV4dENvbnRlbnQgPSBwLmxhYmVsOwogICAgcmVuZGVyQ2F0ZWdvcmllcygpOwogICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUobnVsbCwgIiIsIGxvY2F0aW9uLnBhdGhuYW1lICsgbG9jYXRpb24uc2VhcmNoICsgIiMvIiArIHNsdWcpOwogIH0KCiAgZnVuY3Rpb24gcmVuZGVySG9tZUJ1dHRvbnMoKXsKICAgIHBlb3BsZUdyaWQuaW5uZXJIVE1MID0gIiI7CgogICAgZm9yIChjb25zdCBwIG9mIFBFT1BMRSl7CiAgICAgIGNvbnN0IHRpbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgdGlsZS5jbGFzc05hbWUgPSAicGVyc29uLXRpbGUiOwoKICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICAgIGJ0bi5jbGFzc05hbWUgPSAicGVyc29uLWJ0biI7CiAgICAgIGJ0bi50eXBlID0gImJ1dHRvbiI7CiAgICAgIGJ0bi5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0icGVyc29uLXRpdGxlIj4ke2VzY2FwZUh0bWwocC5sYWJlbCl9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icGVyc29uLXN1YiI+zobOvc6/zrnOs868zrEgz4POtc67zq/OtM6xz4I8L2Rpdj4KICAgICAgYDsKICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgIGNvbnN0IFBJTlMgPSB7CiAgICAgICAgICAidGVyaS12aS1zZW50aW8iOiAiMTQ3OCIsCiAgICAgICAgICAibW9uaGlhIjogIjk2MzIiLAogICAgICAgICAgImxpc2phbnNpIjogIjIzNjUiCiAgICAgICAgfTsKICAgICAgICBjb25zdCBleHBlY3RlZCA9IFBJTlNbcC5zbHVnXTsKICAgICAgICBpZiAoZXhwZWN0ZWQpewogICAgICAgICAgY29uc3QgcGluID0gcHJvbXB0KCLOlc65z4POrM6zzrXPhM61IFBJTiDOs865zrEgz4DPgc+Mz4POss6xz4POtzoiKTsKICAgICAgICAgIGlmIChwaW4gIT09IGV4cGVjdGVkKXsKICAgICAgICAgICAgYWxlcnQoIs6bzqzOuM6/z4IgUElOLiDOlM61zr0gzrXPgM65z4TPgc6tz4DOtc+EzrHOuSDOtyDPgM+Bz4zPg86yzrHPg863LiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNob3dQZXJzb24ocC5zbHVnKTsKICAgICAgfSk7Y29uc3Qgc3luYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgICBzeW5jLmNsYXNzTmFtZSA9ICJzeW5jLW1pbmkiOwogICAgICBzeW5jLnR5cGUgPSAiYnV0dG9uIjsKICAgICAgc3luYy50aXRsZSA9ICLOo8+FzrPPh8+Bzr/Ovc65z4POvM+Mz4IgzrHPgM+MIEV4Y2VsICgueGxzeCkiOwogICAgICBzeW5jLnRleHRDb250ZW50ID0gIuKfsyBFeGNlbCI7CiAgICAgIHN5bmMuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoZSkgPT4gewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIHN0YXJ0RXhjZWxJbXBvcnRGb3IocCk7CiAgICAgIH0pOwoKICAgICAgdGlsZS5hcHBlbmRDaGlsZChidG4pOwogICAgICB0aWxlLmFwcGVuZENoaWxkKHN5bmMpOwogICAgICBwZW9wbGVHcmlkLmFwcGVuZENoaWxkKHRpbGUpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcmVuZGVyQ2F0ZWdvcmllcygpewogICAgY2F0ZWdvcmllc0VsLmlubmVySFRNTCA9ICIiOwoKICAgIGZvciAoY29uc3QgY2F0IG9mIENBVEVHT1JJRVMpewogICAgICBjb25zdCBjb3VudCA9IGZpbGxlZENvdW50KGNhdCk7CiAgICAgIGNvbnN0IGRyYWdPbiA9IGlzRHJhZ0VuYWJsZWQoY2F0KTsKCiAgICAgIHN0YXRlW2NhdF0gPSBbLi4uc3RhdGVbY2F0XS5maWx0ZXIoaGFzVGV4dFJvdyksIC4uLnN0YXRlW2NhdF0uZmlsdGVyKHIgPT4gIWhhc1RleHRSb3cocikpXTsKCiAgICAgIGNvbnN0IGNhdENhcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgY2F0Q2FyZC5jbGFzc05hbWUgPSAiY2F0IjsKICAgICAgY2F0Q2FyZC5kYXRhc2V0LmNhdCA9IGNhdDsKCiAgICAgIGNvbnN0IGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgaGVhZC5jbGFzc05hbWUgPSAiY2F0LWhlYWQiOwogICAgICBoZWFkLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2PgogICAgICAgICAgPGgyPiR7ZXNjYXBlSHRtbChjYXQpfTwvaDI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJzdGF0dXMgJHtkcmFnT24gPyAib24iIDogIiJ9Ij4KICAgICAgICAgICAgJHtkcmFnT24gPyBgRHJhZyAmIGRyb3A6IE9OICgke2NvdW50fSDPhM6vz4TOu86/zrkpYCA6IGBEcmFnICYgZHJvcDogT0ZGICjOss6szrvOtSDPhM6/z4XOu86sz4fOuc+Dz4TOv869IDIgz4TOr8+EzrvOv8+Fz4Ig4oCUIM+Ez47Pgc6xIM6tz4fOtc65ICR7Y291bnR9KWB9CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgYDsKCiAgICAgIGNvbnN0IGNsZWFyQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICAgIGNsZWFyQnRuLmNsYXNzTmFtZSA9ICJtaW5pIjsKICAgICAgY2xlYXJCdG4udHlwZSA9ICJidXR0b24iOwogICAgICBjbGVhckJ0bi50ZXh0Q29udGVudCA9ICJDbGVhciI7CiAgICAgIGNsZWFyQnRuLnRpdGxlID0gIs6azrHOuM6sz4HOuc+DzrzOsSDOvM+Mzr3OvyDOsc+Fz4TOrs+CIM+EzrfPgiDOus6xz4TOt86zzr/Pgc6vzrHPgiI7CiAgICAgIGNsZWFyQnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgIHN0YXRlW2NhdF0gPSBzdGF0ZVtjYXRdLm1hcChyID0+ICh7Li4uciwgdGV4dDoiIn0pKTsKICAgICAgICBzYXZlU3RhdGUoKTsKICAgICAgICByZW5kZXJDYXRlZ29yaWVzKCk7CiAgICAgIH0pOwogICAgICBoZWFkLmFwcGVuZENoaWxkKGNsZWFyQnRuKTsKCiAgICAgIGNvbnN0IGxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgbGlzdC5jbGFzc05hbWUgPSAibGlzdCI7CiAgICAgIGxpc3QuZGF0YXNldC5jYXQgPSBjYXQ7CgogICAgICBzdGF0ZVtjYXRdLmZvckVhY2goKHJvdywgaWR4KSA9PiB7CiAgICAgICAgY29uc3Qgcm93RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBjb25zdCByb3dGaWxsZWQgPSBoYXNUZXh0Um93KHJvdyk7CiAgICAgICAgcm93RWwuY2xhc3NOYW1lID0gInJvdyIgKyAoZHJhZ09uID8gIiBkcmFnLWVuYWJsZWQiIDogIiIpOwogICAgICAgIHJvd0VsLmRhdGFzZXQuaWQgPSByb3cuaWQ7CiAgICAgICAgcm93RWwuZHJhZ2dhYmxlID0gZHJhZ09uICYmIHJvd0ZpbGxlZDsKCiAgICAgICAgY29uc3QgaGFuZGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgaGFuZGxlLmNsYXNzTmFtZSA9ICJoYW5kbGUiICsgKGRyYWdPbiAmJiByb3dGaWxsZWQgPyAiIiA6ICIgb2ZmIik7CiAgICAgICAgaGFuZGxlLnRleHRDb250ZW50ID0gIuKYsCI7CiAgICAgICAgaGFuZGxlLnRpdGxlID0gKGRyYWdPbiAmJiByb3dGaWxsZWQpCiAgICAgICAgICA/ICJEcmFnIgogICAgICAgICAgOiAizqfPgc61zrnOrM62zr/Ovc+EzrHOuSDPhM6/z4XOu86sz4fOuc+Dz4TOv869IDIgz4PPhc68z4DOu863z4HPic68zq3Ovc6/zrkgz4TOr8+EzrvOv865ICjOus6xzrkgz4TOvyDPg8+FzrPOus61zrrPgc65zrzOrc69zr8gz4DOtc60zq/OvyDOvc6xIM61zq/Ovc6xzrkgz4PPhc68z4DOu863z4HPic68zq3Ovc6/KSI7CgogICAgICAgIGNvbnN0IG51bSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIG51bS5jbGFzc05hbWUgPSAibnVtIjsKICAgICAgICBudW0udGV4dENvbnRlbnQgPSBTdHJpbmcoaWR4ICsgMSk7CgogICAgICAgIGNvbnN0IHNjb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgc2NvcmUuY2xhc3NOYW1lID0gInNjb3JlIjsKICAgICAgICBjb25zdCBiYWRnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIGJhZGdlLmNsYXNzTmFtZSA9ICJiYWRnZSI7CiAgICAgICAgYmFkZ2UudGV4dENvbnRlbnQgPSByb3dGaWxsZWQgPyBTdHJpbmcoKFNDT1JFU1tpZHhdID8/IDApKSA6ICIiOwogICAgICAgIHNjb3JlLmFwcGVuZENoaWxkKGJhZGdlKTsKCiAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgICAgIGlucHV0LmNsYXNzTmFtZSA9ICJ0ZXh0IjsKICAgICAgICBpbnB1dC50eXBlID0gInRleHQiOwogICAgICAgIGlucHV0LnBsYWNlaG9sZGVyID0gIs6Tz4HOrM+IzrUgzrXOtM+OLi4uIjsKICAgICAgICBpbnB1dC52YWx1ZSA9IHJvdy50ZXh0IHx8ICIiOwogICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKGUpID0+IHsKICAgICAgICAgIHJvdy50ZXh0ID0gZS50YXJnZXQudmFsdWU7CiAgICAgICAgICBzYXZlU3RhdGUoKTsKICAgICAgICAgIHJlbmRlckNhdGVnb3JpZXMoKTsKICAgICAgICB9KTsKCiAgICAgICAgcm93RWwuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ3N0YXJ0IiwgKGUpID0+IHsKICAgICAgICAgIGlmICghaXNEcmFnRW5hYmxlZChjYXQpIHx8ICFoYXNUZXh0Um93KHJvdykpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyByZXR1cm47IH0KICAgICAgICAgIGRyYWdDdHguY2F0ID0gY2F0OwogICAgICAgICAgZHJhZ0N0eC5kcmFnZ2luZ0lkID0gcm93LmlkOwogICAgICAgICAgcm93RWwuY2xhc3NMaXN0LmFkZCgiZHJhZ2dpbmciKTsKICAgICAgICAgIGUuZGF0YVRyYW5zZmVyLmVmZmVjdEFsbG93ZWQgPSAibW92ZSI7CiAgICAgICAgICBlLmRhdGFUcmFuc2Zlci5zZXREYXRhKCJ0ZXh0L3BsYWluIiwgcm93LmlkKTsKICAgICAgICB9KTsKCiAgICAgICAgcm93RWwuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ2VuZCIsICgpID0+IHsKICAgICAgICAgIHJvd0VsLmNsYXNzTGlzdC5yZW1vdmUoImRyYWdnaW5nIik7CiAgICAgICAgICBkcmFnQ3R4LmNhdCA9IG51bGw7CiAgICAgICAgICBkcmFnQ3R4LmRyYWdnaW5nSWQgPSBudWxsOwogICAgICAgIH0pOwoKICAgICAgICByb3dFbC5hZGRFdmVudExpc3RlbmVyKCJkcmFnb3ZlciIsIChlKSA9PiB7CiAgICAgICAgICBpZiAoIWlzRHJhZ0VuYWJsZWQoY2F0KSkgcmV0dXJuOwogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9ICJtb3ZlIjsKICAgICAgICB9KTsKCiAgICAgICAgcm93RWwuYWRkRXZlbnRMaXN0ZW5lcigiZHJvcCIsIChlKSA9PiB7CiAgICAgICAgICBpZiAoIWlzRHJhZ0VuYWJsZWQoY2F0KSkgcmV0dXJuOwogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgIGNvbnN0IGZyb21JZCA9IGUuZGF0YVRyYW5zZmVyLmdldERhdGEoInRleHQvcGxhaW4iKTsKICAgICAgICAgIGNvbnN0IHRvSWQgPSByb3cuaWQ7CiAgICAgICAgICBpZiAoIWZyb21JZCB8fCBmcm9tSWQgPT09IHRvSWQpIHJldHVybjsKICAgICAgICAgIGlmIChkcmFnQ3R4LmNhdCAhPT0gY2F0KSByZXR1cm47CgogICAgICAgICAgY29uc3QgdG9Sb3cgPSBzdGF0ZVtjYXRdLmZpbmQoeCA9PiB4LmlkID09PSB0b0lkKTsKICAgICAgICAgIGlmICghdG9Sb3cgfHwgIWhhc1RleHRSb3codG9Sb3cpKSByZXR1cm47CgogICAgICAgICAgY29uc3QgYXJyID0gc3RhdGVbY2F0XTsKICAgICAgICAgIGNvbnN0IGZyb21JZHggPSBhcnIuZmluZEluZGV4KHggPT4geC5pZCA9PT0gZnJvbUlkKTsKICAgICAgICAgIGNvbnN0IHRvSWR4ID0gYXJyLmZpbmRJbmRleCh4ID0+IHguaWQgPT09IHRvSWQpOwogICAgICAgICAgaWYgKGZyb21JZHggPCAwIHx8IHRvSWR4IDwgMCkgcmV0dXJuOwoKICAgICAgICAgIGNvbnN0IFtpdGVtXSA9IGFyci5zcGxpY2UoZnJvbUlkeCwgMSk7CiAgICAgICAgICBhcnIuc3BsaWNlKHRvSWR4LCAwLCBpdGVtKTsKCiAgICAgICAgICBzYXZlU3RhdGUoKTsKICAgICAgICAgIHJlbmRlckNhdGVnb3JpZXMoKTsKICAgICAgICB9KTsKCiAgICAgICAgcm93RWwuYXBwZW5kQ2hpbGQoaGFuZGxlKTsKICAgICAgICByb3dFbC5hcHBlbmRDaGlsZChudW0pOwogICAgICAgIHJvd0VsLmFwcGVuZENoaWxkKGlucHV0KTsKICAgICAgICByb3dFbC5hcHBlbmRDaGlsZChzY29yZSk7CiAgICAgICAgbGlzdC5hcHBlbmRDaGlsZChyb3dFbCk7CiAgICAgIH0pOwoKICAgICAgY2F0Q2FyZC5hcHBlbmRDaGlsZChoZWFkKTsKICAgICAgY2F0Q2FyZC5hcHBlbmRDaGlsZChsaXN0KTsKICAgICAgY2F0ZWdvcmllc0VsLmFwcGVuZENoaWxkKGNhdENhcmQpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZXNjYXBlSHRtbChzdHIpewogICAgcmV0dXJuIFN0cmluZyhzdHIpCiAgICAgIC5yZXBsYWNlQWxsKCImIiwiJmFtcDsiKQogICAgICAucmVwbGFjZUFsbCgiPCIsIiZsdDsiKQogICAgICAucmVwbGFjZUFsbCgiPiIsIiZndDsiKQogICAgICAucmVwbGFjZUFsbCgnIicsIiZxdW90OyIpCiAgICAgIC5yZXBsYWNlQWxsKCInIiwiJiMwMzk7Iik7CiAgfQoKICBiYWNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgc2hvd0hvbWUpOwoKICByZXNldEFsbEJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgIGlmICghY3VycmVudFBlcnNvbikgcmV0dXJuOwogICAgc3RhdGUgPSBtYWtlRGVmYXVsdFN0YXRlKCk7CiAgICBzYXZlU3RhdGUoKTsKICAgIHJlbmRlckNhdGVnb3JpZXMoKTsKICB9KTsKCiAgZnVuY3Rpb24gcm91dGUoKXsKICAgIGNvbnN0IGggPSBsb2NhdGlvbi5oYXNoIHx8ICIjLyI7CiAgICBjb25zdCBwYXJ0cyA9IGgucmVwbGFjZSgvXiNcLz8vLCAiIikuc3BsaXQoIi8iKS5maWx0ZXIoQm9vbGVhbik7CiAgICBpZiAocGFydHMubGVuZ3RoID09PSAwKSBzaG93SG9tZSgpOwogICAgZWxzZSBzaG93UGVyc29uKHBhcnRzWzBdKTsKICB9CgogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJoYXNoY2hhbmdlIiwgcm91dGUpOwoKICByZW5kZXJIb21lQnV0dG9ucygpOwogIHJvdXRlKCk7CgogIC8vID09PT09IEphbWVzIFJpZ2FzOiBTdGF0aXN0aWNzICYgRXhjZWwgRXhwb3J0ID09PT09CiAgY29uc3Qgc3RhdHNCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3RhdHNCdG4iKTsKCiAgZnVuY3Rpb24gY29sbGVjdFN0YXRpc3RpY3MoKXsKICAgIGNvbnN0IHJlc3VsdHMgPSBbXTsKICAgIGZvciAoY29uc3QgcCBvZiBQRU9QTEUpewogICAgICBjb25zdCBzdCA9IGxvYWRTdGF0ZShwLnNsdWcpOwogICAgICBmb3IgKGNvbnN0IGNhdCBvZiBDQVRFR09SSUVTKXsKICAgICAgICBjb25zdCByb3dzID0gc3RbY2F0XSB8fCBbXTsKICAgICAgICByb3dzLmZvckVhY2goKHIsIGlkeCkgPT4gewogICAgICAgICAgaWYgKChyLnRleHQgfHwgIiIpLnRyaW0oKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHsKICAgICAgICAgICAgICBwZXJzb246IHAubGFiZWwsCiAgICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdCwKICAgICAgICAgICAgICByYW5rOiBpZHggKyAxLAogICAgICAgICAgICAgIHNjb3JlOiBTQ09SRVNbaWR4XSA/PyAwLAogICAgICAgICAgICAgIHZhbHVlOiByLnRleHQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH0KCiAgZnVuY3Rpb24gZXhwb3J0U3RhdHNUb0V4Y2VsKCl7CiAgICBjb25zdCBwaW4gPSBwcm9tcHQoIs6VzrnPg86szrPOtc+EzrUgz4TOv869IM66z4nOtM65zrrPjCDOs865zrEgzrXOvs6xzrPPic6zzq4gRXhjZWw6Iik7CiAgICBpZiAocGluICE9PSAiNzQ1NiIpewogICAgICBhbGVydCgizpvOrM64zr/PgiDOus+JzrTOuc66z4zPgi4gzpcgzrXOvs6xzrPPic6zzq4gzrHOus+Fz4HPjs64zrfOus61LiIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgZGF0YSA9IGNvbGxlY3RTdGF0aXN0aWNzKCk7CiAgICBpZiAoIWRhdGEubGVuZ3RoKXsKICAgICAgYWxlcnQoIs6UzrXOvSDPhc+AzqzPgc+Hzr/Phc69IM60zrXOtM6/zrzOrc69zrEgzrPOuc6xIM61zr7Osc6zz4nOs86uLiIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3Qgd3NEYXRhID0gWwogICAgICBbIlBlcnNvbiIsICJDYXRlZ29yeSIsICJSYW5rIiwgIlNjb3JlIiwgIkFuc3dlciJdCiAgICBdOwogICAgZGF0YS5mb3JFYWNoKGQgPT4gewogICAgICB3c0RhdGEucHVzaChbZC5wZXJzb24sIGQuY2F0ZWdvcnksIGQucmFuaywgZC5zY29yZSwgZC52YWx1ZV0pOwogICAgfSk7CgogICAgY29uc3Qgd3MgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldCh3c0RhdGEpOwogICAgY29uc3Qgd2IgPSBYTFNYLnV0aWxzLmJvb2tfbmV3KCk7CiAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCB3cywgIlN0YXRpc3RpY3MiKTsKCiAgICBYTFNYLndyaXRlRmlsZSh3YiwgIkphbWVzX1JpZ2FzX1N0YXRpc3RpY3MueGxzeCIpOwogIH0KCiAgaWYgKHN0YXRzQnRuKXsKICAgIHN0YXRzQnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXhwb3J0U3RhdHNUb0V4Y2VsKTsKICB9CgoKICAvLyBFeHBvc2UgaW50ZXJuYWxzIGZvciBjb21wYXRpYmlsaXR5IChmaWxlOi8vIC8gaWZyYW1lIHdyYXBwZXJzKQogIHRyeXsKICAgIHdpbmRvdy5QRU9QTEUgPSBQRU9QTEU7CiAgICB3aW5kb3cuQ0FURUdPUklFUyA9IENBVEVHT1JJRVM7CiAgICB3aW5kb3cubG9hZFN0YXRlID0gbG9hZFN0YXRlOwogICAgd2luZG93LnNhdmVTdGF0ZSA9IHNhdmVTdGF0ZTsKICB9Y2F0Y2goZSl7fQp9KSgpOwo8L3NjcmlwdD4KCjxzY3JpcHQ+Ci8vID09PT09IEphbWVzIFJpZ2FzOiBQZXItcGVyc29uIFBJTiBFeHBvcnQgPT09PT0KY29uc3QgUEVSU09OX1BJTlMgPSB7CiAgInRlcmktdmktc2VudGlvIjogIjE0NzgiLAogICJtb25oaWEiOiAiOTYzMiIsCiAgImxpc2phbnNpIjogIjIzNjUiCn07CgpmdW5jdGlvbiBleHBvcnRTdGF0c1RvRXhjZWwoKXsKICBjb25zdCBwZXJzb25TbHVnID0gcHJvbXB0KAogICAgIs6gzrvOt866z4TPgc6/zrvPjM6zzrfPg861IM6sz4TOv868zr8gzrPOuc6xIGV4cG9ydDpcbiIgKwogICAgInRlcmktdmktc2VudGlvXG5tb25oaWFcbmxpc2phbnNpIgogICk7CgogIGlmICghcGVyc29uU2x1ZyB8fCAhUEVSU09OX1BJTlNbcGVyc29uU2x1Z10pewogICAgYWxlcnQoIs6czrcgzq3Os866z4XPgc6/IM6sz4TOv868zr8uIM6XIM61zr7Osc6zz4nOs86uIM6xzrrPhc+Bz47OuM63zrrOtS4iKTsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHBpbiA9IHByb21wdCgizpXOuc+DzqzOs861z4TOtSBQSU46Iik7CiAgaWYgKHBpbiAhPT0gUEVSU09OX1BJTlNbcGVyc29uU2x1Z10pewogICAgYWxlcnQoIs6bzqzOuM6/z4IgUElOLiDOlyDOtc6+zrHOs8+JzrPOriDOsc66z4XPgc+OzrjOt866zrUuIik7CiAgICByZXR1cm47CiAgfQoKICBjb25zdCBzdCA9IGxvYWRTdGF0ZShwZXJzb25TbHVnKTsKICBjb25zdCBwZXJzb24gPSBQRU9QTEUuZmluZChwID0+IHAuc2x1ZyA9PT0gcGVyc29uU2x1Zyk7CgogIGNvbnN0IHJvd3NPdXQgPSBbXTsKICBmb3IgKGNvbnN0IGNhdCBvZiBDQVRFR09SSUVTKXsKICAgIGNvbnN0IHJvd3MgPSBzdFtjYXRdIHx8IFtdOwogICAgcm93cy5mb3JFYWNoKChyLCBpZHgpID0+IHsKICAgICAgaWYgKChyLnRleHQgfHwgIiIpLnRyaW0oKS5sZW5ndGggPiAwKXsKICAgICAgICByb3dzT3V0LnB1c2goWwogICAgICAgICAgcGVyc29uLmxhYmVsLAogICAgICAgICAgY2F0LAogICAgICAgICAgaWR4ICsgMSwKICAgICAgICAgIFNDT1JFU1tpZHhdID8/IDAsCiAgICAgICAgICByLnRleHQKICAgICAgICBdKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBpZiAoIXJvd3NPdXQubGVuZ3RoKXsKICAgIGFsZXJ0KCLOlM61zr0gz4XPgM6sz4HPh86/z4XOvSDOtM61zrTOv868zq3Ovc6xIM6zzrnOsSDOtc6+zrHOs8+JzrPOri4iKTsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHdzRGF0YSA9IFsKICAgIFsiUGVyc29uIiwgIkNhdGVnb3J5IiwgIlJhbmsiLCAiU2NvcmUiLCAiQW5zd2VyIl0sCiAgICAuLi5yb3dzT3V0CiAgXTsKCiAgY29uc3Qgd3MgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldCh3c0RhdGEpOwogIGNvbnN0IHdiID0gWExTWC51dGlscy5ib29rX25ldygpOwogIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2IsIHdzLCBwZXJzb24ubGFiZWwpOwoKICBYTFNYLndyaXRlRmlsZSgKICAgIHdiLAogICAgcGVyc29uLmxhYmVsLnJlcGxhY2UoL1xzKy9nLCAiXyIpICsgIl9TdGF0aXN0aWNzLnhsc3giCiAgKTsKfQoKLy8gcmViaW5kIGJ1dHRvbgpjb25zdCBzdGF0c0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzdGF0c0J0biIpOwppZiAoc3RhdHNCdG4pewogIHN0YXRzQnRuLm9uY2xpY2sgPSBleHBvcnRTdGF0c1RvRXhjZWw7Cn0KPC9zY3JpcHQ+Cgo8c2NyaXB0PgooZnVuY3Rpb24oKXsKICBjb25zdCBQSU5fT0sgPSAiMDgyNSI7CgogIGZ1bmN0aW9uIHBvaW50cyhyYW5rKXsKICAgIHJhbmsgPSBOdW1iZXIocmFuayk7CiAgICBpZiAoIU51bWJlci5pc0Zpbml0ZShyYW5rKSkgcmV0dXJuICIiOwogICAgaWYgKHJhbmsgPT09IDEpIHJldHVybiAxMjsKICAgIGlmIChyYW5rID09PSAyKSByZXR1cm4gMTA7CiAgICByZXR1cm4gTWF0aC5tYXgoMSwgMTEgLSByYW5rKTsKICB9CgogIGZ1bmN0aW9uIGV4cG9ydEFsbFRvRXhjZWwoKXsKICAgIGNvbnN0IHBpbiA9IHByb21wdCgizpXOuc+DzqzOs861z4TOtSBQSU46Iik7CiAgICBpZiAocGluICE9PSBQSU5fT0spewogICAgICBhbGVydCgizpvOrM64zr/PgiBQSU4iKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIDEpIEdhdGhlciByYXcgYW5zd2VycyBmcm9tIEFMTCBwZW9wbGUgKM+MzrvOv865IM6/zrkgzrXPgc+Jz4TOt868zq3Ovc6/zrkpCiAgICBjb25zdCByYXcgPSBbXTsgLy8ge3BlcnNvbiwgY2F0ZWdvcnksIHJhbmssIHNjb3JlLCBhbnN3ZXJ9CiAgICBjb25zdCBwZW9wbGVMaXN0ID0gKHdpbmRvdy5QRU9QTEUgfHwgWwogICAgICB7IGxhYmVsOiAiVGVyaSBWaSBTZW50aW8iLCBzbHVnOiAidGVyaS12aS1zZW50aW8iIH0sCiAgICAgIHsgbGFiZWw6ICJNb25oaWEiLCBzbHVnOiAibW9uaGlhIiB9LAogICAgICB7IGxhYmVsOiAiTGlzamFuc2kiLCBzbHVnOiAibGlzamFuc2kiIH0KICAgIF0pOwoKICAgIGZvciAoY29uc3QgcGVyc29uIG9mIHBlb3BsZUxpc3QpewogICAgICBjb25zdCBzdCA9IGxvYWRTdGF0ZShwZXJzb24uc2x1Zyk7CiAgICAgIGlmICghc3QpIGNvbnRpbnVlOwogICAgICBmb3IgKGNvbnN0IGNhdCBvZiBDQVRFR09SSUVTKXsKICAgICAgICBjb25zdCBhcnIgPSBzdCAmJiBzdFtjYXRdID8gc3RbY2F0XSA6IFtdOwogICAgICAgIGZvciAobGV0IGk9MDtpPGFyci5sZW5ndGg7aSsrKXsKICAgICAgICAgIGNvbnN0IGFucyA9IFN0cmluZyhhcnJbaV0gJiYgYXJyW2ldLnRleHQgPyBhcnJbaV0udGV4dCA6ICIiKS50cmltKCk7CiAgICAgICAgICBpZiAoIWFucykgY29udGludWU7CiAgICAgICAgICBjb25zdCByYW5rID0gaSsxOwogICAgICAgICAgcmF3LnB1c2goewogICAgICAgICAgICBwZXJzb246IHBlcnNvbi5sYWJlbCB8fCBwZXJzb24ubmFtZSB8fCBwZXJzb24uc2x1ZywKICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdCwKICAgICAgICAgICAgcmFuaywKICAgICAgICAgICAgc2NvcmU6IHBvaW50cyhyYW5rKSwKICAgICAgICAgICAgYW5zd2VyOiBhbnMKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGlmICghcmF3Lmxlbmd0aCl7CiAgICAgIGFsZXJ0KCLOlM61zr0gzrLPgc6tzrjOt866zrHOvSDOsc+AzrHOvc+Ezq7Pg861zrnPgiDOs865zrEgZXhwb3J0LiIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gMikgQWdncmVnYXRlIHN0YXRpc3RpY3MgKM+Dz4XOs866zrXOvc+Ez4HPic+EzrnOus6sKQogICAgLy8gS2V5OiBjYXRlZ29yeXxhbnN3ZXIKICAgIGNvbnN0IGJ5QW5zd2VyID0gbmV3IE1hcCgpOwogICAgLy8gS2V5OiBjYXRlZ29yeXxyYW5rfGFuc3dlcgogICAgY29uc3QgYnlSYW5rID0gbmV3IE1hcCgpOwogICAgLy8gS2V5OiBjYXRlZ29yeSAtPiB0b3RhbCBhbnN3ZXJzCiAgICBjb25zdCBieUNhdGVnb3J5ID0gbmV3IE1hcCgpOwoKICAgIGZvciAoY29uc3QgciBvZiByYXcpewogICAgICAvLyBieSBjYXRlZ29yeQogICAgICBieUNhdGVnb3J5LnNldChyLmNhdGVnb3J5LCAoYnlDYXRlZ29yeS5nZXQoci5jYXRlZ29yeSkgfHwgMCkgKyAxKTsKCiAgICAgIC8vIGJ5IGFuc3dlcgogICAgICBjb25zdCBrMSA9IHIuY2F0ZWdvcnkgKyAifHwiICsgci5hbnN3ZXIudG9Mb3dlckNhc2UoKTsKICAgICAgY29uc3QgY3VyMSA9IGJ5QW5zd2VyLmdldChrMSkgfHwgeyBjYXRlZ29yeTogci5jYXRlZ29yeSwgYW5zd2VyOiByLmFuc3dlciwgY291bnQ6MCwgdG90YWxTY29yZTowIH07CiAgICAgIGN1cjEuY291bnQgKz0gMTsKICAgICAgY3VyMS50b3RhbFNjb3JlICs9IChOdW1iZXIoci5zY29yZSkgfHwgMCk7CiAgICAgIGJ5QW5zd2VyLnNldChrMSwgY3VyMSk7CgogICAgICAvLyBieSByYW5rCiAgICAgIGNvbnN0IGsyID0gci5jYXRlZ29yeSArICJ8fCIgKyByLnJhbmsgKyAifHwiICsgci5hbnN3ZXIudG9Mb3dlckNhc2UoKTsKICAgICAgY29uc3QgY3VyMiA9IGJ5UmFuay5nZXQoazIpIHx8IHsgY2F0ZWdvcnk6IHIuY2F0ZWdvcnksIHJhbms6IHIucmFuaywgYW5zd2VyOiByLmFuc3dlciwgY291bnQ6MCwgdG90YWxTY29yZTowIH07CiAgICAgIGN1cjIuY291bnQgKz0gMTsKICAgICAgY3VyMi50b3RhbFNjb3JlICs9IChOdW1iZXIoci5zY29yZSkgfHwgMCk7CiAgICAgIGJ5UmFuay5zZXQoazIsIGN1cjIpOwogICAgfQoKICAgIGNvbnN0IHN0YXRzUm93cyA9IEFycmF5LmZyb20oYnlBbnN3ZXIudmFsdWVzKCkpCiAgICAgIC5tYXAoeCA9PiAoey4uLngsIGF2Z1Njb3JlOiB4LmNvdW50ID8gKHgudG90YWxTY29yZSAvIHguY291bnQpIDogMH0pKQogICAgICAuc29ydCgoYSxiKSA9PiAoYi50b3RhbFNjb3JlIC0gYS50b3RhbFNjb3JlKSB8fCAoYi5jb3VudCAtIGEuY291bnQpIHx8IGEuY2F0ZWdvcnkubG9jYWxlQ29tcGFyZShiLmNhdGVnb3J5KSB8fCBhLmFuc3dlci5sb2NhbGVDb21wYXJlKGIuYW5zd2VyKSk7CgogICAgY29uc3QgcmFua1Jvd3MgPSBBcnJheS5mcm9tKGJ5UmFuay52YWx1ZXMoKSkKICAgICAgLm1hcCh4ID0+ICh7Li4ueCwgYXZnU2NvcmU6IHguY291bnQgPyAoeC50b3RhbFNjb3JlIC8geC5jb3VudCkgOiAwfSkpCiAgICAgIC5zb3J0KChhLGIpID0+IGEuY2F0ZWdvcnkubG9jYWxlQ29tcGFyZShiLmNhdGVnb3J5KSB8fCAoYS5yYW5rIC0gYi5yYW5rKSB8fCAoYi50b3RhbFNjb3JlIC0gYS50b3RhbFNjb3JlKSB8fCAoYi5jb3VudCAtIGEuY291bnQpKTsKCiAgICBjb25zdCBjYXRSb3dzID0gQXJyYXkuZnJvbShieUNhdGVnb3J5LmVudHJpZXMoKSkKICAgICAgLm1hcCgoW2NhdGVnb3J5LCB0b3RhbEFuc3dlcnNdKSA9PiAoeyBjYXRlZ29yeSwgdG90YWxBbnN3ZXJzIH0pKQogICAgICAuc29ydCgoYSxiKSA9PiBiLnRvdGFsQW5zd2VycyAtIGEudG90YWxBbnN3ZXJzKTsKCiAgICAvLyAzKSBCdWlsZCB3b3JrYm9vawogICAgY29uc3Qgd2IgPSBYTFNYLnV0aWxzLmJvb2tfbmV3KCk7CgogICAgLy8gU2hlZXQ6IFJBVwogICAgY29uc3QgcmF3QW9hID0gW1siUGVyc29uIiwiQ2F0ZWdvcnkiLCJSYW5rIiwiU2NvcmUiLCJBbnN3ZXIiXV07CiAgICByYXcuZm9yRWFjaChyID0+IHJhd0FvYS5wdXNoKFtyLnBlcnNvbiwgci5jYXRlZ29yeSwgci5yYW5rLCByLnNjb3JlLCByLmFuc3dlcl0pKTsKICAgIGNvbnN0IHdzUmF3ID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQocmF3QW9hKTsKICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2IsIHdzUmF3LCAiUkFXIik7CgogICAgLy8gU2hlZXQ6IFNUQVRTIChieSBBbnN3ZXIpCiAgICBjb25zdCBzdGF0c0FvYSA9IFtbIkNhdGVnb3J5IiwiQW5zd2VyIiwiQ291bnQiLCJUb3RhbCBTY29yZSIsIkF2ZyBTY29yZSJdXTsKICAgIHN0YXRzUm93cy5mb3JFYWNoKHMgPT4gc3RhdHNBb2EucHVzaChbcy5jYXRlZ29yeSwgcy5hbnN3ZXIsIHMuY291bnQsIHMudG90YWxTY29yZSwgTWF0aC5yb3VuZChzLmF2Z1Njb3JlKjEwMCkvMTAwXSkpOwogICAgY29uc3Qgd3NTdGF0cyA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KHN0YXRzQW9hKTsKICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2IsIHdzU3RhdHMsICJTVEFUUyIpOwoKICAgIC8vIFNoZWV0OiBCWV9SQU5LCiAgICBjb25zdCByYW5rQW9hID0gW1siQ2F0ZWdvcnkiLCJSYW5rIiwiQW5zd2VyIiwiQ291bnQiLCJUb3RhbCBTY29yZSIsIkF2ZyBTY29yZSJdXTsKICAgIHJhbmtSb3dzLmZvckVhY2gocyA9PiByYW5rQW9hLnB1c2goW3MuY2F0ZWdvcnksIHMucmFuaywgcy5hbnN3ZXIsIHMuY291bnQsIHMudG90YWxTY29yZSwgTWF0aC5yb3VuZChzLmF2Z1Njb3JlKjEwMCkvMTAwXSkpOwogICAgY29uc3Qgd3NSYW5rID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQocmFua0FvYSk7CiAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCB3c1JhbmssICJCWV9SQU5LIik7CgogICAgLy8gU2hlZXQ6IENBVEVHT1JJRVMKICAgIGNvbnN0IGNhdEFvYSA9IFtbIkNhdGVnb3J5IiwiVG90YWwgQW5zd2VycyJdXTsKICAgIGNhdFJvd3MuZm9yRWFjaChjID0+IGNhdEFvYS5wdXNoKFtjLmNhdGVnb3J5LCBjLnRvdGFsQW5zd2Vyc10pKTsKICAgIGNvbnN0IHdzQ2F0ID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQoY2F0QW9hKTsKICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2IsIHdzQ2F0LCAiQ0FURUdPUklFUyIpOwoKICAgIC8vIE5pY2UgY29sdW1uIHdpZHRocwogICAgZnVuY3Rpb24gc2V0Q29scyh3cywgd2lkdGhzKXsKICAgICAgd3NbIiFjb2xzIl0gPSB3aWR0aHMubWFwKHcgPT4gKHsgd2NoOncgfSkpOwogICAgfQogICAgc2V0Q29scyh3c1JhdywgICBbMTgsIDI2LCA2LCA3LCA0Nl0pOwogICAgc2V0Q29scyh3c1N0YXRzLCBbMjYsIDQ2LCA4LCAxMiwgMTBdKTsKICAgIHNldENvbHMod3NSYW5rLCAgWzI2LCA2LCA0NiwgOCwgMTIsIDEwXSk7CiAgICBzZXRDb2xzKHdzQ2F0LCAgIFsyNiwgMTRdKTsKCiAgICBYTFNYLndyaXRlRmlsZSh3YiwgIkphbWVzUmlnYXNfU3RhdHNfT0xBLnhsc3giKTsKICB9CgogIGNvbnN0IHN0YXRzQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN0YXRzQnRuIik7CiAgaWYgKHN0YXRzQnRuKXsKICAgIHN0YXRzQnRuLm9uY2xpY2sgPSBleHBvcnRBbGxUb0V4Y2VsOwogIH0KfSkoKTsKCiAgLy8gPT09PT0gR3JhYi10by1zY3JvbGwgaW5zaWRlIC5saXN0IChtb3VzZSBtaWRkbGUgYnV0dG9uIE9SIEFsdCtMZWZ0KSA9PT09PQogIChmdW5jdGlvbigpewogICAgZnVuY3Rpb24gZW5hYmxlR3JhYlNjcm9sbChlbCl7CiAgICAgIGlmKCFlbCkgcmV0dXJuOwogICAgICBlbC5jbGFzc0xpc3QuYWRkKCJncmFiIik7CiAgICAgIGxldCBkb3duPWZhbHNlLCBzdGFydFk9MCwgc3RhcnRUb3A9MCwgYWN0aXZlQnRuPW51bGw7CgogICAgICBmdW5jdGlvbiBvbkRvd24oZSl7CiAgICAgICAgY29uc3QgaXNNb3VzZSA9IGUudHlwZSA9PT0gIm1vdXNlZG93biI7CiAgICAgICAgY29uc3QgaXNUb3VjaCA9IGUudHlwZSA9PT0gInRvdWNoc3RhcnQiOwogICAgICAgIGlmKGlzTW91c2UpewogICAgICAgICAgLy8gTWlkZGxlIG1vdXNlIGJ1dHRvbiAod2hlZWwgY2xpY2spIE9SIEFsdCtMZWZ0IGNsaWNrCiAgICAgICAgICBpZighKGUuYnV0dG9uPT09MSB8fCAoZS5idXR0b249PT0wICYmIGUuYWx0S2V5KSkpIHJldHVybjsKICAgICAgICAgIGFjdGl2ZUJ0biA9IGUuYnV0dG9uOwogICAgICAgICAgZG93biA9IHRydWU7CiAgICAgICAgICBzdGFydFkgPSBlLmNsaWVudFk7CiAgICAgICAgICBzdGFydFRvcCA9IGVsLnNjcm9sbFRvcDsKICAgICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoImdyYWJiaW5nIik7CiAgICAgICAgICAvLyBwcmV2ZW50IG1pZGRsZS1jbGljayBhdXRvc2Nyb2xsIC8gc2VsZWN0aW9uCiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfSBlbHNlIGlmKGlzVG91Y2gpewogICAgICAgICAgaWYoIWUudG91Y2hlcyB8fCBlLnRvdWNoZXMubGVuZ3RoIT09MSkgcmV0dXJuOwogICAgICAgICAgLy8gVG91Y2ggZHJhZyBvbmx5IHdoZW4gdGhlIGxpc3QgY2FuIGFjdHVhbGx5IHNjcm9sbAogICAgICAgICAgaWYoZWwuc2Nyb2xsSGVpZ2h0IDw9IGVsLmNsaWVudEhlaWdodCsxKSByZXR1cm47CiAgICAgICAgICBkb3duID0gdHJ1ZTsKICAgICAgICAgIHN0YXJ0WSA9IGUudG91Y2hlc1swXS5jbGllbnRZOwogICAgICAgICAgc3RhcnRUb3AgPSBlbC5zY3JvbGxUb3A7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBvbk1vdmUoZSl7CiAgICAgICAgaWYoIWRvd24pIHJldHVybjsKICAgICAgICBsZXQgeTsKICAgICAgICBpZihlLnR5cGU9PT0ibW91c2Vtb3ZlIil7CiAgICAgICAgICB5ID0gZS5jbGllbnRZOwogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0gZWxzZSBpZihlLnR5cGU9PT0idG91Y2htb3ZlIil7CiAgICAgICAgICBpZighZS50b3VjaGVzIHx8IGUudG91Y2hlcy5sZW5ndGghPT0xKSByZXR1cm47CiAgICAgICAgICB5ID0gZS50b3VjaGVzWzBdLmNsaWVudFk7CiAgICAgICAgICAvLyBwcmV2ZW50IHRoZSBwYWdlIGZyb20gc3RlYWxpbmcgdGhlIHNjcm9sbCB3aGlsZSB3ZSdyZSBkcmFnZ2luZyB0aGlzIGxpc3QKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9IGVsc2UgcmV0dXJuOwogICAgICAgIGNvbnN0IGR5ID0geSAtIHN0YXJ0WTsKICAgICAgICBlbC5zY3JvbGxUb3AgPSBzdGFydFRvcCAtIGR5OwogICAgICB9CgogICAgICBmdW5jdGlvbiBvblVwKCl7CiAgICAgICAgaWYoIWRvd24pIHJldHVybjsKICAgICAgICBkb3duPWZhbHNlOwogICAgICAgIGFjdGl2ZUJ0bj1udWxsOwogICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoImdyYWJiaW5nIik7CiAgICAgIH0KCiAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIG9uRG93bik7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCBvbk1vdmUpOwogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibW91c2V1cCIsIG9uVXApOwogICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWxlYXZlIiwgb25VcCk7CgogICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaHN0YXJ0Iiwgb25Eb3duLCB7cGFzc2l2ZTpmYWxzZX0pOwogICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaG1vdmUiLCBvbk1vdmUsIHtwYXNzaXZlOmZhbHNlfSk7CiAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoInRvdWNoZW5kIiwgb25VcCk7CiAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoInRvdWNoY2FuY2VsIiwgb25VcCk7CiAgICB9CgogICAgZnVuY3Rpb24gaG9vaygpewogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIubGlzdCIpLmZvckVhY2goZW5hYmxlR3JhYlNjcm9sbCk7CiAgICB9CiAgICAvLyBpbml0aWFsICsgd2hlbmV2ZXIgY2F0ZWdvcmllcyByZXJlbmRlcgogICAgaG9vaygpOwogICAgY29uc3QgX3JlbmRlckNhdGVnb3JpZXMgPSB3aW5kb3cucmVuZGVyQ2F0ZWdvcmllczsKICAgIC8vIElmIHJlbmRlckNhdGVnb3JpZXMgaXMgaW4gc2NvcGUgKGZ1bmN0aW9uIGRlY2xhcmF0aW9uKSwgaXQgaXMgbm90IG9uIHdpbmRvdyBpbiBzdHJpY3QgbW9kZS4KICAgIC8vIFNvIHdlIGFsc28gb2JzZXJ2ZSBET00gY2hhbmdlcyBpbiAjY2F0ZWdvcmllcy4KICAgIGNvbnN0IGNhdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2F0ZWdvcmllcyIpOwogICAgaWYoY2F0cyl7CiAgICAgIGNvbnN0IG1vID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCk9Pmhvb2soKSk7CiAgICAgIG1vLm9ic2VydmUoY2F0cywge2NoaWxkTGlzdDp0cnVlLCBzdWJ0cmVlOnRydWV9KTsKICAgIH0KICB9KSgpOwoKPC9zY3JpcHQ+Cgo8L2JvZHk+CjwvaHRtbD4K";

  const introFrame = document.getElementById('introFrame');
  const mainFrame  = document.getElementById('mainFrame');

  function b64ToText(b64){ 
    try{ return decodeURIComponent(escape(atob(b64))); }catch(e){ return atob(b64); } 
  }

  introFrame.srcdoc = b64ToText(INTRO_B64);
  mainFrame.srcdoc  = b64ToText(MAIN_B64);

  const INTRO_MS = 10000;
  const FX_MS = 1200;

  function switchToMain(){
    document.body.classList.add('fx-on');
    setTimeout(() => {
      document.body.classList.add('main-on');
      setTimeout(() => { try{ introFrame.srcdoc = ""; }catch(e){} }, 900);
    }, Math.min(900, FX_MS - 200));
    setTimeout(() => document.body.classList.remove('fx-on'), FX_MS);
  }

  const isTouch = matchMedia('(pointer:coarse)').matches || 'ontouchstart' in window;
  const overlay = document.getElementById('startOverlay');
  let started=false, introTimer=null;

  function begin(){
    if (started) return;
    started=true;
    if (overlay) overlay.classList.add('hidden');
    introTimer=setTimeout(switchToMain, INTRO_MS);
  }

  if (isTouch && overlay){
    const tap=()=>begin();
    overlay.addEventListener('click', tap, { once:true });
    overlay.addEventListener('touchstart', tap, { once:true, passive:true });
    overlay.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' ') begin(); }, { once:true });
  } else {
    begin();
  }
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, doc, setDoc, onSnapshot, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // Firebase config (from your Firebase console)
  const firebaseConfig = {
  "apiKey": "AIzaSyA3j74FN_DIrsZclq09lIY62eenSOzP0yQ",
  "authDomain": "euphoria-2026.firebaseapp.com",
  "projectId": "euphoria-2026",
  "storageBucket": "euphoria-2026.firebasestorage.app",
  "messagingSenderId": "259023927428",
  "appId": "1:259023927428:web:74099e69bea7b07a7b2ad1",
  "measurementId": "G-JEVRCV89WB"
};

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  const mainFrame = document.getElementById('mainFrame');

  // --- Touch scroll fallback for mobile if iframe content doesn't scroll naturally ---
  function attachTouchScrollFallback(){
    if (!mainFrame) return;
    const tryAttach = () => {
      let doc;
      try { doc = mainFrame.contentDocument; } catch(e){ return; }
      if (!doc) return;

      // Find the first scrollable container inside the iframe
      const isScrollable = (el) => {
        if (!el) return false;
        const sh = el.scrollHeight, ch = el.clientHeight;
        if (sh <= ch + 2) return false;
        const cs = doc.defaultView.getComputedStyle(el);
        const oy = cs.overflowY;
        return (oy === 'auto' || oy === 'scroll');
      };

      let target = null;
      // Prefer an explicit scroll container if any
      const candidates = Array.from(doc.querySelectorAll('body *')).slice(0, 4000); // cap for perf
      for (const el of candidates){
        if (isScrollable(el)) { target = el; break; }
      }
      // Fallbacks
      if (!target) target = doc.scrollingElement || doc.documentElement || doc.body;

      let lastY = null;
      let lastX = null;

      // If the target can't scroll, just don't attach.
      const canScroll = () => (target && target.scrollHeight > target.clientHeight + 2);
      if (!canScroll()) return;

      doc.addEventListener('touchstart', (e)=>{
        if (e.touches && e.touches.length===1){
          lastY = e.touches[0].clientY;
          lastX = e.touches[0].clientX;
        }
      }, {passive:true});

      doc.addEventListener('touchmove', (e)=>{
        if (lastY==null || !e.touches || e.touches.length!==1) return;
        const y = e.touches[0].clientY;
        const x = e.touches[0].clientX;
        const dy = lastY - y;
        const dx = lastX - x;

        // Only handle mostly-vertical gestures
        if (Math.abs(dy) > Math.abs(dx)){
          // Try to scroll target
          const before = target.scrollTop;
          target.scrollTop = before + dy;

          // If it moved, stop the browser from treating it as a swipe
          if (target.scrollTop !== before){
            e.preventDefault();
          }
          lastY = y; lastX = x;
        }
      }, {passive:false});

      doc.addEventListener('touchend', ()=>{ lastY=null; lastX=null; }, {passive:true});
      doc.addEventListener('touchcancel', ()=>{ lastY=null; lastX=null; }, {passive:true});
    };

    // Attach once on load, and also retry shortly after (some apps render late)
    mainFrame.addEventListener('load', ()=>{
      tryAttach();
      setTimeout(tryAttach, 600);
      setTimeout(tryAttach, 1500);
    }, {once:true});
  }
  attachTouchScrollFallback();


  // "room" decides which shared state you sync (default matches your seed key)
  const room = new URLSearchParams(location.search).get('room') || 'teri-vi-sentio';
  const docRef = doc(db, 'neon-awards', room);

  let applyingRemote = false;

  function postToIframe(type, payload) {
    try {
      mainFrame.contentWindow?.postMessage({ __neonSync: 1, type, payload }, '*');
    } catch (e) {}
  }

  async function ensureDocFromIframe(kv) {
    try {
      const snap = await getDoc(docRef);
      if (!snap.exists()) {
        await setDoc(docRef, { kv, updatedAt: serverTimestamp() }, { merge: true });
      }
    } catch (e) {
      console.warn('Firestore init failed:', e);
    }
  }

  function injectBridge() {
    try {
      const w = mainFrame.contentWindow;
      const d = mainFrame.contentDocument;
      if (!w || !d) return;
      if (w.__neonBridgeInstalled) return;
      w.__neonBridgeInstalled = true;

      const s = d.createElement('script');
      s.textContent = `
(() => {
  const PREFIX = 'neon-awards:';
  const send = (type, payload) => {
    try { parent.postMessage({ __neonSync: 1, type, payload }, '*'); } catch(e) {}
  };

  const ls = window.localStorage;
  const _set = ls.setItem.bind(ls);
  const _rem = ls.removeItem.bind(ls);

  // patch writes so parent can sync to Firestore
  ls.setItem = (k, v) => {
    _set(k, v);
    if (window.__neonApplyingRemote) return;
    if (String(k).startsWith(PREFIX)) send('localChange', { key: String(k), value: String(v) });
  };
  ls.removeItem = (k) => {
    _rem(k);
    if (window.__neonApplyingRemote) return;
    if (String(k).startsWith(PREFIX)) send('localChange', { key: String(k), value: null });
  };

  // receive updates from parent (Firestore -> localStorage)
  window.addEventListener('message', (ev) => {
    const msg = ev.data;
    if (!msg || !msg.__neonSync) return;

    if (msg.type === 'applyRemote') {
      const kv = (msg.payload && msg.payload.kv) ? msg.payload.kv : {};
      window.__neonApplyingRemote = true;
      try {
        for (const [k, v] of Object.entries(kv)) {
          if (!String(k).startsWith(PREFIX)) continue;
          if (v === null || v === undefined) _rem(k);
          else _set(k, String(v));
        }
      } finally {
        window.__neonApplyingRemote = false;
      }
    }
  });

  // send current state once (for first-time Firestore init)
  try {
    const kv = {};
    for (let i=0; i<ls.length; i++) {
      const k = ls.key(i);
      if (k && String(k).startsWith(PREFIX)) kv[String(k)] = ls.getItem(k);
    }
    send('hello', { kv });
  } catch(e) {}
})();
      `;
      d.documentElement.appendChild(s);
    } catch (e) {
      console.warn('Bridge inject failed:', e);
    }
  }

  mainFrame.addEventListener('load', () => {
    injectBridge();
  });

  // In case it loads instantly
  setTimeout(injectBridge, 500);

  // Listen to iframe -> parent events
  window.addEventListener('message', async (ev) => {
    const msg = ev.data;
    if (!msg || !msg.__neonSync) return;

    if (msg.type === 'hello') {
      // If Firestore is empty, seed it from this client
      const kv = msg.payload?.kv || {};
      await ensureDocFromIframe(kv);
      return;
    }

    if (msg.type === 'localChange') {
      if (applyingRemote) return;
      const { key, value } = msg.payload || {};
      if (!key) return;

      try {
        await setDoc(docRef, {
          kv: { [key]: value },
          updatedAt: serverTimestamp()
        }, { merge: true });
      } catch (e) {
        console.warn('Firestore write failed:', e);
      }
    }
  });

  // Firestore -> iframe live updates
  onSnapshot(docRef, (snap) => {
    if (!snap.exists()) return;
    const data = snap.data() || {};
    const kv = data.kv || {};

    applyingRemote = true;
    postToIframe('applyRemote', { kv });
    // allow local edits again on next tick
    setTimeout(() => (applyingRemote = false), 0);
  });
</script>
  // ---- Fit 1920x1080 stage to any screen (mobile looks like PC) ----
(function(){
  const STAGE_W = 1920, STAGE_H = 1080;
  const stage = document.getElementById('stage');
  if(!stage) return;

  function fit(){
    const vw = window.visualViewport ? window.visualViewport.width : window.innerWidth;
    const vh = window.visualViewport ? window.visualViewport.height : window.innerHeight;
    const s = Math.min(vw / STAGE_W, vh / STAGE_H);
    stage.style.setProperty('--s', s.toFixed(5));
  }

  window.addEventListener('resize', fit, {passive:true});
  window.addEventListener('orientationchange', fit, {passive:true});
  if(window.visualViewport) window.visualViewport.addEventListener('resize', fit, {passive:true});
  fit();
})();
</div>
</div>
</body>
</html>
