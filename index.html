<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Euphoria Online Music Awards 2026</title>
  <style>
    :root {
      --bg: #05060f;
      --panel: rgba(20,25,60,.55);
      --panel2: rgba(10,14,40,.45);
      --border: rgba(120,180,255,.35);
      --text: rgba(235,245,255,.98);
      --muted: rgba(180,205,255,.75);
      --muted2: rgba(150,175,255,.6);
      --accent: linear-gradient(135deg, #22d3ee, #a855f7);
      --accentSolid: #38bdf8;
      --danger: linear-gradient(135deg, #fb7185, #ec4899);
      --chip: rgba(56,189,248,.25);
      --chip2: rgba(168,85,247,.25);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 900px at 30% -10%, rgba(255,255,255,.06), transparent 60%), var(--bg);
      color: var(--text);
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 20px; }
    @media (min-width: 640px) { .wrap { padding: 32px; } }
    h1 { margin: 0; font-size: 26px; letter-spacing: -0.02em; }
    @media (min-width: 640px) { h1 { font-size: 34px; } }
    p { margin: 6px 0 0; color: var(--muted); font-size: 13px; }
    .topbar { display: flex; flex-direction: column; gap: 12px; }
    @media (min-width: 760px) { .topbar { flex-direction: row; align-items: center; justify-content: space-between; } }
    .row { display:flex; gap:10px; flex-wrap: wrap; align-items:center; }
    .badge{
      display:inline-flex; align-items:center;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: rgba(255,255,255,.8);
    }
    .btn{
      border: 1px solid rgba(120,180,255,.45);
      background: linear-gradient(135deg, rgba(56,189,248,.25), rgba(168,85,247,.25));
      color: var(--text);
      padding: 11px 14px;
      border-radius: 16px;
      font-weight: 800;
      font-size: 13px;
      cursor: pointer;
      transition: transform .08s ease, box-shadow .15s ease, background .15s ease;
      box-shadow: 0 0 0 rgba(56,189,248,0);
    }
    .btn:hover { background: rgba(255,255,255,.07); }
    .btn:active { transform: scale(.99); }
    .btn.primary {
      background: var(--accent);
      color: #05060f;
      border-color: transparent;
      box-shadow: 0 0 18px rgba(168,85,247,.55);
    }
    .btn.primary:hover { background: rgba(255,255,255,.85); }
    .btn.danger {
      background: var(--danger);
      border-color: transparent;
      box-shadow: 0 0 18px rgba(236,72,153,.55);
    }
    .btn.danger:hover { filter: brightness(1.05); }
    .grid3 { display:grid; grid-template-columns: 1fr; gap: 14px; margin-top: 26px; }
    @media (min-width: 820px) { .grid3 { grid-template-columns: repeat(3, 1fr); } }
    .card{
      box-shadow: 0 0 0 rgba(56,189,248,0), 0 20px 50px rgba(0,0,0,.45);

      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 18px;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
    }
    .card .hd{ padding: 16px 16px 10px; display:flex; align-items:center; justify-content:space-between; gap: 10px; }
    .card .bd{ padding: 0 16px 16px; }
    .title{ font-weight: 900; font-size: 18px; }
    .muted{ color: var(--muted); }
    .hint{ margin-top: 10px; font-size: 12px; color: var(--muted2); }
    .toolbar { margin-top: 18px; display:flex; flex-direction:column; gap: 10px; }
    @media (min-width: 760px) { .toolbar { flex-direction: row; align-items:center; justify-content: space-between; } }
    .searchWrap { position: relative; width: 100%; max-width: 360px; }
    .searchWrap input{
      width: 100%;
      padding: 10px 12px 10px 38px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.25);
      color: var(--text);
      outline: none;
      font-size: 13px;
    }
    .searchWrap .icon{
      position:absolute; left: 12px; top: 50%; transform: translateY(-50%);
      opacity: .7; font-size: 14px;
    }
    .cats { display: grid; gap: 14px; margin-top: 14px; }
    .cat{
      box-shadow: 0 0 0 rgba(168,85,247,0), 0 18px 45px rgba(0,0,0,.45);

      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 18px;
      overflow: hidden;
    }
    .cat.dragOver { outline: 2px solid rgba(255,255,255,.18); }
    .catHeader{
      padding: 14px 14px 10px;
      display:flex; align-items:flex-start; justify-content: space-between; gap: 10px;
    }
    .catHeaderLeft { display:flex; align-items:flex-start; gap: 10px; min-width: 0; }
    .grab{
      width: 26px; height: 26px;
      border-radius: 10px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border);
      cursor: grab;
      user-select: none;
      flex: 0 0 auto;
    }
    .grab:active { cursor: grabbing; }
    .catName { font-weight: 900; font-size: 15px; white-space: nowrap; overflow:hidden; text-overflow: ellipsis; max-width: 520px; }
    .catRight { display:flex; flex-direction: column; align-items:flex-end; gap: 6px; }
    .scorePool{
      display:flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
      max-width: 360px;
    }
    .scorePool.dragOver{ outline: 2px solid rgba(255,255,255,.18); outline-offset: 4px; border-radius: 14px; }
    
    /* Eurovision-like score tiles */
    .scorePool{
      display:flex;
      flex-wrap: nowrap;
      gap: 0;
      justify-content: flex-end;
      max-width: 420px;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
    }
    .chip{
      display:inline-flex; align-items:center; justify-content:center;
      width: 40px; height: 30px;
      padding: 0;
      border-right: 1px solid rgba(255,255,255,.10);
      border-left: 0;
      border-top: 0;
      border-bottom: 0;
      border-radius: 0;
      color: rgba(255,255,255,.95);
      font-size: 14px;
      font-weight: 900;
      cursor: pointer;
      user-select: none;
      letter-spacing: .02em;
      text-shadow: 0 1px 0 rgba(0,0,0,.35);
    }
    .chip:last-child{ border-right: 0; }
    .chip:active { transform: translateY(0.5px); }
    .chip.assigned{
      width: 40px; height: 30px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
    }
    .chip.selected{
      box-shadow: 0 0 14px rgba(56,189,248,.85), inset 0 0 8px rgba(255,255,255,.25);

      outline: 2px solid rgba(255,255,255,.55);
      outline-offset: -2px;
    }
    /* Color mapping similar to Eurovision: 1-7 blue/purple, 8-12 red */
    .s1 { background: linear-gradient(180deg, #2f2b6b, #221f52); }
    .s2 { background: linear-gradient(180deg, #32307a, #26235f); }
    .s3 { background: linear-gradient(180deg, #35358a, #2a286b); }
    .s4 { background: linear-gradient(180deg, #383b9a, #2d2f77); }
    .s5 { background: linear-gradient(180deg, #3b41aa, #303583); }
    .s6 { background: linear-gradient(180deg, #3e47ba, #333c8f); }
    .s7 { background: linear-gradient(180deg, #414dca, #36429b); }
    .s8 { background: linear-gradient(180deg, #b5163b, #8f0f2e); }
    .s10{ background: linear-gradient(180deg, #c11335, #9a0f2a); }
    .s12{ background: linear-gradient(180deg, #d3112f, #a60f25); }
    .list{
      margin: 0 14px 14px;
      padding: 10px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: var(--panel2);
      min-height: 24px;
    }
    .item{
      display:flex; align-items:flex-start; gap: 10px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.20);
      border-radius: 14px;
      padding: 10px 10px;
      margin-bottom: 10px;
    }
    .item:last-child { margin-bottom: 0; }
    .item.dragging { opacity: .6; }
    .item.dropOver { outline: 2px solid rgba(255,255,255,.18); }
    .itemText { font-size: 13px; line-height: 1.25rem; }
    .scoreBox{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap: 8px;
      min-width: 120px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }
    .scoreLabel { font-size: 11px; color: var(--muted2); }
    .scoreVal{
      min-width: 36px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--chip2);
      display:flex; align-items:center; justify-content:center;
      font-weight: 900;
      font-size: 12px;
      color: rgba(255,255,255,.9);
    }
    .scoreVal.empty{
      color: rgba(255,255,255,.35);
      border-style: dashed;
      background: rgba(0,0,0,.16);
    }
    .foot { margin-top: 16px; font-size: 12px; color: var(--muted2); }
    .modalBack{
      position: fixed; inset: 0; background: rgba(0,0,0,.72);
      display:none; align-items:center; justify-content:center; z-index: 50;
    }
    .modalBack.open{ display:flex; }
    .modal{
      width: 92vw; max-width: 420px;
      border: 1px solid var(--border);
      background: rgba(24,24,27,.85);
      border-radius: 18px;
      box-shadow: 0 24px 80px rgba(0,0,0,.55);
      padding: 14px;
    }
    .modalTop{ display:flex; align-items:center; justify-content:space-between; gap: 10px; }
    .modalTitle{ font-weight: 900; }
    .modal input{
      width: 100%;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.25);
      color: var(--text);
      outline: none;
      margin-top: 10px;
      font-size: 13px;
    }
    .err{ color: #f87171; font-size: 13px; margin-top: 8px; }
    .modalBtns{ display:flex; justify-content:flex-end; gap: 10px; margin-top: 12px; }
    .dropHint{
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: 14px;
      padding: 10px;
      color: var(--muted2);
      font-size: 12px;
      text-align:center;
      display:none;
    }
    .list.empty .dropHint{ display:block; }
  
    body.selecting { cursor: crosshair; box-shadow: inset 0 0 120px rgba(56,189,248,.08); }
    body.selecting .item { cursor: pointer; }

    /* Highlight voted rows (neon) */
    .item.scored{
      border-color: rgba(56,189,248,.55);
      box-shadow: 0 0 18px rgba(56,189,248,.25), inset 0 0 0 1px rgba(168,85,247,.15);
    }
    .item.scored.s1, .item.scored.s2, .item.scored.s3, .item.scored.s4, .item.scored.s5, .item.scored.s6, .item.scored.s7{
      background: linear-gradient(90deg, rgba(56,189,248,.18), rgba(34,211,238,.10), rgba(0,0,0,.16));
    }
    .item.scored.s8, .item.scored.s10, .item.scored.s12{
      background: linear-gradient(90deg, rgba(251,113,133,.18), rgba(236,72,153,.12), rgba(0,0,0,.16));
      border-color: rgba(236,72,153,.55);
      box-shadow: 0 0 18px rgba(236,72,153,.25), inset 0 0 0 1px rgba(236,72,153,.18);
    }


    /* Smooth reordering animation */
    .item {
      transition: transform 0.9s cubic-bezier(0.22, 1, 0.36, 1), background 0.6s ease, box-shadow 0.6s ease;
    }


    /* --- Intro Splash --- */
    #introSplash{
      position: fixed; inset: 0;
      display:flex; align-items:center; justify-content:center;
      z-index: 9999;
      background:
        radial-gradient(900px 650px at 20% 10%, rgba(56,189,248,.18), transparent 60%),
        radial-gradient(900px 650px at 85% 30%, rgba(236,72,153,.18), transparent 60%),
        radial-gradient(1200px 900px at 30% -10%, rgba(255,255,255,.06), transparent 60%),
        var(--bg);
      overflow:hidden;
    }
    #introSplash::before{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 180deg, rgba(56,189,248,.0), rgba(56,189,248,.16), rgba(168,85,247,.12), rgba(236,72,153,.14), rgba(56,189,248,.0));
      filter: blur(18px);
      animation: introSpin 8s linear infinite;
      opacity:.55;
    }
    @keyframes introSpin { from{ transform: rotate(0deg);} to{ transform: rotate(360deg);} }

    .introCard{
      position:relative;
      width: min(720px, 92vw);
      border-radius: 26px;
      border: 1px solid rgba(120,180,255,.35);
      background: rgba(12,14,34,.55);
      box-shadow: 0 30px 120px rgba(0,0,0,.55), 0 0 40px rgba(56,189,248,.12);
      padding: 34px 26px 26px;
      backdrop-filter: blur(8px);
      overflow:hidden;
    }
    .introGlow{
      position:absolute; inset:-2px;
      background: linear-gradient(135deg, rgba(56,189,248,.35), rgba(168,85,247,.25), rgba(236,72,153,.28));
      opacity:.25;
      filter: blur(18px);
      pointer-events:none;
    }
    .introTitle{
      margin: 0;
      text-align:center;
      font-weight: 1000;
      letter-spacing: -0.03em;
      font-size: clamp(44px, 9vw, 92px);
      line-height: 1;
      background: linear-gradient(90deg, #38bdf8, #a855f7, #fb7185);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow:
        0 0 24px rgba(56,189,248,.35),
        0 0 24px rgba(236,72,153,.28);
      animation: introPulse 2.4s ease-in-out infinite;
    }
    @keyframes introPulse {
      0%,100% { filter: drop-shadow(0 0 10px rgba(56,189,248,.28)) drop-shadow(0 0 10px rgba(236,72,153,.20)); }
      50% { filter: drop-shadow(0 0 18px rgba(56,189,248,.45)) drop-shadow(0 0 18px rgba(236,72,153,.32)); }
    }
    .introSub{
      margin: 12px 0 0;
      text-align:center;
      color: rgba(180,205,255,.82);
      font-weight: 700;
      letter-spacing: .02em;
      font-size: 13px;
    }
    .introBarWrap{
      margin: 22px auto 0;
      width: min(520px, 86vw);
      height: 14px;
      border-radius: 999px;
      border: 1px solid rgba(120,180,255,.35);
      background: rgba(0,0,0,.25);
      overflow:hidden;
      box-shadow: inset 0 0 18px rgba(0,0,0,.35);
    }
    .introBar{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(56,189,248,.95), rgba(168,85,247,.92), rgba(236,72,153,.92));
      box-shadow: 0 0 18px rgba(56,189,248,.35), 0 0 18px rgba(236,72,153,.28);
    }
    .introHint{
      margin-top: 12px;
      text-align:center;
      color: rgba(150,175,255,.68);
      font-size: 12px;
    }

    /* Reveal effect */
    .wrap.introHidden{
      opacity: 0;
      transform: translateY(14px) scale(.985);
      filter: blur(6px);
      pointer-events: none;
    }
    .wrap.introReveal{
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0);
      transition: opacity .9s ease, transform .9s cubic-bezier(0.22,1,0.36,1), filter .9s ease;
      pointer-events: auto;
    }
    #introSplash.out{
      animation: introOut 1.05s cubic-bezier(0.22,1,0.36,1) forwards;
    }
    @keyframes introOut{
      to { opacity: 0; transform: scale(1.03); filter: blur(10px); }
    }

</style>

</head>
<body>
  
  <div id="introSplash" aria-hidden="true">
    <div class="introCard">
      <div class="introGlow"></div>
      <h1 class="introTitle">Euphoria</h1>
      <div class="introSub">Online Music Awards 2026</div>
      <div class="introBarWrap" aria-label="loading">
        <div class="introBar" id="introBar"></div>
      </div>
      <div class="introHint">Loadingâ€¦</div>
    </div>
  </div>
<div class="wrap introHidden">
    <div class="topbar">
      <div>
        <h1>Euphoria Online Music Awards 2026</h1>
        <p>Î£ÏÏÎµ Ï„Î¯Ï„Î»Î¿Ï…Ï‚ Î³Î¹Î± ÏƒÎµÎ¹ÏÎ¬ ÎºÎ±Î¹ ÏƒÏÏÎµ <b>Î²Î±Î¸Î¼Î¿ÏÏ‚</b> (12,10,8,7,6,5,4,3,2,1) Ï€Î¬Î½Ï‰ ÏƒÎµ ÎºÎ¬Î¸Îµ Î³ÏÎ±Î¼Î¼Î® Î³Î¹Î± Î½Î± ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ score Î´ÎµÎ¾Î¹Î¬.</p>
      </div>
      <div class="row" id="actions" style="display:none;">
        <span class="badge" id="activeLabel"></span>
        <button class="btn" id="btnSave">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
        <button class="btn" id="btnReset">Reset</button>
        <button class="btn danger" id="btnLogout">ÎˆÎ¾Î¿Î´Î¿Ï‚</button>
      </div>
    </div>

    <div id="home" class="grid3"></div>

    <div id="app" style="display:none;">
      <div class="toolbar">
        <div class="searchWrap">
          <div class="icon">ğŸ”</div>
          <input id="search" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Ï„Î¯Ï„Î»Î¿Ï… Î® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚â€¦" />
        </div>
        <div class="row">
          <button class="btn" id="btnExport">Î•Î¾Î±Î³Ï‰Î³Î® JSON</button>
        </div>
      </div>

      <div id="cats" class="cats"></div>

      <div class="foot">
        Tips: (1) Î£ÏÏÎµ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ Î±Ï€ÏŒ â ¿. (2) Î£ÏÏÎµ Ï„Î¯Ï„Î»Î¿Ï…Ï‚ Î¼Î­ÏƒÎ± ÏƒÏ„Î¹Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚. (3) Î£ÏÏÎµ Î²Î±Î¸Î¼Î¿ÏÏ‚ Î±Ï€ÏŒ Ï„Î± chips (Î´Î¯Ï€Î»Î± ÏƒÏ„Î¿Î½ Ï„Î¯Ï„Î»Î¿ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚) Ï€Î¬Î½Ï‰ ÏƒÎµ Î¼Î¹Î± Î³ÏÎ±Î¼Î¼Î® Î³Î¹Î± Î½Î± Î¼Ï€ÎµÎ¹ score. ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î¼ÎµÏ„Î±Ï†Î­ÏÎµÎ¹Ï‚ score ÏƒÎµ Î¬Î»Î»Î· Î³ÏÎ±Î¼Î¼Î® Î® Î½Î± Ï„Î¿ ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹Ï‚ ÏƒÏ„Î¿ pool.
      </div>
    </div>
  </div>

  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalTop">
        <div>
          <div class="modalTitle">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚</div>
          <div class="muted" style="font-size:13px;margin-top:4px;">Dataset: <span id="pendingLabel" style="color:var(--text);font-weight:700;"></span></div>
        </div>
        <button class="btn" id="modalClose" aria-label="close">âœ•</button>
      </div>
      <input id="pwd" type="password" placeholder="Î’Î¬Î»Îµ ÎºÏ‰Î´Î¹ÎºÏŒâ€¦" />
      <div class="err" id="pwdErr" style="display:none;"></div>
      <div class="modalBtns">
        <button class="btn" id="modalCancel">Î†ÎºÏ…ÏÎ¿</button>
        <button class="btn primary" id="modalOk">Î£Ï…Î½Î­Ï‡ÎµÎ¹Î±</button>
      </div>
    </div>
  </div>


  <div class="modalBack" id="totalsBack" role="dialog" aria-modal="true">
    <div class="modal" style="max-width: 900px;">
      <div class="modalTop">
        <div>
          <div class="modalTitle">Î£ÏÎ½Î¿Î»Î± Î²Î±Î¸Î¼ÏÎ½ Î±Î½Î¬ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</div>
          <div class="muted" style="font-size:13px;margin-top:4px;">Î£Ï…Î³ÎºÎµÎ½Ï„ÏÏ‰Ï„Î¹ÎºÎ¬ Î±Ï€ÏŒ ÏŒÎ»Î± Ï„Î± datasets (Teri / Monhia / Lijiansi) Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î± scores ÏƒÏ„Î¿Î½ browser.</div>
        </div>
        <button class="btn" id="totalsClose" aria-label="close">âœ•</button>
      </div>
      <div class="searchWrap" style="max-width:none;margin-top:10px;">
        <div class="icon">ğŸ”</div>
        <input id="totalsSearch" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Ï„Î¯Ï„Î»Î¿Ï… Î® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚â€¦" />
      </div>
      <div id="totalsBody" style="margin-top:12px; max-height: 70vh; overflow:auto;"></div>
      <div class="modalBtns">
        <button class="btn" id="totalsOk">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button>
      </div>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  // ğŸ‘‡ Î•Î”Î© ÎšÎŸÎ›Î›Î‘Î£ Î‘Î¥Î¤ÎŸ Î ÎŸÎ¥ Î£ÎŸÎ¥ Î•Î”Î©Î£Î• Î¤ÎŸ FIREBASE
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// Î±Î½ÏÎ½Ï…Î¼Î¿ login
await signInAnonymously(auth);

// ---- Intro splash (16s progress + reveal) ----
(function(){
  const splash = document.getElementById('introSplash');
  const bar = document.getElementById('introBar');
  const wrap = document.querySelector('.wrap');

  const DURATION = 16000; // 16 seconds
  const t0 = performance.now();

  function tick(now){
    const p = Math.min(1, (now - t0) / DURATION);
    if (bar) bar.style.width = (p * 100).toFixed(2) + '%';
    if (p < 1) requestAnimationFrame(tick);
    else finish();
  }

  function finish(){
    if (!wrap) return;
    wrap.classList.remove('introHidden');
    wrap.classList.add('introReveal');
    if (splash){
      splash.classList.add('out');
      setTimeout(() => splash.remove(), 1100);
    }
  }

  requestAnimationFrame(tick);
})();

const DATASETS = {"teri": {"label": "Teri Vi Sentio","categories": [{"id": "cat0","name": "BEST GREEK SONG","items": [{"id": "cat0_item0","title": "Î‘Î»Î®Ï„Î¹ÎºÎ· Î‘Î³Î¬Ï€Î· - LEX & Dof Towgee","score": null},{"id": "cat0_item1","title": "Î‘ÏƒÏ„ÎµÏÎ¿Î¼Î¬Ï„Î± - ÎšÎ»Î±Ï…Î´Î¯Î±","score": null},{"id": "cat0_item2","title": "ÎšÎ±Î¯Î³Î¿Î¼Î±Î¹ - APON","score": null},{"id": "cat0_item3","title": "Lola - ÎœÎ±ÏÎ¯Î½Î± Î£Î¬Ï„Ï„Î¹","score": null},{"id": "cat0_item4","title": "ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹ - Danae","score": null},{"id": "cat0_item5","title": "Î“Î¹Î± Î£Î­Î½Î± - Saske","score": null},{"id": "cat0_item6","title": "ÎœÎµ Î›Î¯Î³Î± Î›ÏŒÎ³Î¹Î± - ÎÎ¯ÎºÎ¿Ï‚ ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼ÏŒÏ€Î¿Ï…Î»Î¿Ï‚","score": null},{"id": "cat0_item7","title": "Î ÎµÏ‚ ÎšÎ±Î¹ Î˜Î± 'ÏÎ¸Ï‰ - Î§ÏÎ·ÏƒÎ·Î¯Î´Î± Î“ÎºÎ±Î³ÎºÎ¿ÏÏ„Î·","score": null}],"scorePool": null},{"id": "cat1","name": "BEST FOREIGN SONG","items": [{"id": "cat1_item0","title": "Batmana Ansak - Sherine","score": null},{"id": "cat1_item1","title": "Baddies - Aya Nakamura","score": null},{"id": "cat1_item2","title": "Messiah - Sevdaliza","score": null},{"id": "cat1_item3","title": "Sports Car - Tate McRae","score": null},{"id": "cat1_item4","title": "Die On This Hill - Sienna Spiro","score": null},{"id": "cat1_item5","title": "Ordinary - Alex Warren","score": null},{"id": "cat1_item6","title": "like JENNIE - JENNIE","score": null},{"id": "cat1_item7","title": "Rockstar - Lisa","score": null},{"id": "cat1_item8","title": "SÃ£o Paulo - The Weeknd","score": null},{"id": "cat1_item9","title": "Manchild - Sabrina Carpenter","score": null},{"id": "cat1_item10","title": "The Fate of Ophelia - Taylor Swift","score": null},{"id": "cat1_item11","title": "What I Want - Morgan Wallen ft. Tate McRae","score": null},{"id": "cat1_item12","title": "Chanel - Tyla","score": null},{"id": "cat1_item13","title": "Is it - Tyla","score": null},{"id": "cat1_item14","title": "Gabriela - Katseye","score": null}],"scorePool": null},{"id": "cat2","name": "BEST GREEK MALE ARTIST","items": [{"id": "cat2_item0","title": "FY","score": null},{"id": "cat2_item1","title": "Snik","score": null},{"id": "cat2_item2","title": "Toquel","score": null},{"id": "cat2_item3","title": "Rack","score": null},{"id": "cat2_item4","title": "Lex","score": null},{"id": "cat2_item5","title": "Î£Î¬ÎºÎ·Ï‚ Î¡Î¿Ï…Î²Î¬Ï‚","score": null},{"id": "cat2_item6","title": "Pan Pan","score": null}],"scorePool": null},{"id": "cat3","name": "BEST FOREIGN MALE ARTIST","items": [{"id": "cat3_item0","title": "Justin bieber","score": null},{"id": "cat3_item1","title": "Chris Brown","score": null},{"id": "cat3_item2","title": "Zayn","score": null},{"id": "cat3_item3","title": "Shawn Mendez","score": null},{"id": "cat3_item4","title": "Troye Sivan","score": null},{"id": "cat3_item5","title": "Travis Scott","score": null},{"id": "cat3_item6","title": "Conan Grey","score": null}],"scorePool": null},{"id": "cat4","name": "BEST GREEK FEMALE ARTIST","items": [{"id": "cat4_item0","title": "ÎÎ±Ï„Î¬ÏƒÏƒÎ± ÎœÏ€Î¿Ï†Î¯Î»Î¹Î¿Ï…","score": null},{"id": "cat4_item1","title": "Paola","score": null},{"id": "cat4_item2","title": "ÎšÎ±Ï„ÎµÏÎ¯Î½Î± Î›Î¹ÏŒÎ»Î¹Î¿Ï…","score": null},{"id": "cat4_item3","title": "Josephine","score": null}],"scorePool": null},{"id": "cat5","name": "BEST FOREIGN FEMALE ARTIST","items": [{"id": "cat5_item0","title": "Ariana Grande","score": null},{"id": "cat5_item1","title": "Jenie","score": null},{"id": "cat5_item2","title": "Lissa","score": null},{"id": "cat5_item3","title": "BeyoncÃ©","score": null},{"id": "cat5_item4","title": "Charli xcx","score": null},{"id": "cat5_item5","title": "Lana del rey","score": null},{"id": "cat5_item6","title": "Adele","score": null},{"id": "cat5_item7","title": "Raye","score": null}],"scorePool": null},{"id": "cat6","name": "BEST GR MUSIC VIDEO","items": [{"id": "cat6_item0","title": "ÎœÏ€Î¿ÏÏ ÎšÎ¹ Î•Î³Ï - Î•Î»Î­Î½Î· Î¦Î¿Ï…ÏÎ­Î¹ÏÎ± & Î§ÏÎ®ÏƒÏ„Î¿Ï‚ ÎœÎ¬ÏƒÏ„Î¿ÏÎ±Ï‚","score": null},{"id": "cat6_item1","title": "Î•Î¾Î±Î¯ÏÎµÏƒÎ· - Î†Î½Î½Î± Î’Î¯ÏƒÏƒÎ·","score": null},{"id": "cat6_item2","title": "ÎÎµÏÏŒ - ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï‚ Î‘ÏÎ³Ï…ÏÏŒÏ‚","score": null},{"id": "cat6_item3","title": "Alleluia - Î•Î»Î­Î½Î· Î¦Î¿Ï…ÏÎ­Î¹ÏÎ±","score": null},{"id": "cat6_item4","title": "ÎœÎ¿Î½Î¿Ï„Î¿Î½Î¯Î± - Î¤Î¬Î¼Ï„Î± ft. Lila","score": null},{"id": "cat6_item5","title": "Î’Î¿ÏÎ¹Î¬Ï‚ - APON","score": null},{"id": "cat6_item6","title": "Î†Î»Î»Î¿ - Î‘Î½Î±ÏƒÏ„Î±ÏƒÎ¯Î±","score": null},{"id": "cat6_item7","title": "Î Î±Î½ÏƒÎ­Î»Î·Î½Î¿Ï‚ - Î”Î­ÏƒÏ€Î¿Î¹Î½Î± Î’Î±Î½Î´Î·","score": null},{"id": "cat6_item8","title": "Ma Bella - Rack","score": null},{"id": "cat6_item9","title": "Î‘Î½Î¬ÎºÎ±Ï„Î± - Tamta","score": null},{"id": "cat6_item10","title": "Î“Î¹Î± 'ÏƒÎ­Î½Î± - Saske","score": null},{"id": "cat6_item11","title": "Î›Î­ÎµÎ¹ - Josephine","score": null}],"scorePool": null},{"id": "cat7","name": "BEST FOREIGN MUSIC VIDEO","items": [{"id": "cat7_item0","title": "like - JENNIE","score": null},{"id": "cat7_item1","title": "Ordinary - Alex Warren","score": null},{"id": "cat7_item2","title": "Birds Of A Feather - Billie Eilish","score": null},{"id": "cat7_item3","title": "Espresso - Sabrina Carpenter","score": null},{"id": "cat7_item4","title": "We Canâ€™t Be Friends - Ariana Grande","score": null},{"id": "cat7_item5","title": "Sex ÎŸn Î¤he Î’eat - AdÃ©la","score": null},{"id": "cat7_item6","title": "Zen - JENNIE","score": null},{"id": "cat7_item7","title": "Rockstar - Lisa","score": null},{"id": "cat7_item8","title": "The Subway - Chappell Roan","score": null},{"id": "cat7_item9","title": "House - Charlie xcx","score": null},{"id": "cat7_item10","title": "The Fate Of Ophelia - Taylor Swift","score": null},{"id": "cat7_item11","title": "Party 4 U - Charli xcx","score": null},{"id": "cat7_item12","title": "Berghain - Rosalia","score": null},{"id": "cat7_item13","title": "Chanel - Tyla","score": null}],"scorePool": null},{"id": "cat8","name": "BEST ESC 25 PERFORMANCE","items": [{"id": "cat8_item0","title": "Shh - Theo Evan","score": null},{"id": "cat8_item1","title": "Survivor - PARG","score": null},{"id": "cat8_item2","title": "Strobe Lights - Red Sebastian","score": null},{"id": "cat8_item3","title": "Gaja - Justyna Steczkowska","score": null},{"id": "cat8_item4","title": "Voyage - Zoe Me","score": null},{"id": "cat8_item5","title": "Cest La Vie - Claude","score": null},{"id": "cat8_item6","title": "Tavo Akys - Katarsis","score": null}],"scorePool": null},{"id": "cat9","name": "BEST ALBUM","items": [{"id": "cat9_item0","title": "Mayhem - Lady Gaga","score": null},{"id": "cat9_item1","title": "Lux - Rosalia","score": null},{"id": "cat9_item2","title": "So Close To What - Tate McRae","score": null},{"id": "cat9_item3","title": "The Villain Heroine - Tamta","score": null},{"id": "cat9_item4","title": "Alter Ego - Lisa","score": null},{"id": "cat9_item5","title": "Ruby - JENNIE","score": null},{"id": "cat9_item6","title": "To Diko mou DNA - ÎšÎ±Ï„ÎµÏÎ¯Î½Î± Î›Î¹ÏŒÎ»Î¹Î¿Ï…","score": null},{"id": "cat9_item7","title": "Î‘Ï€Î¿Ï„ÏÏ€Ï‰Î¼Î± - Lila","score": null},{"id": "cat9_item8","title": "ÎŸ Î§Î¿ÏÏŒÏ‚ - FY","score": null},{"id": "cat9_item9","title": "The Life Of A Showgirl - Taylor Swift","score": null},{"id": "cat9_item10","title": "Mayhem - Lady Gaga","score": null}],"scorePool": null}]},"monhia": {"label": "Monhia","categories": [{"id": "cat0","name": "BEST GREEK SONG","items": [{"id": "cat0_item0","title": "Î§ÏÏŒÎ½Î¹Î± Î Î¿Î»Î»Î¬ - Î•Î»Î­Î½Î· Î¦Î¿Ï…ÏÎ­Î¹ÏÎ±","score": null},{"id": "cat0_item1","title": "Î‘Î½ÎµÎ¾Î¬ÏÏ„Î·Ï„Î· - Î™Î¿Ï…Î»Î¯Î± ÎšÎ±Î»Î»Î¹Î¼Î¬Î½Î·","score": null},{"id": "cat0_item2","title": "Î‘Î»Î®Ï„Î¹ÎºÎ· Î‘Î³Î¬Ï€Î· - LEX & Dof Twogee","score": null},{"id": "cat0_item3","title": "Î§ÏŒÏÎµÏˆÎµ - ÎœÎ¹Ï‡Î¬Î»Î·Ï‚ Î§Î±Ï„Î¶Î·Î³Î¹Î¬Î½Î½Î·Ï‚","score": null},{"id": "cat0_item4","title": "Î‘ÏƒÏ„ÎµÏÎ¿Î¼Î¬Ï„Î± - ÎšÎ»Î±Ï…Î´Î¯Î±","score": null},{"id": "cat0_item5","title": "Î‘Ï‡ ÎšÎ±ÏÎ´Î¹Î¬ ÎœÎ¿Ï… - ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï‚ Î‘ÏÎ³Ï…ÏÏŒÏ‚","score": null},{"id": "cat0_item6","title": "ÎšÎ±Î»Î¬ Î½Î± Ï€ÎµÏÎ½Î¬Ï„Îµ - Î”Î­ÏƒÏ€Î¿Î¹Î½Î± Î’Î±Î½Î´Î®","score": null},{"id": "cat0_item7","title": "ÎšÎ±Î¯Î³Î¿Î¼Î±Î¹ - APON","score": null},{"id": "cat0_item8","title": "Î’Î¿ÏÎ¹Î¬Ï‚ - APON","score": null},{"id": "cat0_item9","title": "ÎšÎ¬Ï„Î¹ ÎÎ­ÏÎµÎ¹Ï‚ - Î¡Î¯Î± Î•Î»Î»Î·Î½Î¯Î´Î¿Ï…","score": null},{"id": "cat0_item10","title": "Lola - ÎœÎ±ÏÎ¯Î½Î± Î£Î¬Ï„Ï„Î¹","score": null}],"scorePool": null},{"id": "cat1","name": "BEST FOREIGN SONG","items": [{"id": "cat1_item0","title": "Not Like Us - Kendrick Lamar","score": null},{"id": "cat1_item1","title": "Dancing In The Flames - The Weeknd","score": null},{"id": "cat1_item2","title": "The Dead Dance - Lady Gaga","score": null},{"id": "cat1_item3","title": "The Fate of Ophelia - Taylor Swift","score": null},{"id": "cat1_item4","title": "Bad Dreams - Teddy Swims","score": null},{"id": "cat1_item5","title": "Feelslikeimfallinginlove - Coldplay","score": null},{"id": "cat1_item6","title": "Ordinary - Alex Warren","score": null},{"id": "cat1_item7","title": "Messy - Lola Young","score": null},{"id": "cat1_item8","title": "I Had Some Help - Post Malone ft. Morgan Wallen","score": null},{"id": "cat1_item9","title": "TEXAS HOLD 'EM - BeyoncÃ©","score": null},{"id": "cat1_item10","title": "Manchild - Sabrina Carpenter","score": null},{"id": "cat1_item11","title": "What I Want - Morgan Wallen ft. Tate McRae","score": null},{"id": "cat1_item12","title": "Chanel - Tyla","score": null},{"id": "cat1_item13","title": "Is it - Tyla","score": null},{"id": "cat1_item14","title": "Gabriela - Katseye","score": null}],"scorePool": null},{"id": "cat2","name": "BEST GREEK MALE ARTIST","items": [{"id": "cat2_item0","title": "Î‘Î½Ï„ÏÎ½Î·Ï‚ Î¡Î­Î¼Î¿Ï‚","score": null},{"id": "cat2_item1","title": "FY","score": null},{"id": "cat2_item2","title": "Î˜Î¿Î´Ï‰ÏÎ®Ï‚ Î¦Î­ÏÏÎ·Ï‚","score": null},{"id": "cat2_item3","title": "Î Î­Ï„ÏÎ¿Ï‚ Î™Î±ÎºÏ‰Î²Î¹Î´Î·Ï‚","score": null},{"id": "cat2_item4","title": "Snik","score": null},{"id": "cat2_item5","title": "Toquel","score": null},{"id": "cat2_item6","title": "Rack","score": null},{"id": "cat2_item7","title": "Lex","score": null},{"id": "cat2_item8","title": "Î“Î¹ÏÏÎ³Î¿Ï‚ Î£Î±Î¼Ï€Î¬Î½Î·Ï‚","score": null}],"scorePool": null},{"id": "cat3","name": "BEST FOREIGN MALE ARTIST","items": [{"id": "cat3_item0","title": "Teddy Swims","score": null},{"id": "cat3_item1","title": "Chris Brown","score": null},{"id": "cat3_item2","title": "Travis Scott","score": null},{"id": "cat3_item3","title": "Benson Boone","score": null},{"id": "cat3_item4","title": "Post Malone","score": null}],"scorePool": null},{"id": "cat4","name": "BEST GREEK FEMALE ARTIST","items": [{"id": "cat4_item0","title": "ÎšÎ±Ï„ÎµÏÎ¯Î½Î± Î›Î¹ÏŒÎ»Î¹Î¿Ï…","score": null},{"id": "cat4_item1","title": "Josephine","score": null},{"id": "cat4_item2","title": "ÎÎ±Ï„Î¬ÏƒÎ± Î˜ÎµÎ¿Î´Ï‰ÏÎ¯Î´Î¿Ï…","score": null},{"id": "cat4_item3","title": "Î¡Î¯Î± Î•Î»Î»Î·Î½Î¯Î´Î¿Ï…","score": null},{"id": "cat4_item4","title": "Î™Î¿Ï…Î»Î¯Î± ÎšÎ±Î»Î»Î¹Î¼Î¬Î½Î·","score": null},{"id": "cat4_item5","title": "ÎšÎ±Î¯Ï„Î· Î“Î±ÏÎ¼Ï€Î®","score": null},{"id": "cat4_item6","title": "Î‰Î²Î· Î‘Î´Î¬Î¼Î¿Ï…","score": null}],"scorePool": null},{"id": "cat5","name": "BEST FOREIGN FEMALE ARTIST","items": [{"id": "cat5_item0","title": "Ariana Grande","score": null},{"id": "cat5_item1","title": "BeyoncÃ©","score": null},{"id": "cat5_item2","title": "Charli xcx","score": null},{"id": "cat5_item3","title": "Lola Î¥oung","score": null},{"id": "cat5_item4","title": "Chappell Roan","score": null},{"id": "cat5_item5","title": "Olivia Rodrigo","score": null},{"id": "cat5_item6","title": "Shakira","score": null}],"scorePool": null},{"id": "cat6","name": "BEST GR MUSIC VIDEO","items": [{"id": "cat6_item0","title": "ÎœÏ€Î¿ÏÏ ÎšÎ¹ Î•Î³Ï - Î•Î»Î­Î½Î· Î¦Î¿Ï…ÏÎ­Î¹ÏÎ± & Î§ÏÎ®ÏƒÏ„Î¿Ï‚ ÎœÎ¬ÏƒÏ„Î¿ÏÎ±Ï‚","score": null},{"id": "cat6_item1","title": "Alleluia - Î•Î»Î­Î½Î· Î¦Î¿Ï…ÏÎ­Î¹ÏÎ±","score": null},{"id": "cat6_item2","title": "ÎœÎ¿Î½Î¿Ï„Î¿Î½Î¯Î± - Tamta ft. Lila","score": null},{"id": "cat6_item3","title": "Î“Î¹Î± Î£Î­Î½Î± - Saske","score": null},{"id": "cat6_item4","title": "ÎœÎ¿Î½Î±Ï‡Î¹ÎºÎ® ÎšÎ±ÏÎ´Î¹Î¬ - Î§ÏÎ®ÏƒÏ„Î¿Ï‚ ÎœÎ¬ÏƒÏ„Î¿ÏÎ±Ï‚","score": null},{"id": "cat6_item5","title": "ÎšÎ¬Ï„Î¹ ÎÎ­ÏÎµÎ¹Ï‚ - Î¡Î¯Î± Î•Î»Î»Î·Î½Î¯Î´Î¿Ï…","score": null},{"id": "cat6_item6","title": "Î¤Î¿ Î’Î±Î»Îµ - ÎšÎ±Ï„ÎµÏÎ¯Î½Î± Î›Î¹ÏŒÎ»Î¹Î¿Ï…","score": null},{"id": "cat6_item7","title": "Î‘Ï‡ ÎšÎ±ÏÎ´Î¹Î¬ ÎœÎ¿Ï… - ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï‚ Î‘ÏÎ³Ï…ÏÏŒÏ‚","score": null},{"id": "cat6_item8","title": "Î§ÏŒÏÎµÏˆÎµ - ÎœÎ¹Ï‡Î¬Î»Î·Ï‚ Î§Î±Ï„Î¶Î·Î³Î¹Î¬Î½Î½Î·Ï‚","score": null},{"id": "cat6_item9","title": "ÎšÎ±Î»Î­... Î Î¿Î¹Î¿Ï‚ Î•Î¯Î½Î±Î¹ Î‘Ï…Ï„ÏŒÏ‚? - Î‘Î½Î´ÏÎ¿Î¼Î¬Ï‡Î·","score": null},{"id": "cat6_item10","title": "Î›Î­ÎµÎ¹ - Josephine","score": null},{"id": "cat6_item11","title": "Î‘Ï€Î¿Ï„ÏÏ€Ï‰Î¼Î± - Lila","score": null},{"id": "cat6_item12","title": "Î›ÏŒÎ³Î¹Î± - Î‰Î²Î· Î‘Î´Î¬Î¼Î¿Ï…","score": null}],"scorePool": null},{"id": "cat7","name": "BEST FOREIGN MUSIC VIDEO","items": [{"id": "cat7_item0","title": "TEXAS HOLD 'EM - BeyoncÃ©","score": null},{"id": "cat7_item1","title": "Ordinary - Alex Warren","score": null},{"id": "cat7_item2","title": "Midnight Sun - Zara Larsson","score": null},{"id": "cat7_item3","title": "The Dead Dance - Lady Gaga","score": null},{"id": "cat7_item4","title": "Golden - Huntr/x, Ejae, Audrey Nuna & Rei Ami","score": null},{"id": "cat7_item5","title": "The Door - Teddy Swims","score": null},{"id": "cat7_item6","title": "Bad Dreams - Teddy Swims","score": null},{"id": "cat7_item7","title": "Training Season - Dua Lipa","score": null},{"id": "cat7_item8","title": "Sex ÎŸn Î¤he Î’eat - AdÃ©la","score": null},{"id": "cat7_item9","title": "Berghain - Rosalia","score": null},{"id": "cat7_item10","title": "The Subway - Chappell Roan","score": null},{"id": "cat7_item11","title": "The Fate of Ophelia - Taylor Swift","score": null},{"id": "cat7_item12","title": "Party 4 u - Charli xcx","score": null},{"id": "cat7_item13","title": "Chanel - Tyla","score": null},{"id": "cat7_item14","title": "Fortnight - Taylor Swift ft. Post Malone","score": null}],"scorePool": null},{"id": "cat8","name": "BEST ESC 25 PERFORMANCE","items": [{"id": "cat8_item0","title": "Bara Bada Bastu - KAJ","score": null},{"id": "cat8_item1","title": "Esa Diva - Melody","score": null},{"id": "cat8_item2","title": "Espresso Macciato - Tommy Cash","score": null},{"id": "cat8_item3","title": "Shh - Theo Evan","score": null},{"id": "cat8_item4","title": "Survivor - Parg","score": null},{"id": "cat8_item5","title": "Maman - Louane","score": null},{"id": "cat8_item6","title": "Strobe Lights - Red Sebastian","score": null},{"id": "cat8_item7","title": "New Day Will Rise - Yuval Raphael","score": null}],"scorePool": null},{"id": "cat9","name": "BEST ALBUM","items": [{"id": "cat9_item0","title": "Cowboy Carter - BeyoncÃ©","score": null},{"id": "cat9_item1","title": "Radical Optimism - Dua Lipa","score": null},{"id": "cat9_item2","title": "The Tortured Poets Department - Taylor Swift","score": null},{"id": "cat9_item3","title": "Hit Me Hard and Soft - Billie Eilish","score": null},{"id": "cat9_item4","title": "The Villain Heroine - Tamta","score": null},{"id": "cat9_item5","title": "To Diko mou DNA - ÎšÎ±Ï„ÎµÏÎ¯Î½Î± Î›Î¹ÏŒÎ»Î¹Î¿Ï…","score": null},{"id": "cat9_item6","title": "Î‘Ï€Î¿Ï„ÏÏ€Ï‰Î¼Î± - Lila","score": null},{"id": "cat9_item7","title": "ÎŸ Î§Î¿ÏÏŒÏ‚ - FY","score": null},{"id": "cat9_item8","title": "The Life Of A Showgirl - Taylor Swift","score": null},{"id": "cat9_item9","title": "Î’Î¿ÏÎ¹Î¬Ï‚ - APON","score": null},{"id": "cat9_item10","title": "Not Like Us - Kendrick Lamar","score": null},{"id": "cat9_item11","title": "We Can't Be Friends - Ariana Grande","score": null},{"id": "cat9_item12","title": "I Had Some Help - Post Malone ft. Morgan Wallen","score": null},{"id": "cat9_item13","title": "Feelslikeimfallinginlove - Coldplay","score": null},{"id": "cat9_item14","title": "Saturn - Satiyar","score": null}],"scorePool": null}]},"lijiansi": {"label": "Lijiansi","categories": [{"id": "cat0","name": "BEST GREEK SONG","items": [{"id": "cat0_item0","title": "Î§ÏÏŒÎ½Î¹Î± Ï€Î¿Î»Î»Î¬ - Î•Î»Î­Î½Î· Î¦Î¿Ï…ÏÎ­Î¹ÏÎ±","score": null},{"id": "cat0_item1","title": "ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹ - Danae","score": null},{"id": "cat0_item2","title": "Î“Î¹Î± Î£Î­Î½Î± - Saske","score": null},{"id": "cat0_item3","title": "Î‘Î½ÎµÎ¾Î¬ÏÏ„Î·Ï„Î· - Î™Î¿Ï…Î»Î¯Î± ÎšÎ±Î»Î»Î¹Î¼Î¬Î½Î·","score": null},{"id": "cat0_item4","title": "Î§ÏŒÏÎµÏˆÎµ - ÎœÎ¹Ï‡Î¬Î»Î·Ï‚ Î§Î±Ï„Î¶Î·Î³Î¹Î¬Î½Î½Î·Ï‚","score": null},{"id": "cat0_item5","title": "Î‘Ï‡ ÎšÎ±ÏÎ´Î¹Î¬ ÎœÎ¿Ï… - ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï‚ Î‘ÏÎ³Ï…ÏÏŒÏ‚","score": null},{"id": "cat0_item6","title": "ÎšÎ±Î»Î¬ ÎÎ± Î ÎµÏÎ½Î¬Ï„Îµ - Î”Î­ÏƒÏ€Î¿Î¹Î½Î± Î’Î±Î½Î´Î®","score": null},{"id": "cat0_item7","title": "ÎœÎµ Î›Î¯Î³Î± Î›ÏŒÎ³Î¹Î± - ÎÎ¯ÎºÎ¿Ï‚ ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼ÏŒÏ€Î¿Ï…Î»Î¿Ï‚","score": null},{"id": "cat0_item8","title": "Î ÎµÏ‚ ÎšÎ±Î¹ Î˜Î± Î¡Î¸Ï‰ - Î§ÏÎ·ÏƒÎ·Î¯Î´Î± Î“ÎºÎ±Î³ÎºÎ¿ÏÏ„Î·","score": null},{"id": "cat0_item9","title": "Î’Î¿ÏÎ¹Î¬Ï‚ - APON","score": null},{"id": "cat0_item10","title": "ÎšÎ¬Ï„Î¹ ÎÎ­ÏÎµÎ¹Ï‚ - Î¡Î¯Î± Î•Î»Î»Î·Î½Î¯Î´Î¿Ï…","score": null}],"scorePool": null},{"id": "cat1","name": "BEST FOREIGN SONG","items": [{"id": "cat1_item0","title": "Not Like Us - Kendrick Lamar","score": null},{"id": "cat1_item1","title": "Dancing In The Flames - The Weeknd","score": null},{"id": "cat1_item2","title": "The Dead Dance - Lady Gaga","score": null},{"id": "cat1_item3","title": "Batmana Ansak - Sherine","score": null},{"id": "cat1_item4","title": "Bad Dreams - Teddy Swims","score": null},{"id": "cat1_item5","title": "Feelslikeimfallinginlove - Coldplay","score": null},{"id": "cat1_item6","title": "Baddies - Aya Nakamura","score": null},{"id": "cat1_item7","title": "Messiah - Sevdaliza","score": null},{"id": "cat1_item8","title": "Sports Car - Tate McRae","score": null},{"id": "cat1_item9","title": "Die On this hill - Sienna Spiro","score": null},{"id": "cat1_item10","title": "like JENNIE - JENNIE","score": null},{"id": "cat1_item11","title": "Rockstar - Lisa","score": null},{"id": "cat1_item12","title": "SÃ£o Paulo - The Weeknd","score": null},{"id": "cat1_item13","title": "Messy - Lola Young","score": null},{"id": "cat1_item14","title": "I Had Some Help - Post Malone ft. Morgan Wallen","score": null},{"id": "cat1_item15","title": "TEXAS HOLD 'EM - BeyoncÃ©","score": null}],"scorePool": null},{"id": "cat2","name": "BEST GREEK MALE ARTIST","items": [{"id": "cat2_item0","title": "Î‘Î½Ï„ÏÎ½Î·Ï‚ Î¡Î­Î¼Î¿Ï‚","score": null},{"id": "cat2_item1","title": "Î£Î¬ÎºÎ·Ï‚ Î¡Î¿Ï…Î²Î¬Ï‚","score": null},{"id": "cat2_item2","title": "Î˜Î¿Î´Ï‰ÏÎ®Ï‚ Î¦Î­ÏÏÎ·Ï‚","score": null},{"id": "cat2_item3","title": "Î Î­Ï„ÏÎ¿Ï‚ Î™Î±ÎºÏ‰Î²Î¹Î´Î·Ï‚","score": null},{"id": "cat2_item4","title": "Pan Pan","score": null},{"id": "cat2_item5","title": "Î“Î¹ÏÏÎ³Î¿Ï‚ Î£Î±Î¼Ï€Î¬Î½Î·Ï‚","score": null}],"scorePool": null},{"id": "cat3","name": "BEST FOREIGN MALE ARTIST","items": [{"id": "cat3_item0","title": "Teddy Swims","score": null},{"id": "cat3_item1","title": "Justin Î’ieber","score": null},{"id": "cat3_item2","title": "Zayn","score": null},{"id": "cat3_item3","title": "Shawn Mendez","score": null},{"id": "cat3_item4","title": "Troye Sivan","score": null},{"id": "cat3_item5","title": "Benson Boone","score": null},{"id": "cat3_item6","title": "Post Malone","score": null}],"scorePool": null},{"id": "cat4","name": "BEST GREEK FEMALE ARTIST","items": [{"id": "cat4_item0","title": "ÎÎ±Ï„Î¬ÏƒÏƒÎ± ÎœÏ€Î¿Ï†Î¯Î»Î¹Î¿Ï…","score": null},{"id": "cat4_item1","title": "Paola","score": null},{"id": "cat4_item2","title": "ÎÎ±Ï„Î¬ÏƒÏƒÎ± Î˜ÎµÎ¿Î´Ï‰ÏÎ¯Î´Î¿Ï…","score": null},{"id": "cat4_item3","title": "Î¡Î¯Î± Î•Î»Î»Î·Î½Î¯Î´Î¿Ï…","score": null},{"id": "cat4_item4","title": "Î™Î¿Ï…Î»Î¯Î± ÎšÎ±Î»Î»Î¹Î¼Î¬Î½Î·","score": null},{"id": "cat4_item5","title": "ÎšÎ±Î¯Ï„Î· Î“Î±ÏÎ¼Ï€Î®","score": null},{"id": "cat4_item6","title": "Î‰Î²Î· Î‘Î´Î¬Î¼Î¿Ï…","score": null}],"scorePool": null},{"id": "cat5","name": "BEST FOREIGN FEMALE ARTIST","items": [{"id": "cat5_item0","title": "JENNIE","score": null},{"id": "cat5_item1","title": "Lissa","score": null},{"id": "cat5_item2","title": "Lana del rey","score": null},{"id": "cat5_item3","title": "Adele","score": null},{"id": "cat5_item4","title": "Raye","score": null},{"id": "cat5_item5","title": "Lola Î¥oung","score": null},{"id": "cat5_item6","title": "Chappell Roan","score": null},{"id": "cat5_item7","title": "Olivia Rodrigo","score": null},{"id": "cat5_item8","title": "Shakira","score": null}],"scorePool": null},{"id": "cat6","name": "BEST GR MUSIC VIDEO","items": [{"id": "cat6_item0","title": "Î•Î¾Î±Î¯ÏÎµÏƒÎ· - Î†Î½Î½Î± Î’Î¯ÏƒÏƒÎ·","score": null},{"id": "cat6_item1","title": "ÎÎµÏÏŒ - ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï‚ Î‘ÏÎ³Ï…ÏÏŒÏ‚","score": null},{"id": "cat6_item2","title": "ÎœÎ¿Î½Î±Ï‡Î¹ÎºÎ® ÎšÎ±ÏÎ´Î¹Î¬ - Î§ÏÎ®ÏƒÏ„Î¿Ï‚ ÎœÎ¬ÏƒÏ„Î¿ÏÎ±Ï‚","score": null},{"id": "cat6_item3","title": "ÎšÎ¬Ï„Î¹ Î¾Î­ÏÎµÎ¹Ï‚ - Î¡Î¯Î± Î•Î»Î»Î·Î½Î¯Î´Î¿Ï…","score": null},{"id": "cat6_item4","title": "Î¤Î¿ 'Î²Î±Î»Îµ - ÎšÎ±Ï„ÎµÏÎ¯Î½Î± Î›Î¹ÏŒÎ»Î¹Î¿Ï…","score": null},{"id": "cat6_item5","title": "Î’Î¿ÏÎ¹Î¬Ï‚ - APON","score": null},{"id": "cat6_item6","title": "Î†Î»Î»Î¿ - Î‘Î½Î±ÏƒÏ„Î±ÏƒÎ¯Î±","score": null},{"id": "cat6_item7","title": "Î Î±Î½ÏƒÎ­Î»Î·Î½Î¿Ï‚ - Î”Î­ÏƒÏ€Î¿Î¹Î½Î± Î’Î±Î½Î´Î·","score": null},{"id": "cat6_item8","title": "Ma Bella - Rack","score": null},{"id": "cat6_item9","title": "Î‘Î½Î¬ÎºÎ±Ï„Î± - Tamta","score": null},{"id": "cat6_item10","title": "Î‘Ï‡ ÎºÎ±ÏÎ´Î¹Î¬ Î¼Î¿Ï… - ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï‚ Î‘ÏÎ³Ï…ÏÏŒÏ‚","score": null},{"id": "cat6_item11","title": "Î§ÏŒÏÎµÏˆÎµ - ÎœÎ¹Ï‡Î¬Î»Î·Ï‚ Î§Î±Ï„Î¶Î·Î³Î¹Î¬Î½Î½Î·Ï‚","score": null},{"id": "cat6_item12","title": "ÎšÎ±Î»Î­... Î Î¿Î¹Î¿Ï‚ Î•Î¯Î½Î±Î¹ Î‘Ï…Ï„ÏŒÏ‚? - Î‘Î½Î´ÏÎ¿Î¼Î¬Ï‡Î·","score": null},{"id": "cat6_item13","title": "Î‘Ï€Î¿Ï„ÏÏ€Ï‰Î¼Î± - Lila","score": null},{"id": "cat6_item14","title": "Î›ÏŒÎ³Î¹Î± - Î‰Î²Î· Î‘Î´Î¬Î¼Î¿Ï…","score": null}],"scorePool": null},{"id": "cat7","name": "BEST FOREIGN MUSIC VIDEO","items": [{"id": "cat7_item0","title": "TEXAS HOLD 'EM - BeyoncÃ©","score": null},{"id": "cat7_item1","title": "like - JENNIE","score": null},{"id": "cat7_item2","title": "Birds of a feather - Billie Eilish","score": null},{"id": "cat7_item3","title": "Espresso - Sabrina Carpenter","score": null},{"id": "cat7_item4","title": "We canâ€™t be friends - Ariana Grande","score": null},{"id": "cat7_item5","title": "House - Charlie xcx","score": null},{"id": "cat7_item6","title": "Zen - JENNIE","score": null},{"id": "cat7_item7","title": "Rockstar - Lisa","score": null},{"id": "cat7_item8","title": "Midnight Sun - Zara Larsson","score": null},{"id": "cat7_item9","title": "The Dead Dance - Lady Gaga","score": null},{"id": "cat7_item10","title": "Golden - Huntr/x, Ejae, Audrey Nuna & Rei Ami","score": null},{"id": "cat7_item11","title": "The Door - Teddy Swims","score": null},{"id": "cat7_item12","title": "Bad Dreams - Teddy Swims","score": null},{"id": "cat7_item13","title": "Training Season - Dua Lipa","score": null},{"id": "cat7_item14","title": "Fortnight - Taylor Swift ft. Post Malone","score": null}],"scorePool": null},{"id": "cat8","name": "BEST ESC 25 PERFORMANCE","items": [{"id": "cat8_item0","title": "Bara Bada Bastu - KAJ","score": null},{"id": "cat8_item1","title": "Esa Diva - Melody","score": null},{"id": "cat8_item2","title": "Espresso Macciato - Tommy Cash","score": null},{"id": "cat8_item3","title": "Gaja - Justyna Steczkowska","score": null},{"id": "cat8_item4","title": "Voyage - Zoe Me","score": null},{"id": "cat8_item5","title": "Maman - Louane","score": null},{"id": "cat8_item6","title": "Cest la vie - Claude","score": null},{"id": "cat8_item7","title": "New Day Will Rise - Yuval Raphael","score": null},{"id": "cat8_item8","title": "Tavo Akys - Katarsis","score": null}],"scorePool": null},{"id": "cat9","name": "BEST ALBUM","items": [{"id": "cat9_item0","title": "Cowboy Carter - BeyoncÃ©","score": null},{"id": "cat9_item1","title": "Radical Optimism - Dua Lipa","score": null},{"id": "cat9_item2","title": "The Tortured Poets Department - Taylor Swift","score": null},{"id": "cat9_item3","title": "Hit Me Hard and Soft - Billie Eilish","score": null},{"id": "cat9_item4","title": "Mayhem - Lady Gaga","score": null},{"id": "cat9_item5","title": "Lux - Rosalia","score": null},{"id": "cat9_item6","title": "So Close To What - Tate McRae","score": null},{"id": "cat9_item7","title": "Alter Ego - Lisa","score": null},{"id": "cat9_item8","title": "Ruby - JENNIE","score": null},{"id": "cat9_item9","title": "Not like us - Kendrick Lamar","score": null},{"id": "cat9_item10","title": "We Can't Be Friends - Ariana Grande","score": null},{"id": "cat9_item11","title": "I Had Some Help - Post Malone ft. Morgan Wallen","score": null},{"id": "cat9_item12","title": "Feelslikeimfallinginlove - Coldplay","score": null},{"id": "cat9_item13","title": "Saturn - Satiyar","score": null}],"scorePool": null}]}};
const PASSWORDS = { teri: '1478', monhia: '9632', lijiansi: '2365' };
const SCORE_SET = [12, 10, 8, 7, 6, 5, 4, 3, 2, 1];

let activeKey = null;
let categories = [];
let pendingKey = null;

const elHome = document.getElementById('home');
const elApp = document.getElementById('app');
const elCats = document.getElementById('cats');
const elActions = document.getElementById('actions');
const elActiveLabel = document.getElementById('activeLabel');
const elSearch = document.getElementById('search');

const modalBack = document.getElementById('modalBack');
const pendingLabel = document.getElementById('pendingLabel');
const pwdInput = document.getElementById('pwd');
const pwdErr = document.getElementById('pwdErr');

function storageKey() { return activeKey ? `euphoria_dnd_${activeKey}` : null; }
function deepCopy(x) { return JSON.parse(JSON.stringify(x)); }

function ensureScoringInitialized() {
  for (const c of categories) {
    if (!Array.isArray(c.scorePool)) c.scorePool = SCORE_SET.slice();
    if (!Array.isArray(c.items)) c.items = [];
    for (let i = 0; i < c.items.length; i++) {
      const it = c.items[i];
      if (!('score' in it)) it.score = null;
      if (!('origIndex' in it)) it.origIndex = i;
    }
    const assigned = new Set(c.items.map(it => it.score).filter(v => typeof v === 'number'));
    c.scorePool = SCORE_SET.filter(v => !assigned.has(v));
  }
}

function saveNow() {
  const k = storageKey();
  if (!k) return;
  localStorage.setItem(k, JSON.stringify(categories));
}

function loadDataset(key) {
  activeKey = key;
  elActiveLabel.textContent = DATASETS[activeKey].label;
  elActions.style.display = '';
  document.getElementById('home').style.display = 'none';
  elApp.style.display = '';
  elSearch.value = '';

  const k = storageKey();
  const saved = k ? localStorage.getItem(k) : null;
  if (saved) {
    try { categories = JSON.parse(saved); }
    catch { categories = deepCopy(DATASETS[activeKey].categories); }
  } else {
    categories = deepCopy(DATASETS[activeKey].categories);
  }
  ensureScoringInitialized();
  saveNow();
  render();
  playFlip();
}

function logout() {
  activeKey = null;
  categories = [];
  elActions.style.display = 'none';
  elApp.style.display = 'none';
  document.getElementById('home').style.display = '';
  renderHome();
}

function resetOrder() {
  if (!activeKey) return;
  categories = deepCopy(DATASETS[activeKey].categories);
  ensureScoringInitialized();
  saveNow();
  render();
}

function exportJson() {
  const blob = new Blob([JSON.stringify(categories, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `euphoria_${activeKey}_order.json`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

function openPassword(key) {
  const expected = (PASSWORDS && PASSWORDS[key]) ? String(PASSWORDS[key]) : '';
  const entered = window.prompt('ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚');
  if (entered === null) return; // cancelled
  if (String(entered).trim() !== expected) {
    window.alert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚.');
    return;
  }
  loadDataset(key);
}

function closePassword() { modalBack.classList.remove('open'); pendingKey = null; }

function confirmPassword() { /* not used (prompt-based PIN) */ }

function renderHome() {
  elHome.innerHTML = '';
  const cards = [
    { key:'teri', label:'Teri Vi Sentio'},
    { key:'monhia', label:'Monhia'},
    { key:'lijiansi', label:'Lijiansi'},
  ];
  for (const c of cards) {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <div class="hd">
        <div class="title">${c.label}</div>
        
      </div>
      <div class="bd">
        <button class="btn primary" style="width:100%;" data-open="${c.key}">Î†Î½Î¿Î¹Î³Î¼Î±</button>
      </div>
    `;
    elHome.appendChild(div);
  }
  elHome.insertAdjacentHTML('beforeend', `
<div style="grid-column:1/-1; display:flex; gap:10px; flex-wrap:wrap; margin-top:4px;">
  <button class="btn primary" id="btnTotalsHome" style="flex:1; min-width: 220px;">Î£ÏÎ½Î¿Î»Î± Î²Î±Î¸Î¼ÏÎ½</button>
</div>
<div style="grid-column:1/-1" class="hint">Tip: Î· ÏƒÎµÎ¹ÏÎ¬ + Î¿Î¹ Î²Î±Î¸Î¼Î¿Î¯ Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿Î½ browser (localStorage) Î±Î½Î¬ dataset.</div>
`);
  elHome.querySelectorAll('[data-open]').forEach(btn => {
    btn.addEventListener('click', () => openPassword(btn.getAttribute('data-open')));
  });
  const totalsBtn = document.getElementById('btnTotalsHome');
  if (totalsBtn) totalsBtn.addEventListener('click', () => openTotals());
}

function escapeHtml(s) {
  return String(s)
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'",'&#039;');
}


function getDatasetCategories(key) {
  const k = `euphoria_dnd_${key}`;
  const saved = localStorage.getItem(k);
  if (saved) {
    try { return JSON.parse(saved); } catch {}
  }
  // fallback to defaults
  return deepCopy(DATASETS[key].categories);
}

function computeTotals() {
  const keys = Object.keys(DATASETS);
  const totalsByCat = new Map(); // catName -> Map(title -> total)
  for (const key of keys) {
    const cats = getDatasetCategories(key) || [];
    for (const c of cats) {
      const catName = (c && c.name) ? String(c.name) : 'â€”';
      if (!totalsByCat.has(catName)) totalsByCat.set(catName, new Map());
      const titleMap = totalsByCat.get(catName);
      const items = Array.isArray(c.items) ? c.items : [];
      for (const it of items) {
        const title = (it && it.title) ? String(it.title) : 'â€”';
        const score = (it && typeof it.score === 'number') ? it.score : 0;
        if (!score) continue;
        titleMap.set(title, (titleMap.get(title) || 0) + score);
      }
    }
  }
  return totalsByCat;
}

const totalsBack = document.getElementById('totalsBack');
const totalsBody = document.getElementById('totalsBody');
const totalsSearch = document.getElementById('totalsSearch');

function closeTotals() {
  totalsBack?.classList.remove('open');
  if (totalsSearch) totalsSearch.value = '';
}

function renderTotals(filterText) {
  if (!totalsBody) return;
  const q = (filterText || '').trim().toLowerCase();
  const totalsByCat = computeTotals();

  let html = '';
  for (const [catName, titleMap] of totalsByCat.entries()) {
    const rows = Array.from(titleMap.entries())
      .map(([title, total]) => ({ title, total }))
      .sort((a,b) => b.total - a.total);

    const catMatches = catName.toLowerCase().includes(q);
    const filtered = !q ? rows : rows.filter(r => catMatches || r.title.toLowerCase().includes(q));
    if (q && !catMatches && filtered.length === 0) continue;

    const rowsHtml = filtered.map(r => `
      <div class="item scored" style="margin-bottom:10px;">
        <div class="itemText" style="font-weight:800;">${escapeHtml(r.title)}</div>
        <div class="scoreBox">
          <div class="scoreLabel">ÏƒÏÎ½Î¿Î»Î¿</div>
          <div class="scoreVal">${r.total}</div>
        </div>
      </div>
    `).join('');

    html += `
      <div class="cat" style="margin-bottom:14px;">
        <div class="catHeader">
          <div class="catHeaderLeft">
            <div class="grab" style="cursor:default;">ğŸ“Œ</div>
            <div class="catName">${escapeHtml(catName)}</div>
          </div>
          <div class="catRight">
            <span class="badge">${filtered.length}</span>
          </div>
        </div>
        <div class="list" style="margin-top:0;">${rowsHtml || `<div class="dropHint" style="display:block;">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î²Î±Î¸Î¼Î¿Î¯ Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±.</div>`}</div>
      </div>
    `;
  }

  totalsBody.innerHTML = html || `<div class="hint" style="margin-top:6px;">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±.</div>`;
}


function openTotals() {
  const entered = window.prompt('ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚');
  if (entered === null) return;
  if (String(entered).trim() !== '0825') {
    window.alert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚.');
    return;
  }
  renderTotals('');
  totalsBack?.classList.add('open');
  setTimeout(() => totalsSearch?.focus(), 0);
}


// totals modal events
document.getElementById('totalsClose')?.addEventListener('click', closeTotals);
document.getElementById('totalsOk')?.addEventListener('click', closeTotals);
totalsBack?.addEventListener('click', (e) => { if (e.target === totalsBack) closeTotals(); });
totalsSearch?.addEventListener('input', () => renderTotals(totalsSearch.value));


let lastPositions = new Map();

function capturePositions() {
  lastPositions.clear();
  document.querySelectorAll('.item').forEach(el => {
    lastPositions.set(el.dataset.itemid, el.getBoundingClientRect());
  });
}

function playFlip() {
  document.querySelectorAll('.item').forEach(el => {
    const first = lastPositions.get(el.dataset.itemid);
    if (!first) return;
    const last = el.getBoundingClientRect();
    const dx = first.left - last.left;
    const dy = first.top - last.top;
    if (dx || dy) {
      el.style.transform = `translate(${dx}px, ${dy}px)`;
      el.getBoundingClientRect(); // force reflow
      el.style.transform = '';
    }
  });
}

function render() {
  if (!activeKey) return;

  const q = (elSearch.value || '').trim().toLowerCase();
  const view = (!q) ? categories : categories
    .map(c => {
      const catMatches = c.name.toLowerCase().includes(q);
      const items = catMatches ? c.items : c.items.filter(it => it.title.toLowerCase().includes(q));
      return { ...c, items, __hidden: !catMatches && items.length === 0 };
    })
    .filter(c => !c.__hidden);

  elCats.innerHTML = '';
  view.forEach((cat) => {
    const catEl = document.createElement('div');
    catEl.className = 'cat';
    catEl.setAttribute('data-catid', cat.id);
    catEl.setAttribute('draggable', 'true');

    const pool = Array.isArray(cat.scorePool) ? cat.scorePool : [];
    const poolHtml = pool.map(v => {
      const sel = (selectedScore && selectedScore.value === v && selectedScore.catId === cat.id && selectedScore.from === 'pool');
      const base = `chip s${v}`;
      const cls = sel ? `${base} selected` : base;
      return `<div class="${cls}" draggable="true" data-score="${v}" data-scorecat="${cat.id}" title="ÎšÎ»Î¹Îº Î³Î¹Î± ÎµÏ€Î¹Î»Î¿Î³Î® Î® ÏƒÏÏÎµ Ï€Î¬Î½Ï‰ ÏƒÎµ Î³ÏÎ±Î¼Î¼Î®">${v}</div>`;
    }).join('');

    catEl.innerHTML = `
      <div class="catHeader">
        <div class="catHeaderLeft">
          <div class="grab" title="Î£ÏÏÎµ Î³Î¹Î± Î±Î»Î»Î±Î³Î® ÏƒÎµÎ¹ÏÎ¬Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚">â ¿</div>
          <div class="catName">${escapeHtml(cat.name)}</div>
        </div>
        <div class="catRight">
          <span class="badge">${cat.items.length}</span>
          <div class="scorePool" data-scorepool="${cat.id}" title="Î†Ï†Î·ÏƒÎµ ÎµÎ´Ï score Î³Î¹Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ pool">${poolHtml}</div>
        </div>
      </div>
      <div class="list" data-list="${cat.id}">
        <div class="dropHint">Î£ÏÏÎµ Î­Î½Î±Î½ Ï„Î¯Ï„Î»Î¿ ÎµÎ´Ïâ€¦</div>
      </div>
    `;
    elCats.appendChild(catEl);

    const listEl = catEl.querySelector('.list');
    if (cat.items.length === 0) listEl.classList.add('empty');

    cat.items.forEach((it, idx) => {
      const itEl = document.createElement('div');
      itEl.className = 'item';
      itEl.setAttribute('draggable', 'true');
      itEl.setAttribute('data-itemid', it.id);
      itEl.setAttribute('data-fromcat', cat.id);

      const score = (typeof it.score === 'number') ? it.score : null;
      if (score !== null) itEl.className = `item scored s${score}`;
      const scoreVal = score !== null ? `${score}` : 'â€”';
      const scoreClass = score !== null ? 'scoreVal' : 'scoreVal empty';
      const draggableScore = score !== null
        ? (() => {
            const sel = (selectedScore && selectedScore.value === score && selectedScore.catId === cat.id && selectedScore.from === 'item' && selectedScore.fromItemId === it.id);
            const base = `chip assigned s${score}`;
            const cls = sel ? `${base} selected` : base;
            return `<div class="${cls}" draggable="true" data-score="${score}" data-scorefromitem="${it.id}" data-scorecat="${cat.id}" title="ÎšÎ»Î¹Îº Î³Î¹Î± ÎµÏ€Î¹Î»Î¿Î³Î® Î® ÏƒÏÏÎµ Î³Î¹Î± Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬/ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î®">${score}</div>`;
          })()
        : '';

      itEl.innerHTML = `
        <div class="grab" title="Î£ÏÏÎµ Î³Î¹Î± Î±Î»Î»Î±Î³Î® ÏƒÎµÎ¹ÏÎ¬Ï‚">â‹®â‹®</div>
        <div class="itemText">${escapeHtml(it.title)}</div>
        <div class="scoreBox">
          <div class="scoreLabel">score</div>
          <div class="${scoreClass}" data-scorebox="${it.id}" data-scorecat="${cat.id}" title="Î†Ï†Î·ÏƒÎµ ÎµÎ´Ï Î²Î±Î¸Î¼ÏŒ">${scoreVal}</div>
          ${draggableScore}
          <div class="idx">#${idx+1}</div>
        </div>
      `;
      listEl.appendChild(itEl);
    });

    wireCategoryDnD(catEl, cat.id);
    wireListDnD(listEl, cat.id);
    wireScorePoolDnD(catEl.querySelector('[data-scorepool]'), cat.id);
    catEl.querySelectorAll('[data-score]').forEach(chip => wireScoreChipDnD(chip));
  });
}

// ---- Drag & Drop logic ----
let dragPayload = null;
let selectedScore = null; // {value, catId, from, fromItemId}


function wireCategoryDnD(catEl, catId) {
  const grab = catEl.querySelector('.catHeader .grab');
  grab.addEventListener('mousedown', () => { catEl.dataset.dragMode = 'category'; });
  grab.addEventListener('mouseup', () => { catEl.dataset.dragMode = ''; });

  catEl.addEventListener('dragstart', (e) => {
    if (catEl.dataset.dragMode !== 'category') { e.preventDefault(); return; }
    dragPayload = { type:'category', catId };
    e.dataTransfer.setData('text/plain', JSON.stringify(dragPayload));
    e.dataTransfer.effectAllowed = 'move';
    catEl.classList.add('dragging');
  });

  catEl.addEventListener('dragend', () => {
    catEl.classList.remove('dragging');
    dragPayload = null;
    document.querySelectorAll('.cat.dragOver').forEach(x => x.classList.remove('dragOver'));
  });

  catEl.addEventListener('dragover', (e) => {
    if (!dragPayload || dragPayload.type !== 'category') return;
    e.preventDefault();
    catEl.classList.add('dragOver');
  });
  catEl.addEventListener('dragleave', () => catEl.classList.remove('dragOver'));

  catEl.addEventListener('drop', (e) => {
    if (!dragPayload || dragPayload.type !== 'category') return;
    e.preventDefault();
    catEl.classList.remove('dragOver');
    const sourceId = dragPayload.catId;
    const destId = catId;
    if (sourceId === destId) return;

    const sIdx = categories.findIndex(c => c.id === sourceId);
    const dIdx = categories.findIndex(c => c.id === destId);
    if (sIdx < 0 || dIdx < 0) return;

    const [moved] = categories.splice(sIdx, 1);
    categories.splice(dIdx, 0, moved);
    saveNow();
    render();
  });
}

function wireListDnD(listEl, catId) {
  listEl.addEventListener('dragover', (e) => {
    const payload = getPayload(e);
    if (!payload) return;
    if (payload.type === 'item') {
      e.preventDefault();
      listEl.closest('.cat')?.classList.add('dragOver');
      e.dataTransfer.dropEffect = 'move';
    }
  });

  listEl.addEventListener('dragleave', () => {
    listEl.closest('.cat')?.classList.remove('dragOver');
  });

  listEl.addEventListener('drop', (e) => {
    const payload = getPayload(e);
    if (!payload || payload.type !== 'item') return;
    e.preventDefault();
    listEl.closest('.cat')?.classList.remove('dragOver');

    const destCatId = catId;
    const sourceCatId = payload.fromCatId;
    const itemId = payload.itemId;

    const afterEl = getDragAfterElement(listEl, e.clientY);
    let destIndex = afterEl ? Array.from(listEl.querySelectorAll('.item')).indexOf(afterEl) : listEl.querySelectorAll('.item').length;

    moveItem(sourceCatId, destCatId, itemId, destIndex);
    saveNow();
    render();
  });

  listEl.querySelectorAll('.item').forEach(itEl => {
    itEl.addEventListener('dragstart', (e) => {
      // If a score is selected (click-to-assign), don't start dragging items
      if (selectedScore && selectedScore.type === 'score') { e.preventDefault(); return; }
      if (dragPayload && dragPayload.type === 'score') return;
      dragPayload = { type:'item', itemId: itEl.dataset.itemid, fromCatId: itEl.dataset.fromcat };
      e.dataTransfer.setData('text/plain', JSON.stringify(dragPayload));
      e.dataTransfer.effectAllowed = 'move';
      itEl.classList.add('dragging');
    });
    itEl.addEventListener('dragend', () => {
      itEl.classList.remove('dragging');
      document.querySelectorAll('.cat.dragOver').forEach(x => x.classList.remove('dragOver'));
      document.querySelectorAll('.item.dropOver').forEach(x => x.classList.remove('dropOver'));
      dragPayload = null;
    });

    // Drop SCORE onto item
    itEl.addEventListener('dragover', (e) => {
      const payload = getPayload(e);
      if (!payload || payload.type !== 'score') return;
      if (payload.catId !== itEl.dataset.fromcat) return;
      e.preventDefault();
      itEl.classList.add('dropOver');
      e.dataTransfer.dropEffect = 'move';
    });
    itEl.addEventListener('dragleave', () => itEl.classList.remove('dropOver'));
    itEl.addEventListener('drop', (e) => {
      const payload = getPayload(e);
      if (!payload || payload.type !== 'score') return;
      if (payload.catId !== itEl.dataset.fromcat) return;
      e.preventDefault();
      itEl.classList.remove('dropOver');
      assignScoreToItem(payload, itEl.dataset.fromcat, itEl.dataset.itemid);
      saveNow();
      render();
    });

    // Also allow dropping score specifically on the score box (more reliable in some browsers)
    const scoreBox = itEl.querySelector('[data-scorebox]');
    if (scoreBox) {
      scoreBox.addEventListener('dragover', (e) => {
        const payload = getPayload(e);
        if (!payload || payload.type !== 'score') return;
        // Only allow scores from same category
        if (payload.catId !== itEl.dataset.fromcat) return;
        e.preventDefault();
        itEl.classList.add('dropOver');
        e.dataTransfer.dropEffect = 'move';
      });
      scoreBox.addEventListener('dragleave', () => itEl.classList.remove('dropOver'));
      scoreBox.addEventListener('click', (e) => {
        e.stopPropagation();
        if (!selectedScore || selectedScore.type !== 'score') return;
        if (selectedScore.catId !== itEl.dataset.fromcat) return;
        assignScoreToItem(selectedScore, itEl.dataset.fromcat, itEl.dataset.itemid);
        selectedScore = null;
        saveNow();
        render();
      });
      
      scoreBox.addEventListener('drop', (e) => {
        const payload = getPayload(e);
        if (!payload || payload.type !== 'score') return;
        if (payload.catId !== itEl.dataset.fromcat) return;
        e.preventDefault();
        itEl.classList.remove('dropOver');
        assignScoreToItem(payload, itEl.dataset.fromcat, itEl.dataset.itemid);
        saveNow();
        render();
      });
    }

    // Click anywhere on the row to assign the selected score
    itEl.addEventListener('click', (e) => {
      // ignore clicks on the score tiles themselves
      if (e.target && e.target.closest('.chip')) return;
      if (!selectedScore || selectedScore.type !== 'score') return;
      if (selectedScore.catId !== itEl.dataset.fromcat) return;
      assignScoreToItem(selectedScore, itEl.dataset.fromcat, itEl.dataset.itemid);
      selectedScore = null;
      document.body.classList.remove('selecting');
      saveNow();
      render();
    });


  });
}


function setSelectedScore(payload) {
  document.body.classList.remove('selecting');
  // toggle
  if (selectedScore && selectedScore.value === payload.value && selectedScore.catId === payload.catId && selectedScore.from === payload.from && selectedScore.fromItemId === payload.fromItemId) {
    selectedScore = null;
  } else {
    selectedScore = payload;
    document.body.classList.add('selecting');
  }
}

function wireScoreChipDnD(chipEl) {
  chipEl.addEventListener('click', (e) => {
    e.stopPropagation();
    const v = Number(chipEl.getAttribute('data-score'));
    const catId = chipEl.getAttribute('data-scorecat');
    const fromItemId = chipEl.getAttribute('data-scorefromitem');
    const payload = { type:'score', value: v, catId, from: fromItemId ? 'item' : 'pool', fromItemId: fromItemId || null };
    setSelectedScore(payload);
    render();
  });

  chipEl.addEventListener('dragstart', (e) => {
    const v = Number(chipEl.getAttribute('data-score'));
    const catId = chipEl.getAttribute('data-scorecat');
    const fromItemId = chipEl.getAttribute('data-scorefromitem');
    dragPayload = { type:'score', value: v, catId, from: fromItemId ? 'item' : 'pool', fromItemId: fromItemId || null };
    e.dataTransfer.setData('text/plain', JSON.stringify(dragPayload));
    e.dataTransfer.effectAllowed = 'move';
  });
  chipEl.addEventListener('dragend', () => {
    document.querySelectorAll('.scorePool.dragOver').forEach(x => x.classList.remove('dragOver'));
    document.querySelectorAll('.item.dropOver').forEach(x => x.classList.remove('dropOver'));
    dragPayload = null;
  });
}

function wireScorePoolDnD(poolEl, catId) {
  poolEl.addEventListener('dragover', (e) => {
    const payload = getPayload(e);
    if (!payload || payload.type !== 'score') return;
    if (payload.catId !== catId) return;
    e.preventDefault();
    poolEl.classList.add('dragOver');
    e.dataTransfer.dropEffect = 'move';
  });
  poolEl.addEventListener('dragleave', () => poolEl.classList.remove('dragOver'));
  poolEl.addEventListener('drop', (e) => {
    const payload = getPayload(e);
    if (!payload || payload.type !== 'score') return;
    if (payload.catId !== catId) return;
    e.preventDefault();
    poolEl.classList.remove('dragOver');
    returnScoreToPool(payload, catId);
    saveNow();
    render();
  });
}

function getPayload(e) {
  try {
    const txt = e.dataTransfer.getData('text/plain');
    if (!txt) return dragPayload;
    return JSON.parse(txt);
  } catch {
    return dragPayload;
  }
}

function getDragAfterElement(container, y) {
  const draggableElements = [...container.querySelectorAll('.item:not(.dragging)')];
  let closest = { offset: Number.NEGATIVE_INFINITY, element: null };
  for (const child of draggableElements) {
    const box = child.getBoundingClientRect();
    const offset = y - box.top - box.height / 2;
    if (offset < 0 && offset > closest.offset) closest = { offset, element: child };
  }
  return closest.element;
}

function findCat(catId) { return categories.find(c => c.id === catId); }

function sortCategoryByScore(cat) {
  if (!cat || !Array.isArray(cat.items)) return;
  cat.items.sort((a,b) => {
    const as = (typeof a.score === 'number') ? a.score : -1;
    const bs = (typeof b.score === 'number') ? b.score : -1;
    // scored first, high to low
    if (bs !== as) return bs - as;
    // tie / unscored: keep stable by original index
    const ai = (typeof a.origIndex === 'number') ? a.origIndex : 1e9;
    const bi = (typeof b.origIndex === 'number') ? b.origIndex : 1e9;
    return ai - bi;
  });
}


function moveItem(sourceCatId, destCatId, itemId, destIndex) {
  const sCat = findCat(sourceCatId);
  const dCat = findCat(destCatId);
  if (!sCat || !dCat) return;

  const itemIndex = sCat.items.findIndex(it => it.id === itemId);
  if (itemIndex < 0) return;

  const [moved] = sCat.items.splice(itemIndex, 1);
  destIndex = Math.max(0, Math.min(destIndex, dCat.items.length));
  dCat.items.splice(destIndex, 0, moved);
}

function assignScoreToItem(payload, destCatId, destItemId) {
  const cat = findCat(destCatId);
  if (!cat) return;
  const destItem = cat.items.find(it => it.id === destItemId);
  if (!destItem) return;

  const value = payload.value;

  if (typeof destItem.score === 'number') cat.scorePool.push(destItem.score);

  if (payload.from === 'pool') {
    const idx = cat.scorePool.indexOf(value);
    if (idx >= 0) cat.scorePool.splice(idx, 1);
  }

  if (payload.from === 'item' && payload.fromItemId) {
    const fromItem = cat.items.find(it => it.id === payload.fromItemId);
    if (fromItem) fromItem.score = null;
  }

  destItem.score = value;
  cat.scorePool = SCORE_SET.filter(v => !cat.items.some(it => it.score === v));
  // Eurovision-style re-ranking by score
  capturePositions();
  sortCategoryByScore(cat);
  // Eurovision-style re-ranking by score
  capturePositions();
  sortCategoryByScore(cat);
}

function returnScoreToPool(payload, catId) {
  const cat = findCat(catId);
  if (!cat) return;
  const value = payload.value;

  if (payload.from === 'item' && payload.fromItemId) {
    const fromItem = cat.items.find(it => it.id === payload.fromItemId);
    if (fromItem) fromItem.score = null;
  }

  if (!cat.scorePool.includes(value) && !cat.items.some(it => it.score === value)) cat.scorePool.push(value);
  cat.scorePool = SCORE_SET.filter(v => !cat.items.some(it => it.score === v));
}

document.getElementById('btnSave').addEventListener('click', saveNow);
document.getElementById('btnReset').addEventListener('click', resetOrder);
document.getElementById('btnLogout').addEventListener('click', logout);
document.getElementById('btnExport').addEventListener('click', exportJson);
elSearch.addEventListener('input', render);

document.getElementById('modalClose').addEventListener('click', closePassword);
document.getElementById('modalCancel').addEventListener('click', closePassword);
document.getElementById('modalOk').addEventListener('click', confirmPassword);
pwdInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') confirmPassword(); });
modalBack.addEventListener('click', (e) => { if (e.target === modalBack) closePassword(); });

renderHome();
</script>
</body>
</html>
