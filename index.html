<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Euphoria Intro → Neon Awards</title>
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <style>
    html,body{height:100%; margin:0; background:#000; overflow:hidden;}
    .layer{position:fixed; inset:0; width:100%; height:100%; border:0;}
    #introFrame{z-index:10;}
    #mainFrame{z-index:1; opacity:0; pointer-events:none; transition:opacity .8s ease; background:#070817;}
    body.main-on #mainFrame{opacity:1; pointer-events:auto;}
    body.main-on #introFrame{opacity:0; pointer-events:none; transition:opacity .6s ease;}
    #fx{position:fixed; inset:0; z-index:20; pointer-events:none; opacity:0;}
    body.fx-on #fx{opacity:1; animation:fxFlash 1.2s ease forwards;}
    @keyframes fxFlash{
      0%{opacity:0; filter:none;}
      10%{opacity:1; filter:contrast(1.35) saturate(1.4) blur(0px);}
      35%{opacity:1; filter:contrast(1.55) saturate(1.8) blur(1px);}
      65%{opacity:.75; filter:contrast(1.2) saturate(1.25) blur(0.5px);}
      100%{opacity:0; filter:none;}
    }
    #startOverlay{position:fixed; inset:0; z-index:40; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,65); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding:18px;}
    #startOverlay.hidden{display:none;}
    #startOverlay .startCard{width:min(520px, 92vw); border-radius:22px; padding:18px 18px 16px;
      background:rgba(10,10,18,72); border:1px solid rgba(255,255,255,10);}
    #startOverlay .startTitle{font:700 20px/1.2 system-ui; color:rgba(255,255,255,92); margin-bottom:8px;}
    #startOverlay .startSub{font:13px/1.35 system-ui; color:rgba(255,255,255,70);}
  </style>
</head>
<body>
  <iframe id="introFrame" class="layer" title="Euphoria Intro" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
  <iframe id="mainFrame" class="layer" title="Neon Awards" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
  <div id="fx" aria-hidden="true"></div>

  <div id="startOverlay" role="button" aria-label="Tap to start" tabindex="0">
    <div class="startCard">
      <div class="startTitle">Tap to start</div>
      <div class="startSub">Βελτιστοποιημένο για κινητό — ξεκινάει το intro &amp; το timer.</div>
    </div>
  </div>

<script>
  // ---- Seed data (από το Excel) ----
  (function(){
    const SEED_MARK = "neon-awards:seed:v1";
    try{
      if (!localStorage.getItem(SEED_MARK)){
        localStorage.setItem("neon-awards:teri-vi-sentio", "{\"Best gr song\": [{\"id\": \"Best gr song__0__seed\", \"text\": \"Χρόνια πολλά φουρειρα\"}, {\"id\": \"Best gr song__1__seed\", \"text\": \"Alleluia φουρειρα\"}, {\"id\": \"Best gr song__2__seed\", \"text\": \"Εξαίρεση βισση\"}, {\"id\": \"Best gr song__3__seed\", \"text\": \"Ανεξάρτητη καλιμανη\"}, {\"id\": \"Best gr song__4__seed\", \"text\": \"Χόρεψε χατζηγιαννης\"}, {\"id\": \"Best gr song__5__seed\", \"text\": \"Αχ καρδιά μου αργυρός\"}, {\"id\": \"Best gr song__6__seed\", \"text\": \"Καλά να περνάτε δέσποινα Βανδή\"}, {\"id\": \"Best gr song__7__seed\", \"text\": \"Κάτι ξερις ρια ελληνιδου\"}, {\"id\": \"Best gr song__8__seed\", \"text\": \"Βοριάς απόν\"}, {\"id\": \"Best gr song__9__seed\", \"text\": \"Μπορώ και εγώ μέλισσες\"}], \"Best foreign song\": [{\"id\": \"Best foreign song__0__seed\", \"text\": \"Not like us\"}, {\"id\": \"Best foreign song__1__seed\", \"text\": \"Dancing in the flames\"}, {\"id\": \"Best foreign song__2__seed\", \"text\": \"Death dance\"}, {\"id\": \"Best foreign song__3__seed\", \"text\": \"Golden\"}, {\"id\": \"Best foreign song__4__seed\", \"text\": \"Bad dreams\"}, {\"id\": \"Best foreign song__5__seed\", \"text\": \"Feels like I m falling in love\"}, {\"id\": \"Best foreign song__6__seed\", \"text\": \"Abracadabra\"}, {\"id\": \"Best foreign song__7__seed\", \"text\": \"Messy\"}, {\"id\": \"Best foreign song__8__seed\", \"text\": \"I had some help\"}, {\"id\": \"Best foreign song__9__seed\", \"text\": \"Texas hold em\"}], \"Best GR Male Artist\": [{\"id\": \"Best GR Male Artist__0__seed\", \"text\": \"Ρεμος\"}, {\"id\": \"Best GR Male Artist__1__seed\", \"text\": \"Αργυρός\"}, {\"id\": \"Best GR Male Artist__2__seed\", \"text\": \"Φέρρης\"}, {\"id\": \"Best GR Male Artist__3__seed\", \"text\": \"Ιακωβιδης\"}, {\"id\": \"Best GR Male Artist__4__seed\", \"text\": \"Απόν\"}, {\"id\": \"Best GR Male Artist__5__seed\", \"text\": \"Σικαρο\"}, {\"id\": \"Best GR Male Artist__6__seed\", \"text\": \"Μάστορας\"}, {\"id\": \"Best GR Male Artist__7__seed\", \"text\": \"Οικονομόπουλος\"}, {\"id\": \"Best GR Male Artist__8__seed\", \"text\": \"Σαμπάνης\"}, {\"id\": \"Best GR Male Artist__9__seed\", \"text\": \"Μαζωνάκης\"}], \"Best GR Female Artsis\": [{\"id\": \"Best GR Female Artsis__0__seed\", \"text\": \"Βανδή\"}, {\"id\": \"Best GR Female Artsis__1__seed\", \"text\": \"Βισση\"}, {\"id\": \"Best GR Female Artsis__2__seed\", \"text\": \"Παπαριζου\"}, {\"id\": \"Best GR Female Artsis__3__seed\", \"text\": \"Σαττι\"}, {\"id\": \"Best GR Female Artsis__4__seed\", \"text\": \"Θεοδωριδου\"}, {\"id\": \"Best GR Female Artsis__5__seed\", \"text\": \"Ελληνιδου\"}, {\"id\": \"Best GR Female Artsis__6__seed\", \"text\": \"Καλλιμάνη\"}, {\"id\": \"Best GR Female Artsis__7__seed\", \"text\": \"Κλαυδια\"}, {\"id\": \"Best GR Female Artsis__8__seed\", \"text\": \"Γαρμπή\"}, {\"id\": \"Best GR Female Artsis__9__seed\", \"text\": \"Αδάμου\"}], \"Best Foreign Male Artist\": [{\"id\": \"Best Foreign Male Artist__0__seed\", \"text\": \"Ted swims\"}, {\"id\": \"Best Foreign Male Artist__1__seed\", \"text\": \"Drake\"}, {\"id\": \"Best Foreign Male Artist__2__seed\", \"text\": \"Lamar\"}, {\"id\": \"Best Foreign Male Artist__3__seed\", \"text\": \"Alex warren\"}, {\"id\": \"Best Foreign Male Artist__4__seed\", \"text\": \"Ed sheeran\"}, {\"id\": \"Best Foreign Male Artist__5__seed\", \"text\": \"Bad bunny\"}, {\"id\": \"Best Foreign Male Artist__6__seed\", \"text\": \"Bruno mars\"}, {\"id\": \"Best Foreign Male Artist__7__seed\", \"text\": \"Weekend\"}, {\"id\": \"Best Foreign Male Artist__8__seed\", \"text\": \"Benson boone\"}, {\"id\": \"Best Foreign Male Artist__9__seed\", \"text\": \"Post malone\"}], \"Best Foreign Female Artist\": [{\"id\": \"Best Foreign Female Artist__0__seed\", \"text\": \"Lady gaga\"}, {\"id\": \"Best Foreign Female Artist__1__seed\", \"text\": \"Sabrina carpenter\"}, {\"id\": \"Best Foreign Female Artist__2__seed\", \"text\": \"Taylor swift\"}, {\"id\": \"Best Foreign Female Artist__3__seed\", \"text\": \"Day lipa\"}, {\"id\": \"Best Foreign Female Artist__4__seed\", \"text\": \"Billie eilish\"}, {\"id\": \"Best Foreign Female Artist__5__seed\", \"text\": \"Lola young\"}, {\"id\": \"Best Foreign Female Artist__6__seed\", \"text\": \"Chappell roan\"}, {\"id\": \"Best Foreign Female Artist__7__seed\", \"text\": \"Doja cat\"}, {\"id\": \"Best Foreign Female Artist__8__seed\", \"text\": \"Olivia Rodrigo\"}, {\"id\": \"Best Foreign Female Artist__9__seed\", \"text\": \"Shakira\"}], \"Best GR music Video\": [{\"id\": \"Best GR music Video__0__seed\", \"text\": \"Αστεροματα κλαδιά\"}, {\"id\": \"Best GR music Video__1__seed\", \"text\": \"Λολα σαττι\"}, {\"id\": \"Best GR music Video__2__seed\", \"text\": \"Μηχανική καρδιά μάστορας\"}, {\"id\": \"Best GR music Video__3__seed\", \"text\": \"Κάτι ξέρεις ρια ελληνιδου\"}, {\"id\": \"Best GR music Video__4__seed\", \"text\": \"Το βάλε λιολιου\"}, {\"id\": \"Best GR music Video__5__seed\", \"text\": \"Αχ καρδιά μου αργυρός\"}, {\"id\": \"Best GR music Video__6__seed\", \"text\": \"Χόρεψε χατζηγιαννης\"}, {\"id\": \"Best GR music Video__7__seed\", \"text\": \"Καλέ ποιος είναι αυτός Ανδρομάχης\"}, {\"id\": \"Best GR music Video__8__seed\", \"text\": \"Αποτυπώματα λιλα\"}, {\"id\": \"Best GR music Video__9__seed\", \"text\": \"Λόγια ΗΒΗ Αδάμου\"}], \"Best Foreign Music Video\": [{\"id\": \"Best Foreign Music Video__0__seed\", \"text\": \"Neon dreams\"}, {\"id\": \"Best Foreign Music Video__1__seed\", \"text\": \"Texas hold em\"}, {\"id\": \"Best Foreign Music Video__2__seed\", \"text\": \"Abracadabra\"}, {\"id\": \"Best Foreign Music Video__3__seed\", \"text\": \"Midnight sun\"}, {\"id\": \"Best Foreign Music Video__4__seed\", \"text\": \"Death dance\"}, {\"id\": \"Best Foreign Music Video__5__seed\", \"text\": \"Golden\"}, {\"id\": \"Best Foreign Music Video__6__seed\", \"text\": \"Door\"}, {\"id\": \"Best Foreign Music Video__7__seed\", \"text\": \"Bad dreams\"}, {\"id\": \"Best Foreign Music Video__8__seed\", \"text\": \"Training seadon\"}, {\"id\": \"Best Foreign Music Video__9__seed\", \"text\": \"Fortnight\"}], \"Best ESC 2025 perfomance\": [{\"id\": \"Best ESC 2025 perfomance__0__seed\", \"text\": \"Sweden\"}, {\"id\": \"Best ESC 2025 perfomance__1__seed\", \"text\": \"Spain\"}, {\"id\": \"Best ESC 2025 perfomance__2__seed\", \"text\": \"Estonia\"}, {\"id\": \"Best ESC 2025 perfomance__3__seed\", \"text\": \"Φιλανδια\"}, {\"id\": \"Best ESC 2025 perfomance__4__seed\", \"text\": \"Ελλάδα\"}, {\"id\": \"Best ESC 2025 perfomance__5__seed\", \"text\": \"Γαλλία\"}, {\"id\": \"Best ESC 2025 perfomance__6__seed\", \"text\": \"Αυστρία\"}, {\"id\": \"Best ESC 2025 perfomance__7__seed\", \"text\": \"Ισραήλ\"}, {\"id\": \"Best ESC 2025 perfomance__8__seed\", \"text\": \"Γερμανία\"}, {\"id\": \"Best ESC 2025 perfomance__9__seed\", \"text\": \"Μαλτα\"}], \"Best Album of the Year\": [{\"id\": \"Best Album of the Year__0__seed\", \"text\": \"Comboy carter\"}, {\"id\": \"Best Album of the Year__1__seed\", \"text\": \"Radical optimism\"}, {\"id\": \"Best Album of the Year__2__seed\", \"text\": \"The tortured poets departmet\"}, {\"id\": \"Best Album of the Year__3__seed\", \"text\": \"Hit me hard and soft\"}, {\"id\": \"Best Album of the Year__4__seed\", \"text\": \"Hurry up tomorrow\"}, {\"id\": \"Best Album of the Year__5__seed\", \"text\": \"Not like us\"}, {\"id\": \"Best Album of the Year__6__seed\", \"text\": \"We cant be friends\"}, {\"id\": \"Best Album of the Year__7__seed\", \"text\": \"I had some help\"}, {\"id\": \"Best Album of the Year__8__seed\", \"text\": \"Feels like I m falling in love\"}, {\"id\": \"Best Album of the Year__9__seed\", \"text\": \"Saturn\"}]}");
        localStorage.setItem(SEED_MARK, "1");
      }
    }catch(e){}
  })();

  const INTRO_B64 = "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVsIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiIC8+Cjx0aXRsZT5FdXBob3JpYSDigJQgTmVvbiBTbW9vdGggKFB1bHNlICsgR3JhaW4pPC90aXRsZT4KPHN0eWxlPgogIDpyb290ewogICAgLS1iZy1kZWVwOiMwMjAzMGE7CiAgICAtLWJnLWJsdWU6IzA1MGEyMjsKICAgIC0tYmctYmx1ZTI6IzA2MGIxZTsKCiAgICAtLXdoaXRlOiNmZmY7CiAgICAtLW5lb24tY3lhbjojMmJkOWZmOwogICAgLS1uZW9uLXBpbms6I2ZmMmJkNjsKCiAgICAtLWdsYXNzOiByZ2JhKDEyLCAyNCwgNTAsIC4zOCk7CiAgICAtLXN0cm9rZTogcmdiYSg0MSwxODIsMjU1LC41NSk7CgogICAgLyogc3luYyBrbm9icyAqLwogICAgLS1wdWxzZUR1cjogMy42czsgICAgIC8qIGtlZXAgc2FtZSBhcyBsb2dvIG5lb25CcmVhdGggKi8KICAgIC0tcHVsc2VEZWxheTogMS4yczsgICAvKiBtYXRjaGVzIGxvZ28gbmVvbkJyZWF0aCBkZWxheSAqLwogIH0KCiAgKnsgYm94LXNpemluZzpib3JkZXItYm94OyB9CiAgaHRtbCxib2R5eyBoZWlnaHQ6MTAwJTsgfQoKICAvKiA9PT09PSBCQVNFIEJBQ0tHUk9VTkQgKGRhcmsgbmVvbikgPT09PT0gKi8KICBib2R5ewogICAgbWFyZ2luOjA7CiAgICBvdmVyZmxvdzpoaWRkZW47CiAgICBjb2xvcjp2YXIoLS13aGl0ZSk7CiAgICBmb250LWZhbWlseTogc3lzdGVtLXVpLCAtYXBwbGUtc3lzdGVtLCBTZWdvZSBVSSwgUm9ib3RvLCBIZWx2ZXRpY2EsIEFyaWFsLCAiQnJ1c2ggU2NyaXB0IE1UIiwgY3Vyc2l2ZTsKCiAgICBiYWNrZ3JvdW5kOgogICAgICByYWRpYWwtZ3JhZGllbnQoMTIwMHB4IDYwMHB4IGF0IDE4JSAyMiUsIHJnYmEoMjU1LDQzLDIxNCwwLjE4KSwgdHJhbnNwYXJlbnQgNjIlKSwKICAgICAgcmFkaWFsLWdyYWRpZW50KDExMDBweCA2NTBweCBhdCA3OCUgNzIlLCByZ2JhKDQzLDIxNywyNTUsMC4xNiksIHRyYW5zcGFyZW50IDY2JSksCiAgICAgIGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHZhcigtLWJnLWJsdWUpIDAlLCB2YXIoLS1iZy1kZWVwKSA0NSUsIHZhcigtLWJnLWJsdWUyKSAxMDAlKTsKICB9CgogIC8qID09PT09IFNMT1cgTkVPTiBNT1RJT04gTEFZRVIgKHZlcnkgc2xvdyBkcmlmdCkgPT09PT0gKi8KICAuYmctZHJpZnR7CiAgICBwb3NpdGlvbjpmaXhlZDsKICAgIGluc2V0Oi0yMiU7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgei1pbmRleDowOwogICAgYmFja2dyb3VuZDoKICAgICAgcmFkaWFsLWdyYWRpZW50KDk4MHB4IDU2MHB4IGF0IDMwJSAzMCUsIHJnYmEoMjU1LDQzLDIxNCwwLjIwKSwgdHJhbnNwYXJlbnQgNjAlKSwKICAgICAgcmFkaWFsLWdyYWRpZW50KDkyMHB4IDU2MHB4IGF0IDcwJSA3MCUsIHJnYmEoNDMsMjE3LDI1NSwwLjE4KSwgdHJhbnNwYXJlbnQgNjIlKTsKICAgIGZpbHRlcjogYmx1cigyMHB4KSBzYXR1cmF0ZSgxLjIpOwogICAgb3BhY2l0eTouODU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsMCwwKTsKICAgIGFuaW1hdGlvbjogYmdEcmlmdCAyMnMgZWFzZS1pbi1vdXQgaW5maW5pdGUgYWx0ZXJuYXRlOwogICAgbWl4LWJsZW5kLW1vZGU6IHNjcmVlbjsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm0sIG9wYWNpdHk7CiAgfQoKICBAa2V5ZnJhbWVzIGJnRHJpZnR7CiAgICAwJSAgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTIuNSUsIC0xLjUlKSBzY2FsZSgxLjAyKTsgfQogICAgNTAlICB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDIuNSUsICAxLjIlKSBzY2FsZSgxLjA1KTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC0xLjIlLCAyLjIlKSBzY2FsZSgxLjAzKTsgfQogIH0KCiAgLyogPT09PT0gUFVMU0UgTEFZRVIgKHN5bmNlZCB0byBsb2dvKSA9PT09PSAqLwogIC5iZy1wdWxzZXsKICAgIHBvc2l0aW9uOmZpeGVkOwogICAgaW5zZXQ6MDsKICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICB6LWluZGV4OjE7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC42cyBlYXNlOwogICAgbWl4LWJsZW5kLW1vZGU6IHNjcmVlbjsKICB9CgogIC8qIG9ubHkgc3RhcnQgcHVsc2luZyBvbmNlIGxvZ28gaXMgInJlYWR5IiAqLwogIGJvZHkubG9nby1vbiAuYmctcHVsc2V7CiAgICBvcGFjaXR5OjE7CiAgICBhbmltYXRpb246IGJnUHVsc2UgdmFyKC0tcHVsc2VEdXIpIGVhc2UtaW4tb3V0IGluZmluaXRlIHZhcigtLXB1bHNlRGVsYXkpOwogIH0KCiAgQGtleWZyYW1lcyBiZ1B1bHNlewogICAgMCUsMTAwJXsKICAgICAgZmlsdGVyOiBibHVyKDBweCkgc2F0dXJhdGUoMS4wNSk7CiAgICAgIG9wYWNpdHk6LjU1OwogICAgfQogICAgNTAlewogICAgICBmaWx0ZXI6IGJsdXIoMHB4KSBzYXR1cmF0ZSgxLjI1KTsKICAgICAgb3BhY2l0eTouODU7CiAgICB9CiAgfQoKICAuYmctcHVsc2U6OmJlZm9yZXsKICAgIGNvbnRlbnQ6IiI7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIGluc2V0Oi0xMCU7CiAgICBiYWNrZ3JvdW5kOgogICAgICByYWRpYWwtZ3JhZGllbnQoOTAwcHggNTIwcHggYXQgNTAlIDQ1JSwgcmdiYSgyNTUsNDMsMjE0LDAuMTEpLCB0cmFuc3BhcmVudCA2OCUpLAogICAgICByYWRpYWwtZ3JhZGllbnQoODYwcHggNTIwcHggYXQgNTIlIDUwJSwgcmdiYSg0MywyMTcsMjU1LDAuMTApLCB0cmFuc3BhcmVudCA3MCUpOwogICAgZmlsdGVyOiBibHVyKDE4cHgpOwogIH0KCiAgLyogPT09PT0gQ0lORU1BVElDIE5PSVNFIC8gR1JBSU4gPT09PT0gKi8KICAuZ3JhaW57CiAgICBwb3NpdGlvbjpmaXhlZDsKICAgIGluc2V0Oi0xNSU7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgei1pbmRleDozOwogICAgb3BhY2l0eTouMzI7CiAgICBtaXgtYmxlbmQtbW9kZTogb3ZlcmxheTsKICAgIGJhY2tncm91bmQ6CiAgICAgIHJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoMGRlZywgcmdiYSgyNTUsMjU1LDI1NSwwLjAyOCkgMCAxcHgsIHRyYW5zcGFyZW50IDFweCAzcHgpLAogICAgICByZXBlYXRpbmctbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDI1NSwyNTUsMjU1LDAuMDIwKSAwIDFweCwgdHJhbnNwYXJlbnQgMXB4IDRweCksCiAgICAgIHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgNTAlIDUwJSwgcmdiYSgyNTUsMjU1LDI1NSwwLjAzKSwgdHJhbnNwYXJlbnQgNzAlKTsKICAgIGZpbHRlcjogY29udHJhc3QoMTE1JSkgYnJpZ2h0bmVzcygxMDUlKTsKICAgIGFuaW1hdGlvbjogZ3JhaW5Nb3ZlIDZzIHN0ZXBzKDgpIGluZmluaXRlOwogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsKICB9CgogIEBrZXlmcmFtZXMgZ3JhaW5Nb3ZlewogICAgMCUgICB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDAsMCkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICAxMCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTIlLCAxJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICAyMCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTQlLCAtMiUpIHJvdGF0ZSgwLjAxZGVnKTsgfQogICAgMzAlICB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDMlLCAyJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICA0MCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMSUsIC0zJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICA1MCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTMlLCAzJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICA2MCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoNCUsIDElKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDcwJSAgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgyJSwgLTIlKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDgwJSAgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtMiUsIDIlKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDkwJSAgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgzJSwgLTElKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgwLDApIHJvdGF0ZSgwLjAxZGVnKTsgfQogIH0KCiAgLyogPT09PT0gSU5UUk8gUE9QVVAgPT09PT0gKi8KICAuaW50cm8tbGF5ZXJ7CiAgICBwb3NpdGlvbjpmaXhlZDsgaW5zZXQ6MDsgei1pbmRleDoxMDsKICAgIGRpc3BsYXk6Z3JpZDsgcGxhY2UtaXRlbXM6Y2VudGVyOwogICAgYmFja2dyb3VuZDoKICAgICAgcmFkaWFsLWdyYWRpZW50KDEyMDBweCA4MDBweCBhdCA1MCUgNTAlLCByZ2JhKDAsMCwwLC40OCksIHRyYW5zcGFyZW50IDcwJSksCiAgICAgIGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoNCwxMCwzMiwuOTApIDAlLCByZ2JhKDAsMCwwLC45NSkgMTAwJSk7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNnB4KSBzYXR1cmF0ZSgxLjA1KTsKICAgIHRyYW5zaXRpb246IG9wYWNpdHkgLjdzIGVhc2UsIHRyYW5zZm9ybSAuN3MgY3ViaWMtYmV6aWVyKC4yLC44LC4yLDEpLCBmaWx0ZXIgLjdzIGVhc2U7CiAgfQoKICAuaW50cm8tY2FyZHsKICAgIHdpZHRoOm1pbig4NnZ3LDUyMHB4KTsKICAgIGJvcmRlci1yYWRpdXM6MjBweDsKICAgIHBhZGRpbmc6MjhweCAyNHB4IDIycHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCB2YXIoLS1nbGFzcyksIHJnYmEoMCwwLDAsLjE4KSk7CiAgICBib3JkZXI6MXB4IHNvbGlkIHJnYmEoNDEsMTgyLDI1NSwuNTUpOwogICAgYm94LXNoYWRvdzoKICAgICAgMCAwIDI0cHggcmdiYSg0MSwxODIsMjU1LC4xOCksCiAgICAgIDAgMCA4MHB4IHJnYmEoMjU1LDQzLDIxNCwuMTApLAogICAgICAwIDAgMTMwcHggcmdiYSg0MywyMTcsMjU1LC4wOCk7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTZweCkgc2NhbGUoLjk4KTsKICAgIG9wYWNpdHk6MDsKICAgIGZpbHRlcjogYmx1cig4cHgpOwogICAgdHJhbnNpdGlvbjoKICAgICAgb3BhY2l0eSAuNjVzIGVhc2UsCiAgICAgIHRyYW5zZm9ybSAuNzVzIGN1YmljLWJlemllciguMiwuOCwuMiwxKSwKICAgICAgZmlsdGVyIC43NXMgZWFzZTsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm0sIG9wYWNpdHksIGZpbHRlcjsKICB9CiAgLmludHJvLWNhcmQuc2hvd3sKICAgIG9wYWNpdHk6MTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKSBzY2FsZSgxKTsKICAgIGZpbHRlcjogYmx1cigwKTsKICB9CgogIC5oZXJvLW5hbWV7CiAgICBtYXJnaW46NnB4IDAgMnB4OwogICAgdGV4dC1hbGlnbjpjZW50ZXI7CiAgICBmb250LXNpemU6Y2xhbXAoMThweCw0LjZ2dyw0MHB4KTsKICAgIGZvbnQtd2VpZ2h0OjY1MDsKICAgIGxldHRlci1zcGFjaW5nOi0uMDJlbTsKICAgIGNvbG9yOnJnYmEoMjU1LDI1NSwyNTUsLjkyKTsKICAgIHRleHQtc2hhZG93OiAwIDAgMTBweCByZ2JhKDI1NSwyNTUsMjU1LC4xOCk7CiAgfQoKICAuc3VibGluZXsKICAgIHRleHQtYWxpZ246Y2VudGVyOwogICAgbWFyZ2luOjhweCAwIDE4cHg7CiAgICBmb250LWZhbWlseToiTW9udHNlcnJhdCIsIHN5c3RlbS11aSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICBmb250LXdlaWdodDo4MDA7CiAgICBsZXR0ZXItc3BhY2luZzoxLjFlbTsKICAgIGZvbnQtc2l6ZTpjbGFtcCgxMHB4LDJ2dywxNHB4KTsKICAgIGNvbG9yOnJnYmEoMjU1LDI1NSwyNTUsLjUwKTsKICAgIHRleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTsKICB9CgogIC5jdGF7IGRpc3BsYXk6ZmxleDsganVzdGlmeS1jb250ZW50OmNlbnRlcjsgfQogIC5jdGEgYnV0dG9uewogICAgY3Vyc29yOnBvaW50ZXI7CiAgICBib3JkZXI6bm9uZTsKICAgIHBhZGRpbmc6MTJweCAyMnB4OwogICAgYm9yZGVyLXJhZGl1czoxNnB4OwogICAgZm9udC13ZWlnaHQ6ODUwOwogICAgbGV0dGVyLXNwYWNpbmc6LjMyZW07CiAgICBmb250LWZhbWlseToiTW9udHNlcnJhdCIsIHN5c3RlbS11aSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICB0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7CiAgICBjb2xvcjp2YXIoLS13aGl0ZSk7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHZhcigtLW5lb24tcGluayksIHZhcigtLW5lb24tY3lhbikpOwogICAgYm94LXNoYWRvdzoKICAgICAgMCAwIDEycHggcmdiYSgyNTUsNDMsMjE0LC42MCksCiAgICAgIDAgMCAyNnB4IHJnYmEoNDMsMjE3LDI1NSwuNDUpLAogICAgICAwIDAgNjBweCByZ2JhKDQzLDIxNywyNTUsLjI1KTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKSBzY2FsZSgxKTsKICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAuMjJzIGVhc2UsIGZpbHRlciAuMjJzIGVhc2UsIGJveC1zaGFkb3cgLjIycyBlYXNlOwogICAgcG9zaXRpb246cmVsYXRpdmU7CiAgICBpc29sYXRpb246aXNvbGF0ZTsKICB9CiAgLmN0YSBidXR0b246OmJlZm9yZXsKICAgIGNvbnRlbnQ6IiI7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIGluc2V0Oi0ycHg7CiAgICBib3JkZXItcmFkaXVzOjE4cHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMjU1LDQzLDIxNCwuODUpLCByZ2JhKDQzLDIxNywyNTUsLjc1KSk7CiAgICBmaWx0ZXI6IGJsdXIoMTJweCk7CiAgICBvcGFjaXR5Oi41NTsKICAgIHotaW5kZXg6LTE7CiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC4yMnMgZWFzZSwgZmlsdGVyIC4yMnMgZWFzZTsKICB9CiAgLmN0YSBidXR0b246aG92ZXJ7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCkgc2NhbGUoMS4wMSk7CiAgICBmaWx0ZXI6IGJyaWdodG5lc3MoMS4xKTsKICAgIGJveC1zaGFkb3c6CiAgICAgIDAgMCAxOHB4IHJnYmEoMjU1LDQzLDIxNCwuODApLAogICAgICAwIDAgMzhweCByZ2JhKDQzLDIxNywyNTUsLjU1KSwKICAgICAgMCAwIDkwcHggcmdiYSg0MywyMTcsMjU1LC4zNSk7CiAgfQogIC5jdGEgYnV0dG9uOmhvdmVyOjpiZWZvcmV7IG9wYWNpdHk6Ljg7IGZpbHRlcjogYmx1cigxNHB4KTsgfQogIC5jdGEgYnV0dG9uOmFjdGl2ZXsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApIHNjYWxlKC45OSk7IH0KCiAgLmludHJvLWxheWVyLmV4aXR7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMDIpOwogICAgZmlsdGVyOiBibHVyKDEwcHgpIGJyaWdodG5lc3MoMS4xNSk7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogIH0KCiAgLyogPT09PT0gTUFJTiBTVEFHRSA9PT09PSAqLwogIC5zdGFnZXsKICAgIHBvc2l0aW9uOmZpeGVkOyBpbnNldDowOwogICAgZGlzcGxheTpncmlkOyBwbGFjZS1pdGVtczpjZW50ZXI7CiAgICB6LWluZGV4OjI7CiAgICBwYWRkaW5nOiA2dmggNHZ3OwogICAgb3BhY2l0eTowOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDhweCk7CiAgICBmaWx0ZXI6IGJsdXIoOHB4KTsKICAgIHRyYW5zaXRpb246CiAgICAgIG9wYWNpdHkgLjc1cyBlYXNlLAogICAgICB0cmFuc2Zvcm0gLjg1cyBjdWJpYy1iZXppZXIoLjIsLjgsLjIsMSksCiAgICAgIGZpbHRlciAuODVzIGVhc2UsCiAgICAgIHBhZGRpbmcgLjg1cyBlYXNlOwogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybSwgb3BhY2l0eSwgZmlsdGVyLCBwYWRkaW5nOwogIH0KICAuc3RhZ2UuYWN0aXZlewogICAgb3BhY2l0eToxOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOwogICAgZmlsdGVyOiBibHVyKDApOwogIH0KCiAgLmxvZ297CiAgICBwb3NpdGlvbjpyZWxhdGl2ZTsKICAgIHRleHQtYWxpZ246Y2VudGVyOwogICAgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDAgMjZweCByZ2JhKDI1NSw0MywyMTQsLjU1KSk7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVooMCk7CiAgICB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOwogIH0KCiAgLnRpdGxlewogICAgbWFyZ2luOjA7CiAgICBmb250LXNpemU6IGNsYW1wKDQ4cHgsIDIwdncsIDgwMHB4KTsKICAgIGxpbmUtaGVpZ2h0Oi44ODsKICAgIHdoaXRlLXNwYWNlOm5vd3JhcDsKICAgIGZvbnQtZmFtaWx5OiJCcnVzaCBTY3JpcHQgTVQiLCJCcnVzaCBTY3JpcHQgU3RkIixjdXJzaXZlOwogICAgZm9udC13ZWlnaHQ6NjAwOwogICAgbGV0dGVyLXNwYWNpbmc6LS4wM2VtOwogICAgY29sb3I6dmFyKC0td2hpdGUpOwogICAgLXdlYmtpdC10ZXh0LXN0cm9rZTouNHB4IHJnYmEoMjU1LDI1NSwyNTUsLjUpOwogICAgdGV4dC1zaGFkb3c6CiAgICAgIDAgMCAxOHB4IHJnYmEoMjU1LDQzLDIxNCwuODUpLAogICAgICAwIDAgNDBweCByZ2JhKDQzLDIxNywyNTUsLjU1KSwKICAgICAgMCAwIDRweCByZ2JhKDI1NSwyNTUsMjU1LC45NSk7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMThweCkgc2NhbGUoLjk4NSk7CiAgICB0cmFuc2l0aW9uOiBmb250LXNpemUgLjlzIGVhc2UsIGxldHRlci1zcGFjaW5nIC45cyBlYXNlOwogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybSwgb3BhY2l0eTsKICB9CgogIEBrZXlmcmFtZXMgbmVvbkJyZWF0aHsKICAgIDAlLDEwMCV7CiAgICAgIHRleHQtc2hhZG93OgogICAgICAgIDAgMCAxOHB4IHJnYmEoMjU1LDQzLDIxNCwuODUpLAogICAgICAgIDAgMCA0MHB4IHJnYmEoNDMsMjE3LDI1NSwuNTUpLAogICAgICAgIDAgMCA0cHggcmdiYSgyNTUsMjU1LDI1NSwxKTsKICAgICAgZmlsdGVyOiBzYXR1cmF0ZSgxLjA1KTsKICAgIH0KICAgIDUwJXsKICAgICAgdGV4dC1zaGFkb3c6CiAgICAgICAgMCAwIDMycHggcmdiYSgyNTUsNDMsMjE0LDEpLAogICAgICAgIDAgMCA3OHB4IHJnYmEoNDMsMjE3LDI1NSwuNzUpLAogICAgICAgIDAgMCA1cHggcmdiYSgyNTUsMjU1LDI1NSwxKTsKICAgICAgZmlsdGVyOiBzYXR1cmF0ZSgxLjIpOwogICAgfQogIH0KICAudGl0bGUucmVhZHl7CiAgICBvcGFjaXR5OjE7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCkgc2NhbGUoMSk7CiAgICBhbmltYXRpb246IG5lb25CcmVhdGggdmFyKC0tcHVsc2VEdXIpIGVhc2UtaW4tb3V0IGluZmluaXRlIHZhcigtLXB1bHNlRGVsYXkpOwogIH0KCiAgLnRpdGxlIC5sZXR0ZXJ7CiAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICAgIG9wYWNpdHk6MDsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgyNnB4KSBzY2FsZSguOTYpIHNrZXdZKDEuNWRlZyk7CiAgICBmaWx0ZXI6IGJsdXIoN3B4KTsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm0sIG9wYWNpdHksIGZpbHRlcjsKICB9CiAgLnRpdGxlIC5sZXR0ZXIuc2hvd3sKICAgIG9wYWNpdHk6MTsKICAgIHRyYW5zZm9ybTpub25lOwogICAgZmlsdGVyOiBibHVyKDApOwogICAgdHJhbnNpdGlvbjoKICAgICAgb3BhY2l0eSAuNjJzIGN1YmljLWJlemllciguMjIsLjYxLC4zNiwxKSwKICAgICAgdHJhbnNmb3JtIC43NHMgY3ViaWMtYmV6aWVyKC4yMiwuNjEsLjM2LDEpLAogICAgICBmaWx0ZXIgLjc0cyBlYXNlOwogIH0KICBAa2V5ZnJhbWVzIGZsb2F0eXsKICAgIDAleyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0KICAgIDUwJXsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0ycHgpOyB9CiAgICAxMDAleyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0KICB9CiAgLnRpdGxlIC5sZXR0ZXIuZmxvd3sgYW5pbWF0aW9uOiBmbG9hdHkgMy44cyBlYXNlLWluLW91dCBpbmZpbml0ZTsgfQoKICAuc3VidGl0bGV7CiAgICBmb250LWZhbWlseToiTW9udHNlcnJhdCIsIlNlZ29lIFVJIixBcmlhbCxzYW5zLXNlcmlmOwogICAgZm9udC13ZWlnaHQ6OTAwOwogICAgbGV0dGVyLXNwYWNpbmc6M3B4OwogICAgbWFyZ2luLXRvcDowOwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgdG9wOi0zNnB4OyAvKiBPTkxZIHN1YnRpdGxlIG1vdmVzIHVwICovCiAgICBmb250LXNpemU6Y2xhbXAoMTZweCwzdncsNDhweCk7CiAgICB0ZXh0LXNoYWRvdzoKICAgICAgMCAwIDEwcHggcmdiYSgyNTUsNDMsMjE0LC4zNSksCiAgICAgIDAgMCAxNHB4IHJnYmEoMjU1LDI1NSwyNTUsLjM1KSwKICAgICAgMCAwIDMwcHggcmdiYSg0MywyMTcsMjU1LC42NSk7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTJweCk7CiAgICB0cmFuc2l0aW9uOgogICAgICBvcGFjaXR5IC45NXMgZWFzZSwKICAgICAgdHJhbnNmb3JtIDFzIGVhc2UsCiAgICAgIHRvcCAuODVzIGVhc2UsCiAgICAgIGZvbnQtc2l6ZSAuOXMgZWFzZSwKICAgICAgbGV0dGVyLXNwYWNpbmcgLjlzIGVhc2U7Cn0KICAuc3VidGl0bGUuc2hvd3sgb3BhY2l0eToxOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0KCiAgLyogPT09PT0gQ09NUEFDVCBTVEFURSA9PT09PSAqLwogIC5zdGFnZS5jb21wYWN0ewogICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAganVzdGlmeS1pdGVtczpjZW50ZXI7CiAgICBwYWRkaW5nLXRvcDogMDsKICAgIHBhZGRpbmctbGVmdDogNHZ3OwogICAgcGFkZGluZy1yaWdodDogNHZ3Owp9CiAgLnRpdGxlLmNvbXBhY3R7CiAgZm9udC1zaXplOiBpbmhlcml0OwogIGxldHRlci1zcGFjaW5nOiBpbmhlcml0Owp9CiAgLnN1YnRpdGxlLmNvbXBhY3R7CiAgdG9wOi0xNHB4OwogIGZvbnQtc2l6ZTogaW5oZXJpdDsKICBsZXR0ZXItc3BhY2luZzogaW5oZXJpdDsKfQoKICAubG9nby5jb21wYWN0TGlmdHsKICAgIGFuaW1hdGlvbjogbGlmdEdsb3cgLjg1cyBjdWJpYy1iZXppZXIoLjIsLjgsLjIsMSkgYm90aDsKICB9CiAgQGtleWZyYW1lcyBsaWZ0R2xvd3sKICAgIDAleyBmaWx0ZXI6IGRyb3Atc2hhZG93KDAgMCAyNnB4IHJnYmEoMjU1LDQzLDIxNCwuNTUpKTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApIHNjYWxlKDEpOyB9CiAgICA2MCV7IGZpbHRlcjogZHJvcC1zaGFkb3coMCAwIDQ0cHggcmdiYSgyNTUsNDMsMjE0LC43MikpIGRyb3Atc2hhZG93KDAgMCAzNHB4IHJnYmEoNDMsMjE3LDI1NSwuNDUpKTsgfQogICAgMTAwJXsgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDAgMzBweCByZ2JhKDI1NSw0MywyMTQsLjU1KSkgZHJvcC1zaGFkb3coMCAwIDIwcHggcmdiYSg0MywyMTcsMjU1LC4zMikpOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCkgc2NhbGUoMSk7IH0KICB9CgogIC8qIGFjY2Vzc2liaWxpdHkgKi8KICBAbWVkaWEgKHByZWZlcnMtcmVkdWNlZC1tb3Rpb246IHJlZHVjZSl7CiAgICAqeyBhbmltYXRpb246bm9uZSAhaW1wb3J0YW50OyB0cmFuc2l0aW9uOm5vbmUgIWltcG9ydGFudDsgfQogICAgLmJnLWRyaWZ0LCAuZ3JhaW57IGFuaW1hdGlvbjpub25lICFpbXBvcnRhbnQ7IH0KICAgIC5iZy1wdWxzZXsgb3BhY2l0eTowICFpbXBvcnRhbnQ7IH0KICB9CgogIC8qID09PT09IElNUEFDVCBMSU5FUyBCVVJTVCAob24gSU5TRVJUKSA9PT09PSAqLwogICNidXJzdENhbnZhc3sKICAgIHBvc2l0aW9uOmZpeGVkOwogICAgaW5zZXQ6MDsKICAgIHdpZHRoOjEwMHZ3OwogICAgaGVpZ2h0OjEwMHZoOwogICAgei1pbmRleDogMTsKICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC4yNXMgZWFzZTsKICB9CiAgYm9keS5idXJzdC1vbiAjYnVyc3RDYW52YXN7IG9wYWNpdHk6MTsgfQoKPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KCiAgPCEtLSBiYWNrZ3JvdW5kIGxheWVycyAtLT4KICA8ZGl2IGNsYXNzPSJiZy1kcmlmdCIgYXJpYS1oaWRkZW49InRydWUiPjwvZGl2PgogIDxkaXYgY2xhc3M9ImJnLXB1bHNlIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9kaXY+CiAgPGRpdiBjbGFzcz0iZ3JhaW4iIGFyaWEtaGlkZGVuPSJ0cnVlIj48L2Rpdj4KICA8Y2FudmFzIGlkPSJidXJzdENhbnZhcyIgYXJpYS1oaWRkZW49InRydWUiPjwvY2FudmFzPgoKCiAgPCEtLSBJTlRSTyAtLT4KICA8ZGl2IGNsYXNzPSJpbnRyby1sYXllciIgaWQ9ImludHJvIj4KICAgIDxkaXYgY2xhc3M9ImludHJvLWNhcmQiIGlkPSJpbnRyb0NhcmQiPgogICAgICA8aDIgY2xhc3M9Imhlcm8tbmFtZSI+SkFNRVMgUklHQVM8L2gyPgogICAgICA8ZGl2IGNsYXNzPSJzdWJsaW5lIj5QUkVTRU5UUzwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjdGEiPjxidXR0b24gaWQ9ImdvQnRuIj5JTlNFUlQ8L2J1dHRvbj48L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8IS0tIE1BSU4gLS0+CiAgPGRpdiBjbGFzcz0ic3RhZ2UiIGlkPSJzdGFnZSIgYXJpYS1oaWRkZW49InRydWUiPgogICAgPGRpdiBjbGFzcz0ibG9nbyIgaWQ9ImxvZ28iPgogICAgICA8aDEgY2xhc3M9InRpdGxlIiBpZD0idGl0bGUiPkV1cGhvcmlhPC9oMT4KICAgICAgPGRpdiBjbGFzcz0ic3VidGl0bGUiIGlkPSJzdWJ0aXRsZSI+T05MSU5FIE1VU0lDIEFXQVJEUyAyMDI2PC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCjxzY3JpcHQ+CigoKSA9PiB7CiAgY29uc3QgaW50cm8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW50cm8nKTsKICBjb25zdCBjYXJkICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnRyb0NhcmQnKTsKICBjb25zdCBnb0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb0J0bicpOwoKICBjb25zdCBzdGFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFnZScpOwogIGNvbnN0IGxvZ28gID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ28nKTsKICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZScpOwogIGNvbnN0IHN1YnRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1YnRpdGxlJyk7CgogIC8vIHNob3cgcG9wdXAgYWZ0ZXIgMnMKICBzZXRUaW1lb3V0KCgpID0+IGNhcmQuY2xhc3NMaXN0LmFkZCgnc2hvdycpLCAyMDAwKTsKCiAgZnVuY3Rpb24gbGF1bmNoTWFpbigpewogICAgCiAgICBzdGFydEJ1cnN0KCk7CmdvQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgIGludHJvLmNsYXNzTGlzdC5hZGQoJ2V4aXQnKTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgaW50cm8uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgc3RhZ2UuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgIHN0YWdlLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTsKICAgICAgc3RhcnRMb2dvKCk7CgogICAgICAvLyBjb21wYWN0IG1vZGUgZGlzYWJsZWQg4oCTIGxvZ28gc2l6ZSBsb2NrZWQKCiAgICB9LCA2NTApOwogIH0KICBnb0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGxhdW5jaE1haW4pOwogIC8vIEFVVE8tU1RBUlQgKGZvciBjb21iaW5lZCBpbnRybykKICBzZXRUaW1lb3V0KCgpID0+IHsgdHJ5eyBpZihnb0J0biAmJiAhZ29CdG4uZGlzYWJsZWQpIGxhdW5jaE1haW4oKTsgfWNhdGNoKGUpe30gfSwgMjQwMCk7CgoKICAKICAvKiA9PT09PSAxMDAgTElORVMgQlVSU1QgKHNwYXduIGF0IGNlbnRlciwgYm91bmNlL3JlZmxlY3Qgb24gZWRnZXMpID09PT09ICovCiAgY29uc3QgYnVyc3RDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVyc3RDYW52YXMnKTsKICBjb25zdCBiY3R4ID0gYnVyc3RDYW52YXMuZ2V0Q29udGV4dCgnMmQnLCB7IGFscGhhOiB0cnVlIH0pOwoKICBsZXQgYnVyc3RSdW5uaW5nID0gZmFsc2U7CiAgbGV0IGJ1cnN0UGFydHMgPSBbXTsKICBsZXQgYnVyc3RSQUYgPSAwOwogIGxldCBidXJzdFN0YXJ0VCA9IDA7CgogIGZ1bmN0aW9uIHJlc2l6ZUJ1cnN0KCl7CiAgICBjb25zdCBkcHIgPSBNYXRoLm1heCgxLCBNYXRoLm1pbigyLCB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxKSk7CiAgICBidXJzdENhbnZhcy53aWR0aCAgPSBNYXRoLmZsb29yKHdpbmRvdy5pbm5lcldpZHRoICAqIGRwcik7CiAgICBidXJzdENhbnZhcy5oZWlnaHQgPSBNYXRoLmZsb29yKHdpbmRvdy5pbm5lckhlaWdodCAqIGRwcik7CiAgICBidXJzdENhbnZhcy5zdHlsZS53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoICsgJ3B4JzsKICAgIGJ1cnN0Q2FudmFzLnN0eWxlLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCArICdweCc7CiAgICBiY3R4LnNldFRyYW5zZm9ybShkcHIsIDAsIDAsIGRwciwgMCwgMCk7CiAgfQogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCByZXNpemVCdXJzdCwgeyBwYXNzaXZlOnRydWUgfSk7CiAgcmVzaXplQnVyc3QoKTsKCiAgZnVuY3Rpb24gcmFuZChtaW4sIG1heCl7IHJldHVybiBtaW4gKyBNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbik7IH0KCiAgZnVuY3Rpb24gbWFrZVBhcnQoKXsKICAgIGNvbnN0IGN4ID0gd2luZG93LmlubmVyV2lkdGggKiAwLjU7CiAgICBjb25zdCBjeSA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuNTsKCiAgICAvLyByYW5kb20gZGlyZWN0aW9uIGZyb20gY2VudGVyCiAgICBjb25zdCBhbmcgPSByYW5kKDAsIE1hdGguUEkgKiAyKTsKICAgIGNvbnN0IHNwZWVkID0gcmFuZCg1MjAsIDk4MCk7IC8vIHB4L3NlYwogICAgY29uc3QgdnggPSBNYXRoLmNvcyhhbmcpICogc3BlZWQ7CiAgICBjb25zdCB2eSA9IE1hdGguc2luKGFuZykgKiBzcGVlZDsKCiAgICByZXR1cm4gewogICAgICB4OiBjeCwgeTogY3ksCiAgICAgIHZ4LCB2eSwKICAgICAgbGVuOiByYW5kKDE4LCA1NiksCiAgICAgIHc6IHJhbmQoMS4wLCAyLjQpLAogICAgICBnbG93OiByYW5kKDAuMTgsIDAuNDIpLAogICAgICBhbHBoYTogMSwKICAgICAgaHVlTWl4OiBNYXRoLnJhbmRvbSgpIDwgMC41ID8gJ3BpbmsnIDogJ2N5YW4nCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gZHJhd1BhcnQocCl7CiAgICAvLyBkcmF3IGEgc2hvcnQgbGluZSBvcmllbnRlZCBhbG9uZyB2ZWxvY2l0eSBkaXJlY3Rpb24KICAgIGNvbnN0IGEgPSBNYXRoLmF0YW4yKHAudnksIHAudngpOwogICAgY29uc3QgZHggPSBNYXRoLmNvcyhhKSAqIHAubGVuICogMC41OwogICAgY29uc3QgZHkgPSBNYXRoLnNpbihhKSAqIHAubGVuICogMC41OwoKICAgIC8vIG5lb24taXNoIHN0cm9rZSArIHNvZnQgZ2xvdyAod2l0aG91dCBjaGFuZ2luZyBnbG9iYWwgcGFsZXR0ZSkKICAgIGJjdHgubGluZVdpZHRoID0gcC53OwogICAgYmN0eC5nbG9iYWxBbHBoYSA9IHAuYWxwaGE7CgogICAgLy8gbWFpbiBsaW5lCiAgICBiY3R4LnNoYWRvd0JsdXIgPSAxODsKICAgIGJjdHguc2hhZG93Q29sb3IgPSBwLmh1ZU1peCA9PT0gJ3BpbmsnID8gJ3JnYmEoMjU1LDQzLDIxNCwuODUpJyA6ICdyZ2JhKDQzLDIxNywyNTUsLjg1KSc7CiAgICBiY3R4LnN0cm9rZVN0eWxlID0gcC5odWVNaXggPT09ICdwaW5rJyA/ICdyZ2JhKDI1NSw0MywyMTQsLjg1KScgOiAncmdiYSg0MywyMTcsMjU1LC44NSknOwogICAgYmN0eC5iZWdpblBhdGgoKTsKICAgIGJjdHgubW92ZVRvKHAueCAtIGR4LCBwLnkgLSBkeSk7CiAgICBiY3R4LmxpbmVUbyhwLnggKyBkeCwgcC55ICsgZHkpOwogICAgYmN0eC5zdHJva2UoKTsKCiAgICAvLyB3aGl0ZSBob3QgY29yZQogICAgYmN0eC5zaGFkb3dCbHVyID0gMTA7CiAgICBiY3R4LnNoYWRvd0NvbG9yID0gJ3JnYmEoMjU1LDI1NSwyNTUsLjc1KSc7CiAgICBiY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMjU1LDI1NSwyNTUsLjc1KSc7CiAgICBiY3R4LmxpbmVXaWR0aCA9IE1hdGgubWF4KDAuOCwgcC53ICogMC41NSk7CiAgICBiY3R4LmJlZ2luUGF0aCgpOwogICAgYmN0eC5tb3ZlVG8ocC54IC0gZHggKiAwLjksIHAueSAtIGR5ICogMC45KTsKICAgIGJjdHgubGluZVRvKHAueCArIGR4ICogMC45LCBwLnkgKyBkeSAqIDAuOSk7CiAgICBiY3R4LnN0cm9rZSgpOwogIH0KCiAgZnVuY3Rpb24gc3RlcEJ1cnN0KHQpewogICAgaWYoIWJ1cnN0UnVubmluZykgcmV0dXJuOwoKICAgIGNvbnN0IG5vdyA9IHQgfHwgcGVyZm9ybWFuY2Uubm93KCk7CiAgICBjb25zdCBkdCA9IE1hdGgubWluKDAuMDIyLCAobm93IC0gKHN0ZXBCdXJzdC5fbHQgfHwgbm93KSkgLyAxMDAwKTsKICAgIHN0ZXBCdXJzdC5fbHQgPSBub3c7CgogICAgLy8gZmFkZSB0cmFpbAogICAgYmN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLW92ZXInOwogICAgYmN0eC5nbG9iYWxBbHBoYSA9IDE7CiAgICBiY3R4LmNsZWFyUmVjdCgwLCAwLCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTsKCiAgICBjb25zdCBXID0gd2luZG93LmlubmVyV2lkdGgsIEggPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CgogICAgZm9yKGNvbnN0IHAgb2YgYnVyc3RQYXJ0cyl7CiAgICAgIHAueCArPSBwLnZ4ICogZHQ7CiAgICAgIHAueSArPSBwLnZ5ICogZHQ7CgogICAgICAvLyBib3VuY2UvcmVmbGVjdCBvbiBlZGdlcwogICAgICBjb25zdCBwYWQgPSAyOwogICAgICBpZihwLnggPD0gcGFkKXsgcC54ID0gcGFkOyBwLnZ4ICo9IC0xOyB9CiAgICAgIGlmKHAueCA+PSBXIC0gcGFkKXsgcC54ID0gVyAtIHBhZDsgcC52eCAqPSAtMTsgfQogICAgICBpZihwLnkgPD0gcGFkKXsgcC55ID0gcGFkOyBwLnZ5ICo9IC0xOyB9CiAgICAgIGlmKHAueSA+PSBIIC0gcGFkKXsgcC55ID0gSCAtIHBhZDsgcC52eSAqPSAtMTsgfQoKICAgICAgLy8gc3VidGxlIGVuZXJneSBsb3NzCiAgICAgIHAudnggKj0gMC45OTg7CiAgICAgIHAudnkgKj0gMC45OTg7CgogICAgICBkcmF3UGFydChwKTsKICAgIH0KICAgIGJ1cnN0UkFGID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHN0ZXBCdXJzdCk7CiAgfQoKICBmdW5jdGlvbiBzdGFydEJ1cnN0KCl7CiAgICAvLyByZXNwZWN0IHJlZHVjZWQgbW90aW9uCiAgICBpZiAod2luZG93Lm1hdGNoTWVkaWEgJiYgd2luZG93Lm1hdGNoTWVkaWEoJyhwcmVmZXJzLXJlZHVjZWQtbW90aW9uOiByZWR1Y2UpJykubWF0Y2hlcykgcmV0dXJuOwoKICAgIHJlc2l6ZUJ1cnN0KCk7CiAgICBidXJzdFBhcnRzID0gW107CiAgICBmb3IobGV0IGk9MDsgaTwxMDA7IGkrKykgYnVyc3RQYXJ0cy5wdXNoKG1ha2VQYXJ0KCkpOwoKICAgIGJ1cnN0UnVubmluZyA9IHRydWU7CiAgICBidXJzdFN0YXJ0VCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgc3RlcEJ1cnN0Ll9sdCA9IGJ1cnN0U3RhcnRUOwoKICAgIC8vIGNsZWFyCiAgICBiY3R4LmNsZWFyUmVjdCgwLDAsd2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2J1cnN0LW9uJyk7CiAgICBidXJzdFJBRiA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShzdGVwQnVyc3QpOwogIH0KCiAgZnVuY3Rpb24gc3RvcEJ1cnN0KCl7CiAgICBidXJzdFJ1bm5pbmcgPSBmYWxzZTsKICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGJ1cnN0UkFGKTsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnYnVyc3Qtb24nKTsKCiAgICAvLyBmYWRlIG91dCBxdWlja2x5IHRoZW4gY2xlYXIKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICBiY3R4LmNsZWFyUmVjdCgwLDAsd2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7CiAgICB9LCAyMjApOwogIH0KCgogIGZ1bmN0aW9uIHN0YXJ0TG9nbygpewogICAgY29uc3QgdGV4dCA9IHRpdGxlLnRleHRDb250ZW50LnRyaW0oKTsKICAgIHRpdGxlLnRleHRDb250ZW50ID0gJyc7CgogICAgY29uc3QgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgIGZvciAobGV0IGk9MDsgaTx0ZXh0Lmxlbmd0aDsgaSsrKXsKICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgc3Bhbi5jbGFzc05hbWUgPSAnbGV0dGVyJzsKICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IHRleHRbaV07CiAgICAgIGZyYWcuYXBwZW5kQ2hpbGQoc3Bhbik7CiAgICB9CiAgICB0aXRsZS5hcHBlbmRDaGlsZChmcmFnKTsKCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gewogICAgICB0aXRsZS5jbGFzc0xpc3QuYWRkKCdyZWFkeScpOwoKICAgICAgLy8gU1RBUlQgYmFja2dyb3VuZCBwdWxzZSBzeW5jZWQgd2l0aCBsb2dvCiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnbG9nby1vbicpOwogICAgfSk7CgogICAgY29uc3QgbGV0dGVycyA9IEFycmF5LmZyb20odGl0bGUucXVlcnlTZWxlY3RvckFsbCgnLmxldHRlcicpKTsKICAgIGNvbnN0IEJBU0VfREVMQVkgPSA0MiwgUkFORE9NX0pJVFRFUiA9IDkwLCBPVkVSTEFQX09GRlNFVCA9IDE4MDsKCiAgICBsZXR0ZXJzLmZvckVhY2goKGVsLCBpZHgpID0+IHsKICAgICAgY29uc3QgZGVsYXkgPSBpZHggKiBCQVNFX0RFTEFZICsgTWF0aC5yYW5kb20oKSAqIFJBTkRPTV9KSVRURVIgLSBPVkVSTEFQX09GRlNFVDsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gZWwuY2xhc3NMaXN0LmFkZCgnZmxvdycpLCAxODApOwogICAgICB9LCBNYXRoLm1heCgwLCBkZWxheSkpOwogICAgfSk7CgogICAgc2V0VGltZW91dCgoKSA9PiBzdWJ0aXRsZS5jbGFzc0xpc3QuYWRkKCdzaG93JyksCiAgICAgIE1hdGgubWF4KDkwMCwgbGV0dGVycy5sZW5ndGggKiBCQVNFX0RFTEFZICogMC43MikKICAgICk7CiAgfQoKICAKICAKICAvLyA9PT09PSBLRVlCT0FSRCBDT05UUk9MUyAoRU5URVIgPSBJTlNFUlQsIEVTQyA9IEZVTExTQ1JFRU4gVE9HR0xFKSA9PT09PQogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gewoKICAgIC8vIEVOVEVSID0gSU5TRVJUCiAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicpIHsKICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvQnRuJyk7CiAgICAgIGlmIChidG4gJiYgIWJ0bi5kaXNhYmxlZCkgewogICAgICAgIGJ0bi5jbGljaygpOwogICAgICB9CiAgICB9CgogICAgLy8gRVNDID0gRlVMTFNDUkVFTiBUT0dHTEUKICAgIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHsKICAgICAgLy8gTm90ZTogc29tZSBicm93c2VycyBtYXkgc3RpbGwgdXNlIEVTQyB0byBleGl0IGZ1bGxzY3JlZW4sIGJ1dCB0aGlzIHdvcmtzIHJlbGlhYmx5IHRvIEVOVEVSIGZ1bGxzY3JlZW4gd2hlbiBub3QgZnVsbHNjcmVlbi4KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCiAgICAgIGlmICghZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHsKICAgICAgICBpZiAoZWwucmVxdWVzdEZ1bGxzY3JlZW4pIGVsLnJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKSBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpOwogICAgICB9CiAgICB9CgogIH0pOwpmdW5jdGlvbiB0b2dnbGVGdWxsc2NyZWVuKCl7CiAgICBjb25zdCBkb2MgPSBkb2N1bWVudDsKICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgaWYgKCFkb2MuZnVsbHNjcmVlbkVsZW1lbnQgJiYKICAgICAgICAhZG9jLndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50ICYmCiAgICAgICAgIWRvYy5tb3pGdWxsU2NyZWVuRWxlbWVudCAmJgogICAgICAgICFkb2MubXNGdWxsc2NyZWVuRWxlbWVudCkgewoKICAgICAgaWYgKGVsLnJlcXVlc3RGdWxsc2NyZWVuKSBlbC5yZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICBlbHNlIGlmIChlbC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikgZWwud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4oKTsKICAgICAgZWxzZSBpZiAoZWwubW96UmVxdWVzdEZ1bGxTY3JlZW4pIGVsLm1velJlcXVlc3RGdWxsU2NyZWVuKCk7CiAgICAgIGVsc2UgaWYgKGVsLm1zUmVxdWVzdEZ1bGxzY3JlZW4pIGVsLm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTsKCiAgICB9IGVsc2UgewogICAgICBpZiAoZG9jLmV4aXRGdWxsc2NyZWVuKSBkb2MuZXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgZWxzZSBpZiAoZG9jLndlYmtpdEV4aXRGdWxsc2NyZWVuKSBkb2Mud2Via2l0RXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgZWxzZSBpZiAoZG9jLm1vekNhbmNlbEZ1bGxTY3JlZW4pIGRvYy5tb3pDYW5jZWxGdWxsU2NyZWVuKCk7CiAgICAgIGVsc2UgaWYgKGRvYy5tc0V4aXRGdWxsc2NyZWVuKSBkb2MubXNFeGl0RnVsbHNjcmVlbigpOwogICAgfQogIH0KCn0pKCk7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K";
  const MAIN_B64  = "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVsIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xIiAvPgogIDx0aXRsZT5OZW9uIEF3YXJkcyBGb3JtPC90aXRsZT4KICAKICA8c3R5bGU+CiAgICA6cm9vdHsKICAgICAgLS1iZzojMDcwODE3OwogICAgICAtLWJnMjojMDUwNjEyOwogICAgICAtLWNhcmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjA2KTsKICAgICAgLS1jYXJkMjogcmdiYSgyNTUsMjU1LDI1NSwuMDQpOwogICAgICAtLWJvcmRlcjogcmdiYSgyNTUsMjU1LDI1NSwuMTApOwogICAgICAtLXRleHQ6I2ZmZmZmZjsKICAgICAgLS1tdXRlZDogcmdiYSgyNTUsMjU1LDI1NSwuNzApOwogICAgICAtLW11dGVkMjogcmdiYSgyNTUsMjU1LDI1NSwuNTApOwoKICAgICAgLS1waW5rOiNmZjJlYTY7CiAgICAgIC0tYmx1ZTojMDBkMWZmOwoKICAgICAgLS1yaW5nOiAwIDAgMCAycHggcmdiYSgwLDIwOSwyNTUsLjMwKSwgMCAwIDI0cHggcmdiYSgyNTUsNDYsMTY2LC4xOCk7CiAgICAgIC0tc2hhZG93OiAwIDE0cHggNDBweCByZ2JhKDAsMCwwLC40NSk7CiAgICAgIC0tZ2xvdzogMCAwIDIwcHggcmdiYSgwLDIwOSwyNTUsLjIyKSwgMCAwIDI2cHggcmdiYSgyNTUsNDYsMTY2LC4xOCk7CiAgICAgIC0tcmFkaXVzOiAxOHB4OwogICAgfQoKICAgICp7IGJveC1zaXppbmc6Ym9yZGVyLWJveDsgfQogICAgaHRtbCxib2R5eyBoZWlnaHQ6MTAwJTsgfQogICAgYm9keXsKICAgICAgbWFyZ2luOjA7CiAgICAgIGNvbG9yOnZhcigtLXRleHQpOwogICAgICBmb250LWZhbWlseTogdWktc2Fucy1zZXJpZiwgc3lzdGVtLXVpLCAtYXBwbGUtc3lzdGVtLCBTZWdvZSBVSSwgUm9ib3RvLCAiSGVsdmV0aWNhIE5ldWUiLCBBcmlhbCwgIk5vdG8gU2FucyIsICJBcHBsZSBDb2xvciBFbW9qaSIsICJTZWdvZSBVSSBFbW9qaSI7CiAgICAgIGJhY2tncm91bmQ6CiAgICAgICAgcmFkaWFsLWdyYWRpZW50KDkwMHB4IDQyMHB4IGF0IDE1JSAxNSUsIHJnYmEoMjU1LDQ2LDE2NiwuMTgpLCB0cmFuc3BhcmVudCA2MCUpLAogICAgICAgIHJhZGlhbC1ncmFkaWVudCg5MDBweCA0MjBweCBhdCA4NSUgMjAlLCByZ2JhKDAsMjA5LDI1NSwuMTYpLCB0cmFuc3BhcmVudCA2MCUpLAogICAgICAgIGxpbmVhci1ncmFkaWVudCgxODBkZWcsIHZhcigtLWJnKSAwJSwgdmFyKC0tYmcyKSAxMDAlKTsKICAgICAgb3ZlcmZsb3cteDpoaWRkZW47CiAgICB9CgogICAgLyogY2xlYW4gbmVvbiBzY3JvbGxiYXIgKi8KICAgIDo6LXdlYmtpdC1zY3JvbGxiYXJ7IHdpZHRoOjEwcHg7IGhlaWdodDoxMHB4OyB9CiAgICA6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCByZ2JhKDI1NSw0NiwxNjYsLjc1KSwgcmdiYSgwLDIwOSwyNTUsLjc1KSk7CiAgICAgIGJvcmRlci1yYWRpdXM6OTk5cHg7CiAgICB9CiAgICA6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNreyBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LC4wNik7IH0KCiAgICBheyBjb2xvcjppbmhlcml0OyB9CiAgICBidXR0b24sIGlucHV0eyBmb250OmluaGVyaXQ7IGNvbG9yOmluaGVyaXQ7IH0KCiAgICAud3JhcHsKICAgICAgbWF4LXdpZHRoOiA5ODBweDsKICAgICAgbWFyZ2luOiAwIGF1dG87CiAgICAgIHBhZGRpbmc6IDI2cHggMTZweCA2NHB4OwogICAgfQoKICAgIC8qID09PT09IEhlYWRlciA9PT09PSAqLwogICAgLmhlYWRlcnsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBnYXA6MTRweDsKICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICBtYXJnaW4tYm90dG9tOiAxNHB4OwogICAgfQogICAgLmxvZ297CiAgICAgIHdpZHRoOjQwcHg7CiAgICAgIGhlaWdodDo0MHB4OwogICAgICBib3JkZXItcmFkaXVzOiAxNHB4OwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCByZ2JhKDI1NSw0NiwxNjYsLjk1KSwgcmdiYSgwLDIwOSwyNTUsLjk1KSk7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLWdsb3cpOwogICAgfQogICAgaDF7CiAgICAgIG1hcmdpbjowOwogICAgICBmb250LXNpemU6IGNsYW1wKDIycHgsIDN2dywgMzRweCk7CiAgICAgIGxldHRlci1zcGFjaW5nOi0wLjAyZW07CiAgICB9CiAgICAuc3VidGl0bGV7CiAgICAgIG1hcmdpbjo4cHggMCAwOwogICAgICBjb2xvcjogdmFyKC0tbXV0ZWQpOwogICAgICBtYXgtd2lkdGg6IDc1Y2g7CiAgICAgIGxpbmUtaGVpZ2h0OiAxLjQ1OwogICAgICBmb250LXNpemU6IDE0cHg7CiAgICB9CgogICAgLyogPT09PT0gU2ltcGxlIHNoZWxsL2NhcmQgPT09PT0gKi8KICAgIC5jYXJkewogICAgICBib3JkZXItcmFkaXVzOiAyMnB4OwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCB2YXIoLS1jYXJkKSAwJSwgdmFyKC0tY2FyZDIpIDEwMCUpOwogICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3cpOwogICAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTJweCk7CiAgICB9CgogICAgLyogPT09PT0gSG9tZSBncmlkID09PT09ICovCiAgICAuZ3JpZDR7CiAgICAgIGRpc3BsYXk6Z3JpZDsKICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnI7CiAgICAgIGdhcDogMTJweDsKICAgICAgcGFkZGluZzogMTZweDsKICAgIH0KICAgIEBtZWRpYSAobWluLXdpZHRoOiA2NDBweCl7IC5ncmlkNHsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoMiwgbWlubWF4KDAsMWZyKSk7IH0gfQogICAgQG1lZGlhIChtaW4td2lkdGg6IDk4MHB4KXsgLmdyaWQ0eyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgzLCBtaW5tYXgoMCwxZnIpKTsgfSB9CgogICAgLnBlcnNvbi10aWxleyBwb3NpdGlvbjpyZWxhdGl2ZTsgfQogICAgLnBlcnNvbi1idG57CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlcik7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjA0KTsKICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tcmFkaXVzKTsKICAgICAgcGFkZGluZzogMTZweCAxNHB4OwogICAgICBjdXJzb3I6cG9pbnRlcjsKICAgICAgdGV4dC1hbGlnbjpsZWZ0OwogICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gLjE0cyBlYXNlLCBib3JkZXItY29sb3IgLjE0cyBlYXNlLCBiYWNrZ3JvdW5kIC4xNHMgZWFzZSwgYm94LXNoYWRvdyAuMTRzIGVhc2U7CiAgICB9CiAgICAucGVyc29uLWJ0bjpob3ZlcnsKICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LC4wNik7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuMTYpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1nbG93KTsKICAgIH0KICAgIC5wZXJzb24tdGl0bGV7IGZvbnQtd2VpZ2h0OjgwMDsgZm9udC1zaXplOjE2cHg7IH0KICAgIC5wZXJzb24tc3VieyBtYXJnaW4tdG9wOjZweDsgZm9udC1zaXplOjEycHg7IGNvbG9yOiB2YXIoLS1tdXRlZDIpOyB9CgogICAgLnN5bmMtbWluaXsKICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgIHRvcDoxMHB4OyByaWdodDoxMHB4OwogICAgICBwYWRkaW5nOiA4cHggMTBweDsKICAgICAgYm9yZGVyLXJhZGl1czogMTRweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMTQpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4yNSk7CiAgICAgIGN1cnNvcjpwb2ludGVyOwogICAgICBmb250LXNpemU6MTJweDsKICAgICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEwcHgpOwogICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gLjE0cyBlYXNlLCBib3JkZXItY29sb3IgLjE0cyBlYXNlLCBiYWNrZ3JvdW5kIC4xNHMgZWFzZSwgYm94LXNoYWRvdyAuMTRzIGVhc2U7CiAgICB9CiAgICAuc3luYy1taW5pOmhvdmVyewogICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuMjIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4zNSk7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLWdsb3cpOwogICAgfQogICAgLnN5bmMtbWluaTpmb2N1c3sgb3V0bGluZTogbm9uZTsgYm94LXNoYWRvdzogdmFyKC0tcmluZyk7IH0KCiAgICAvKiA9PT09PSBQZXJzb24gdmlldyB0b3BiYXIgPT09PT0gKi8KICAgIC50b3BiYXJ7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZmxleC13cmFwOndyYXA7CiAgICAgIGdhcDogMTJweDsKICAgICAgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsKICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICBtYXJnaW46IDhweCAwIDE0cHg7CiAgICB9CgogICAgLmJhY2t7CiAgICAgIGJvcmRlcjpub25lOwogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICAgICAgcGFkZGluZzogNnB4IDA7CiAgICAgIGNvbG9yOiB2YXIoLS1tdXRlZCk7CiAgICAgIGN1cnNvcjpwb2ludGVyOwogICAgfQogICAgLmJhY2s6aG92ZXJ7IGNvbG9yOiAjZmZmOyB9CgogICAgLmFjdGlvbnN7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICBnYXA6IDEwcHg7CiAgICAgIGZsZXgtd3JhcDp3cmFwOwogICAgfQoKICAgIC5waWxsewogICAgICBkaXNwbGF5OmlubGluZS1mbGV4OwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIGdhcDogOHB4OwogICAgICBwYWRkaW5nOiAxMHB4IDEycHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4xOCk7CiAgICAgIGNvbG9yOiB2YXIoLS1tdXRlZCk7CiAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgIH0KICAgIC5waWxsIHN0cm9uZ3sgY29sb3I6I2ZmZjsgZm9udC13ZWlnaHQ6ODAwOyB9CgogICAgLmFjdGlvbnsKICAgICAgcGFkZGluZzogMTBweCAxMnB4OwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMTQpOwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCByZ2JhKDI1NSw0NiwxNjYsLjE2KSwgcmdiYSgwLDIwOSwyNTUsLjE0KSk7CiAgICAgIGN1cnNvcjpwb2ludGVyOwogICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gLjE0cyBlYXNlLCBib3gtc2hhZG93IC4xNHMgZWFzZSwgYm9yZGVyLWNvbG9yIC4xNHMgZWFzZTsKICAgIH0KICAgIC5hY3Rpb246aG92ZXJ7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsgYm94LXNoYWRvdzogdmFyKC0tZ2xvdyk7IGJvcmRlci1jb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuMjIpOyB9CiAgICAuYWN0aW9uOmZvY3VzeyBvdXRsaW5lOm5vbmU7IGJveC1zaGFkb3c6IHZhcigtLXJpbmcpOyB9CgogICAgLyogPT09PT0gQ2F0ZWdvcmllcyA9PT09PSAqLwogICAgLmNhdHN7CiAgICAgIGRpc3BsYXk6Z3JpZDsKICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnI7CiAgICAgIGdhcDogMTRweDsKICAgICAgcGFkZGluZzogMTZweDsKICAgIH0KICAgIEBtZWRpYSAobWluLXdpZHRoOiA5ODBweCl7IC5jYXRzeyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7IH0gfQoKICAgIC5jYXR7CiAgICAgIGJvcmRlci1yYWRpdXM6IDIwcHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlcik7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjA0KTsKICAgICAgcGFkZGluZzogMTRweDsKICAgIH0KICAgIC5jYXQgaDJ7IG1hcmdpbjowOyBmb250LXNpemU6IDE0cHg7IGZvbnQtd2VpZ2h0OiA4MDA7IGxldHRlci1zcGFjaW5nOiAuMDFlbTsgfQogICAgLnN0YXR1c3sKICAgICAgbWFyZ2luLXRvcDogNnB4OwogICAgICBmb250LXNpemU6IDEycHg7CiAgICAgIGNvbG9yOiB2YXIoLS1tdXRlZDIpOwogICAgfQogICAgLnN0YXR1cy5vbnsgY29sb3I6IHJnYmEoMCwyMDksMjU1LC45MCk7IH0KCiAgICAuY2F0LWhlYWR7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICBnYXA6IDEwcHg7CiAgICAgIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7CiAgICAgIG1hcmdpbi1ib3R0b206IDEwcHg7CiAgICB9CgogICAgLm1pbml7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LC4xNCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsLjE4KTsKICAgICAgcGFkZGluZzogOHB4IDEwcHg7CiAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgY3Vyc29yOnBvaW50ZXI7CiAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAuMTRzIGVhc2UsIGJveC1zaGFkb3cgLjE0cyBlYXNlLCBiYWNrZ3JvdW5kIC4xNHMgZWFzZSwgYm9yZGVyLWNvbG9yIC4xNHMgZWFzZTsKICAgIH0KICAgIC5taW5pOmhvdmVyewogICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsLjI4KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LC4yMik7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLWdsb3cpOwogICAgfQogICAgLm1pbmk6Zm9jdXN7IG91dGxpbmU6bm9uZTsgYm94LXNoYWRvdzogdmFyKC0tcmluZyk7IH0KCiAgICAubGlzdHsgZGlzcGxheTpmbGV4OyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOyBnYXA6IDhweDsgfQoKICAgIC5yb3d7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICBnYXA6IDEwcHg7CiAgICAgIHBhZGRpbmc6IDEwcHggMTJweDsKICAgICAgYm9yZGVyLXJhZGl1czogMTZweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMTApOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4xNik7CiAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAuMTJzIGVhc2UsIGJvcmRlci1jb2xvciAuMTJzIGVhc2UsIGJveC1zaGFkb3cgLjEycyBlYXNlLCBiYWNrZ3JvdW5kIC4xMnMgZWFzZTsKICAgICAgcG9zaXRpb246cmVsYXRpdmU7CiAgICB9CiAgICAucm93LmRyYWctZW5hYmxlZDpob3ZlcnsKICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjE4KTsKICAgICAgYm94LXNoYWRvdzogMCAwIDAgMXB4IHJnYmEoMCwyMDksMjU1LC4xNSksIDAgMCAxOHB4IHJnYmEoMjU1LDQ2LDE2NiwuMTIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4yMCk7CiAgICB9CiAgICAucm93LmRyYWdnaW5newogICAgICBvdXRsaW5lOiBub25lOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1yaW5nKTsKICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjAxKTsKICAgIH0KCiAgICAuaGFuZGxlewogICAgICB3aWR0aDogMzRweDsKICAgICAgaGVpZ2h0OiAzNHB4OwogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICAgICAgYm9yZGVyLXJhZGl1czogMTJweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMTIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LC4wNCk7CiAgICAgIGNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LC43NSk7CiAgICAgIHVzZXItc2VsZWN0Om5vbmU7CiAgICB9CiAgICAucm93LmRyYWctZW5hYmxlZCAuaGFuZGxleyBjdXJzb3I6IGdyYWI7IH0KICAgIC5yb3cuZHJhZy1lbmFibGVkIC5oYW5kbGU6YWN0aXZleyBjdXJzb3I6IGdyYWJiaW5nOyB9CiAgICAuaGFuZGxlLm9mZnsgb3BhY2l0eTogLjQ1OyB9CgogICAgLm51bXsKICAgICAgd2lkdGg6IDI2cHg7CiAgICAgIHRleHQtYWxpZ246Y2VudGVyOwogICAgICBmb250LXNpemU6IDEycHg7CiAgICAgIGNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LC41NSk7CiAgICAgIGZvbnQtdmFyaWFudC1udW1lcmljOiB0YWJ1bGFyLW51bXM7CiAgICB9CgogICAgaW5wdXQudGV4dHsKICAgICAgZmxleDogMTsKICAgICAgd2lkdGg6MTAwJTsKICAgICAgYm9yZGVyLXJhZGl1czogMTRweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMTIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LC4wNCk7CiAgICAgIHBhZGRpbmc6IDEwcHggMTJweDsKICAgICAgb3V0bGluZTpub25lOwogICAgfQogICAgaW5wdXQudGV4dDo6cGxhY2Vob2xkZXJ7IGNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LC4zNSk7IH0KICAgIGlucHV0LnRleHQ6Zm9jdXN7IGJveC1zaGFkb3c6IHZhcigtLXJpbmcpOyBib3JkZXItY29sb3I6IHRyYW5zcGFyZW50OyB9CgogICAgLnNjb3JlewogICAgICB3aWR0aDogNjRweDsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1lbmQ7CiAgICB9CiAgICAuYmFkZ2V7CiAgICAgIG1pbi13aWR0aDogNDZweDsKICAgICAgdGV4dC1hbGlnbjpjZW50ZXI7CiAgICAgIHBhZGRpbmc6IDhweCAxMHB4OwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMTIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LC4wNCk7CiAgICAgIGNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LC43MCk7CiAgICAgIGZvbnQtd2VpZ2h0OiA4MDA7CiAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgZm9udC12YXJpYW50LW51bWVyaWM6IHRhYnVsYXItbnVtczsKICAgIH0KICAgIC5yb3cuZHJhZy1lbmFibGVkIC5iYWRnZXsKICAgICAgY29sb3I6I2ZmZjsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LC4xOCk7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoMjU1LDQ2LDE2NiwuNzUpLCByZ2JhKDAsMjA5LDI1NSwuNzUpKTsKICAgICAgYm94LXNoYWRvdzogMCAwIDE0cHggcmdiYSgwLDIwOSwyNTUsLjIyKSwgMCAwIDE0cHggcmdiYSgyNTUsNDYsMTY2LC4xOCk7CiAgICB9CgogICAgLmdyaWQtYmd7IGRpc3BsYXk6bm9uZTsgfQoKICAgIC5oaW50ewogICAgICBtYXJnaW4tdG9wOiAxMnB4OwogICAgICBjb2xvcjogdmFyKC0tbXV0ZWQyKTsKICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICBwYWRkaW5nOiAwIDJweDsKICAgIH0KCiAgICAuaGlkZGVueyBkaXNwbGF5Om5vbmUgIWltcG9ydGFudDsgfQogIDwvc3R5bGU+Cgo8c2NyaXB0PgooZnVuY3Rpb24oKXsKICBmdW5jdGlvbiBzYWZlV3JhcChmbil7CiAgICByZXR1cm4gZnVuY3Rpb24oKXsKICAgICAgdHJ5eyByZXR1cm4gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfWNhdGNoKGUpeyByZXR1cm4gbnVsbDsgfQogICAgfTsKICB9CiAgdHJ5ewogICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUgPSBzYWZlV3JhcChoaXN0b3J5LnJlcGxhY2VTdGF0ZSk7CiAgICBoaXN0b3J5LnB1c2hTdGF0ZSA9IHNhZmVXcmFwKGhpc3RvcnkucHVzaFN0YXRlKTsKICB9Y2F0Y2goZSl7fQp9KSgpOwo8L3NjcmlwdD4KCjwvaGVhZD4KCjxib2R5PgogIDxkaXYgY2xhc3M9IndyYXAiPgogICAgPGRpdiBpZD0iaG9tZVZpZXciPgogICAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgogICAgICAgIDxkaXYgY2xhc3M9ImxvZ28iPjwvZGl2PgogICAgICAgIDxkaXY+CiAgICAgICAgICA8aDE+TmVvbiBBd2FyZHMgRm9ybTwvaDE+CiAgICAgICAgICA8cCBjbGFzcz0ic3VidGl0bGUiPgogICAgICAgICAgICDOlM65zqzOu861zr7OtSDOrM+Ezr/OvM6/LiDOms6szrjOtSDPg861zrvOr860zrEgzq3Ph861zrkgMTAgzrrOsc+EzrfOs86/z4HOr861z4IgzrrOsc65IM6/zrkgzrPPgc6xzrzOvM6tz4Igz4DPgc6/z4POsc+BzrzPjM62zr/Ovc+EzrHOuSDOsc+Fz4TPjM68zrHPhM6xICjOsc+Az4wgRXhjZWwgzq4gz4fOtc65z4HOv866zq/Ovc63z4TOsSkuCiAgICAgICAgICAgIM6cz4zOu865z4Igz4XPgM6sz4HPh86/z4XOvSA8c3Ryb25nPs+Ezr/Phc67zqzPh865z4PPhM6/zr0gMjwvc3Ryb25nPiDPg8+FzrzPgM67zrfPgc+JzrzOrc69zr/OuSDPhM6vz4TOu86/zrkgz4POtSDOvM65zrEgzrrOsc+EzrfOs86/z4HOr86xLCDOtc69zrXPgc6zzr/PgM6/zrnOtc6vz4TOsc65IGRyYWcgJiBkcm9wIM66zrHPhM6sz4TOsc6+zrcKICAgICAgICAgICAgzrrOsc65IM68z4DOsc6vzr3Otc65IM6xz4XPhM+MzrzOsc+EzrEgc2NvcmUgKDEy4oCTMSkuCiAgICAgICAgICA8L3A+CiAgICAgICAgPC9kaXY+CiAgICAgICAgCjxidXR0b24gY2xhc3M9ImFjdGlvbiIgaWQ9InN0YXRzQnRuIiB0aXRsZT0izqPPhc6zzrrOtc69z4TPgc+Jz4TOuc66zqwgz4PPhM6xz4TOuc+Dz4TOuc66zqwgJiBFeHBvcnQgRXhjZWwiPgogIPCfk4ogSmFtZXMgUmlnYXMKPC9idXR0b24+CgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9IiI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJncmlkNCIgaWQ9InBlb3BsZUdyaWQiPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9ImdyaWQtYmciPjwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBpZD0icGVyc29uVmlldyIgY2xhc3M9ImhpZGRlbiI+CiAgICAgIDxkaXYgY2xhc3M9InRvcGJhciI+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJhY2siIGlkPSJiYWNrQnRuIj7ihpAgzqDOr8+Dz4k8L2J1dHRvbj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImhlYWRlciIgc3R5bGU9Im1hcmdpbjo2cHggMCAwOyI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImxvZ28iIHN0eWxlPSJ3aWR0aDozNHB4O2hlaWdodDozNHB4OyI+PC9kaXY+CiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPGgxIGlkPSJwZXJzb25UaXRsZSIgc3R5bGU9ImZvbnQtc2l6ZTogY2xhbXAoMjRweCwgMy44dncsIDM4cHgpOyBtYXJnaW46MDsiPjwvaDE+CiAgICAgICAgICAgICAgPHAgY2xhc3M9InN1YnRpdGxlIiBzdHlsZT0ibWFyZ2luLXRvcDo2cHg7Ij4KICAgICAgICAgICAgICAgIM6jz4XOvM+AzrvOrs+Bz4nPg861IM+EzrnPgiDOs8+BzrHOvM68zq3Pgi4gzozPhM6xzr0gz4XPgM6sz4HPh86/z4XOvSA8c3Ryb25nPs+Ezr/Phc67zqzPh865z4PPhM6/zr0gMjwvc3Ryb25nPiDPg8+FzrzPgM67zrfPgc+JzrzOrc69zr/OuSDPhM6vz4TOu86/zrkgz4POtSDOvM65zrEgzrrOsc+EzrfOs86/z4HOr86xLAogICAgICAgICAgICAgICAgzrzPgM6/z4HOtc6vz4Igzr3OsSDOus6szr3Otc65z4IgZHJhZyAmIGRyb3AgzrPOuc6xIM66zrHPhM6sz4TOsc6+zrcgzrrOsc65IM+Ezr8gc2NvcmUgzrXOvc63zrzOtc+Bz47Ovc61z4TOsc65IM6xz4XPhM+MzrzOsc+EzrEgKDHOtz0xMiwgMs63PTEwLCAzzrc9OCwgNM63PTcsIC4uLikuCiAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImFjdGlvbnMiPgogICAgICAgICAgPGRpdiBjbGFzcz0icGlsbCIgdGl0bGU9IkF1dG9zYXZlIM+DzrUgbG9jYWxTdG9yYWdlIj4KICAgICAgICAgICAgPHNwYW4+QXV0b3NhdmU6PC9zcGFuPiA8c3Ryb25nPk9OPC9zdHJvbmc+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxidXR0b24gY2xhc3M9ImFjdGlvbiIgaWQ9InJlc2V0QWxsQnRuIj5SZXNldCDPjM67zrE8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSIiPgogICAgICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICAgICAgPGRpdiBjbGFzcz0iY2F0cyIgaWQ9ImNhdGVnb3JpZXMiPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9ImhpbnQiPlRpcDogzqTOvyBkcmFnIM61zr3Otc+BzrPOv8+Azr/Ouc61zq/PhM6xzrkgzrHOvc6sIM66zrHPhM63zrPOv8+Bzq/OsSDPjM+EzrHOvSDPhc+AzqzPgc+Hzr/Phc69IM+Ezr/Phc67zqzPh865z4PPhM6/zr0gMiDPg8+FzrzPgM67zrfPgc+JzrzOrc69zr/OuSDPhM6vz4TOu86/zrkuIM6kzrEgc2NvcmVzIM68z4DOsc6vzr3Ov8+Fzr0gzrzPjM69zr8gz4PPhM65z4Igz4PPhc68z4DOu863z4HPic68zq3Ovc61z4IgzrPPgc6xzrzOvM6tz4IuPC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCjxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL3hsc3hAMC4xOC41L2Rpc3QveGxzeC5mdWxsLm1pbi5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQ+CigoKSA9PiB7CiAgY29uc3QgUEVPUExFID0gWwogICAgeyBsYWJlbDogIlRlcmkgVmkgU2VudGlvIiwgc2x1ZzogInRlcmktdmktc2VudGlvIiB9LAogICAgeyBsYWJlbDogIk1vbmhpYSIsIHNsdWc6ICJtb25oaWEiIH0sCiAgICB7IGxhYmVsOiAiTGlzamFuc2kiLCBzbHVnOiAibGlzamFuc2kiIH0sCiAgXTsKCiAgY29uc3QgQ0FURUdPUklFUyA9IFsKICAgICJCZXN0IGdyIHNvbmciLAogICAgIkJlc3QgZm9yZWlnbiBzb25nIiwKICAgICJCZXN0IEdSIE1hbGUgQXJ0aXN0IiwKICAgICJCZXN0IEdSIEZlbWFsZSBBcnRzaXMiLAogICAgIkJlc3QgRm9yZWlnbiBNYWxlIEFydGlzdCIsCiAgICAiQmVzdCBGb3JlaWduIEZlbWFsZSBBcnRpc3QiLAogICAgIkJlc3QgR1IgbXVzaWMgVmlkZW8iLAogICAgIkJlc3QgRm9yZWlnbiBNdXNpYyBWaWRlbyIsCiAgICAiQmVzdCBFU0MgMjAyNSBwZXJmb21hbmNlIiwKICAgICJCZXN0IEFsYnVtIG9mIHRoZSBZZWFyIiwKICBdOwoKICAvLyBTY29yaW5nIGZvciB1cCB0byAxMCByYW5rZWQgaXRlbXMgKGFwcGxpZXMgdG8gZmlsbGVkIHJvd3Mgb25seSkKICBjb25zdCBTQ09SRVMgPSBbMTIsIDEwLCA4LCA3LCA2LCA1LCA0LCAzLCAyLCAxXTsKCiAgY29uc3QgcXMgPSAoc2VsLCBlbD1kb2N1bWVudCkgPT4gZWwucXVlcnlTZWxlY3RvcihzZWwpOwoKICBjb25zdCBob21lVmlldyA9IHFzKCIjaG9tZVZpZXciKTsKICBjb25zdCBwZXJzb25WaWV3ID0gcXMoIiNwZXJzb25WaWV3Iik7CiAgY29uc3QgcGVvcGxlR3JpZCA9IHFzKCIjcGVvcGxlR3JpZCIpOwogIGNvbnN0IGNhdGVnb3JpZXNFbCA9IHFzKCIjY2F0ZWdvcmllcyIpOwogIGNvbnN0IHBlcnNvblRpdGxlID0gcXMoIiNwZXJzb25UaXRsZSIpOwogIGNvbnN0IGJhY2tCdG4gPSBxcygiI2JhY2tCdG4iKTsKICBjb25zdCByZXNldEFsbEJ0biA9IHFzKCIjcmVzZXRBbGxCdG4iKTsKCiAgbGV0IGN1cnJlbnRQZXJzb24gPSBudWxsOwogIGxldCBzdGF0ZSA9IG51bGw7IC8vIHsgW2NhdGVnb3J5XTogWyB7aWQsdGV4dH0gLi4uIF0gfQogIGxldCBkcmFnQ3R4ID0geyBjYXQ6IG51bGwsIGRyYWdnaW5nSWQ6IG51bGwgfTsKCiAgLy8gRXhjZWwgaW1wb3J0IChwZXIgcGVyc29uKQogIGxldCBwZW5kaW5nSW1wb3J0UGVyc29uID0gbnVsbDsKCiAgY29uc3QgZXhjZWxJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgZXhjZWxJbnB1dC50eXBlID0gImZpbGUiOwogIGV4Y2VsSW5wdXQuYWNjZXB0ID0gIi54bHN4LC54bHMiOwogIGV4Y2VsSW5wdXQuY2xhc3NOYW1lID0gImhpZGRlbiI7CiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChleGNlbElucHV0KTsKCiAgZXhjZWxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCBhc3luYyAoKSA9PiB7CiAgICBjb25zdCBmaWxlID0gZXhjZWxJbnB1dC5maWxlcyAmJiBleGNlbElucHV0LmZpbGVzWzBdOwogICAgZXhjZWxJbnB1dC52YWx1ZSA9ICIiOyAvLyByZXNldCBzbyB0aGUgc2FtZSBmaWxlIGNhbiBiZSBwaWNrZWQgYWdhaW4KICAgIGlmICghZmlsZSB8fCAhcGVuZGluZ0ltcG9ydFBlcnNvbikgcmV0dXJuOwogICAgdHJ5ewogICAgICBhd2FpdCBpbXBvcnRFeGNlbEZvclBlcnNvbihmaWxlLCBwZW5kaW5nSW1wb3J0UGVyc29uKTsKICAgICAgYWxlcnQoYM6IzrPOuc69zrUgz4PPhc6zz4fPgc6/zr3Ouc+DzrzPjM+CIM6zzrnOsTogJHtwZW5kaW5nSW1wb3J0UGVyc29uLmxhYmVsfWApOwogICAgfWNhdGNoKGVycil7CiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgYWxlcnQoIs6Rz4DOv8+Ez4XPh86vzrEgz4PPhc6zz4fPgc6/zr3Ouc+DzrzOv8+NLiDOks61zrLOsc65z47Pg86/z4Ugz4zPhM65IM+Ezr8gRXhjZWwgzrXOr869zrHOuSDPg8+Jz4PPhM+MICgueGxzeCkgzrrOsc65IM60zr/Ous6vzrzOsc+DzrUgzr7Osc69zqwuIik7CiAgICB9ZmluYWxseXsKICAgICAgcGVuZGluZ0ltcG9ydFBlcnNvbiA9IG51bGw7CiAgICB9CiAgfSk7CgogIGZ1bmN0aW9uIHN0YXJ0RXhjZWxJbXBvcnRGb3IocGVyc29uKXsKICAgIGlmICh0eXBlb2YgWExTWCA9PT0gInVuZGVmaW5lZCIpewogICAgICBhbGVydCgizpTOtc69IM6yz4HOrc64zrfOus61IM63IM6yzrnOss67zrnOv864zq7Ous63IFhMU1guIM6IzrvOtc6zzr7OtSDPjM+Ezrkgzq3Ph861zrnPgiDPg8+Nzr3OtM61z4POtyDOriDPjM+Ezrkgz4bOv8+Bz4TPjs69zrXPhM6xzrkgz4PPic+Dz4TOrCDPhM6/IHhsc3guZnVsbC5taW4uanMuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHBlbmRpbmdJbXBvcnRQZXJzb24gPSBwZXJzb247CiAgICBleGNlbElucHV0LmNsaWNrKCk7CiAgfQoKICBmdW5jdGlvbiBub3JtKHMpewogICAgcmV0dXJuIFN0cmluZyhzID8/ICIiKQogICAgICAudG9Mb3dlckNhc2UoKQogICAgICAucmVwbGFjZSgvW1xcdTIwMEItXFx1MjAwRFxcdUZFRkZdL2csICIiKQogICAgICAucmVwbGFjZSgvW15hLXowLTnOsS3Pic6szq3Ors6vz4zPjc+Oz4rPi86QzrBcXHNdL2dpLCAiICIpCiAgICAgIC5yZXBsYWNlKC9cXHMrL2csICIgIikKICAgICAgLnRyaW0oKTsKICB9CgogIGZ1bmN0aW9uIG1hcEV4Y2VsQ2F0ZWdvcnkocmF3KXsKICAgIGNvbnN0IG4gPSBub3JtKHJhdyk7CgogICAgZm9yIChjb25zdCBjIG9mIENBVEVHT1JJRVMpewogICAgICBpZiAobm9ybShjKSA9PT0gbikgcmV0dXJuIGM7CiAgICB9CgogICAgaWYgKG4uaW5jbHVkZXMoImJlc3QgZ3JlZWsgc29uZyIpIHx8IG4uaW5jbHVkZXMoImJlc3QgZ3Igc29uZyIpIHx8IChuLmluY2x1ZGVzKCLOtc67zrvOt869IikgJiYgbi5pbmNsdWRlcygiz4TPgc6xzrPOv8+FzrQiKSkpCiAgICAgIHJldHVybiAiQmVzdCBnciBzb25nIjsKICAgIGlmIChuLmluY2x1ZGVzKCJiZXN0IGZvcmVpZ24gc29uZyIpIHx8IChuLmluY2x1ZGVzKCLOvs61zr0iKSAmJiBuLmluY2x1ZGVzKCLPhM+BzrHOs86/z4XOtCIpKSkKICAgICAgcmV0dXJuICJCZXN0IGZvcmVpZ24gc29uZyI7CgogICAgaWYgKG4uaW5jbHVkZXMoImJlc3QgZ3JlZWsgbWFsZSBhcnRpc3QiKSB8fCBuLmluY2x1ZGVzKCJiZXN0IGdyIG1hbGUiKSB8fCAobi5pbmNsdWRlcygizrXOu867zrfOvSIpICYmIG4uaW5jbHVkZXMoIs6xzr3OtM+BIikpKQogICAgICByZXR1cm4gIkJlc3QgR1IgTWFsZSBBcnRpc3QiOwogICAgaWYgKG4uaW5jbHVkZXMoImJlc3QgZ3JlZWsgZmVtYWxlIGFydGlzdCIpIHx8IG4uaW5jbHVkZXMoImJlc3QgZ3IgZmVtYWxlIikgfHwgKG4uaW5jbHVkZXMoIs61zrvOu863zr0iKSAmJiBuLmluY2x1ZGVzKCLOs8+Fzr0iKSkpCiAgICAgIHJldHVybiAiQmVzdCBHUiBGZW1hbGUgQXJ0c2lzIjsKCiAgICBpZiAobi5pbmNsdWRlcygiYmVzdCBmb3JlaWduIG1hbGUgYXJ0aXN0IikgfHwgbi5pbmNsdWRlcygiYmVzdCBmb3JlaWduIG1hbGUiKSB8fCAobi5pbmNsdWRlcygizr7Otc69IikgJiYgbi5pbmNsdWRlcygizrHOvc60z4EiKSkpCiAgICAgIHJldHVybiAiQmVzdCBGb3JlaWduIE1hbGUgQXJ0aXN0IjsKICAgIGlmIChuLmluY2x1ZGVzKCJiZXN0IGZvcmVpZ24gZmVtYWxlIGFydGlzdCIpIHx8IG4uaW5jbHVkZXMoImJlc3QgZm9yZWlnbiBmZW1hbGUiKSB8fCAobi5pbmNsdWRlcygizr7Otc69IikgJiYgbi5pbmNsdWRlcygizrPPhc69IikpKQogICAgICByZXR1cm4gIkJlc3QgRm9yZWlnbiBGZW1hbGUgQXJ0aXN0IjsKCiAgICBpZiAobi5pbmNsdWRlcygiYmVzdCBncmVlayBtdXNpYyB2aWRlbyIpIHx8IG4uaW5jbHVkZXMoImJlc3QgZ3IgbXVzaWMgdmlkZW8iKSB8fCAobi5pbmNsdWRlcygizrXOu867zrfOvSIpICYmIG4uaW5jbHVkZXMoIs6yzrnOvc+EzrUiKSkpCiAgICAgIHJldHVybiAiQmVzdCBHUiBtdXNpYyBWaWRlbyI7CiAgICBpZiAobi5pbmNsdWRlcygiYmVzdCBmb3JlaWduIG11c2ljIHZpZGVvIikgfHwgKG4uaW5jbHVkZXMoIs6+zrXOvSIpICYmIG4uaW5jbHVkZXMoIs6yzrnOvc+EzrUiKSkpCiAgICAgIHJldHVybiAiQmVzdCBGb3JlaWduIE11c2ljIFZpZGVvIjsKCiAgICBpZiAobi5pbmNsdWRlcygiZXNjIikgJiYgKG4uaW5jbHVkZXMoInBlcmZvcm1hbmNlIikgfHwgbi5pbmNsdWRlcygicGVyZm9tYW5jZSIpIHx8IG4uaW5jbHVkZXMoInBlcmYiKSkpCiAgICAgIHJldHVybiAiQmVzdCBFU0MgMjAyNSBwZXJmb21hbmNlIjsKCiAgICBpZiAobi5pbmNsdWRlcygiYWxidW0gb2YgdGhlIHllYXIiKSB8fCBuID09PSAiYWxidW0iIHx8IG4uaW5jbHVkZXMoIs6szrvOvM+AIikpCiAgICAgIHJldHVybiAiQmVzdCBBbGJ1bSBvZiB0aGUgWWVhciI7CgogICAgcmV0dXJuIG51bGw7CiAgfQoKICBmdW5jdGlvbiBzdG9yYWdlS2V5KHNsdWcpeyByZXR1cm4gYG5lb24tYXdhcmRzOiR7c2x1Z31gOyB9CgogIGZ1bmN0aW9uIHV1aWQoKSB7CiAgICBpZiAodHlwZW9mIGNyeXB0byAhPT0gInVuZGVmaW5lZCIgJiYgY3J5cHRvLnJhbmRvbVVVSUQpIHJldHVybiBjcnlwdG8ucmFuZG9tVVVJRCgpOwogICAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIpICsgIi0iICsgRGF0ZS5ub3coKS50b1N0cmluZygxNik7CiAgfQoKICBmdW5jdGlvbiBtYWtlRGVmYXVsdFN0YXRlKCl7CiAgICBjb25zdCBvYmogPSB7fTsKICAgIGZvciAoY29uc3QgY2F0IG9mIENBVEVHT1JJRVMpewogICAgICBvYmpbY2F0XSA9IEFycmF5LmZyb20oe2xlbmd0aDoxMH0sIChfLGkpID0+ICh7IGlkOiBgJHtjYXR9X18ke2l9X18ke3V1aWQoKX1gLCB0ZXh0OiAiIiB9KSk7CiAgICB9CiAgICByZXR1cm4gb2JqOwogIH0KCiAgZnVuY3Rpb24gZW5zdXJlQ2F0ZWdvcnlMZW5ndGgoc3QsIGNhdCwgbGVuKXsKICAgIGlmICghQXJyYXkuaXNBcnJheShzdFtjYXRdKSB8fCBzdFtjYXRdLmxlbmd0aCA8IDEpewogICAgICBzdFtjYXRdID0gQXJyYXkuZnJvbSh7bGVuZ3RoOjEwfSwgKF8saSkgPT4gKHsgaWQ6IGAke2NhdH1fXyR7aX1fXyR7dXVpZCgpfWAsIHRleHQ6ICIiIH0pKTsKICAgIH0KICAgIGNvbnN0IGN1ciA9IHN0W2NhdF0ubGVuZ3RoOwoKICAgIGlmIChsZW4gPiBjdXIpewogICAgICBmb3IgKGxldCBpPWN1cjsgaTxsZW47IGkrKyl7CiAgICAgICAgc3RbY2F0XS5wdXNoKHsgaWQ6IGAke2NhdH1fXyR7aX1fXyR7dXVpZCgpfWAsIHRleHQ6ICIiIH0pOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAobGVuIDwgY3VyKXsKICAgICAgY29uc3QgdGFpbEhhc1RleHQgPSBzdFtjYXRdLnNsaWNlKGxlbikuc29tZShyID0+IChyLnRleHQgfHwgIiIpLnRyaW0oKS5sZW5ndGggPiAwKTsKICAgICAgaWYgKCF0YWlsSGFzVGV4dCl7CiAgICAgICAgc3RbY2F0XSA9IHN0W2NhdF0uc2xpY2UoMCwgbGVuKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gbG9hZFN0YXRlKHNsdWcpewogICAgdHJ5ewogICAgICBjb25zdCByYXcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShzdG9yYWdlS2V5KHNsdWcpKTsKICAgICAgaWYgKCFyYXcpIHJldHVybiBtYWtlRGVmYXVsdFN0YXRlKCk7CiAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UocmF3KTsKCiAgICAgIGZvciAoY29uc3QgY2F0IG9mIENBVEVHT1JJRVMpewogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShwYXJzZWQ/LltjYXRdKSB8fCBwYXJzZWRbY2F0XS5sZW5ndGggPCAxKXsKICAgICAgICAgIHBhcnNlZFtjYXRdID0gQXJyYXkuZnJvbSh7bGVuZ3RoOjEwfSwgKF8saSkgPT4gKHsgaWQ6IGAke2NhdH1fXyR7aX1fXyR7dXVpZCgpfWAsIHRleHQ6ICIiIH0pKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBwYXJzZWRbY2F0XSA9IHBhcnNlZFtjYXRdLm1hcCgocixpKSA9PiAoewogICAgICAgICAgaWQ6IFN0cmluZyhyPy5pZCB8fCBgJHtjYXR9X18ke2l9X18ke3V1aWQoKX1gKSwKICAgICAgICAgIHRleHQ6IFN0cmluZyhyPy50ZXh0ID8/ICIiKQogICAgICAgIH0pKTsKICAgICAgfQogICAgICByZXR1cm4gcGFyc2VkOwogICAgfWNhdGNoewogICAgICByZXR1cm4gbWFrZURlZmF1bHRTdGF0ZSgpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gc2F2ZVN0YXRlKCl7CiAgICB0cnl7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHN0b3JhZ2VLZXkoY3VycmVudFBlcnNvbi5zbHVnKSwgSlNPTi5zdHJpbmdpZnkoc3RhdGUpKTsKICAgIH1jYXRjaHt9CiAgfQoKICBmdW5jdGlvbiBoYXNUZXh0Um93KHIpewogICAgcmV0dXJuIChyLnRleHQgfHwgIiIpLnRyaW0oKS5sZW5ndGggPiAwOwogIH0KCiAgZnVuY3Rpb24gZmlsbGVkQ291bnQoY2F0KXsKICAgIHJldHVybiBzdGF0ZVtjYXRdLmZpbHRlcihoYXNUZXh0Um93KS5sZW5ndGg7CiAgfQoKICAvLyDinIUgRHJhZyAmIGRyb3AgKyByYW5raW5nIGFjdGl2YXRlIHdpdGggYXQgbGVhc3QgMiBmaWxsZWQgcm93cwogIGZ1bmN0aW9uIGlzRHJhZ0VuYWJsZWQoY2F0KXsKICAgIHJldHVybiBmaWxsZWRDb3VudChjYXQpID49IDI7CiAgfQoKICBhc3luYyBmdW5jdGlvbiBpbXBvcnRFeGNlbEZvclBlcnNvbihmaWxlLCBwZXJzb24pewogICAgY29uc3QgYnVmID0gYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpOwogICAgY29uc3Qgd2IgPSBYTFNYLnJlYWQoYnVmLCB7IHR5cGU6ICJhcnJheSIgfSk7CiAgICBjb25zdCBzaGVldE5hbWUgPSB3Yi5TaGVldE5hbWVzPy5bMF07CiAgICBpZiAoIXNoZWV0TmFtZSkgdGhyb3cgbmV3IEVycm9yKCJObyBzaGVldHMiKTsKICAgIGNvbnN0IHdzID0gd2IuU2hlZXRzW3NoZWV0TmFtZV07CgogICAgY29uc3Qgcm93cyA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbih3cywgeyBoZWFkZXI6IDEsIHJhdzogZmFsc2UsIGRlZnZhbDogIiIgfSk7CiAgICBpZiAoIXJvd3MgfHwgcm93cy5sZW5ndGggPCAyKSB0aHJvdyBuZXcgRXJyb3IoIkVtcHR5IHNoZWV0Iik7CgogICAgY29uc3QgaGVhZGVyID0gcm93c1swXS5tYXAoeCA9PiBTdHJpbmcoeCA/PyAiIikpOwogICAgY29uc3QgaGVhZGVyTiA9IGhlYWRlci5tYXAobm9ybSk7CgogICAgbGV0IGNhdElkeCA9IGhlYWRlck4uZmluZEluZGV4KGggPT4gaCA9PT0gIs66zrHPhM63zrPOv8+Bzq/OsSIgfHwgaCA9PT0gImNhdGVnb3J5Iik7CiAgICBsZXQgcG9zSWR4ID0gaGVhZGVyTi5maW5kSW5kZXgoaCA9PiBoID09PSAizrjOrc+DzrciIHx8IGggPT09ICLOuM61z4POtyIgfHwgaCA9PT0gInBvc2l0aW9uIiB8fCBoID09PSAicmFuayIpOwogICAgaWYgKGNhdElkeCA8IDApIGNhdElkeCA9IDA7CiAgICBpZiAocG9zSWR4IDwgMCkgcG9zSWR4ID0gMTsKCiAgICBsZXQgcGVyc29uSWR4ID0gLTE7CiAgICBjb25zdCBsYWJlbE4gPSBub3JtKHBlcnNvbi5sYWJlbCk7CiAgICBmb3IgKGxldCBpPTA7aTxoZWFkZXJOLmxlbmd0aDtpKyspewogICAgICBpZiAoaGVhZGVyTltpXSA9PT0gbGFiZWxOKSB7IHBlcnNvbklkeCA9IGk7IGJyZWFrOyB9CiAgICB9CiAgICBpZiAocGVyc29uSWR4IDwgMCl7CiAgICAgIGlmIChoZWFkZXIubGVuZ3RoID09PSAzKSBwZXJzb25JZHggPSAyOwogICAgICBlbHNlIHBlcnNvbklkeCA9IE1hdGgubWF4KHBvc0lkeCArIDEsIDIpOwogICAgfQoKICAgIGNvbnN0IGltcG9ydGVkU3RhdGUgPSBsb2FkU3RhdGUocGVyc29uLnNsdWcpOwoKICAgIGxldCBjdXJyZW50Q2F0UmF3ID0gIiI7CiAgICBmb3IgKGxldCByID0gMTsgciA8IHJvd3MubGVuZ3RoOyByKyspewogICAgICBjb25zdCByb3cgPSByb3dzW3JdOwogICAgICBjb25zdCBjYXRDZWxsID0gcm93W2NhdElkeF07CiAgICAgIGlmIChTdHJpbmcoY2F0Q2VsbCA/PyAiIikudHJpbSgpLmxlbmd0aCA+IDApewogICAgICAgIGN1cnJlbnRDYXRSYXcgPSBTdHJpbmcoY2F0Q2VsbCkudHJpbSgpOwogICAgICB9CiAgICAgIGNvbnN0IG1hcHBlZENhdCA9IG1hcEV4Y2VsQ2F0ZWdvcnkoY3VycmVudENhdFJhdyk7CiAgICAgIGlmICghbWFwcGVkQ2F0KSBjb250aW51ZTsKCiAgICAgIGNvbnN0IHBvcyA9IE51bWJlcihyb3dbcG9zSWR4XSk7CiAgICAgIGlmICghTnVtYmVyLmlzRmluaXRlKHBvcykgfHwgcG9zIDwgMSkgY29udGludWU7CgogICAgICBlbnN1cmVDYXRlZ29yeUxlbmd0aChpbXBvcnRlZFN0YXRlLCBtYXBwZWRDYXQsIE1hdGgubWF4KGltcG9ydGVkU3RhdGVbbWFwcGVkQ2F0XS5sZW5ndGgsIHBvcykpOwoKICAgICAgY29uc3QgdmFsdWUgPSBTdHJpbmcocm93W3BlcnNvbklkeF0gPz8gIiIpLnRyaW0oKTsKICAgICAgaWYgKHZhbHVlLmxlbmd0aCA+IDApewogICAgICAgIGltcG9ydGVkU3RhdGVbbWFwcGVkQ2F0XVtwb3MtMV0udGV4dCA9IHZhbHVlOwogICAgICB9CiAgICB9CgogICAgdHJ5ewogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzdG9yYWdlS2V5KHBlcnNvbi5zbHVnKSwgSlNPTi5zdHJpbmdpZnkoaW1wb3J0ZWRTdGF0ZSkpOwogICAgfWNhdGNoe30KCiAgICBpZiAoY3VycmVudFBlcnNvbj8uc2x1ZyA9PT0gcGVyc29uLnNsdWcpewogICAgICBzdGF0ZSA9IGltcG9ydGVkU3RhdGU7CiAgICAgIHJlbmRlckNhdGVnb3JpZXMoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHNob3dIb21lKCl7CiAgICBjdXJyZW50UGVyc29uID0gbnVsbDsKICAgIHN0YXRlID0gbnVsbDsKICAgIHBlcnNvblZpZXcuY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICBob21lVmlldy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKG51bGwsICIiLCBsb2NhdGlvbi5wYXRobmFtZSArIGxvY2F0aW9uLnNlYXJjaCArICIjLyIpOwogIH0KCiAgZnVuY3Rpb24gc2hvd1BlcnNvbihzbHVnKXsKICAgIGNvbnN0IHAgPSBQRU9QTEUuZmluZCh4ID0+IHguc2x1ZyA9PT0gc2x1Zyk7CiAgICBpZiAoIXApIHJldHVybiBzaG93SG9tZSgpOwogICAgY3VycmVudFBlcnNvbiA9IHA7CiAgICBzdGF0ZSA9IGxvYWRTdGF0ZShzbHVnKTsKICAgIGhvbWVWaWV3LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgcGVyc29uVmlldy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKICAgIHBlcnNvblRpdGxlLnRleHRDb250ZW50ID0gcC5sYWJlbDsKICAgIHJlbmRlckNhdGVnb3JpZXMoKTsKICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKG51bGwsICIiLCBsb2NhdGlvbi5wYXRobmFtZSArIGxvY2F0aW9uLnNlYXJjaCArICIjLyIgKyBzbHVnKTsKICB9CgogIGZ1bmN0aW9uIHJlbmRlckhvbWVCdXR0b25zKCl7CiAgICBwZW9wbGVHcmlkLmlubmVySFRNTCA9ICIiOwoKICAgIGZvciAoY29uc3QgcCBvZiBQRU9QTEUpewogICAgICBjb25zdCB0aWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIHRpbGUuY2xhc3NOYW1lID0gInBlcnNvbi10aWxlIjsKCiAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgICBidG4uY2xhc3NOYW1lID0gInBlcnNvbi1idG4iOwogICAgICBidG4udHlwZSA9ICJidXR0b24iOwogICAgICBidG4uaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InBlcnNvbi10aXRsZSI+JHtlc2NhcGVIdG1sKHAubGFiZWwpfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InBlcnNvbi1zdWIiPs6Gzr3Ov865zrPOvM6xIM+DzrXOu86vzrTOsc+CPC9kaXY+CiAgICAgIGA7CiAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICBjb25zdCBQSU5TID0gewogICAgICAgICAgInRlcmktdmktc2VudGlvIjogIjE0NzgiLAogICAgICAgICAgIm1vbmhpYSI6ICI5NjMyIiwKICAgICAgICAgICJsaXNqYW5zaSI6ICIyMzY1IgogICAgICAgIH07CiAgICAgICAgY29uc3QgZXhwZWN0ZWQgPSBQSU5TW3Auc2x1Z107CiAgICAgICAgaWYgKGV4cGVjdGVkKXsKICAgICAgICAgIGNvbnN0IHBpbiA9IHByb21wdCgizpXOuc+DzqzOs861z4TOtSBQSU4gzrPOuc6xIM+Az4HPjM+DzrLOsc+Dzrc6Iik7CiAgICAgICAgICBpZiAocGluICE9PSBleHBlY3RlZCl7CiAgICAgICAgICAgIGFsZXJ0KCLOm86szrjOv8+CIFBJTi4gzpTOtc69IM61z4DOuc+Ez4HOrc+AzrXPhM6xzrkgzrcgz4DPgc+Mz4POss6xz4POty4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzaG93UGVyc29uKHAuc2x1Zyk7CiAgICAgIH0pO2NvbnN0IHN5bmMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgc3luYy5jbGFzc05hbWUgPSAic3luYy1taW5pIjsKICAgICAgc3luYy50eXBlID0gImJ1dHRvbiI7CiAgICAgIHN5bmMudGl0bGUgPSAizqPPhc6zz4fPgc6/zr3Ouc+DzrzPjM+CIM6xz4DPjCBFeGNlbCAoLnhsc3gpIjsKICAgICAgc3luYy50ZXh0Q29udGVudCA9ICLin7MgRXhjZWwiOwogICAgICBzeW5jLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKGUpID0+IHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBzdGFydEV4Y2VsSW1wb3J0Rm9yKHApOwogICAgICB9KTsKCiAgICAgIHRpbGUuYXBwZW5kQ2hpbGQoYnRuKTsKICAgICAgdGlsZS5hcHBlbmRDaGlsZChzeW5jKTsKICAgICAgcGVvcGxlR3JpZC5hcHBlbmRDaGlsZCh0aWxlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlbmRlckNhdGVnb3JpZXMoKXsKICAgIGNhdGVnb3JpZXNFbC5pbm5lckhUTUwgPSAiIjsKCiAgICBmb3IgKGNvbnN0IGNhdCBvZiBDQVRFR09SSUVTKXsKICAgICAgY29uc3QgY291bnQgPSBmaWxsZWRDb3VudChjYXQpOwogICAgICBjb25zdCBkcmFnT24gPSBpc0RyYWdFbmFibGVkKGNhdCk7CgogICAgICBzdGF0ZVtjYXRdID0gWy4uLnN0YXRlW2NhdF0uZmlsdGVyKGhhc1RleHRSb3cpLCAuLi5zdGF0ZVtjYXRdLmZpbHRlcihyID0+ICFoYXNUZXh0Um93KHIpKV07CgogICAgICBjb25zdCBjYXRDYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGNhdENhcmQuY2xhc3NOYW1lID0gImNhdCI7CiAgICAgIGNhdENhcmQuZGF0YXNldC5jYXQgPSBjYXQ7CgogICAgICBjb25zdCBoZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGhlYWQuY2xhc3NOYW1lID0gImNhdC1oZWFkIjsKICAgICAgaGVhZC5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdj4KICAgICAgICAgIDxoMj4ke2VzY2FwZUh0bWwoY2F0KX08L2gyPgogICAgICAgICAgPGRpdiBjbGFzcz0ic3RhdHVzICR7ZHJhZ09uID8gIm9uIiA6ICIifSI+CiAgICAgICAgICAgICR7ZHJhZ09uID8gYERyYWcgJiBkcm9wOiBPTiAoJHtjb3VudH0gz4TOr8+EzrvOv865KWAgOiBgRHJhZyAmIGRyb3A6IE9GRiAozrLOrM67zrUgz4TOv8+FzrvOrM+HzrnPg8+Ezr/OvSAyIM+Ezq/PhM67zr/Phc+CIOKAlCDPhM+Oz4HOsSDOrc+HzrXOuSAke2NvdW50fSlgfQogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIGA7CgogICAgICBjb25zdCBjbGVhckJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgICBjbGVhckJ0bi5jbGFzc05hbWUgPSAibWluaSI7CiAgICAgIGNsZWFyQnRuLnR5cGUgPSAiYnV0dG9uIjsKICAgICAgY2xlYXJCdG4udGV4dENvbnRlbnQgPSAiQ2xlYXIiOwogICAgICBjbGVhckJ0bi50aXRsZSA9ICLOms6xzrjOrM+BzrnPg868zrEgzrzPjM69zr8gzrHPhc+Ezq7PgiDPhM63z4IgzrrOsc+EzrfOs86/z4HOr86xz4IiOwogICAgICBjbGVhckJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICBzdGF0ZVtjYXRdID0gc3RhdGVbY2F0XS5tYXAociA9PiAoey4uLnIsIHRleHQ6IiJ9KSk7CiAgICAgICAgc2F2ZVN0YXRlKCk7CiAgICAgICAgcmVuZGVyQ2F0ZWdvcmllcygpOwogICAgICB9KTsKICAgICAgaGVhZC5hcHBlbmRDaGlsZChjbGVhckJ0bik7CgogICAgICBjb25zdCBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGxpc3QuY2xhc3NOYW1lID0gImxpc3QiOwogICAgICBsaXN0LmRhdGFzZXQuY2F0ID0gY2F0OwoKICAgICAgc3RhdGVbY2F0XS5mb3JFYWNoKChyb3csIGlkeCkgPT4gewogICAgICAgIGNvbnN0IHJvd0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgY29uc3Qgcm93RmlsbGVkID0gaGFzVGV4dFJvdyhyb3cpOwogICAgICAgIHJvd0VsLmNsYXNzTmFtZSA9ICJyb3ciICsgKGRyYWdPbiA/ICIgZHJhZy1lbmFibGVkIiA6ICIiKTsKICAgICAgICByb3dFbC5kYXRhc2V0LmlkID0gcm93LmlkOwogICAgICAgIHJvd0VsLmRyYWdnYWJsZSA9IGRyYWdPbiAmJiByb3dGaWxsZWQ7CgogICAgICAgIGNvbnN0IGhhbmRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIGhhbmRsZS5jbGFzc05hbWUgPSAiaGFuZGxlIiArIChkcmFnT24gJiYgcm93RmlsbGVkID8gIiIgOiAiIG9mZiIpOwogICAgICAgIGhhbmRsZS50ZXh0Q29udGVudCA9ICLimLAiOwogICAgICAgIGhhbmRsZS50aXRsZSA9IChkcmFnT24gJiYgcm93RmlsbGVkKQogICAgICAgICAgPyAiRHJhZyIKICAgICAgICAgIDogIs6nz4HOtc65zqzOts6/zr3PhM6xzrkgz4TOv8+FzrvOrM+HzrnPg8+Ezr/OvSAyIM+Dz4XOvM+AzrvOt8+Bz4nOvM6tzr3Ov865IM+Ezq/PhM67zr/OuSAozrrOsc65IM+Ezr8gz4PPhc6zzrrOtc66z4HOuc68zq3Ovc6/IM+AzrXOtM6vzr8gzr3OsSDOtc6vzr3Osc65IM+Dz4XOvM+AzrvOt8+Bz4nOvM6tzr3OvykiOwoKICAgICAgICBjb25zdCBudW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBudW0uY2xhc3NOYW1lID0gIm51bSI7CiAgICAgICAgbnVtLnRleHRDb250ZW50ID0gU3RyaW5nKGlkeCArIDEpOwoKICAgICAgICBjb25zdCBzY29yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIHNjb3JlLmNsYXNzTmFtZSA9ICJzY29yZSI7CiAgICAgICAgY29uc3QgYmFkZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBiYWRnZS5jbGFzc05hbWUgPSAiYmFkZ2UiOwogICAgICAgIGJhZGdlLnRleHRDb250ZW50ID0gcm93RmlsbGVkID8gU3RyaW5nKChTQ09SRVNbaWR4XSA/PyAwKSkgOiAiIjsKICAgICAgICBzY29yZS5hcHBlbmRDaGlsZChiYWRnZSk7CgogICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKICAgICAgICBpbnB1dC5jbGFzc05hbWUgPSAidGV4dCI7CiAgICAgICAgaW5wdXQudHlwZSA9ICJ0ZXh0IjsKICAgICAgICBpbnB1dC5wbGFjZWhvbGRlciA9ICLOk8+BzqzPiM61IM61zrTPji4uLiI7CiAgICAgICAgaW5wdXQudmFsdWUgPSByb3cudGV4dCB8fCAiIjsKICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIChlKSA9PiB7CiAgICAgICAgICByb3cudGV4dCA9IGUudGFyZ2V0LnZhbHVlOwogICAgICAgICAgc2F2ZVN0YXRlKCk7CiAgICAgICAgICByZW5kZXJDYXRlZ29yaWVzKCk7CiAgICAgICAgfSk7CgogICAgICAgIHJvd0VsLmFkZEV2ZW50TGlzdGVuZXIoImRyYWdzdGFydCIsIChlKSA9PiB7CiAgICAgICAgICBpZiAoIWlzRHJhZ0VuYWJsZWQoY2F0KSB8fCAhaGFzVGV4dFJvdyhyb3cpKSB7IGUucHJldmVudERlZmF1bHQoKTsgcmV0dXJuOyB9CiAgICAgICAgICBkcmFnQ3R4LmNhdCA9IGNhdDsKICAgICAgICAgIGRyYWdDdHguZHJhZ2dpbmdJZCA9IHJvdy5pZDsKICAgICAgICAgIHJvd0VsLmNsYXNzTGlzdC5hZGQoImRyYWdnaW5nIik7CiAgICAgICAgICBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gIm1vdmUiOwogICAgICAgICAgZS5kYXRhVHJhbnNmZXIuc2V0RGF0YSgidGV4dC9wbGFpbiIsIHJvdy5pZCk7CiAgICAgICAgfSk7CgogICAgICAgIHJvd0VsLmFkZEV2ZW50TGlzdGVuZXIoImRyYWdlbmQiLCAoKSA9PiB7CiAgICAgICAgICByb3dFbC5jbGFzc0xpc3QucmVtb3ZlKCJkcmFnZ2luZyIpOwogICAgICAgICAgZHJhZ0N0eC5jYXQgPSBudWxsOwogICAgICAgICAgZHJhZ0N0eC5kcmFnZ2luZ0lkID0gbnVsbDsKICAgICAgICB9KTsKCiAgICAgICAgcm93RWwuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ292ZXIiLCAoZSkgPT4gewogICAgICAgICAgaWYgKCFpc0RyYWdFbmFibGVkKGNhdCkpIHJldHVybjsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGUuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSAibW92ZSI7CiAgICAgICAgfSk7CgogICAgICAgIHJvd0VsLmFkZEV2ZW50TGlzdGVuZXIoImRyb3AiLCAoZSkgPT4gewogICAgICAgICAgaWYgKCFpc0RyYWdFbmFibGVkKGNhdCkpIHJldHVybjsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICBjb25zdCBmcm9tSWQgPSBlLmRhdGFUcmFuc2Zlci5nZXREYXRhKCJ0ZXh0L3BsYWluIik7CiAgICAgICAgICBjb25zdCB0b0lkID0gcm93LmlkOwogICAgICAgICAgaWYgKCFmcm9tSWQgfHwgZnJvbUlkID09PSB0b0lkKSByZXR1cm47CiAgICAgICAgICBpZiAoZHJhZ0N0eC5jYXQgIT09IGNhdCkgcmV0dXJuOwoKICAgICAgICAgIGNvbnN0IHRvUm93ID0gc3RhdGVbY2F0XS5maW5kKHggPT4geC5pZCA9PT0gdG9JZCk7CiAgICAgICAgICBpZiAoIXRvUm93IHx8ICFoYXNUZXh0Um93KHRvUm93KSkgcmV0dXJuOwoKICAgICAgICAgIGNvbnN0IGFyciA9IHN0YXRlW2NhdF07CiAgICAgICAgICBjb25zdCBmcm9tSWR4ID0gYXJyLmZpbmRJbmRleCh4ID0+IHguaWQgPT09IGZyb21JZCk7CiAgICAgICAgICBjb25zdCB0b0lkeCA9IGFyci5maW5kSW5kZXgoeCA9PiB4LmlkID09PSB0b0lkKTsKICAgICAgICAgIGlmIChmcm9tSWR4IDwgMCB8fCB0b0lkeCA8IDApIHJldHVybjsKCiAgICAgICAgICBjb25zdCBbaXRlbV0gPSBhcnIuc3BsaWNlKGZyb21JZHgsIDEpOwogICAgICAgICAgYXJyLnNwbGljZSh0b0lkeCwgMCwgaXRlbSk7CgogICAgICAgICAgc2F2ZVN0YXRlKCk7CiAgICAgICAgICByZW5kZXJDYXRlZ29yaWVzKCk7CiAgICAgICAgfSk7CgogICAgICAgIHJvd0VsLmFwcGVuZENoaWxkKGhhbmRsZSk7CiAgICAgICAgcm93RWwuYXBwZW5kQ2hpbGQobnVtKTsKICAgICAgICByb3dFbC5hcHBlbmRDaGlsZChpbnB1dCk7CiAgICAgICAgcm93RWwuYXBwZW5kQ2hpbGQoc2NvcmUpOwogICAgICAgIGxpc3QuYXBwZW5kQ2hpbGQocm93RWwpOwogICAgICB9KTsKCiAgICAgIGNhdENhcmQuYXBwZW5kQ2hpbGQoaGVhZCk7CiAgICAgIGNhdENhcmQuYXBwZW5kQ2hpbGQobGlzdCk7CiAgICAgIGNhdGVnb3JpZXNFbC5hcHBlbmRDaGlsZChjYXRDYXJkKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGVzY2FwZUh0bWwoc3RyKXsKICAgIHJldHVybiBTdHJpbmcoc3RyKQogICAgICAucmVwbGFjZUFsbCgiJiIsIiZhbXA7IikKICAgICAgLnJlcGxhY2VBbGwoIjwiLCImbHQ7IikKICAgICAgLnJlcGxhY2VBbGwoIj4iLCImZ3Q7IikKICAgICAgLnJlcGxhY2VBbGwoJyInLCImcXVvdDsiKQogICAgICAucmVwbGFjZUFsbCgiJyIsIiYjMDM5OyIpOwogIH0KCiAgYmFja0J0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHNob3dIb21lKTsKCiAgcmVzZXRBbGxCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICBpZiAoIWN1cnJlbnRQZXJzb24pIHJldHVybjsKICAgIHN0YXRlID0gbWFrZURlZmF1bHRTdGF0ZSgpOwogICAgc2F2ZVN0YXRlKCk7CiAgICByZW5kZXJDYXRlZ29yaWVzKCk7CiAgfSk7CgogIGZ1bmN0aW9uIHJvdXRlKCl7CiAgICBjb25zdCBoID0gbG9jYXRpb24uaGFzaCB8fCAiIy8iOwogICAgY29uc3QgcGFydHMgPSBoLnJlcGxhY2UoL14jXC8/LywgIiIpLnNwbGl0KCIvIikuZmlsdGVyKEJvb2xlYW4pOwogICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMCkgc2hvd0hvbWUoKTsKICAgIGVsc2Ugc2hvd1BlcnNvbihwYXJ0c1swXSk7CiAgfQoKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiaGFzaGNoYW5nZSIsIHJvdXRlKTsKCiAgcmVuZGVySG9tZUJ1dHRvbnMoKTsKICByb3V0ZSgpOwoKICAvLyA9PT09PSBKYW1lcyBSaWdhczogU3RhdGlzdGljcyAmIEV4Y2VsIEV4cG9ydCA9PT09PQogIGNvbnN0IHN0YXRzQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN0YXRzQnRuIik7CgogIGZ1bmN0aW9uIGNvbGxlY3RTdGF0aXN0aWNzKCl7CiAgICBjb25zdCByZXN1bHRzID0gW107CiAgICBmb3IgKGNvbnN0IHAgb2YgUEVPUExFKXsKICAgICAgY29uc3Qgc3QgPSBsb2FkU3RhdGUocC5zbHVnKTsKICAgICAgZm9yIChjb25zdCBjYXQgb2YgQ0FURUdPUklFUyl7CiAgICAgICAgY29uc3Qgcm93cyA9IHN0W2NhdF0gfHwgW107CiAgICAgICAgcm93cy5mb3JFYWNoKChyLCBpZHgpID0+IHsKICAgICAgICAgIGlmICgoci50ZXh0IHx8ICIiKS50cmltKCkubGVuZ3RoID4gMCl7CiAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7CiAgICAgICAgICAgICAgcGVyc29uOiBwLmxhYmVsLAogICAgICAgICAgICAgIGNhdGVnb3J5OiBjYXQsCiAgICAgICAgICAgICAgcmFuazogaWR4ICsgMSwKICAgICAgICAgICAgICBzY29yZTogU0NPUkVTW2lkeF0gPz8gMCwKICAgICAgICAgICAgICB2YWx1ZTogci50ZXh0CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9CgogIGZ1bmN0aW9uIGV4cG9ydFN0YXRzVG9FeGNlbCgpewogICAgY29uc3QgcGluID0gcHJvbXB0KCLOlc65z4POrM6zzrXPhM61IM+Ezr/OvSDOus+JzrTOuc66z4wgzrPOuc6xIM61zr7Osc6zz4nOs86uIEV4Y2VsOiIpOwogICAgaWYgKHBpbiAhPT0gIjc0NTYiKXsKICAgICAgYWxlcnQoIs6bzqzOuM6/z4IgzrrPic60zrnOus+Mz4IuIM6XIM61zr7Osc6zz4nOs86uIM6xzrrPhc+Bz47OuM63zrrOtS4iKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IGRhdGEgPSBjb2xsZWN0U3RhdGlzdGljcygpOwogICAgaWYgKCFkYXRhLmxlbmd0aCl7CiAgICAgIGFsZXJ0KCLOlM61zr0gz4XPgM6sz4HPh86/z4XOvSDOtM61zrTOv868zq3Ovc6xIM6zzrnOsSDOtc6+zrHOs8+JzrPOri4iKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHdzRGF0YSA9IFsKICAgICAgWyJQZXJzb24iLCAiQ2F0ZWdvcnkiLCAiUmFuayIsICJTY29yZSIsICJBbnN3ZXIiXQogICAgXTsKICAgIGRhdGEuZm9yRWFjaChkID0+IHsKICAgICAgd3NEYXRhLnB1c2goW2QucGVyc29uLCBkLmNhdGVnb3J5LCBkLnJhbmssIGQuc2NvcmUsIGQudmFsdWVdKTsKICAgIH0pOwoKICAgIGNvbnN0IHdzID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQod3NEYXRhKTsKICAgIGNvbnN0IHdiID0gWExTWC51dGlscy5ib29rX25ldygpOwogICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yiwgd3MsICJTdGF0aXN0aWNzIik7CgogICAgWExTWC53cml0ZUZpbGUod2IsICJKYW1lc19SaWdhc19TdGF0aXN0aWNzLnhsc3giKTsKICB9CgogIGlmIChzdGF0c0J0bil7CiAgICBzdGF0c0J0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGV4cG9ydFN0YXRzVG9FeGNlbCk7CiAgfQoKCiAgLy8gRXhwb3NlIGludGVybmFscyBmb3IgY29tcGF0aWJpbGl0eSAoZmlsZTovLyAvIGlmcmFtZSB3cmFwcGVycykKICB0cnl7CiAgICB3aW5kb3cuUEVPUExFID0gUEVPUExFOwogICAgd2luZG93LkNBVEVHT1JJRVMgPSBDQVRFR09SSUVTOwogICAgd2luZG93LmxvYWRTdGF0ZSA9IGxvYWRTdGF0ZTsKICAgIHdpbmRvdy5zYXZlU3RhdGUgPSBzYXZlU3RhdGU7CiAgfWNhdGNoKGUpe30KfSkoKTsKPC9zY3JpcHQ+Cgo8c2NyaXB0PgovLyA9PT09PSBKYW1lcyBSaWdhczogUGVyLXBlcnNvbiBQSU4gRXhwb3J0ID09PT09CmNvbnN0IFBFUlNPTl9QSU5TID0gewogICJ0ZXJpLXZpLXNlbnRpbyI6ICIxNDc4IiwKICAibW9uaGlhIjogIjk2MzIiLAogICJsaXNqYW5zaSI6ICIyMzY1Igp9OwoKZnVuY3Rpb24gZXhwb3J0U3RhdHNUb0V4Y2VsKCl7CiAgY29uc3QgcGVyc29uU2x1ZyA9IHByb21wdCgKICAgICLOoM67zrfOus+Ez4HOv867z4zOs863z4POtSDOrM+Ezr/OvM6/IM6zzrnOsSBleHBvcnQ6XG4iICsKICAgICJ0ZXJpLXZpLXNlbnRpb1xubW9uaGlhXG5saXNqYW5zaSIKICApOwoKICBpZiAoIXBlcnNvblNsdWcgfHwgIVBFUlNPTl9QSU5TW3BlcnNvblNsdWddKXsKICAgIGFsZXJ0KCLOnM63IM6tzrPOus+Fz4HOvyDOrM+Ezr/OvM6/LiDOlyDOtc6+zrHOs8+JzrPOriDOsc66z4XPgc+OzrjOt866zrUuIik7CiAgICByZXR1cm47CiAgfQoKICBjb25zdCBwaW4gPSBwcm9tcHQoIs6VzrnPg86szrPOtc+EzrUgUElOOiIpOwogIGlmIChwaW4gIT09IFBFUlNPTl9QSU5TW3BlcnNvblNsdWddKXsKICAgIGFsZXJ0KCLOm86szrjOv8+CIFBJTi4gzpcgzrXOvs6xzrPPic6zzq4gzrHOus+Fz4HPjs64zrfOus61LiIpOwogICAgcmV0dXJuOwogIH0KCiAgY29uc3Qgc3QgPSBsb2FkU3RhdGUocGVyc29uU2x1Zyk7CiAgY29uc3QgcGVyc29uID0gUEVPUExFLmZpbmQocCA9PiBwLnNsdWcgPT09IHBlcnNvblNsdWcpOwoKICBjb25zdCByb3dzT3V0ID0gW107CiAgZm9yIChjb25zdCBjYXQgb2YgQ0FURUdPUklFUyl7CiAgICBjb25zdCByb3dzID0gc3RbY2F0XSB8fCBbXTsKICAgIHJvd3MuZm9yRWFjaCgociwgaWR4KSA9PiB7CiAgICAgIGlmICgoci50ZXh0IHx8ICIiKS50cmltKCkubGVuZ3RoID4gMCl7CiAgICAgICAgcm93c091dC5wdXNoKFsKICAgICAgICAgIHBlcnNvbi5sYWJlbCwKICAgICAgICAgIGNhdCwKICAgICAgICAgIGlkeCArIDEsCiAgICAgICAgICBTQ09SRVNbaWR4XSA/PyAwLAogICAgICAgICAgci50ZXh0CiAgICAgICAgXSk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgaWYgKCFyb3dzT3V0Lmxlbmd0aCl7CiAgICBhbGVydCgizpTOtc69IM+Fz4DOrM+Bz4fOv8+Fzr0gzrTOtc60zr/OvM6tzr3OsSDOs865zrEgzrXOvs6xzrPPic6zzq4uIik7CiAgICByZXR1cm47CiAgfQoKICBjb25zdCB3c0RhdGEgPSBbCiAgICBbIlBlcnNvbiIsICJDYXRlZ29yeSIsICJSYW5rIiwgIlNjb3JlIiwgIkFuc3dlciJdLAogICAgLi4ucm93c091dAogIF07CgogIGNvbnN0IHdzID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQod3NEYXRhKTsKICBjb25zdCB3YiA9IFhMU1gudXRpbHMuYm9va19uZXcoKTsKICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCB3cywgcGVyc29uLmxhYmVsKTsKCiAgWExTWC53cml0ZUZpbGUoCiAgICB3YiwKICAgIHBlcnNvbi5sYWJlbC5yZXBsYWNlKC9ccysvZywgIl8iKSArICJfU3RhdGlzdGljcy54bHN4IgogICk7Cn0KCi8vIHJlYmluZCBidXR0b24KY29uc3Qgc3RhdHNCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3RhdHNCdG4iKTsKaWYgKHN0YXRzQnRuKXsKICBzdGF0c0J0bi5vbmNsaWNrID0gZXhwb3J0U3RhdHNUb0V4Y2VsOwp9Cjwvc2NyaXB0PgoKPHNjcmlwdD4KKGZ1bmN0aW9uKCl7CiAgY29uc3QgUElOX09LID0gIjA4MjUiOwoKICBmdW5jdGlvbiBwb2ludHMocmFuayl7CiAgICByYW5rID0gTnVtYmVyKHJhbmspOwogICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUocmFuaykpIHJldHVybiAiIjsKICAgIGlmIChyYW5rID09PSAxKSByZXR1cm4gMTI7CiAgICBpZiAocmFuayA9PT0gMikgcmV0dXJuIDEwOwogICAgcmV0dXJuIE1hdGgubWF4KDEsIDExIC0gcmFuayk7CiAgfQoKICBmdW5jdGlvbiBleHBvcnRBbGxUb0V4Y2VsKCl7CiAgICBjb25zdCBwaW4gPSBwcm9tcHQoIs6VzrnPg86szrPOtc+EzrUgUElOOiIpOwogICAgaWYgKHBpbiAhPT0gUElOX09LKXsKICAgICAgYWxlcnQoIs6bzqzOuM6/z4IgUElOIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyAxKSBHYXRoZXIgcmF3IGFuc3dlcnMgZnJvbSBBTEwgcGVvcGxlICjPjM67zr/OuSDOv865IM61z4HPic+EzrfOvM6tzr3Ov865KQogICAgY29uc3QgcmF3ID0gW107IC8vIHtwZXJzb24sIGNhdGVnb3J5LCByYW5rLCBzY29yZSwgYW5zd2VyfQogICAgY29uc3QgcGVvcGxlTGlzdCA9ICh3aW5kb3cuUEVPUExFIHx8IFsKICAgICAgeyBsYWJlbDogIlRlcmkgVmkgU2VudGlvIiwgc2x1ZzogInRlcmktdmktc2VudGlvIiB9LAogICAgICB7IGxhYmVsOiAiTW9uaGlhIiwgc2x1ZzogIm1vbmhpYSIgfSwKICAgICAgeyBsYWJlbDogIkxpc2phbnNpIiwgc2x1ZzogImxpc2phbnNpIiB9CiAgICBdKTsKCiAgICBmb3IgKGNvbnN0IHBlcnNvbiBvZiBwZW9wbGVMaXN0KXsKICAgICAgY29uc3Qgc3QgPSBsb2FkU3RhdGUocGVyc29uLnNsdWcpOwogICAgICBpZiAoIXN0KSBjb250aW51ZTsKICAgICAgZm9yIChjb25zdCBjYXQgb2YgQ0FURUdPUklFUyl7CiAgICAgICAgY29uc3QgYXJyID0gc3QgJiYgc3RbY2F0XSA/IHN0W2NhdF0gOiBbXTsKICAgICAgICBmb3IgKGxldCBpPTA7aTxhcnIubGVuZ3RoO2krKyl7CiAgICAgICAgICBjb25zdCBhbnMgPSBTdHJpbmcoYXJyW2ldICYmIGFycltpXS50ZXh0ID8gYXJyW2ldLnRleHQgOiAiIikudHJpbSgpOwogICAgICAgICAgaWYgKCFhbnMpIGNvbnRpbnVlOwogICAgICAgICAgY29uc3QgcmFuayA9IGkrMTsKICAgICAgICAgIHJhdy5wdXNoKHsKICAgICAgICAgICAgcGVyc29uOiBwZXJzb24ubGFiZWwgfHwgcGVyc29uLm5hbWUgfHwgcGVyc29uLnNsdWcsCiAgICAgICAgICAgIGNhdGVnb3J5OiBjYXQsCiAgICAgICAgICAgIHJhbmssCiAgICAgICAgICAgIHNjb3JlOiBwb2ludHMocmFuayksCiAgICAgICAgICAgIGFuc3dlcjogYW5zCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAoIXJhdy5sZW5ndGgpewogICAgICBhbGVydCgizpTOtc69IM6yz4HOrc64zrfOus6xzr0gzrHPgM6xzr3PhM6uz4POtc65z4IgzrPOuc6xIGV4cG9ydC4iKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIDIpIEFnZ3JlZ2F0ZSBzdGF0aXN0aWNzICjPg8+FzrPOus61zr3PhM+Bz4nPhM65zrrOrCkKICAgIC8vIEtleTogY2F0ZWdvcnl8YW5zd2VyCiAgICBjb25zdCBieUFuc3dlciA9IG5ldyBNYXAoKTsKICAgIC8vIEtleTogY2F0ZWdvcnl8cmFua3xhbnN3ZXIKICAgIGNvbnN0IGJ5UmFuayA9IG5ldyBNYXAoKTsKICAgIC8vIEtleTogY2F0ZWdvcnkgLT4gdG90YWwgYW5zd2VycwogICAgY29uc3QgYnlDYXRlZ29yeSA9IG5ldyBNYXAoKTsKCiAgICBmb3IgKGNvbnN0IHIgb2YgcmF3KXsKICAgICAgLy8gYnkgY2F0ZWdvcnkKICAgICAgYnlDYXRlZ29yeS5zZXQoci5jYXRlZ29yeSwgKGJ5Q2F0ZWdvcnkuZ2V0KHIuY2F0ZWdvcnkpIHx8IDApICsgMSk7CgogICAgICAvLyBieSBhbnN3ZXIKICAgICAgY29uc3QgazEgPSByLmNhdGVnb3J5ICsgInx8IiArIHIuYW5zd2VyLnRvTG93ZXJDYXNlKCk7CiAgICAgIGNvbnN0IGN1cjEgPSBieUFuc3dlci5nZXQoazEpIHx8IHsgY2F0ZWdvcnk6IHIuY2F0ZWdvcnksIGFuc3dlcjogci5hbnN3ZXIsIGNvdW50OjAsIHRvdGFsU2NvcmU6MCB9OwogICAgICBjdXIxLmNvdW50ICs9IDE7CiAgICAgIGN1cjEudG90YWxTY29yZSArPSAoTnVtYmVyKHIuc2NvcmUpIHx8IDApOwogICAgICBieUFuc3dlci5zZXQoazEsIGN1cjEpOwoKICAgICAgLy8gYnkgcmFuawogICAgICBjb25zdCBrMiA9IHIuY2F0ZWdvcnkgKyAifHwiICsgci5yYW5rICsgInx8IiArIHIuYW5zd2VyLnRvTG93ZXJDYXNlKCk7CiAgICAgIGNvbnN0IGN1cjIgPSBieVJhbmsuZ2V0KGsyKSB8fCB7IGNhdGVnb3J5OiByLmNhdGVnb3J5LCByYW5rOiByLnJhbmssIGFuc3dlcjogci5hbnN3ZXIsIGNvdW50OjAsIHRvdGFsU2NvcmU6MCB9OwogICAgICBjdXIyLmNvdW50ICs9IDE7CiAgICAgIGN1cjIudG90YWxTY29yZSArPSAoTnVtYmVyKHIuc2NvcmUpIHx8IDApOwogICAgICBieVJhbmsuc2V0KGsyLCBjdXIyKTsKICAgIH0KCiAgICBjb25zdCBzdGF0c1Jvd3MgPSBBcnJheS5mcm9tKGJ5QW5zd2VyLnZhbHVlcygpKQogICAgICAubWFwKHggPT4gKHsuLi54LCBhdmdTY29yZTogeC5jb3VudCA/ICh4LnRvdGFsU2NvcmUgLyB4LmNvdW50KSA6IDB9KSkKICAgICAgLnNvcnQoKGEsYikgPT4gKGIudG90YWxTY29yZSAtIGEudG90YWxTY29yZSkgfHwgKGIuY291bnQgLSBhLmNvdW50KSB8fCBhLmNhdGVnb3J5LmxvY2FsZUNvbXBhcmUoYi5jYXRlZ29yeSkgfHwgYS5hbnN3ZXIubG9jYWxlQ29tcGFyZShiLmFuc3dlcikpOwoKICAgIGNvbnN0IHJhbmtSb3dzID0gQXJyYXkuZnJvbShieVJhbmsudmFsdWVzKCkpCiAgICAgIC5tYXAoeCA9PiAoey4uLngsIGF2Z1Njb3JlOiB4LmNvdW50ID8gKHgudG90YWxTY29yZSAvIHguY291bnQpIDogMH0pKQogICAgICAuc29ydCgoYSxiKSA9PiBhLmNhdGVnb3J5LmxvY2FsZUNvbXBhcmUoYi5jYXRlZ29yeSkgfHwgKGEucmFuayAtIGIucmFuaykgfHwgKGIudG90YWxTY29yZSAtIGEudG90YWxTY29yZSkgfHwgKGIuY291bnQgLSBhLmNvdW50KSk7CgogICAgY29uc3QgY2F0Um93cyA9IEFycmF5LmZyb20oYnlDYXRlZ29yeS5lbnRyaWVzKCkpCiAgICAgIC5tYXAoKFtjYXRlZ29yeSwgdG90YWxBbnN3ZXJzXSkgPT4gKHsgY2F0ZWdvcnksIHRvdGFsQW5zd2VycyB9KSkKICAgICAgLnNvcnQoKGEsYikgPT4gYi50b3RhbEFuc3dlcnMgLSBhLnRvdGFsQW5zd2Vycyk7CgogICAgLy8gMykgQnVpbGQgd29ya2Jvb2sKICAgIGNvbnN0IHdiID0gWExTWC51dGlscy5ib29rX25ldygpOwoKICAgIC8vIFNoZWV0OiBSQVcKICAgIGNvbnN0IHJhd0FvYSA9IFtbIlBlcnNvbiIsIkNhdGVnb3J5IiwiUmFuayIsIlNjb3JlIiwiQW5zd2VyIl1dOwogICAgcmF3LmZvckVhY2gociA9PiByYXdBb2EucHVzaChbci5wZXJzb24sIHIuY2F0ZWdvcnksIHIucmFuaywgci5zY29yZSwgci5hbnN3ZXJdKSk7CiAgICBjb25zdCB3c1JhdyA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KHJhd0FvYSk7CiAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCB3c1JhdywgIlJBVyIpOwoKICAgIC8vIFNoZWV0OiBTVEFUUyAoYnkgQW5zd2VyKQogICAgY29uc3Qgc3RhdHNBb2EgPSBbWyJDYXRlZ29yeSIsIkFuc3dlciIsIkNvdW50IiwiVG90YWwgU2NvcmUiLCJBdmcgU2NvcmUiXV07CiAgICBzdGF0c1Jvd3MuZm9yRWFjaChzID0+IHN0YXRzQW9hLnB1c2goW3MuY2F0ZWdvcnksIHMuYW5zd2VyLCBzLmNvdW50LCBzLnRvdGFsU2NvcmUsIE1hdGgucm91bmQocy5hdmdTY29yZSoxMDApLzEwMF0pKTsKICAgIGNvbnN0IHdzU3RhdHMgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChzdGF0c0FvYSk7CiAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCB3c1N0YXRzLCAiU1RBVFMiKTsKCiAgICAvLyBTaGVldDogQllfUkFOSwogICAgY29uc3QgcmFua0FvYSA9IFtbIkNhdGVnb3J5IiwiUmFuayIsIkFuc3dlciIsIkNvdW50IiwiVG90YWwgU2NvcmUiLCJBdmcgU2NvcmUiXV07CiAgICByYW5rUm93cy5mb3JFYWNoKHMgPT4gcmFua0FvYS5wdXNoKFtzLmNhdGVnb3J5LCBzLnJhbmssIHMuYW5zd2VyLCBzLmNvdW50LCBzLnRvdGFsU2NvcmUsIE1hdGgucm91bmQocy5hdmdTY29yZSoxMDApLzEwMF0pKTsKICAgIGNvbnN0IHdzUmFuayA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KHJhbmtBb2EpOwogICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yiwgd3NSYW5rLCAiQllfUkFOSyIpOwoKICAgIC8vIFNoZWV0OiBDQVRFR09SSUVTCiAgICBjb25zdCBjYXRBb2EgPSBbWyJDYXRlZ29yeSIsIlRvdGFsIEFuc3dlcnMiXV07CiAgICBjYXRSb3dzLmZvckVhY2goYyA9PiBjYXRBb2EucHVzaChbYy5jYXRlZ29yeSwgYy50b3RhbEFuc3dlcnNdKSk7CiAgICBjb25zdCB3c0NhdCA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KGNhdEFvYSk7CiAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCB3c0NhdCwgIkNBVEVHT1JJRVMiKTsKCiAgICAvLyBOaWNlIGNvbHVtbiB3aWR0aHMKICAgIGZ1bmN0aW9uIHNldENvbHMod3MsIHdpZHRocyl7CiAgICAgIHdzWyIhY29scyJdID0gd2lkdGhzLm1hcCh3ID0+ICh7IHdjaDp3IH0pKTsKICAgIH0KICAgIHNldENvbHMod3NSYXcsICAgWzE4LCAyNiwgNiwgNywgNDZdKTsKICAgIHNldENvbHMod3NTdGF0cywgWzI2LCA0NiwgOCwgMTIsIDEwXSk7CiAgICBzZXRDb2xzKHdzUmFuaywgIFsyNiwgNiwgNDYsIDgsIDEyLCAxMF0pOwogICAgc2V0Q29scyh3c0NhdCwgICBbMjYsIDE0XSk7CgogICAgWExTWC53cml0ZUZpbGUod2IsICJKYW1lc1JpZ2FzX1N0YXRzX09MQS54bHN4Iik7CiAgfQoKICBjb25zdCBzdGF0c0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzdGF0c0J0biIpOwogIGlmIChzdGF0c0J0bil7CiAgICBzdGF0c0J0bi5vbmNsaWNrID0gZXhwb3J0QWxsVG9FeGNlbDsKICB9Cn0pKCk7Cjwvc2NyaXB0PgoKPC9ib2R5Pgo8L2h0bWw+Cg==";

  const introFrame = document.getElementById('introFrame');
  const mainFrame  = document.getElementById('mainFrame');

  function b64ToText(b64){ 
    try{ return decodeURIComponent(escape(atob(b64))); }catch(e){ return atob(b64); } 
  }

  introFrame.srcdoc = b64ToText(INTRO_B64);
  mainFrame.srcdoc  = b64ToText(MAIN_B64);

  const INTRO_MS = 10000;
  const FX_MS = 1200;

  function switchToMain(){
    document.body.classList.add('fx-on');
    setTimeout(() => {
      document.body.classList.add('main-on');
      setTimeout(() => { try{ introFrame.srcdoc = ""; }catch(e){} }, 900);
    }, Math.min(900, FX_MS - 200));
    setTimeout(() => document.body.classList.remove('fx-on'), FX_MS);
  }

  const isTouch = matchMedia('(pointer:coarse)').matches || 'ontouchstart' in window;
  const overlay = document.getElementById('startOverlay');
  let started=false, introTimer=null;

  function begin(){
    if (started) return;
    started=true;
    if (overlay) overlay.classList.add('hidden');
    introTimer=setTimeout(switchToMain, INTRO_MS);
  }

  if (isTouch && overlay){
    const tap=()=>begin();
    overlay.addEventListener('click', tap, { once:true });
    overlay.addEventListener('touchstart', tap, { once:true, passive:true });
    overlay.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' ') begin(); }, { once:true });
  } else {
    begin();
  }
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, doc, setDoc, onSnapshot, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // Firebase config (from your Firebase console)
  const firebaseConfig = {
  "apiKey": "AIzaSyA3j74FN_DIrsZclq09lIY62eenSOzP0yQ",
  "authDomain": "euphoria-2026.firebaseapp.com",
  "projectId": "euphoria-2026",
  "storageBucket": "euphoria-2026.firebasestorage.app",
  "messagingSenderId": "259023927428",
  "appId": "1:259023927428:web:74099e69bea7b07a7b2ad1",
  "measurementId": "G-JEVRCV89WB"
};

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  const mainFrame = document.getElementById('mainFrame');

  // "room" decides which shared state you sync (default matches your seed key)
  const room = new URLSearchParams(location.search).get('room') || 'teri-vi-sentio';
  const docRef = doc(db, 'neon-awards', room);

  let applyingRemote = false;

  function postToIframe(type, payload) {
    try {
      mainFrame.contentWindow?.postMessage({ __neonSync: 1, type, payload }, '*');
    } catch (e) {}
  }

  async function ensureDocFromIframe(kv) {
    try {
      const snap = await getDoc(docRef);
      if (!snap.exists()) {
        await setDoc(docRef, { kv, updatedAt: serverTimestamp() }, { merge: true });
      }
    } catch (e) {
      console.warn('Firestore init failed:', e);
    }
  }

  function injectBridge() {
    try {
      const w = mainFrame.contentWindow;
      const d = mainFrame.contentDocument;
      if (!w || !d) return;
      if (w.__neonBridgeInstalled) return;
      w.__neonBridgeInstalled = true;

      const s = d.createElement('script');
      s.textContent = `
(() => {
  const PREFIX = 'neon-awards:';
  const send = (type, payload) => {
    try { parent.postMessage({ __neonSync: 1, type, payload }, '*'); } catch(e) {}
  };

  const ls = window.localStorage;
  const _set = ls.setItem.bind(ls);
  const _rem = ls.removeItem.bind(ls);

  // patch writes so parent can sync to Firestore
  ls.setItem = (k, v) => {
    _set(k, v);
    if (window.__neonApplyingRemote) return;
    if (String(k).startsWith(PREFIX)) send('localChange', { key: String(k), value: String(v) });
  };
  ls.removeItem = (k) => {
    _rem(k);
    if (window.__neonApplyingRemote) return;
    if (String(k).startsWith(PREFIX)) send('localChange', { key: String(k), value: null });
  };

  // receive updates from parent (Firestore -> localStorage)
  window.addEventListener('message', (ev) => {
    const msg = ev.data;
    if (!msg || !msg.__neonSync) return;

    if (msg.type === 'applyRemote') {
      const kv = (msg.payload && msg.payload.kv) ? msg.payload.kv : {};
      window.__neonApplyingRemote = true;
      try {
        for (const [k, v] of Object.entries(kv)) {
          if (!String(k).startsWith(PREFIX)) continue;
          if (v === null || v === undefined) _rem(k);
          else _set(k, String(v));
        }
      } finally {
        window.__neonApplyingRemote = false;
      }
    }
  });

  // send current state once (for first-time Firestore init)
  try {
    const kv = {};
    for (let i=0; i<ls.length; i++) {
      const k = ls.key(i);
      if (k && String(k).startsWith(PREFIX)) kv[String(k)] = ls.getItem(k);
    }
    send('hello', { kv });
  } catch(e) {}
})();
      `;
      d.documentElement.appendChild(s);
    } catch (e) {
      console.warn('Bridge inject failed:', e);
    }
  }

  mainFrame.addEventListener('load', () => {
    injectBridge();
  });

  // In case it loads instantly
  setTimeout(injectBridge, 500);

  // Listen to iframe -> parent events
  window.addEventListener('message', async (ev) => {
    const msg = ev.data;
    if (!msg || !msg.__neonSync) return;

    if (msg.type === 'hello') {
      // If Firestore is empty, seed it from this client
      const kv = msg.payload?.kv || {};
      await ensureDocFromIframe(kv);
      return;
    }

    if (msg.type === 'localChange') {
      if (applyingRemote) return;
      const { key, value } = msg.payload || {};
      if (!key) return;

      try {
        await setDoc(docRef, {
          kv: { [key]: value },
          updatedAt: serverTimestamp()
        }, { merge: true });
      } catch (e) {
        console.warn('Firestore write failed:', e);
      }
    }
  });

  // Firestore -> iframe live updates
  onSnapshot(docRef, (snap) => {
    if (!snap.exists()) return;
    const data = snap.data() || {};
    const kv = data.kv || {};

    applyingRemote = true;
    postToIframe('applyRemote', { kv });
    // allow local edits again on next tick
    setTimeout(() => (applyingRemote = false), 0);
  });
</script>
</body>
</html>
