<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Euphoria Intro → Neon Awards</title>
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <style>
    html,body{position:relative;height:100%; margin:0; background:#000; overflow:hidden; touch-action:auto;}
    body{overscroll-behavior-y:none; -webkit-overflow-scrolling:touch;}
    iframe{display:block; border:0;}

    .layer{position:absolute; inset:0; width:100%; height:100%; border:0; overflow:auto; -webkit-overflow-scrolling:touch; touch-action:pan-y;}
    #introFrame{z-index:10;}
    #mainFrame{z-index:1; opacity:0; pointer-events:none; transition:opacity .8s ease; background:#070817;}
    body.main-on #mainFrame{opacity:1; pointer-events:auto;}
    body.main-on #introFrame{opacity:0; pointer-events:none; transition:opacity .6s ease;}
    #fx{position:fixed; inset:0; z-index:20; pointer-events:none; opacity:0;}
    body.fx-on #fx{opacity:1; animation:fxFlash 1.2s ease forwards;}
    @keyframes fxFlash{
      0%{opacity:0; filter:none;}
      10%{opacity:1; filter:contrast(1.35) saturate(1.4) blur(0px);}
      35%{opacity:1; filter:contrast(1.55) saturate(1.8) blur(1px);}
      65%{opacity:.75; filter:contrast(1.2) saturate(1.25) blur(0.5px);}
      100%{opacity:0; filter:none;}
    }
    #startOverlay{position:fixed; inset:0; z-index:40; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,65); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding:18px;}
    #startOverlay.hidden{display:none;}
    #startOverlay .startCard{width:min(520px, 92vw); border-radius:22px; padding:18px 18px 16px;
      background:rgba(10,10,18,72); border:1px solid rgba(255,255,255,10);}
    #startOverlay .startTitle{font:700 20px/1.2 system-ui; color:rgba(255,255,255,92); margin-bottom:8px;}
    #startOverlay .startSub{font:13px/1.35 system-ui; color:rgba(255,255,255,70);}
  </style>
</head>
<body>
  <iframe id="introFrame" class="layer" title="Euphoria Intro" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen scrolling="yes"></iframe>
  <iframe id="mainFrame" class="layer" title="Neon Awards" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen scrolling="yes"></iframe>
  <div id="fx" aria-hidden="true"></div>

  <div id="startOverlay" role="button" aria-label="Tap to start" tabindex="0">
    <div class="startCard">
      <div class="startTitle">Tap to start</div>
      <div class="startSub">Βελτιστοποιημένο για κινητό — ξεκινάει το intro &amp; το timer.</div>
    </div>
  </div>

<script>
  // ---- Seed data (από το Excel) ----
  (function(){
    const SEED_MARK = "neon-awards:seed:v1";
    try{
      if (!localStorage.getItem(SEED_MARK)){
        localStorage.setItem("neon-awards:teri-vi-sentio", "{\"Best gr song\": [{\"id\": \"Best gr song__0__seed\", \"text\": \"Χρόνια πολλά φουρειρα\"}, {\"id\": \"Best gr song__1__seed\", \"text\": \"Alleluia φουρειρα\"}, {\"id\": \"Best gr song__2__seed\", \"text\": \"Εξαίρεση βισση\"}, {\"id\": \"Best gr song__3__seed\", \"text\": \"Ανεξάρτητη καλιμανη\"}, {\"id\": \"Best gr song__4__seed\", \"text\": \"Χόρεψε χατζηγιαννης\"}, {\"id\": \"Best gr song__5__seed\", \"text\": \"Αχ καρδιά μου αργυρός\"}, {\"id\": \"Best gr song__6__seed\", \"text\": \"Καλά να περνάτε δέσποινα Βανδή\"}, {\"id\": \"Best gr song__7__seed\", \"text\": \"Κάτι ξερις ρια ελληνιδου\"}, {\"id\": \"Best gr song__8__seed\", \"text\": \"Βοριάς απόν\"}, {\"id\": \"Best gr song__9__seed\", \"text\": \"Μπορώ και εγώ μέλισσες\"}], \"Best foreign song\": [{\"id\": \"Best foreign song__0__seed\", \"text\": \"Not like us\"}, {\"id\": \"Best foreign song__1__seed\", \"text\": \"Dancing in the flames\"}, {\"id\": \"Best foreign song__2__seed\", \"text\": \"Death dance\"}, {\"id\": \"Best foreign song__3__seed\", \"text\": \"Golden\"}, {\"id\": \"Best foreign song__4__seed\", \"text\": \"Bad dreams\"}, {\"id\": \"Best foreign song__5__seed\", \"text\": \"Feels like I m falling in love\"}, {\"id\": \"Best foreign song__6__seed\", \"text\": \"Abracadabra\"}, {\"id\": \"Best foreign song__7__seed\", \"text\": \"Messy\"}, {\"id\": \"Best foreign song__8__seed\", \"text\": \"I had some help\"}, {\"id\": \"Best foreign song__9__seed\", \"text\": \"Texas hold em\"}], \"Best GR Male Artist\": [{\"id\": \"Best GR Male Artist__0__seed\", \"text\": \"Ρεμος\"}, {\"id\": \"Best GR Male Artist__1__seed\", \"text\": \"Αργυρός\"}, {\"id\": \"Best GR Male Artist__2__seed\", \"text\": \"Φέρρης\"}, {\"id\": \"Best GR Male Artist__3__seed\", \"text\": \"Ιακωβιδης\"}, {\"id\": \"Best GR Male Artist__4__seed\", \"text\": \"Απόν\"}, {\"id\": \"Best GR Male Artist__5__seed\", \"text\": \"Σικαρο\"}, {\"id\": \"Best GR Male Artist__6__seed\", \"text\": \"Μάστορας\"}, {\"id\": \"Best GR Male Artist__7__seed\", \"text\": \"Οικονομόπουλος\"}, {\"id\": \"Best GR Male Artist__8__seed\", \"text\": \"Σαμπάνης\"}, {\"id\": \"Best GR Male Artist__9__seed\", \"text\": \"Μαζωνάκης\"}], \"Best GR Female Artsis\": [{\"id\": \"Best GR Female Artsis__0__seed\", \"text\": \"Βανδή\"}, {\"id\": \"Best GR Female Artsis__1__seed\", \"text\": \"Βισση\"}, {\"id\": \"Best GR Female Artsis__2__seed\", \"text\": \"Παπαριζου\"}, {\"id\": \"Best GR Female Artsis__3__seed\", \"text\": \"Σαττι\"}, {\"id\": \"Best GR Female Artsis__4__seed\", \"text\": \"Θεοδωριδου\"}, {\"id\": \"Best GR Female Artsis__5__seed\", \"text\": \"Ελληνιδου\"}, {\"id\": \"Best GR Female Artsis__6__seed\", \"text\": \"Καλλιμάνη\"}, {\"id\": \"Best GR Female Artsis__7__seed\", \"text\": \"Κλαυδια\"}, {\"id\": \"Best GR Female Artsis__8__seed\", \"text\": \"Γαρμπή\"}, {\"id\": \"Best GR Female Artsis__9__seed\", \"text\": \"Αδάμου\"}], \"Best Foreign Male Artist\": [{\"id\": \"Best Foreign Male Artist__0__seed\", \"text\": \"Ted swims\"}, {\"id\": \"Best Foreign Male Artist__1__seed\", \"text\": \"Drake\"}, {\"id\": \"Best Foreign Male Artist__2__seed\", \"text\": \"Lamar\"}, {\"id\": \"Best Foreign Male Artist__3__seed\", \"text\": \"Alex warren\"}, {\"id\": \"Best Foreign Male Artist__4__seed\", \"text\": \"Ed sheeran\"}, {\"id\": \"Best Foreign Male Artist__5__seed\", \"text\": \"Bad bunny\"}, {\"id\": \"Best Foreign Male Artist__6__seed\", \"text\": \"Bruno mars\"}, {\"id\": \"Best Foreign Male Artist__7__seed\", \"text\": \"Weekend\"}, {\"id\": \"Best Foreign Male Artist__8__seed\", \"text\": \"Benson boone\"}, {\"id\": \"Best Foreign Male Artist__9__seed\", \"text\": \"Post malone\"}], \"Best Foreign Female Artist\": [{\"id\": \"Best Foreign Female Artist__0__seed\", \"text\": \"Lady gaga\"}, {\"id\": \"Best Foreign Female Artist__1__seed\", \"text\": \"Sabrina carpenter\"}, {\"id\": \"Best Foreign Female Artist__2__seed\", \"text\": \"Taylor swift\"}, {\"id\": \"Best Foreign Female Artist__3__seed\", \"text\": \"Day lipa\"}, {\"id\": \"Best Foreign Female Artist__4__seed\", \"text\": \"Billie eilish\"}, {\"id\": \"Best Foreign Female Artist__5__seed\", \"text\": \"Lola young\"}, {\"id\": \"Best Foreign Female Artist__6__seed\", \"text\": \"Chappell roan\"}, {\"id\": \"Best Foreign Female Artist__7__seed\", \"text\": \"Doja cat\"}, {\"id\": \"Best Foreign Female Artist__8__seed\", \"text\": \"Olivia Rodrigo\"}, {\"id\": \"Best Foreign Female Artist__9__seed\", \"text\": \"Shakira\"}], \"Best GR music Video\": [{\"id\": \"Best GR music Video__0__seed\", \"text\": \"Αστεροματα κλαδιά\"}, {\"id\": \"Best GR music Video__1__seed\", \"text\": \"Λολα σαττι\"}, {\"id\": \"Best GR music Video__2__seed\", \"text\": \"Μηχανική καρδιά μάστορας\"}, {\"id\": \"Best GR music Video__3__seed\", \"text\": \"Κάτι ξέρεις ρια ελληνιδου\"}, {\"id\": \"Best GR music Video__4__seed\", \"text\": \"Το βάλε λιολιου\"}, {\"id\": \"Best GR music Video__5__seed\", \"text\": \"Αχ καρδιά μου αργυρός\"}, {\"id\": \"Best GR music Video__6__seed\", \"text\": \"Χόρεψε χατζηγιαννης\"}, {\"id\": \"Best GR music Video__7__seed\", \"text\": \"Καλέ ποιος είναι αυτός Ανδρομάχης\"}, {\"id\": \"Best GR music Video__8__seed\", \"text\": \"Αποτυπώματα λιλα\"}, {\"id\": \"Best GR music Video__9__seed\", \"text\": \"Λόγια ΗΒΗ Αδάμου\"}], \"Best Foreign Music Video\": [{\"id\": \"Best Foreign Music Video__0__seed\", \"text\": \"Neon dreams\"}, {\"id\": \"Best Foreign Music Video__1__seed\", \"text\": \"Texas hold em\"}, {\"id\": \"Best Foreign Music Video__2__seed\", \"text\": \"Abracadabra\"}, {\"id\": \"Best Foreign Music Video__3__seed\", \"text\": \"Midnight sun\"}, {\"id\": \"Best Foreign Music Video__4__seed\", \"text\": \"Death dance\"}, {\"id\": \"Best Foreign Music Video__5__seed\", \"text\": \"Golden\"}, {\"id\": \"Best Foreign Music Video__6__seed\", \"text\": \"Door\"}, {\"id\": \"Best Foreign Music Video__7__seed\", \"text\": \"Bad dreams\"}, {\"id\": \"Best Foreign Music Video__8__seed\", \"text\": \"Training seadon\"}, {\"id\": \"Best Foreign Music Video__9__seed\", \"text\": \"Fortnight\"}], \"Best ESC 2025 perfomance\": [{\"id\": \"Best ESC 2025 perfomance__0__seed\", \"text\": \"Sweden\"}, {\"id\": \"Best ESC 2025 perfomance__1__seed\", \"text\": \"Spain\"}, {\"id\": \"Best ESC 2025 perfomance__2__seed\", \"text\": \"Estonia\"}, {\"id\": \"Best ESC 2025 perfomance__3__seed\", \"text\": \"Φιλανδια\"}, {\"id\": \"Best ESC 2025 perfomance__4__seed\", \"text\": \"Ελλάδα\"}, {\"id\": \"Best ESC 2025 perfomance__5__seed\", \"text\": \"Γαλλία\"}, {\"id\": \"Best ESC 2025 perfomance__6__seed\", \"text\": \"Αυστρία\"}, {\"id\": \"Best ESC 2025 perfomance__7__seed\", \"text\": \"Ισραήλ\"}, {\"id\": \"Best ESC 2025 perfomance__8__seed\", \"text\": \"Γερμανία\"}, {\"id\": \"Best ESC 2025 perfomance__9__seed\", \"text\": \"Μαλτα\"}], \"Best Album of the Year\": [{\"id\": \"Best Album of the Year__0__seed\", \"text\": \"Comboy carter\"}, {\"id\": \"Best Album of the Year__1__seed\", \"text\": \"Radical optimism\"}, {\"id\": \"Best Album of the Year__2__seed\", \"text\": \"The tortured poets departmet\"}, {\"id\": \"Best Album of the Year__3__seed\", \"text\": \"Hit me hard and soft\"}, {\"id\": \"Best Album of the Year__4__seed\", \"text\": \"Hurry up tomorrow\"}, {\"id\": \"Best Album of the Year__5__seed\", \"text\": \"Not like us\"}, {\"id\": \"Best Album of the Year__6__seed\", \"text\": \"We cant be friends\"}, {\"id\": \"Best Album of the Year__7__seed\", \"text\": \"I had some help\"}, {\"id\": \"Best Album of the Year__8__seed\", \"text\": \"Feels like I m falling in love\"}, {\"id\": \"Best Album of the Year__9__seed\", \"text\": \"Saturn\"}]}");
        localStorage.setItem(SEED_MARK, "1");
      }
    }catch(e){}
  })();

  const INTRO_B64 = "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVsIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiIC8+Cjx0aXRsZT5FdXBob3JpYSDigJQgTmVvbiBTbW9vdGggKFB1bHNlICsgR3JhaW4pPC90aXRsZT4KPHN0eWxlPgogIDpyb290ewogICAgLS1iZy1kZWVwOiMwMjAzMGE7CiAgICAtLWJnLWJsdWU6IzA1MGEyMjsKICAgIC0tYmctYmx1ZTI6IzA2MGIxZTsKCiAgICAtLXdoaXRlOiNmZmY7CiAgICAtLW5lb24tY3lhbjojMmJkOWZmOwogICAgLS1uZW9uLXBpbms6I2ZmMmJkNjsKCiAgICAtLWdsYXNzOiByZ2JhKDEyLCAyNCwgNTAsIC4zOCk7CiAgICAtLXN0cm9rZTogcmdiYSg0MSwxODIsMjU1LC41NSk7CgogICAgLyogc3luYyBrbm9icyAqLwogICAgLS1wdWxzZUR1cjogMy42czsgICAgIC8qIGtlZXAgc2FtZSBhcyBsb2dvIG5lb25CcmVhdGggKi8KICAgIC0tcHVsc2VEZWxheTogMS4yczsgICAvKiBtYXRjaGVzIGxvZ28gbmVvbkJyZWF0aCBkZWxheSAqLwogIH0KCiAgKnsgYm94LXNpemluZzpib3JkZXItYm94OyB9CiAgaHRtbCxib2R5eyBoZWlnaHQ6MTAwJTsgfQoKICAvKiA9PT09PSBCQVNFIEJBQ0tHUk9VTkQgKGRhcmsgbmVvbikgPT09PT0gKi8KICBib2R5ewogICAgbWFyZ2luOjA7CiAgICBvdmVyZmxvdzpoaWRkZW47CiAgICBjb2xvcjp2YXIoLS13aGl0ZSk7CiAgICBmb250LWZhbWlseTogc3lzdGVtLXVpLCAtYXBwbGUtc3lzdGVtLCBTZWdvZSBVSSwgUm9ib3RvLCBIZWx2ZXRpY2EsIEFyaWFsLCAiQnJ1c2ggU2NyaXB0IE1UIiwgY3Vyc2l2ZTsKCiAgICBiYWNrZ3JvdW5kOgogICAgICByYWRpYWwtZ3JhZGllbnQoMTIwMHB4IDYwMHB4IGF0IDE4JSAyMiUsIHJnYmEoMjU1LDQzLDIxNCwwLjE4KSwgdHJhbnNwYXJlbnQgNjIlKSwKICAgICAgcmFkaWFsLWdyYWRpZW50KDExMDBweCA2NTBweCBhdCA3OCUgNzIlLCByZ2JhKDQzLDIxNywyNTUsMC4xNiksIHRyYW5zcGFyZW50IDY2JSksCiAgICAgIGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHZhcigtLWJnLWJsdWUpIDAlLCB2YXIoLS1iZy1kZWVwKSA0NSUsIHZhcigtLWJnLWJsdWUyKSAxMDAlKTsKICB9CgogIC8qID09PT09IFNMT1cgTkVPTiBNT1RJT04gTEFZRVIgKHZlcnkgc2xvdyBkcmlmdCkgPT09PT0gKi8KICAuYmctZHJpZnR7CiAgICBwb3NpdGlvbjpmaXhlZDsKICAgIGluc2V0Oi0yMiU7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgei1pbmRleDowOwogICAgYmFja2dyb3VuZDoKICAgICAgcmFkaWFsLWdyYWRpZW50KDk4MHB4IDU2MHB4IGF0IDMwJSAzMCUsIHJnYmEoMjU1LDQzLDIxNCwwLjIwKSwgdHJhbnNwYXJlbnQgNjAlKSwKICAgICAgcmFkaWFsLWdyYWRpZW50KDkyMHB4IDU2MHB4IGF0IDcwJSA3MCUsIHJnYmEoNDMsMjE3LDI1NSwwLjE4KSwgdHJhbnNwYXJlbnQgNjIlKTsKICAgIGZpbHRlcjogYmx1cigyMHB4KSBzYXR1cmF0ZSgxLjIpOwogICAgb3BhY2l0eTouODU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsMCwwKTsKICAgIGFuaW1hdGlvbjogYmdEcmlmdCAyMnMgZWFzZS1pbi1vdXQgaW5maW5pdGUgYWx0ZXJuYXRlOwogICAgbWl4LWJsZW5kLW1vZGU6IHNjcmVlbjsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm0sIG9wYWNpdHk7CiAgfQoKICBAa2V5ZnJhbWVzIGJnRHJpZnR7CiAgICAwJSAgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTIuNSUsIC0xLjUlKSBzY2FsZSgxLjAyKTsgfQogICAgNTAlICB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDIuNSUsICAxLjIlKSBzY2FsZSgxLjA1KTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC0xLjIlLCAyLjIlKSBzY2FsZSgxLjAzKTsgfQogIH0KCiAgLyogPT09PT0gUFVMU0UgTEFZRVIgKHN5bmNlZCB0byBsb2dvKSA9PT09PSAqLwogIC5iZy1wdWxzZXsKICAgIHBvc2l0aW9uOmZpeGVkOwogICAgaW5zZXQ6MDsKICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICB6LWluZGV4OjE7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC42cyBlYXNlOwogICAgbWl4LWJsZW5kLW1vZGU6IHNjcmVlbjsKICB9CgogIC8qIG9ubHkgc3RhcnQgcHVsc2luZyBvbmNlIGxvZ28gaXMgInJlYWR5IiAqLwogIGJvZHkubG9nby1vbiAuYmctcHVsc2V7CiAgICBvcGFjaXR5OjE7CiAgICBhbmltYXRpb246IGJnUHVsc2UgdmFyKC0tcHVsc2VEdXIpIGVhc2UtaW4tb3V0IGluZmluaXRlIHZhcigtLXB1bHNlRGVsYXkpOwogIH0KCiAgQGtleWZyYW1lcyBiZ1B1bHNlewogICAgMCUsMTAwJXsKICAgICAgZmlsdGVyOiBibHVyKDBweCkgc2F0dXJhdGUoMS4wNSk7CiAgICAgIG9wYWNpdHk6LjU1OwogICAgfQogICAgNTAlewogICAgICBmaWx0ZXI6IGJsdXIoMHB4KSBzYXR1cmF0ZSgxLjI1KTsKICAgICAgb3BhY2l0eTouODU7CiAgICB9CiAgfQoKICAuYmctcHVsc2U6OmJlZm9yZXsKICAgIGNvbnRlbnQ6IiI7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIGluc2V0Oi0xMCU7CiAgICBiYWNrZ3JvdW5kOgogICAgICByYWRpYWwtZ3JhZGllbnQoOTAwcHggNTIwcHggYXQgNTAlIDQ1JSwgcmdiYSgyNTUsNDMsMjE0LDAuMTEpLCB0cmFuc3BhcmVudCA2OCUpLAogICAgICByYWRpYWwtZ3JhZGllbnQoODYwcHggNTIwcHggYXQgNTIlIDUwJSwgcmdiYSg0MywyMTcsMjU1LDAuMTApLCB0cmFuc3BhcmVudCA3MCUpOwogICAgZmlsdGVyOiBibHVyKDE4cHgpOwogIH0KCiAgLyogPT09PT0gQ0lORU1BVElDIE5PSVNFIC8gR1JBSU4gPT09PT0gKi8KICAuZ3JhaW57CiAgICBwb3NpdGlvbjpmaXhlZDsKICAgIGluc2V0Oi0xNSU7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgei1pbmRleDozOwogICAgb3BhY2l0eTouMzI7CiAgICBtaXgtYmxlbmQtbW9kZTogb3ZlcmxheTsKICAgIGJhY2tncm91bmQ6CiAgICAgIHJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoMGRlZywgcmdiYSgyNTUsMjU1LDI1NSwwLjAyOCkgMCAxcHgsIHRyYW5zcGFyZW50IDFweCAzcHgpLAogICAgICByZXBlYXRpbmctbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDI1NSwyNTUsMjU1LDAuMDIwKSAwIDFweCwgdHJhbnNwYXJlbnQgMXB4IDRweCksCiAgICAgIHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgNTAlIDUwJSwgcmdiYSgyNTUsMjU1LDI1NSwwLjAzKSwgdHJhbnNwYXJlbnQgNzAlKTsKICAgIGZpbHRlcjogY29udHJhc3QoMTE1JSkgYnJpZ2h0bmVzcygxMDUlKTsKICAgIGFuaW1hdGlvbjogZ3JhaW5Nb3ZlIDZzIHN0ZXBzKDgpIGluZmluaXRlOwogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsKICB9CgogIEBrZXlmcmFtZXMgZ3JhaW5Nb3ZlewogICAgMCUgICB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDAsMCkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICAxMCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTIlLCAxJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICAyMCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTQlLCAtMiUpIHJvdGF0ZSgwLjAxZGVnKTsgfQogICAgMzAlICB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDMlLCAyJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICA0MCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMSUsIC0zJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICA1MCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTMlLCAzJSkgcm90YXRlKDAuMDFkZWcpOyB9CiAgICA2MCUgIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoNCUsIDElKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDcwJSAgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgyJSwgLTIlKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDgwJSAgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtMiUsIDIlKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDkwJSAgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgzJSwgLTElKSByb3RhdGUoMC4wMWRlZyk7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgwLDApIHJvdGF0ZSgwLjAxZGVnKTsgfQogIH0KCiAgLyogPT09PT0gSU5UUk8gUE9QVVAgPT09PT0gKi8KICAuaW50cm8tbGF5ZXJ7CiAgICBwb3NpdGlvbjpmaXhlZDsgaW5zZXQ6MDsgei1pbmRleDoxMDsKICAgIGRpc3BsYXk6Z3JpZDsgcGxhY2UtaXRlbXM6Y2VudGVyOwogICAgYmFja2dyb3VuZDoKICAgICAgcmFkaWFsLWdyYWRpZW50KDEyMDBweCA4MDBweCBhdCA1MCUgNTAlLCByZ2JhKDAsMCwwLC40OCksIHRyYW5zcGFyZW50IDcwJSksCiAgICAgIGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoNCwxMCwzMiwuOTApIDAlLCByZ2JhKDAsMCwwLC45NSkgMTAwJSk7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNnB4KSBzYXR1cmF0ZSgxLjA1KTsKICAgIHRyYW5zaXRpb246IG9wYWNpdHkgLjdzIGVhc2UsIHRyYW5zZm9ybSAuN3MgY3ViaWMtYmV6aWVyKC4yLC44LC4yLDEpLCBmaWx0ZXIgLjdzIGVhc2U7CiAgfQoKICAuaW50cm8tY2FyZHsKICAgIHdpZHRoOm1pbig4NnZ3LDUyMHB4KTsKICAgIGJvcmRlci1yYWRpdXM6MjBweDsKICAgIHBhZGRpbmc6MjhweCAyNHB4IDIycHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCB2YXIoLS1nbGFzcyksIHJnYmEoMCwwLDAsLjE4KSk7CiAgICBib3JkZXI6MXB4IHNvbGlkIHJnYmEoNDEsMTgyLDI1NSwuNTUpOwogICAgYm94LXNoYWRvdzoKICAgICAgMCAwIDI0cHggcmdiYSg0MSwxODIsMjU1LC4xOCksCiAgICAgIDAgMCA4MHB4IHJnYmEoMjU1LDQzLDIxNCwuMTApLAogICAgICAwIDAgMTMwcHggcmdiYSg0MywyMTcsMjU1LC4wOCk7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTZweCkgc2NhbGUoLjk4KTsKICAgIG9wYWNpdHk6MDsKICAgIGZpbHRlcjogYmx1cig4cHgpOwogICAgdHJhbnNpdGlvbjoKICAgICAgb3BhY2l0eSAuNjVzIGVhc2UsCiAgICAgIHRyYW5zZm9ybSAuNzVzIGN1YmljLWJlemllciguMiwuOCwuMiwxKSwKICAgICAgZmlsdGVyIC43NXMgZWFzZTsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm0sIG9wYWNpdHksIGZpbHRlcjsKICB9CiAgLmludHJvLWNhcmQuc2hvd3sKICAgIG9wYWNpdHk6MTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKSBzY2FsZSgxKTsKICAgIGZpbHRlcjogYmx1cigwKTsKICB9CgogIC5oZXJvLW5hbWV7CiAgICBtYXJnaW46NnB4IDAgMnB4OwogICAgdGV4dC1hbGlnbjpjZW50ZXI7CiAgICBmb250LXNpemU6Y2xhbXAoMThweCw0LjZ2dyw0MHB4KTsKICAgIGZvbnQtd2VpZ2h0OjY1MDsKICAgIGxldHRlci1zcGFjaW5nOi0uMDJlbTsKICAgIGNvbG9yOnJnYmEoMjU1LDI1NSwyNTUsLjkyKTsKICAgIHRleHQtc2hhZG93OiAwIDAgMTBweCByZ2JhKDI1NSwyNTUsMjU1LC4xOCk7CiAgfQoKICAuc3VibGluZXsKICAgIHRleHQtYWxpZ246Y2VudGVyOwogICAgbWFyZ2luOjhweCAwIDE4cHg7CiAgICBmb250LWZhbWlseToiTW9udHNlcnJhdCIsIHN5c3RlbS11aSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICBmb250LXdlaWdodDo4MDA7CiAgICBsZXR0ZXItc3BhY2luZzoxLjFlbTsKICAgIGZvbnQtc2l6ZTpjbGFtcCgxMHB4LDJ2dywxNHB4KTsKICAgIGNvbG9yOnJnYmEoMjU1LDI1NSwyNTUsLjUwKTsKICAgIHRleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTsKICB9CgogIC5jdGF7IGRpc3BsYXk6ZmxleDsganVzdGlmeS1jb250ZW50OmNlbnRlcjsgfQogIC5jdGEgYnV0dG9uewogICAgY3Vyc29yOnBvaW50ZXI7CiAgICBib3JkZXI6bm9uZTsKICAgIHBhZGRpbmc6MTJweCAyMnB4OwogICAgYm9yZGVyLXJhZGl1czoxNnB4OwogICAgZm9udC13ZWlnaHQ6ODUwOwogICAgbGV0dGVyLXNwYWNpbmc6LjMyZW07CiAgICBmb250LWZhbWlseToiTW9udHNlcnJhdCIsIHN5c3RlbS11aSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICB0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7CiAgICBjb2xvcjp2YXIoLS13aGl0ZSk7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHZhcigtLW5lb24tcGluayksIHZhcigtLW5lb24tY3lhbikpOwogICAgYm94LXNoYWRvdzoKICAgICAgMCAwIDEycHggcmdiYSgyNTUsNDMsMjE0LC42MCksCiAgICAgIDAgMCAyNnB4IHJnYmEoNDMsMjE3LDI1NSwuNDUpLAogICAgICAwIDAgNjBweCByZ2JhKDQzLDIxNywyNTUsLjI1KTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKSBzY2FsZSgxKTsKICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAuMjJzIGVhc2UsIGZpbHRlciAuMjJzIGVhc2UsIGJveC1zaGFkb3cgLjIycyBlYXNlOwogICAgcG9zaXRpb246cmVsYXRpdmU7CiAgICBpc29sYXRpb246aXNvbGF0ZTsKICB9CiAgLmN0YSBidXR0b246OmJlZm9yZXsKICAgIGNvbnRlbnQ6IiI7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIGluc2V0Oi0ycHg7CiAgICBib3JkZXItcmFkaXVzOjE4cHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMjU1LDQzLDIxNCwuODUpLCByZ2JhKDQzLDIxNywyNTUsLjc1KSk7CiAgICBmaWx0ZXI6IGJsdXIoMTJweCk7CiAgICBvcGFjaXR5Oi41NTsKICAgIHotaW5kZXg6LTE7CiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC4yMnMgZWFzZSwgZmlsdGVyIC4yMnMgZWFzZTsKICB9CiAgLmN0YSBidXR0b246aG92ZXJ7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCkgc2NhbGUoMS4wMSk7CiAgICBmaWx0ZXI6IGJyaWdodG5lc3MoMS4xKTsKICAgIGJveC1zaGFkb3c6CiAgICAgIDAgMCAxOHB4IHJnYmEoMjU1LDQzLDIxNCwuODApLAogICAgICAwIDAgMzhweCByZ2JhKDQzLDIxNywyNTUsLjU1KSwKICAgICAgMCAwIDkwcHggcmdiYSg0MywyMTcsMjU1LC4zNSk7CiAgfQogIC5jdGEgYnV0dG9uOmhvdmVyOjpiZWZvcmV7IG9wYWNpdHk6Ljg7IGZpbHRlcjogYmx1cigxNHB4KTsgfQogIC5jdGEgYnV0dG9uOmFjdGl2ZXsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApIHNjYWxlKC45OSk7IH0KCiAgLmludHJvLWxheWVyLmV4aXR7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMDIpOwogICAgZmlsdGVyOiBibHVyKDEwcHgpIGJyaWdodG5lc3MoMS4xNSk7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogIH0KCiAgLyogPT09PT0gTUFJTiBTVEFHRSA9PT09PSAqLwogIC5zdGFnZXsKICAgIHBvc2l0aW9uOmZpeGVkOyBpbnNldDowOwogICAgZGlzcGxheTpncmlkOyBwbGFjZS1pdGVtczpjZW50ZXI7CiAgICB6LWluZGV4OjI7CiAgICBwYWRkaW5nOiA2dmggNHZ3OwogICAgb3BhY2l0eTowOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDhweCk7CiAgICBmaWx0ZXI6IGJsdXIoOHB4KTsKICAgIHRyYW5zaXRpb246CiAgICAgIG9wYWNpdHkgLjc1cyBlYXNlLAogICAgICB0cmFuc2Zvcm0gLjg1cyBjdWJpYy1iZXppZXIoLjIsLjgsLjIsMSksCiAgICAgIGZpbHRlciAuODVzIGVhc2UsCiAgICAgIHBhZGRpbmcgLjg1cyBlYXNlOwogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybSwgb3BhY2l0eSwgZmlsdGVyLCBwYWRkaW5nOwogIH0KICAuc3RhZ2UuYWN0aXZlewogICAgb3BhY2l0eToxOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOwogICAgZmlsdGVyOiBibHVyKDApOwogIH0KCiAgLmxvZ297CiAgICBwb3NpdGlvbjpyZWxhdGl2ZTsKICAgIHRleHQtYWxpZ246Y2VudGVyOwogICAgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDAgMjZweCByZ2JhKDI1NSw0MywyMTQsLjU1KSk7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVooMCk7CiAgICB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOwogIH0KCiAgLnRpdGxlewogICAgbWFyZ2luOjA7CiAgICBmb250LXNpemU6IGNsYW1wKDQ4cHgsIDIwdncsIDgwMHB4KTsKICAgIGxpbmUtaGVpZ2h0Oi44ODsKICAgIHdoaXRlLXNwYWNlOm5vd3JhcDsKICAgIGZvbnQtZmFtaWx5OiJCcnVzaCBTY3JpcHQgTVQiLCJCcnVzaCBTY3JpcHQgU3RkIixjdXJzaXZlOwogICAgZm9udC13ZWlnaHQ6NjAwOwogICAgbGV0dGVyLXNwYWNpbmc6LS4wM2VtOwogICAgY29sb3I6dmFyKC0td2hpdGUpOwogICAgLXdlYmtpdC10ZXh0LXN0cm9rZTouNHB4IHJnYmEoMjU1LDI1NSwyNTUsLjUpOwogICAgdGV4dC1zaGFkb3c6CiAgICAgIDAgMCAxOHB4IHJnYmEoMjU1LDQzLDIxNCwuODUpLAogICAgICAwIDAgNDBweCByZ2JhKDQzLDIxNywyNTUsLjU1KSwKICAgICAgMCAwIDRweCByZ2JhKDI1NSwyNTUsMjU1LC45NSk7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMThweCkgc2NhbGUoLjk4NSk7CiAgICB0cmFuc2l0aW9uOiBmb250LXNpemUgLjlzIGVhc2UsIGxldHRlci1zcGFjaW5nIC45cyBlYXNlOwogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybSwgb3BhY2l0eTsKICB9CgogIEBrZXlmcmFtZXMgbmVvbkJyZWF0aHsKICAgIDAlLDEwMCV7CiAgICAgIHRleHQtc2hhZG93OgogICAgICAgIDAgMCAxOHB4IHJnYmEoMjU1LDQzLDIxNCwuODUpLAogICAgICAgIDAgMCA0MHB4IHJnYmEoNDMsMjE3LDI1NSwuNTUpLAogICAgICAgIDAgMCA0cHggcmdiYSgyNTUsMjU1LDI1NSwxKTsKICAgICAgZmlsdGVyOiBzYXR1cmF0ZSgxLjA1KTsKICAgIH0KICAgIDUwJXsKICAgICAgdGV4dC1zaGFkb3c6CiAgICAgICAgMCAwIDMycHggcmdiYSgyNTUsNDMsMjE0LDEpLAogICAgICAgIDAgMCA3OHB4IHJnYmEoNDMsMjE3LDI1NSwuNzUpLAogICAgICAgIDAgMCA1cHggcmdiYSgyNTUsMjU1LDI1NSwxKTsKICAgICAgZmlsdGVyOiBzYXR1cmF0ZSgxLjIpOwogICAgfQogIH0KICAudGl0bGUucmVhZHl7CiAgICBvcGFjaXR5OjE7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCkgc2NhbGUoMSk7CiAgICBhbmltYXRpb246IG5lb25CcmVhdGggdmFyKC0tcHVsc2VEdXIpIGVhc2UtaW4tb3V0IGluZmluaXRlIHZhcigtLXB1bHNlRGVsYXkpOwogIH0KCiAgLnRpdGxlIC5sZXR0ZXJ7CiAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICAgIG9wYWNpdHk6MDsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgyNnB4KSBzY2FsZSguOTYpIHNrZXdZKDEuNWRlZyk7CiAgICBmaWx0ZXI6IGJsdXIoN3B4KTsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm0sIG9wYWNpdHksIGZpbHRlcjsKICB9CiAgLnRpdGxlIC5sZXR0ZXIuc2hvd3sKICAgIG9wYWNpdHk6MTsKICAgIHRyYW5zZm9ybTpub25lOwogICAgZmlsdGVyOiBibHVyKDApOwogICAgdHJhbnNpdGlvbjoKICAgICAgb3BhY2l0eSAuNjJzIGN1YmljLWJlemllciguMjIsLjYxLC4zNiwxKSwKICAgICAgdHJhbnNmb3JtIC43NHMgY3ViaWMtYmV6aWVyKC4yMiwuNjEsLjM2LDEpLAogICAgICBmaWx0ZXIgLjc0cyBlYXNlOwogIH0KICBAa2V5ZnJhbWVzIGZsb2F0eXsKICAgIDAleyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0KICAgIDUwJXsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0ycHgpOyB9CiAgICAxMDAleyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0KICB9CiAgLnRpdGxlIC5sZXR0ZXIuZmxvd3sgYW5pbWF0aW9uOiBmbG9hdHkgMy44cyBlYXNlLWluLW91dCBpbmZpbml0ZTsgfQoKICAuc3VidGl0bGV7CiAgICBmb250LWZhbWlseToiTW9udHNlcnJhdCIsIlNlZ29lIFVJIixBcmlhbCxzYW5zLXNlcmlmOwogICAgZm9udC13ZWlnaHQ6OTAwOwogICAgbGV0dGVyLXNwYWNpbmc6M3B4OwogICAgbWFyZ2luLXRvcDowOwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgdG9wOi0zNnB4OyAvKiBPTkxZIHN1YnRpdGxlIG1vdmVzIHVwICovCiAgICBmb250LXNpemU6Y2xhbXAoMTZweCwzdncsNDhweCk7CiAgICB0ZXh0LXNoYWRvdzoKICAgICAgMCAwIDEwcHggcmdiYSgyNTUsNDMsMjE0LC4zNSksCiAgICAgIDAgMCAxNHB4IHJnYmEoMjU1LDI1NSwyNTUsLjM1KSwKICAgICAgMCAwIDMwcHggcmdiYSg0MywyMTcsMjU1LC42NSk7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTJweCk7CiAgICB0cmFuc2l0aW9uOgogICAgICBvcGFjaXR5IC45NXMgZWFzZSwKICAgICAgdHJhbnNmb3JtIDFzIGVhc2UsCiAgICAgIHRvcCAuODVzIGVhc2UsCiAgICAgIGZvbnQtc2l6ZSAuOXMgZWFzZSwKICAgICAgbGV0dGVyLXNwYWNpbmcgLjlzIGVhc2U7Cn0KICAuc3VidGl0bGUuc2hvd3sgb3BhY2l0eToxOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0KCiAgLyogPT09PT0gQ09NUEFDVCBTVEFURSA9PT09PSAqLwogIC5zdGFnZS5jb21wYWN0ewogICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAganVzdGlmeS1pdGVtczpjZW50ZXI7CiAgICBwYWRkaW5nLXRvcDogMDsKICAgIHBhZGRpbmctbGVmdDogNHZ3OwogICAgcGFkZGluZy1yaWdodDogNHZ3Owp9CiAgLnRpdGxlLmNvbXBhY3R7CiAgZm9udC1zaXplOiBpbmhlcml0OwogIGxldHRlci1zcGFjaW5nOiBpbmhlcml0Owp9CiAgLnN1YnRpdGxlLmNvbXBhY3R7CiAgdG9wOi0xNHB4OwogIGZvbnQtc2l6ZTogaW5oZXJpdDsKICBsZXR0ZXItc3BhY2luZzogaW5oZXJpdDsKfQoKICAubG9nby5jb21wYWN0TGlmdHsKICAgIGFuaW1hdGlvbjogbGlmdEdsb3cgLjg1cyBjdWJpYy1iZXppZXIoLjIsLjgsLjIsMSkgYm90aDsKICB9CiAgQGtleWZyYW1lcyBsaWZ0R2xvd3sKICAgIDAleyBmaWx0ZXI6IGRyb3Atc2hhZG93KDAgMCAyNnB4IHJnYmEoMjU1LDQzLDIxNCwuNTUpKTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApIHNjYWxlKDEpOyB9CiAgICA2MCV7IGZpbHRlcjogZHJvcC1zaGFkb3coMCAwIDQ0cHggcmdiYSgyNTUsNDMsMjE0LC43MikpIGRyb3Atc2hhZG93KDAgMCAzNHB4IHJnYmEoNDMsMjE3LDI1NSwuNDUpKTsgfQogICAgMTAwJXsgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDAgMzBweCByZ2JhKDI1NSw0MywyMTQsLjU1KSkgZHJvcC1zaGFkb3coMCAwIDIwcHggcmdiYSg0MywyMTcsMjU1LC4zMikpOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCkgc2NhbGUoMSk7IH0KICB9CgogIC8qIGFjY2Vzc2liaWxpdHkgKi8KICBAbWVkaWEgKHByZWZlcnMtcmVkdWNlZC1tb3Rpb246IHJlZHVjZSl7CiAgICAqeyBhbmltYXRpb246bm9uZSAhaW1wb3J0YW50OyB0cmFuc2l0aW9uOm5vbmUgIWltcG9ydGFudDsgfQogICAgLmJnLWRyaWZ0LCAuZ3JhaW57IGFuaW1hdGlvbjpub25lICFpbXBvcnRhbnQ7IH0KICAgIC5iZy1wdWxzZXsgb3BhY2l0eTowICFpbXBvcnRhbnQ7IH0KICB9CgogIC8qID09PT09IElNUEFDVCBMSU5FUyBCVVJTVCAob24gSU5TRVJUKSA9PT09PSAqLwogICNidXJzdENhbnZhc3sKICAgIHBvc2l0aW9uOmZpeGVkOwogICAgaW5zZXQ6MDsKICAgIHdpZHRoOjEwMHZ3OwogICAgaGVpZ2h0OjEwMHZoOwogICAgei1pbmRleDogMTsKICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICBvcGFjaXR5OjA7CiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC4yNXMgZWFzZTsKICB9CiAgYm9keS5idXJzdC1vbiAjYnVyc3RDYW52YXN7IG9wYWNpdHk6MTsgfQoKPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KCiAgPCEtLSBiYWNrZ3JvdW5kIGxheWVycyAtLT4KICA8ZGl2IGNsYXNzPSJiZy1kcmlmdCIgYXJpYS1oaWRkZW49InRydWUiPjwvZGl2PgogIDxkaXYgY2xhc3M9ImJnLXB1bHNlIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9kaXY+CiAgPGRpdiBjbGFzcz0iZ3JhaW4iIGFyaWEtaGlkZGVuPSJ0cnVlIj48L2Rpdj4KICA8Y2FudmFzIGlkPSJidXJzdENhbnZhcyIgYXJpYS1oaWRkZW49InRydWUiPjwvY2FudmFzPgoKCiAgPCEtLSBJTlRSTyAtLT4KICA8ZGl2IGNsYXNzPSJpbnRyby1sYXllciIgaWQ9ImludHJvIj4KICAgIDxkaXYgY2xhc3M9ImludHJvLWNhcmQiIGlkPSJpbnRyb0NhcmQiPgogICAgICA8aDIgY2xhc3M9Imhlcm8tbmFtZSI+SkFNRVMgUklHQVM8L2gyPgogICAgICA8ZGl2IGNsYXNzPSJzdWJsaW5lIj5QUkVTRU5UUzwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjdGEiPjxidXR0b24gaWQ9ImdvQnRuIj5JTlNFUlQ8L2J1dHRvbj48L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8IS0tIE1BSU4gLS0+CiAgPGRpdiBjbGFzcz0ic3RhZ2UiIGlkPSJzdGFnZSIgYXJpYS1oaWRkZW49InRydWUiPgogICAgPGRpdiBjbGFzcz0ibG9nbyIgaWQ9ImxvZ28iPgogICAgICA8aDEgY2xhc3M9InRpdGxlIiBpZD0idGl0bGUiPkV1cGhvcmlhPC9oMT4KICAgICAgPGRpdiBjbGFzcz0ic3VidGl0bGUiIGlkPSJzdWJ0aXRsZSI+T05MSU5FIE1VU0lDIEFXQVJEUyAyMDI2PC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCjxzY3JpcHQ+CigoKSA9PiB7CiAgY29uc3QgaW50cm8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW50cm8nKTsKICBjb25zdCBjYXJkICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnRyb0NhcmQnKTsKICBjb25zdCBnb0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb0J0bicpOwoKICBjb25zdCBzdGFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFnZScpOwogIGNvbnN0IGxvZ28gID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ28nKTsKICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZScpOwogIGNvbnN0IHN1YnRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1YnRpdGxlJyk7CgogIC8vIHNob3cgcG9wdXAgYWZ0ZXIgMnMKICBzZXRUaW1lb3V0KCgpID0+IGNhcmQuY2xhc3NMaXN0LmFkZCgnc2hvdycpLCAyMDAwKTsKCiAgZnVuY3Rpb24gbGF1bmNoTWFpbigpewogICAgCiAgICBzdGFydEJ1cnN0KCk7CmdvQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgIGludHJvLmNsYXNzTGlzdC5hZGQoJ2V4aXQnKTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgaW50cm8uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgc3RhZ2UuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgIHN0YWdlLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTsKICAgICAgc3RhcnRMb2dvKCk7CgogICAgICAvLyBjb21wYWN0IG1vZGUgZGlzYWJsZWQg4oCTIGxvZ28gc2l6ZSBsb2NrZWQKCiAgICB9LCA2NTApOwogIH0KICBnb0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGxhdW5jaE1haW4pOwogIC8vIEFVVE8tU1RBUlQgKGZvciBjb21iaW5lZCBpbnRybykKICBzZXRUaW1lb3V0KCgpID0+IHsgdHJ5eyBpZihnb0J0biAmJiAhZ29CdG4uZGlzYWJsZWQpIGxhdW5jaE1haW4oKTsgfWNhdGNoKGUpe30gfSwgMjQwMCk7CgoKICAKICAvKiA9PT09PSAxMDAgTElORVMgQlVSU1QgKHNwYXduIGF0IGNlbnRlciwgYm91bmNlL3JlZmxlY3Qgb24gZWRnZXMpID09PT09ICovCiAgY29uc3QgYnVyc3RDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVyc3RDYW52YXMnKTsKICBjb25zdCBiY3R4ID0gYnVyc3RDYW52YXMuZ2V0Q29udGV4dCgnMmQnLCB7IGFscGhhOiB0cnVlIH0pOwoKICBsZXQgYnVyc3RSdW5uaW5nID0gZmFsc2U7CiAgbGV0IGJ1cnN0UGFydHMgPSBbXTsKICBsZXQgYnVyc3RSQUYgPSAwOwogIGxldCBidXJzdFN0YXJ0VCA9IDA7CgogIGZ1bmN0aW9uIHJlc2l6ZUJ1cnN0KCl7CiAgICBjb25zdCBkcHIgPSBNYXRoLm1heCgxLCBNYXRoLm1pbigyLCB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxKSk7CiAgICBidXJzdENhbnZhcy53aWR0aCAgPSBNYXRoLmZsb29yKHdpbmRvdy5pbm5lcldpZHRoICAqIGRwcik7CiAgICBidXJzdENhbnZhcy5oZWlnaHQgPSBNYXRoLmZsb29yKHdpbmRvdy5pbm5lckhlaWdodCAqIGRwcik7CiAgICBidXJzdENhbnZhcy5zdHlsZS53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoICsgJ3B4JzsKICAgIGJ1cnN0Q2FudmFzLnN0eWxlLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCArICdweCc7CiAgICBiY3R4LnNldFRyYW5zZm9ybShkcHIsIDAsIDAsIGRwciwgMCwgMCk7CiAgfQogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCByZXNpemVCdXJzdCwgeyBwYXNzaXZlOnRydWUgfSk7CiAgcmVzaXplQnVyc3QoKTsKCiAgZnVuY3Rpb24gcmFuZChtaW4sIG1heCl7IHJldHVybiBtaW4gKyBNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbik7IH0KCiAgZnVuY3Rpb24gbWFrZVBhcnQoKXsKICAgIGNvbnN0IGN4ID0gd2luZG93LmlubmVyV2lkdGggKiAwLjU7CiAgICBjb25zdCBjeSA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuNTsKCiAgICAvLyByYW5kb20gZGlyZWN0aW9uIGZyb20gY2VudGVyCiAgICBjb25zdCBhbmcgPSByYW5kKDAsIE1hdGguUEkgKiAyKTsKICAgIGNvbnN0IHNwZWVkID0gcmFuZCg1MjAsIDk4MCk7IC8vIHB4L3NlYwogICAgY29uc3QgdnggPSBNYXRoLmNvcyhhbmcpICogc3BlZWQ7CiAgICBjb25zdCB2eSA9IE1hdGguc2luKGFuZykgKiBzcGVlZDsKCiAgICByZXR1cm4gewogICAgICB4OiBjeCwgeTogY3ksCiAgICAgIHZ4LCB2eSwKICAgICAgbGVuOiByYW5kKDE4LCA1NiksCiAgICAgIHc6IHJhbmQoMS4wLCAyLjQpLAogICAgICBnbG93OiByYW5kKDAuMTgsIDAuNDIpLAogICAgICBhbHBoYTogMSwKICAgICAgaHVlTWl4OiBNYXRoLnJhbmRvbSgpIDwgMC41ID8gJ3BpbmsnIDogJ2N5YW4nCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gZHJhd1BhcnQocCl7CiAgICAvLyBkcmF3IGEgc2hvcnQgbGluZSBvcmllbnRlZCBhbG9uZyB2ZWxvY2l0eSBkaXJlY3Rpb24KICAgIGNvbnN0IGEgPSBNYXRoLmF0YW4yKHAudnksIHAudngpOwogICAgY29uc3QgZHggPSBNYXRoLmNvcyhhKSAqIHAubGVuICogMC41OwogICAgY29uc3QgZHkgPSBNYXRoLnNpbihhKSAqIHAubGVuICogMC41OwoKICAgIC8vIG5lb24taXNoIHN0cm9rZSArIHNvZnQgZ2xvdyAod2l0aG91dCBjaGFuZ2luZyBnbG9iYWwgcGFsZXR0ZSkKICAgIGJjdHgubGluZVdpZHRoID0gcC53OwogICAgYmN0eC5nbG9iYWxBbHBoYSA9IHAuYWxwaGE7CgogICAgLy8gbWFpbiBsaW5lCiAgICBiY3R4LnNoYWRvd0JsdXIgPSAxODsKICAgIGJjdHguc2hhZG93Q29sb3IgPSBwLmh1ZU1peCA9PT0gJ3BpbmsnID8gJ3JnYmEoMjU1LDQzLDIxNCwuODUpJyA6ICdyZ2JhKDQzLDIxNywyNTUsLjg1KSc7CiAgICBiY3R4LnN0cm9rZVN0eWxlID0gcC5odWVNaXggPT09ICdwaW5rJyA/ICdyZ2JhKDI1NSw0MywyMTQsLjg1KScgOiAncmdiYSg0MywyMTcsMjU1LC44NSknOwogICAgYmN0eC5iZWdpblBhdGgoKTsKICAgIGJjdHgubW92ZVRvKHAueCAtIGR4LCBwLnkgLSBkeSk7CiAgICBiY3R4LmxpbmVUbyhwLnggKyBkeCwgcC55ICsgZHkpOwogICAgYmN0eC5zdHJva2UoKTsKCiAgICAvLyB3aGl0ZSBob3QgY29yZQogICAgYmN0eC5zaGFkb3dCbHVyID0gMTA7CiAgICBiY3R4LnNoYWRvd0NvbG9yID0gJ3JnYmEoMjU1LDI1NSwyNTUsLjc1KSc7CiAgICBiY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMjU1LDI1NSwyNTUsLjc1KSc7CiAgICBiY3R4LmxpbmVXaWR0aCA9IE1hdGgubWF4KDAuOCwgcC53ICogMC41NSk7CiAgICBiY3R4LmJlZ2luUGF0aCgpOwogICAgYmN0eC5tb3ZlVG8ocC54IC0gZHggKiAwLjksIHAueSAtIGR5ICogMC45KTsKICAgIGJjdHgubGluZVRvKHAueCArIGR4ICogMC45LCBwLnkgKyBkeSAqIDAuOSk7CiAgICBiY3R4LnN0cm9rZSgpOwogIH0KCiAgZnVuY3Rpb24gc3RlcEJ1cnN0KHQpewogICAgaWYoIWJ1cnN0UnVubmluZykgcmV0dXJuOwoKICAgIGNvbnN0IG5vdyA9IHQgfHwgcGVyZm9ybWFuY2Uubm93KCk7CiAgICBjb25zdCBkdCA9IE1hdGgubWluKDAuMDIyLCAobm93IC0gKHN0ZXBCdXJzdC5fbHQgfHwgbm93KSkgLyAxMDAwKTsKICAgIHN0ZXBCdXJzdC5fbHQgPSBub3c7CgogICAgLy8gZmFkZSB0cmFpbAogICAgYmN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLW92ZXInOwogICAgYmN0eC5nbG9iYWxBbHBoYSA9IDE7CiAgICBiY3R4LmNsZWFyUmVjdCgwLCAwLCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTsKCiAgICBjb25zdCBXID0gd2luZG93LmlubmVyV2lkdGgsIEggPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CgogICAgZm9yKGNvbnN0IHAgb2YgYnVyc3RQYXJ0cyl7CiAgICAgIHAueCArPSBwLnZ4ICogZHQ7CiAgICAgIHAueSArPSBwLnZ5ICogZHQ7CgogICAgICAvLyBib3VuY2UvcmVmbGVjdCBvbiBlZGdlcwogICAgICBjb25zdCBwYWQgPSAyOwogICAgICBpZihwLnggPD0gcGFkKXsgcC54ID0gcGFkOyBwLnZ4ICo9IC0xOyB9CiAgICAgIGlmKHAueCA+PSBXIC0gcGFkKXsgcC54ID0gVyAtIHBhZDsgcC52eCAqPSAtMTsgfQogICAgICBpZihwLnkgPD0gcGFkKXsgcC55ID0gcGFkOyBwLnZ5ICo9IC0xOyB9CiAgICAgIGlmKHAueSA+PSBIIC0gcGFkKXsgcC55ID0gSCAtIHBhZDsgcC52eSAqPSAtMTsgfQoKICAgICAgLy8gc3VidGxlIGVuZXJneSBsb3NzCiAgICAgIHAudnggKj0gMC45OTg7CiAgICAgIHAudnkgKj0gMC45OTg7CgogICAgICBkcmF3UGFydChwKTsKICAgIH0KICAgIGJ1cnN0UkFGID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHN0ZXBCdXJzdCk7CiAgfQoKICBmdW5jdGlvbiBzdGFydEJ1cnN0KCl7CiAgICAvLyByZXNwZWN0IHJlZHVjZWQgbW90aW9uCiAgICBpZiAod2luZG93Lm1hdGNoTWVkaWEgJiYgd2luZG93Lm1hdGNoTWVkaWEoJyhwcmVmZXJzLXJlZHVjZWQtbW90aW9uOiByZWR1Y2UpJykubWF0Y2hlcykgcmV0dXJuOwoKICAgIHJlc2l6ZUJ1cnN0KCk7CiAgICBidXJzdFBhcnRzID0gW107CiAgICBmb3IobGV0IGk9MDsgaTwxMDA7IGkrKykgYnVyc3RQYXJ0cy5wdXNoKG1ha2VQYXJ0KCkpOwoKICAgIGJ1cnN0UnVubmluZyA9IHRydWU7CiAgICBidXJzdFN0YXJ0VCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgc3RlcEJ1cnN0Ll9sdCA9IGJ1cnN0U3RhcnRUOwoKICAgIC8vIGNsZWFyCiAgICBiY3R4LmNsZWFyUmVjdCgwLDAsd2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2J1cnN0LW9uJyk7CiAgICBidXJzdFJBRiA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShzdGVwQnVyc3QpOwogIH0KCiAgZnVuY3Rpb24gc3RvcEJ1cnN0KCl7CiAgICBidXJzdFJ1bm5pbmcgPSBmYWxzZTsKICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGJ1cnN0UkFGKTsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnYnVyc3Qtb24nKTsKCiAgICAvLyBmYWRlIG91dCBxdWlja2x5IHRoZW4gY2xlYXIKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICBiY3R4LmNsZWFyUmVjdCgwLDAsd2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7CiAgICB9LCAyMjApOwogIH0KCgogIGZ1bmN0aW9uIHN0YXJ0TG9nbygpewogICAgY29uc3QgdGV4dCA9IHRpdGxlLnRleHRDb250ZW50LnRyaW0oKTsKICAgIHRpdGxlLnRleHRDb250ZW50ID0gJyc7CgogICAgY29uc3QgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgIGZvciAobGV0IGk9MDsgaTx0ZXh0Lmxlbmd0aDsgaSsrKXsKICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgc3Bhbi5jbGFzc05hbWUgPSAnbGV0dGVyJzsKICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IHRleHRbaV07CiAgICAgIGZyYWcuYXBwZW5kQ2hpbGQoc3Bhbik7CiAgICB9CiAgICB0aXRsZS5hcHBlbmRDaGlsZChmcmFnKTsKCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gewogICAgICB0aXRsZS5jbGFzc0xpc3QuYWRkKCdyZWFkeScpOwoKICAgICAgLy8gU1RBUlQgYmFja2dyb3VuZCBwdWxzZSBzeW5jZWQgd2l0aCBsb2dvCiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnbG9nby1vbicpOwogICAgfSk7CgogICAgY29uc3QgbGV0dGVycyA9IEFycmF5LmZyb20odGl0bGUucXVlcnlTZWxlY3RvckFsbCgnLmxldHRlcicpKTsKICAgIGNvbnN0IEJBU0VfREVMQVkgPSA0MiwgUkFORE9NX0pJVFRFUiA9IDkwLCBPVkVSTEFQX09GRlNFVCA9IDE4MDsKCiAgICBsZXR0ZXJzLmZvckVhY2goKGVsLCBpZHgpID0+IHsKICAgICAgY29uc3QgZGVsYXkgPSBpZHggKiBCQVNFX0RFTEFZICsgTWF0aC5yYW5kb20oKSAqIFJBTkRPTV9KSVRURVIgLSBPVkVSTEFQX09GRlNFVDsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gZWwuY2xhc3NMaXN0LmFkZCgnZmxvdycpLCAxODApOwogICAgICB9LCBNYXRoLm1heCgwLCBkZWxheSkpOwogICAgfSk7CgogICAgc2V0VGltZW91dCgoKSA9PiBzdWJ0aXRsZS5jbGFzc0xpc3QuYWRkKCdzaG93JyksCiAgICAgIE1hdGgubWF4KDkwMCwgbGV0dGVycy5sZW5ndGggKiBCQVNFX0RFTEFZICogMC43MikKICAgICk7CiAgfQoKICAKICAKICAvLyA9PT09PSBLRVlCT0FSRCBDT05UUk9MUyAoRU5URVIgPSBJTlNFUlQsIEVTQyA9IEZVTExTQ1JFRU4gVE9HR0xFKSA9PT09PQogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gewoKICAgIC8vIEVOVEVSID0gSU5TRVJUCiAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicpIHsKICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvQnRuJyk7CiAgICAgIGlmIChidG4gJiYgIWJ0bi5kaXNhYmxlZCkgewogICAgICAgIGJ0bi5jbGljaygpOwogICAgICB9CiAgICB9CgogICAgLy8gRVNDID0gRlVMTFNDUkVFTiBUT0dHTEUKICAgIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHsKICAgICAgLy8gTm90ZTogc29tZSBicm93c2VycyBtYXkgc3RpbGwgdXNlIEVTQyB0byBleGl0IGZ1bGxzY3JlZW4sIGJ1dCB0aGlzIHdvcmtzIHJlbGlhYmx5IHRvIEVOVEVSIGZ1bGxzY3JlZW4gd2hlbiBub3QgZnVsbHNjcmVlbi4KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCiAgICAgIGlmICghZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHsKICAgICAgICBpZiAoZWwucmVxdWVzdEZ1bGxzY3JlZW4pIGVsLnJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKSBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpOwogICAgICB9CiAgICB9CgogIH0pOwpmdW5jdGlvbiB0b2dnbGVGdWxsc2NyZWVuKCl7CiAgICBjb25zdCBkb2MgPSBkb2N1bWVudDsKICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgaWYgKCFkb2MuZnVsbHNjcmVlbkVsZW1lbnQgJiYKICAgICAgICAhZG9jLndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50ICYmCiAgICAgICAgIWRvYy5tb3pGdWxsU2NyZWVuRWxlbWVudCAmJgogICAgICAgICFkb2MubXNGdWxsc2NyZWVuRWxlbWVudCkgewoKICAgICAgaWYgKGVsLnJlcXVlc3RGdWxsc2NyZWVuKSBlbC5yZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICBlbHNlIGlmIChlbC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikgZWwud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4oKTsKICAgICAgZWxzZSBpZiAoZWwubW96UmVxdWVzdEZ1bGxTY3JlZW4pIGVsLm1velJlcXVlc3RGdWxsU2NyZWVuKCk7CiAgICAgIGVsc2UgaWYgKGVsLm1zUmVxdWVzdEZ1bGxzY3JlZW4pIGVsLm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTsKCiAgICB9IGVsc2UgewogICAgICBpZiAoZG9jLmV4aXRGdWxsc2NyZWVuKSBkb2MuZXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgZWxzZSBpZiAoZG9jLndlYmtpdEV4aXRGdWxsc2NyZWVuKSBkb2Mud2Via2l0RXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgZWxzZSBpZiAoZG9jLm1vekNhbmNlbEZ1bGxTY3JlZW4pIGRvYy5tb3pDYW5jZWxGdWxsU2NyZWVuKCk7CiAgICAgIGVsc2UgaWYgKGRvYy5tc0V4aXRGdWxsc2NyZWVuKSBkb2MubXNFeGl0RnVsbHNjcmVlbigpOwogICAgfQogIH0KCn0pKCk7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K";
  const MAIN_B64  = "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVsIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xIiAvPgogIDx0aXRsZT5OZW9uIEF3YXJkcyBGb3JtPC90aXRsZT4KICAKICA8c3R5bGU+CiAgICA6cm9vdHsKICAgICAgLS1iZzojMDcwODE3OwogICAgICAtLWJnMjojMDUwNjEyOwogICAgICAtLWNhcmQ6IHJnYmEoMjU1LDI1NSwyNTUsLjA2KTsKICAgICAgLS1jYXJkMjogcmdiYSgyNTUsMjU1LDI1NSwuMDQpOwogICAgICAtLWJvcmRlcjogcmdiYSgyNTUsMjU1LDI1NSwuMTApOwogICAgICAtLXRleHQ6I2ZmZmZmZjsKICAgICAgLS1tdXRlZDogcmdiYSgyNTUsMjU1LDI1NSwuNzApOwogICAgICAtLW11dGVkMjogcmdiYSgyNTUsMjU1LDI1NSwuNTApOwoKICAgICAgLS1waW5rOiNmZjJlYTY7CiAgICAgIC0tYmx1ZTojMDBkMWZmOwoKICAgICAgLS1yaW5nOiAwIDAgMCAycHggcmdiYSgwLDIwOSwyNTUsLjMwKSwgMCAwIDI0cHggcmdiYSgyNTUsNDYsMTY2LC4xOCk7CiAgICAgIC0tc2hhZG93OiAwIDE0cHggNDBweCByZ2JhKDAsMCwwLC40NSk7CiAgICAgIC0tZ2xvdzogMCAwIDIwcHggcmdiYSgwLDIwOSwyNTUsLjIyKSwgMCAwIDI2cHggcmdiYSgyNTUsNDYsMTY2LC4xOCk7CiAgICAgIC0tcmFkaXVzOiAxOHB4OwogICAgfQoKICAgICp7IGJveC1zaXppbmc6Ym9yZGVyLWJveDsgfQogICAgaHRtbCxib2R5e292ZXJzY3JvbGwtYmVoYXZpb3IteTogY29udGFpbjsgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoOyBoZWlnaHQ6MTAwJTsgLXdlYmtpdC10ZXh0LXNpemUtYWRqdXN0OjEwMCU7IH0KICAgIGJvZHl7b3ZlcnNjcm9sbC1iZWhhdmlvci15OiBjb250YWluOyAtd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZzogdG91Y2g7CiAgICAgIG1hcmdpbjowOwogICAgICBjb2xvcjp2YXIoLS10ZXh0KTsKICAgICAgZm9udC1mYW1pbHk6IHVpLXNhbnMtc2VyaWYsIHN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgU2Vnb2UgVUksIFJvYm90bywgIkhlbHZldGljYSBOZXVlIiwgQXJpYWwsICJOb3RvIFNhbnMiLCAiQXBwbGUgQ29sb3IgRW1vamkiLCAiU2Vnb2UgVUkgRW1vamkiOwogICAgICBiYWNrZ3JvdW5kOgogICAgICAgIHJhZGlhbC1ncmFkaWVudCg5MDBweCA0MjBweCBhdCAxNSUgMTUlLCByZ2JhKDI1NSw0NiwxNjYsLjE4KSwgdHJhbnNwYXJlbnQgNjAlKSwKICAgICAgICByYWRpYWwtZ3JhZGllbnQoOTAwcHggNDIwcHggYXQgODUlIDIwJSwgcmdiYSgwLDIwOSwyNTUsLjE2KSwgdHJhbnNwYXJlbnQgNjAlKSwKICAgICAgICBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCB2YXIoLS1iZykgMCUsIHZhcigtLWJnMikgMTAwJSk7CiAgICAgIG92ZXJmbG93LXg6aGlkZGVuOwogICAgfQoKICAgIC8qIGNsZWFuIG5lb24gc2Nyb2xsYmFyICovCiAgICA6Oi13ZWJraXQtc2Nyb2xsYmFyeyB3aWR0aDoxMHB4OyBoZWlnaHQ6MTBweDsgfQogICAgOjotd2Via2l0LXNjcm9sbGJhci10aHVtYnsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgcmdiYSgyNTUsNDYsMTY2LC43NSksIHJnYmEoMCwyMDksMjU1LC43NSkpOwogICAgICBib3JkZXItcmFkaXVzOjk5OXB4OwogICAgfQogICAgOjotd2Via2l0LXNjcm9sbGJhci10cmFja3sgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwuMDYpOyB9CgogICAgYXsgY29sb3I6aW5oZXJpdDsgfQogICAgYnV0dG9uLCBpbnB1dHsgZm9udDppbmhlcml0OyBjb2xvcjppbmhlcml0OyB9CgogICAgLndyYXB7CiAgICAgIG1heC13aWR0aDogOTgwcHg7CiAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICBwYWRkaW5nOiAyNnB4IDE2cHggNjRweDsKICAgIH0KCiAgICAvKiA9PT09PSBIZWFkZXIgPT09PT0gKi8KICAgIC5oZWFkZXJ7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZ2FwOjE0cHg7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgbWFyZ2luLWJvdHRvbTogMTRweDsKICAgIH0KICAgIC5sb2dvewogICAgICB3aWR0aDo0MHB4OwogICAgICBoZWlnaHQ6NDBweDsKICAgICAgYm9yZGVyLXJhZGl1czogMTRweDsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSgyNTUsNDYsMTY2LC45NSksIHJnYmEoMCwyMDksMjU1LC45NSkpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1nbG93KTsKICAgIH0KICAgIGgxewogICAgICBtYXJnaW46MDsKICAgICAgZm9udC1zaXplOiBjbGFtcCgyMnB4LCAzdncsIDM0cHgpOwogICAgICBsZXR0ZXItc3BhY2luZzotMC4wMmVtOwogICAgfQogICAgLnN1YnRpdGxlewogICAgICBtYXJnaW46OHB4IDAgMDsKICAgICAgY29sb3I6IHZhcigtLW11dGVkKTsKICAgICAgbWF4LXdpZHRoOiA3NWNoOwogICAgICBsaW5lLWhlaWdodDogMS40NTsKICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgfQoKICAgIC8qID09PT09IFNpbXBsZSBzaGVsbC9jYXJkID09PT09ICovCiAgICAuY2FyZHsKICAgICAgYm9yZGVyLXJhZGl1czogMjJweDsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgdmFyKC0tY2FyZCkgMCUsIHZhcigtLWNhcmQyKSAxMDAlKTsKICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyKTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93KTsKICAgICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEycHgpOwogICAgfQoKICAgIC8qID09PT09IEhvbWUgZ3JpZCA9PT09PSAqLwogICAgLmdyaWQ0ewogICAgICBkaXNwbGF5OmdyaWQ7CiAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOwogICAgICBnYXA6IDEycHg7CiAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICB9CiAgICBAbWVkaWEgKG1pbi13aWR0aDogNjQwcHgpeyAuZ3JpZDR7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDIsIG1pbm1heCgwLDFmcikpOyB9IH0KICAgIEBtZWRpYSAobWluLXdpZHRoOiA5ODBweCl7IC5ncmlkNHsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoMywgbWlubWF4KDAsMWZyKSk7IH0gfQoKICAgIC5wZXJzb24tdGlsZXsgcG9zaXRpb246cmVsYXRpdmU7IH0KICAgIC5wZXJzb24tYnRuewogICAgICB3aWR0aDoxMDAlOwogICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LC4wNCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cyk7CiAgICAgIHBhZGRpbmc6IDE2cHggMTRweDsKICAgICAgY3Vyc29yOnBvaW50ZXI7CiAgICAgIHRleHQtYWxpZ246bGVmdDsKICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIC4xNHMgZWFzZSwgYm9yZGVyLWNvbG9yIC4xNHMgZWFzZSwgYmFja2dyb3VuZCAuMTRzIGVhc2UsIGJveC1zaGFkb3cgLjE0cyBlYXNlOwogICAgfQogICAgLnBlcnNvbi1idG46aG92ZXJ7CiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwuMDYpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjE2KTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tZ2xvdyk7CiAgICB9CiAgICAucGVyc29uLXRpdGxleyBmb250LXdlaWdodDo4MDA7IGZvbnQtc2l6ZToxNnB4OyB9CiAgICAucGVyc29uLXN1YnsgbWFyZ2luLXRvcDo2cHg7IGZvbnQtc2l6ZToxMnB4OyBjb2xvcjogdmFyKC0tbXV0ZWQyKTsgfQoKICAgIC5zeW5jLW1pbml7CiAgICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgICB0b3A6MTBweDsgcmlnaHQ6MTBweDsKICAgICAgcGFkZGluZzogOHB4IDEwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjE0KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwuMjUpOwogICAgICBjdXJzb3I6cG9pbnRlcjsKICAgICAgZm9udC1zaXplOjEycHg7CiAgICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxMHB4KTsKICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIC4xNHMgZWFzZSwgYm9yZGVyLWNvbG9yIC4xNHMgZWFzZSwgYmFja2dyb3VuZCAuMTRzIGVhc2UsIGJveC1zaGFkb3cgLjE0cyBlYXNlOwogICAgfQogICAgLnN5bmMtbWluaTpob3ZlcnsKICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjIyKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwuMzUpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1nbG93KTsKICAgIH0KICAgIC5zeW5jLW1pbmk6Zm9jdXN7IG91dGxpbmU6IG5vbmU7IGJveC1zaGFkb3c6IHZhcigtLXJpbmcpOyB9CgogICAgLyogPT09PT0gUGVyc29uIHZpZXcgdG9wYmFyID09PT09ICovCiAgICAudG9wYmFyewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGZsZXgtd3JhcDp3cmFwOwogICAgICBnYXA6IDEycHg7CiAgICAgIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7CiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgbWFyZ2luOiA4cHggMCAxNHB4OwogICAgfQoKICAgIC5iYWNrewogICAgICBib3JkZXI6bm9uZTsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgIHBhZGRpbmc6IDZweCAwOwogICAgICBjb2xvcjogdmFyKC0tbXV0ZWQpOwogICAgICBjdXJzb3I6cG9pbnRlcjsKICAgIH0KICAgIC5iYWNrOmhvdmVyeyBjb2xvcjogI2ZmZjsgfQoKICAgIC5hY3Rpb25zewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgZ2FwOiAxMHB4OwogICAgICBmbGV4LXdyYXA6d3JhcDsKICAgIH0KCiAgICAucGlsbHsKICAgICAgZGlzcGxheTppbmxpbmUtZmxleDsKICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICBnYXA6IDhweDsKICAgICAgcGFkZGluZzogMTBweCAxMnB4OwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwuMTgpOwogICAgICBjb2xvcjogdmFyKC0tbXV0ZWQpOwogICAgICBmb250LXNpemU6IDEycHg7CiAgICB9CiAgICAucGlsbCBzdHJvbmd7IGNvbG9yOiNmZmY7IGZvbnQtd2VpZ2h0OjgwMDsgfQoKICAgIC5hY3Rpb257CiAgICAgIHBhZGRpbmc6IDEwcHggMTJweDsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjE0KTsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSgyNTUsNDYsMTY2LC4xNiksIHJnYmEoMCwyMDksMjU1LC4xNCkpOwogICAgICBjdXJzb3I6cG9pbnRlcjsKICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIC4xNHMgZWFzZSwgYm94LXNoYWRvdyAuMTRzIGVhc2UsIGJvcmRlci1jb2xvciAuMTRzIGVhc2U7CiAgICB9CiAgICAuYWN0aW9uOmhvdmVyeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7IGJveC1zaGFkb3c6IHZhcigtLWdsb3cpOyBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsLjIyKTsgfQogICAgLmFjdGlvbjpmb2N1c3sgb3V0bGluZTpub25lOyBib3gtc2hhZG93OiB2YXIoLS1yaW5nKTsgfQoKICAgIC8qID09PT09IENhdGVnb3JpZXMgPT09PT0gKi8KICAgIC5jYXRzewogICAgICBkaXNwbGF5OmdyaWQ7CiAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOwogICAgICBnYXA6IDE0cHg7CiAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICB9CiAgICBAbWVkaWEgKG1pbi13aWR0aDogOTgwcHgpeyAuY2F0c3sgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOyB9IH0KCiAgICAuY2F0ewogICAgICBib3JkZXItcmFkaXVzOiAyMHB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LC4wNCk7CiAgICAgIHBhZGRpbmc6IDE0cHg7CiAgICB9CiAgICAuY2F0IGgyeyBtYXJnaW46MDsgZm9udC1zaXplOiAxNHB4OyBmb250LXdlaWdodDogODAwOyBsZXR0ZXItc3BhY2luZzogLjAxZW07IH0KICAgIC5zdGF0dXN7CiAgICAgIG1hcmdpbi10b3A6IDZweDsKICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICBjb2xvcjogdmFyKC0tbXV0ZWQyKTsKICAgIH0KICAgIC5zdGF0dXMub257IGNvbG9yOiByZ2JhKDAsMjA5LDI1NSwuOTApOyB9CgogICAgLmNhdC1oZWFkewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgZ2FwOiAxMHB4OwogICAgICBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OwogICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgfQoKICAgIC5taW5pewogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMTQpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4xOCk7CiAgICAgIHBhZGRpbmc6IDhweCAxMHB4OwogICAgICBmb250LXNpemU6IDEycHg7CiAgICAgIGN1cnNvcjpwb2ludGVyOwogICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gLjE0cyBlYXNlLCBib3gtc2hhZG93IC4xNHMgZWFzZSwgYmFja2dyb3VuZCAuMTRzIGVhc2UsIGJvcmRlci1jb2xvciAuMTRzIGVhc2U7CiAgICB9CiAgICAubWluaTpob3ZlcnsKICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4yOCk7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuMjIpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1nbG93KTsKICAgIH0KICAgIC5taW5pOmZvY3VzeyBvdXRsaW5lOm5vbmU7IGJveC1zaGFkb3c6IHZhcigtLXJpbmcpOyB9CgogICAgLmxpc3R7IGRpc3BsYXk6ZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgZ2FwOiA4cHg7IH0KCiAgICAucm93ewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgZ2FwOiAxMHB4OwogICAgICBwYWRkaW5nOiAxMHB4IDEycHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE2cHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjEwKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwuMTYpOwogICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gLjEycyBlYXNlLCBib3JkZXItY29sb3IgLjEycyBlYXNlLCBib3gtc2hhZG93IC4xMnMgZWFzZSwgYmFja2dyb3VuZCAuMTJzIGVhc2U7CiAgICAgIHBvc2l0aW9uOnJlbGF0aXZlOwogICAgfQogICAgLnJvdy5kcmFnLWVuYWJsZWQ6aG92ZXJ7CiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LC4xOCk7CiAgICAgIGJveC1zaGFkb3c6IDAgMCAwIDFweCByZ2JhKDAsMjA5LDI1NSwuMTUpLCAwIDAgMThweCByZ2JhKDI1NSw0NiwxNjYsLjEyKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwuMjApOwogICAgfQogICAgLnJvdy5kcmFnZ2luZ3sKICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tcmluZyk7CiAgICAgIHRyYW5zZm9ybTogc2NhbGUoMS4wMSk7CiAgICB9CgogICAgLmhhbmRsZXsKICAgICAgd2lkdGg6IDM0cHg7CiAgICAgIGhlaWdodDogMzRweDsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjEyKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwuMDQpOwogICAgICBjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuNzUpOwogICAgICB1c2VyLXNlbGVjdDpub25lOwogICAgfQogICAgLnJvdy5kcmFnLWVuYWJsZWQgLmhhbmRsZXsgY3Vyc29yOiBncmFiOyB9CiAgICAucm93LmRyYWctZW5hYmxlZCAuaGFuZGxlOmFjdGl2ZXsgY3Vyc29yOiBncmFiYmluZzsgfQogICAgLmhhbmRsZS5vZmZ7IG9wYWNpdHk6IC40NTsgfQoKICAgIC5udW17CiAgICAgIHdpZHRoOiAyNnB4OwogICAgICB0ZXh0LWFsaWduOmNlbnRlcjsKICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICBjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuNTUpOwogICAgICBmb250LXZhcmlhbnQtbnVtZXJpYzogdGFidWxhci1udW1zOwogICAgfQoKICAgIGlucHV0LnRleHR7CiAgICAgIGZsZXg6IDE7CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjEyKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwuMDQpOwogICAgICBwYWRkaW5nOiAxMHB4IDEycHg7CiAgICAgIG91dGxpbmU6bm9uZTsKICAgIH0KICAgIGlucHV0LnRleHQ6OnBsYWNlaG9sZGVyeyBjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuMzUpOyB9CiAgICBpbnB1dC50ZXh0OmZvY3VzeyBib3gtc2hhZG93OiB2YXIoLS1yaW5nKTsgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsgfQoKICAgIC5zY29yZXsKICAgICAgd2lkdGg6IDY0cHg7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAganVzdGlmeS1jb250ZW50OmZsZXgtZW5kOwogICAgfQogICAgLmJhZGdlewogICAgICBtaW4td2lkdGg6IDQ2cHg7CiAgICAgIHRleHQtYWxpZ246Y2VudGVyOwogICAgICBwYWRkaW5nOiA4cHggMTBweDsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjEyKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwuMDQpOwogICAgICBjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuNzApOwogICAgICBmb250LXdlaWdodDogODAwOwogICAgICBmb250LXNpemU6IDEycHg7CiAgICAgIGZvbnQtdmFyaWFudC1udW1lcmljOiB0YWJ1bGFyLW51bXM7CiAgICB9CiAgICAucm93LmRyYWctZW5hYmxlZCAuYmFkZ2V7CiAgICAgIGNvbG9yOiNmZmY7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwuMTgpOwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCByZ2JhKDI1NSw0NiwxNjYsLjc1KSwgcmdiYSgwLDIwOSwyNTUsLjc1KSk7CiAgICAgIGJveC1zaGFkb3c6IDAgMCAxNHB4IHJnYmEoMCwyMDksMjU1LC4yMiksIDAgMCAxNHB4IHJnYmEoMjU1LDQ2LDE2NiwuMTgpOwogICAgfQoKICAgIC5ncmlkLWJneyBkaXNwbGF5Om5vbmU7IH0KCiAgICAuaGludHsKICAgICAgbWFyZ2luLXRvcDogMTJweDsKICAgICAgY29sb3I6IHZhcigtLW11dGVkMik7CiAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgcGFkZGluZzogMCAycHg7CiAgICB9CgogICAgLmhpZGRlbnsgZGlzcGxheTpub25lICFpbXBvcnRhbnQ7IH0KICA8L3N0eWxlPgoKPHNjcmlwdD4KKGZ1bmN0aW9uKCl7CiAgZnVuY3Rpb24gc2FmZVdyYXAoZm4pewogICAgcmV0dXJuIGZ1bmN0aW9uKCl7CiAgICAgIHRyeXsgcmV0dXJuIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1jYXRjaChlKXsgcmV0dXJuIG51bGw7IH0KICAgIH07CiAgfQogIHRyeXsKICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlID0gc2FmZVdyYXAoaGlzdG9yeS5yZXBsYWNlU3RhdGUpOwogICAgaGlzdG9yeS5wdXNoU3RhdGUgPSBzYWZlV3JhcChoaXN0b3J5LnB1c2hTdGF0ZSk7CiAgfWNhdGNoKGUpe30KfSkoKTsKPC9zY3JpcHQ+Cgo8L2hlYWQ+Cgo8Ym9keT4KICA8ZGl2IGNsYXNzPSJ3cmFwIj4KICAgIDxkaXYgaWQ9ImhvbWVWaWV3Ij4KICAgICAgPGRpdiBjbGFzcz0iaGVhZGVyIj4KICAgICAgICA8ZGl2IGNsYXNzPSJsb2dvIj48L2Rpdj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGgxPk5lb24gQXdhcmRzIEZvcm08L2gxPgogICAgICAgICAgPHAgY2xhc3M9InN1YnRpdGxlIj4KICAgICAgICAgICAgzpTOuc6szrvOtc6+zrUgzqzPhM6/zrzOvy4gzprOrM64zrUgz4POtc67zq/OtM6xIM6tz4fOtc65IDEwIM66zrHPhM63zrPOv8+Bzq/Otc+CIM66zrHOuSDOv865IM6zz4HOsc68zrzOrc+CIM+Az4HOv8+DzrHPgc68z4zOts6/zr3PhM6xzrkgzrHPhc+Ez4zOvM6xz4TOsSAozrHPgM+MIEV4Y2VsIM6uIM+HzrXOuc+Bzr/Ous6vzr3Ot8+EzrEpLgogICAgICAgICAgICDOnM+MzrvOuc+CIM+Fz4DOrM+Bz4fOv8+Fzr0gPHN0cm9uZz7PhM6/z4XOu86sz4fOuc+Dz4TOv869IDI8L3N0cm9uZz4gz4PPhc68z4DOu863z4HPic68zq3Ovc6/zrkgz4TOr8+EzrvOv865IM+DzrUgzrzOuc6xIM66zrHPhM63zrPOv8+Bzq/OsSwgzrXOvc61z4HOs86/z4DOv865zrXOr8+EzrHOuSBkcmFnICYgZHJvcCDOus6xz4TOrM+EzrHOvs63CiAgICAgICAgICAgIM66zrHOuSDOvM+AzrHOr869zrXOuSDOsc+Fz4TPjM68zrHPhM6xIHNjb3JlICgxMuKAkzEpLgogICAgICAgICAgPC9wPgogICAgICAgIDwvZGl2PgogICAgICAgIAo8YnV0dG9uIGNsYXNzPSJhY3Rpb24iIGlkPSJzdGF0c0J0biIgdGl0bGU9Is6jz4XOs866zrXOvc+Ez4HPic+EzrnOus6sIM+Dz4TOsc+EzrnPg8+EzrnOus6sICYgRXhwb3J0IEV4Y2VsIj4KICDwn5OKIEphbWVzIFJpZ2FzCjwvYnV0dG9uPgoKICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSIiPgogICAgICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICAgICAgPGRpdiBjbGFzcz0iZ3JpZDQiIGlkPSJwZW9wbGVHcmlkIj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJncmlkLWJnIj48L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgaWQ9InBlcnNvblZpZXciIGNsYXNzPSJoaWRkZW4iPgogICAgICA8ZGl2IGNsYXNzPSJ0b3BiYXIiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJiYWNrIiBpZD0iYmFja0J0biI+4oaQIM6gzq/Pg8+JPC9idXR0b24+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiIHN0eWxlPSJtYXJnaW46NnB4IDAgMDsiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsb2dvIiBzdHlsZT0id2lkdGg6MzRweDtoZWlnaHQ6MzRweDsiPjwvZGl2PgogICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgIDxoMSBpZD0icGVyc29uVGl0bGUiIHN0eWxlPSJmb250LXNpemU6IGNsYW1wKDI0cHgsIDMuOHZ3LCAzOHB4KTsgbWFyZ2luOjA7Ij48L2gxPgogICAgICAgICAgICAgIDxwIGNsYXNzPSJzdWJ0aXRsZSIgc3R5bGU9Im1hcmdpbi10b3A6NnB4OyI+CiAgICAgICAgICAgICAgICDOo8+FzrzPgM67zq7Pgc+Jz4POtSDPhM65z4IgzrPPgc6xzrzOvM6tz4IuIM6Mz4TOsc69IM+Fz4DOrM+Bz4fOv8+Fzr0gPHN0cm9uZz7PhM6/z4XOu86sz4fOuc+Dz4TOv869IDI8L3N0cm9uZz4gz4PPhc68z4DOu863z4HPic68zq3Ovc6/zrkgz4TOr8+EzrvOv865IM+DzrUgzrzOuc6xIM66zrHPhM63zrPOv8+Bzq/OsSwKICAgICAgICAgICAgICAgIM68z4DOv8+BzrXOr8+CIM69zrEgzrrOrM69zrXOuc+CIGRyYWcgJiBkcm9wIM6zzrnOsSDOus6xz4TOrM+EzrHOvs63IM66zrHOuSDPhM6/IHNjb3JlIM61zr3Ot868zrXPgc+Ozr3Otc+EzrHOuSDOsc+Fz4TPjM68zrHPhM6xICgxzrc9MTIsIDLOtz0xMCwgM863PTgsIDTOtz03LCAuLi4pLgogICAgICAgICAgICAgIDwvcD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJhY3Rpb25zIj4KICAgICAgICAgIDxkaXYgY2xhc3M9InBpbGwiIHRpdGxlPSJBdXRvc2F2ZSDPg861IGxvY2FsU3RvcmFnZSI+CiAgICAgICAgICAgIDxzcGFuPkF1dG9zYXZlOjwvc3Bhbj4gPHN0cm9uZz5PTjwvc3Ryb25nPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJhY3Rpb24iIGlkPSJyZXNldEFsbEJ0biI+UmVzZXQgz4zOu86xPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzcz0iIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImNhdHMiIGlkPSJjYXRlZ29yaWVzIj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJoaW50Ij5UaXA6IM6kzr8gZHJhZyDOtc69zrXPgc6zzr/PgM6/zrnOtc6vz4TOsc65IM6xzr3OrCDOus6xz4TOt86zzr/Pgc6vzrEgz4zPhM6xzr0gz4XPgM6sz4HPh86/z4XOvSDPhM6/z4XOu86sz4fOuc+Dz4TOv869IDIgz4PPhc68z4DOu863z4HPic68zq3Ovc6/zrkgz4TOr8+EzrvOv865LiDOpM6xIHNjb3JlcyDOvM+AzrHOr869zr/Phc69IM68z4zOvc6/IM+Dz4TOuc+CIM+Dz4XOvM+AzrvOt8+Bz4nOvM6tzr3Otc+CIM6zz4HOsc68zrzOrc+CLjwvZGl2PgogICAgPC9kaXY+CiAgPC9kaXY+Cgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS94bHN4QDAuMTguNS9kaXN0L3hsc3guZnVsbC5taW4uanMiPjwvc2NyaXB0Pgo8c2NyaXB0PgooKCkgPT4gewogIGNvbnN0IFBFT1BMRSA9IFsKICAgIHsgbGFiZWw6ICJUZXJpIFZpIFNlbnRpbyIsIHNsdWc6ICJ0ZXJpLXZpLXNlbnRpbyIgfSwKICAgIHsgbGFiZWw6ICJNb25oaWEiLCBzbHVnOiAibW9uaGlhIiB9LAogICAgeyBsYWJlbDogIkxpc2phbnNpIiwgc2x1ZzogImxpc2phbnNpIiB9LAogIF07CgogIGNvbnN0IENBVEVHT1JJRVMgPSBbCiAgICAiQmVzdCBnciBzb25nIiwKICAgICJCZXN0IGZvcmVpZ24gc29uZyIsCiAgICAiQmVzdCBHUiBNYWxlIEFydGlzdCIsCiAgICAiQmVzdCBHUiBGZW1hbGUgQXJ0c2lzIiwKICAgICJCZXN0IEZvcmVpZ24gTWFsZSBBcnRpc3QiLAogICAgIkJlc3QgRm9yZWlnbiBGZW1hbGUgQXJ0aXN0IiwKICAgICJCZXN0IEdSIG11c2ljIFZpZGVvIiwKICAgICJCZXN0IEZvcmVpZ24gTXVzaWMgVmlkZW8iLAogICAgIkJlc3QgRVNDIDIwMjUgcGVyZm9tYW5jZSIsCiAgICAiQmVzdCBBbGJ1bSBvZiB0aGUgWWVhciIsCiAgXTsKCiAgLy8gU2NvcmluZyBmb3IgdXAgdG8gMTAgcmFua2VkIGl0ZW1zIChhcHBsaWVzIHRvIGZpbGxlZCByb3dzIG9ubHkpCiAgY29uc3QgU0NPUkVTID0gWzEyLCAxMCwgOCwgNywgNiwgNSwgNCwgMywgMiwgMV07CgogIGNvbnN0IHFzID0gKHNlbCwgZWw9ZG9jdW1lbnQpID0+IGVsLnF1ZXJ5U2VsZWN0b3Ioc2VsKTsKCiAgY29uc3QgaG9tZVZpZXcgPSBxcygiI2hvbWVWaWV3Iik7CiAgY29uc3QgcGVyc29uVmlldyA9IHFzKCIjcGVyc29uVmlldyIpOwogIGNvbnN0IHBlb3BsZUdyaWQgPSBxcygiI3Blb3BsZUdyaWQiKTsKICBjb25zdCBjYXRlZ29yaWVzRWwgPSBxcygiI2NhdGVnb3JpZXMiKTsKICBjb25zdCBwZXJzb25UaXRsZSA9IHFzKCIjcGVyc29uVGl0bGUiKTsKICBjb25zdCBiYWNrQnRuID0gcXMoIiNiYWNrQnRuIik7CiAgY29uc3QgcmVzZXRBbGxCdG4gPSBxcygiI3Jlc2V0QWxsQnRuIik7CgogIGxldCBjdXJyZW50UGVyc29uID0gbnVsbDsKICBsZXQgc3RhdGUgPSBudWxsOyAvLyB7IFtjYXRlZ29yeV06IFsge2lkLHRleHR9IC4uLiBdIH0KICBsZXQgZHJhZ0N0eCA9IHsgY2F0OiBudWxsLCBkcmFnZ2luZ0lkOiBudWxsIH07CgogIC8vIEV4Y2VsIGltcG9ydCAocGVyIHBlcnNvbikKICBsZXQgcGVuZGluZ0ltcG9ydFBlcnNvbiA9IG51bGw7CgogIGNvbnN0IGV4Y2VsSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogIGV4Y2VsSW5wdXQudHlwZSA9ICJmaWxlIjsKICBleGNlbElucHV0LmFjY2VwdCA9ICIueGxzeCwueGxzIjsKICBleGNlbElucHV0LmNsYXNzTmFtZSA9ICJoaWRkZW4iOwogIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZXhjZWxJbnB1dCk7CgogIGV4Y2VsSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgYXN5bmMgKCkgPT4gewogICAgY29uc3QgZmlsZSA9IGV4Y2VsSW5wdXQuZmlsZXMgJiYgZXhjZWxJbnB1dC5maWxlc1swXTsKICAgIGV4Y2VsSW5wdXQudmFsdWUgPSAiIjsgLy8gcmVzZXQgc28gdGhlIHNhbWUgZmlsZSBjYW4gYmUgcGlja2VkIGFnYWluCiAgICBpZiAoIWZpbGUgfHwgIXBlbmRpbmdJbXBvcnRQZXJzb24pIHJldHVybjsKICAgIHRyeXsKICAgICAgYXdhaXQgaW1wb3J0RXhjZWxGb3JQZXJzb24oZmlsZSwgcGVuZGluZ0ltcG9ydFBlcnNvbik7CiAgICAgIGFsZXJ0KGDOiM6zzrnOvc61IM+Dz4XOs8+Hz4HOv869zrnPg868z4zPgiDOs865zrE6ICR7cGVuZGluZ0ltcG9ydFBlcnNvbi5sYWJlbH1gKTsKICAgIH1jYXRjaChlcnIpewogICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgIGFsZXJ0KCLOkc+Azr/PhM+Fz4fOr86xIM+Dz4XOs8+Hz4HOv869zrnPg868zr/PjS4gzpLOtc6yzrHOuc+Oz4POv8+FIM+Mz4TOuSDPhM6/IEV4Y2VsIM61zq/Ovc6xzrkgz4PPic+Dz4TPjCAoLnhsc3gpIM66zrHOuSDOtM6/zrrOr868zrHPg861IM6+zrHOvc6sLiIpOwogICAgfWZpbmFsbHl7CiAgICAgIHBlbmRpbmdJbXBvcnRQZXJzb24gPSBudWxsOwogICAgfQogIH0pOwoKICBmdW5jdGlvbiBzdGFydEV4Y2VsSW1wb3J0Rm9yKHBlcnNvbil7CiAgICBpZiAodHlwZW9mIFhMU1ggPT09ICJ1bmRlZmluZWQiKXsKICAgICAgYWxlcnQoIs6UzrXOvSDOss+Bzq3OuM63zrrOtSDOtyDOss65zrLOu865zr/OuM6uzrrOtyBYTFNYLiDOiM67zrXOs86+zrUgz4zPhM65IM6tz4fOtc65z4Igz4PPjc69zrTOtc+Dzrcgzq4gz4zPhM65IM+Gzr/Pgc+Ez47Ovc61z4TOsc65IM+Dz4nPg8+Ezqwgz4TOvyB4bHN4LmZ1bGwubWluLmpzLiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBwZW5kaW5nSW1wb3J0UGVyc29uID0gcGVyc29uOwogICAgZXhjZWxJbnB1dC5jbGljaygpOwogIH0KCiAgZnVuY3Rpb24gbm9ybShzKXsKICAgIHJldHVybiBTdHJpbmcocyA/PyAiIikKICAgICAgLnRvTG93ZXJDYXNlKCkKICAgICAgLnJlcGxhY2UoL1tcXHUyMDBCLVxcdTIwMERcXHVGRUZGXS9nLCAiIikKICAgICAgLnJlcGxhY2UoL1teYS16MC05zrEtz4nOrM6tzq7Or8+Mz43Pjs+Kz4vOkM6wXFxzXS9naSwgIiAiKQogICAgICAucmVwbGFjZSgvXFxzKy9nLCAiICIpCiAgICAgIC50cmltKCk7CiAgfQoKICBmdW5jdGlvbiBtYXBFeGNlbENhdGVnb3J5KHJhdyl7CiAgICBjb25zdCBuID0gbm9ybShyYXcpOwoKICAgIGZvciAoY29uc3QgYyBvZiBDQVRFR09SSUVTKXsKICAgICAgaWYgKG5vcm0oYykgPT09IG4pIHJldHVybiBjOwogICAgfQoKICAgIGlmIChuLmluY2x1ZGVzKCJiZXN0IGdyZWVrIHNvbmciKSB8fCBuLmluY2x1ZGVzKCJiZXN0IGdyIHNvbmciKSB8fCAobi5pbmNsdWRlcygizrXOu867zrfOvSIpICYmIG4uaW5jbHVkZXMoIs+Ez4HOsc6zzr/Phc60IikpKQogICAgICByZXR1cm4gIkJlc3QgZ3Igc29uZyI7CiAgICBpZiAobi5pbmNsdWRlcygiYmVzdCBmb3JlaWduIHNvbmciKSB8fCAobi5pbmNsdWRlcygizr7Otc69IikgJiYgbi5pbmNsdWRlcygiz4TPgc6xzrPOv8+FzrQiKSkpCiAgICAgIHJldHVybiAiQmVzdCBmb3JlaWduIHNvbmciOwoKICAgIGlmIChuLmluY2x1ZGVzKCJiZXN0IGdyZWVrIG1hbGUgYXJ0aXN0IikgfHwgbi5pbmNsdWRlcygiYmVzdCBnciBtYWxlIikgfHwgKG4uaW5jbHVkZXMoIs61zrvOu863zr0iKSAmJiBuLmluY2x1ZGVzKCLOsc69zrTPgSIpKSkKICAgICAgcmV0dXJuICJCZXN0IEdSIE1hbGUgQXJ0aXN0IjsKICAgIGlmIChuLmluY2x1ZGVzKCJiZXN0IGdyZWVrIGZlbWFsZSBhcnRpc3QiKSB8fCBuLmluY2x1ZGVzKCJiZXN0IGdyIGZlbWFsZSIpIHx8IChuLmluY2x1ZGVzKCLOtc67zrvOt869IikgJiYgbi5pbmNsdWRlcygizrPPhc69IikpKQogICAgICByZXR1cm4gIkJlc3QgR1IgRmVtYWxlIEFydHNpcyI7CgogICAgaWYgKG4uaW5jbHVkZXMoImJlc3QgZm9yZWlnbiBtYWxlIGFydGlzdCIpIHx8IG4uaW5jbHVkZXMoImJlc3QgZm9yZWlnbiBtYWxlIikgfHwgKG4uaW5jbHVkZXMoIs6+zrXOvSIpICYmIG4uaW5jbHVkZXMoIs6xzr3OtM+BIikpKQogICAgICByZXR1cm4gIkJlc3QgRm9yZWlnbiBNYWxlIEFydGlzdCI7CiAgICBpZiAobi5pbmNsdWRlcygiYmVzdCBmb3JlaWduIGZlbWFsZSBhcnRpc3QiKSB8fCBuLmluY2x1ZGVzKCJiZXN0IGZvcmVpZ24gZmVtYWxlIikgfHwgKG4uaW5jbHVkZXMoIs6+zrXOvSIpICYmIG4uaW5jbHVkZXMoIs6zz4XOvSIpKSkKICAgICAgcmV0dXJuICJCZXN0IEZvcmVpZ24gRmVtYWxlIEFydGlzdCI7CgogICAgaWYgKG4uaW5jbHVkZXMoImJlc3QgZ3JlZWsgbXVzaWMgdmlkZW8iKSB8fCBuLmluY2x1ZGVzKCJiZXN0IGdyIG11c2ljIHZpZGVvIikgfHwgKG4uaW5jbHVkZXMoIs61zrvOu863zr0iKSAmJiBuLmluY2x1ZGVzKCLOss65zr3PhM61IikpKQogICAgICByZXR1cm4gIkJlc3QgR1IgbXVzaWMgVmlkZW8iOwogICAgaWYgKG4uaW5jbHVkZXMoImJlc3QgZm9yZWlnbiBtdXNpYyB2aWRlbyIpIHx8IChuLmluY2x1ZGVzKCLOvs61zr0iKSAmJiBuLmluY2x1ZGVzKCLOss65zr3PhM61IikpKQogICAgICByZXR1cm4gIkJlc3QgRm9yZWlnbiBNdXNpYyBWaWRlbyI7CgogICAgaWYgKG4uaW5jbHVkZXMoImVzYyIpICYmIChuLmluY2x1ZGVzKCJwZXJmb3JtYW5jZSIpIHx8IG4uaW5jbHVkZXMoInBlcmZvbWFuY2UiKSB8fCBuLmluY2x1ZGVzKCJwZXJmIikpKQogICAgICByZXR1cm4gIkJlc3QgRVNDIDIwMjUgcGVyZm9tYW5jZSI7CgogICAgaWYgKG4uaW5jbHVkZXMoImFsYnVtIG9mIHRoZSB5ZWFyIikgfHwgbiA9PT0gImFsYnVtIiB8fCBuLmluY2x1ZGVzKCLOrM67zrzPgCIpKQogICAgICByZXR1cm4gIkJlc3QgQWxidW0gb2YgdGhlIFllYXIiOwoKICAgIHJldHVybiBudWxsOwogIH0KCiAgZnVuY3Rpb24gc3RvcmFnZUtleShzbHVnKXsgcmV0dXJuIGBuZW9uLWF3YXJkczoke3NsdWd9YDsgfQoKICBmdW5jdGlvbiB1dWlkKCkgewogICAgaWYgKHR5cGVvZiBjcnlwdG8gIT09ICJ1bmRlZmluZWQiICYmIGNyeXB0by5yYW5kb21VVUlEKSByZXR1cm4gY3J5cHRvLnJhbmRvbVVVSUQoKTsKICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zbGljZSgyKSArICItIiArIERhdGUubm93KCkudG9TdHJpbmcoMTYpOwogIH0KCiAgZnVuY3Rpb24gbWFrZURlZmF1bHRTdGF0ZSgpewogICAgY29uc3Qgb2JqID0ge307CiAgICBmb3IgKGNvbnN0IGNhdCBvZiBDQVRFR09SSUVTKXsKICAgICAgb2JqW2NhdF0gPSBBcnJheS5mcm9tKHtsZW5ndGg6MTB9LCAoXyxpKSA9PiAoeyBpZDogYCR7Y2F0fV9fJHtpfV9fJHt1dWlkKCl9YCwgdGV4dDogIiIgfSkpOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CgogIGZ1bmN0aW9uIGVuc3VyZUNhdGVnb3J5TGVuZ3RoKHN0LCBjYXQsIGxlbil7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoc3RbY2F0XSkgfHwgc3RbY2F0XS5sZW5ndGggPCAxKXsKICAgICAgc3RbY2F0XSA9IEFycmF5LmZyb20oe2xlbmd0aDoxMH0sIChfLGkpID0+ICh7IGlkOiBgJHtjYXR9X18ke2l9X18ke3V1aWQoKX1gLCB0ZXh0OiAiIiB9KSk7CiAgICB9CiAgICBjb25zdCBjdXIgPSBzdFtjYXRdLmxlbmd0aDsKCiAgICBpZiAobGVuID4gY3VyKXsKICAgICAgZm9yIChsZXQgaT1jdXI7IGk8bGVuOyBpKyspewogICAgICAgIHN0W2NhdF0ucHVzaCh7IGlkOiBgJHtjYXR9X18ke2l9X18ke3V1aWQoKX1gLCB0ZXh0OiAiIiB9KTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKGxlbiA8IGN1cil7CiAgICAgIGNvbnN0IHRhaWxIYXNUZXh0ID0gc3RbY2F0XS5zbGljZShsZW4pLnNvbWUociA9PiAoci50ZXh0IHx8ICIiKS50cmltKCkubGVuZ3RoID4gMCk7CiAgICAgIGlmICghdGFpbEhhc1RleHQpewogICAgICAgIHN0W2NhdF0gPSBzdFtjYXRdLnNsaWNlKDAsIGxlbik7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGxvYWRTdGF0ZShzbHVnKXsKICAgIHRyeXsKICAgICAgY29uc3QgcmF3ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oc3RvcmFnZUtleShzbHVnKSk7CiAgICAgIGlmICghcmF3KSByZXR1cm4gbWFrZURlZmF1bHRTdGF0ZSgpOwogICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHJhdyk7CgogICAgICBmb3IgKGNvbnN0IGNhdCBvZiBDQVRFR09SSUVTKXsKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGFyc2VkPy5bY2F0XSkgfHwgcGFyc2VkW2NhdF0ubGVuZ3RoIDwgMSl7CiAgICAgICAgICBwYXJzZWRbY2F0XSA9IEFycmF5LmZyb20oe2xlbmd0aDoxMH0sIChfLGkpID0+ICh7IGlkOiBgJHtjYXR9X18ke2l9X18ke3V1aWQoKX1gLCB0ZXh0OiAiIiB9KSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgcGFyc2VkW2NhdF0gPSBwYXJzZWRbY2F0XS5tYXAoKHIsaSkgPT4gKHsKICAgICAgICAgIGlkOiBTdHJpbmcocj8uaWQgfHwgYCR7Y2F0fV9fJHtpfV9fJHt1dWlkKCl9YCksCiAgICAgICAgICB0ZXh0OiBTdHJpbmcocj8udGV4dCA/PyAiIikKICAgICAgICB9KSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHBhcnNlZDsKICAgIH1jYXRjaHsKICAgICAgcmV0dXJuIG1ha2VEZWZhdWx0U3RhdGUoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHNhdmVTdGF0ZSgpewogICAgdHJ5ewogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzdG9yYWdlS2V5KGN1cnJlbnRQZXJzb24uc2x1ZyksIEpTT04uc3RyaW5naWZ5KHN0YXRlKSk7CiAgICB9Y2F0Y2h7fQogIH0KCiAgZnVuY3Rpb24gaGFzVGV4dFJvdyhyKXsKICAgIHJldHVybiAoci50ZXh0IHx8ICIiKS50cmltKCkubGVuZ3RoID4gMDsKICB9CgogIGZ1bmN0aW9uIGZpbGxlZENvdW50KGNhdCl7CiAgICByZXR1cm4gc3RhdGVbY2F0XS5maWx0ZXIoaGFzVGV4dFJvdykubGVuZ3RoOwogIH0KCiAgLy8g4pyFIERyYWcgJiBkcm9wICsgcmFua2luZyBhY3RpdmF0ZSB3aXRoIGF0IGxlYXN0IDIgZmlsbGVkIHJvd3MKICBmdW5jdGlvbiBpc0RyYWdFbmFibGVkKGNhdCl7CiAgICByZXR1cm4gZmlsbGVkQ291bnQoY2F0KSA+PSAyOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gaW1wb3J0RXhjZWxGb3JQZXJzb24oZmlsZSwgcGVyc29uKXsKICAgIGNvbnN0IGJ1ZiA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTsKICAgIGNvbnN0IHdiID0gWExTWC5yZWFkKGJ1ZiwgeyB0eXBlOiAiYXJyYXkiIH0pOwogICAgY29uc3Qgc2hlZXROYW1lID0gd2IuU2hlZXROYW1lcz8uWzBdOwogICAgaWYgKCFzaGVldE5hbWUpIHRocm93IG5ldyBFcnJvcigiTm8gc2hlZXRzIik7CiAgICBjb25zdCB3cyA9IHdiLlNoZWV0c1tzaGVldE5hbWVdOwoKICAgIGNvbnN0IHJvd3MgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24od3MsIHsgaGVhZGVyOiAxLCByYXc6IGZhbHNlLCBkZWZ2YWw6ICIiIH0pOwogICAgaWYgKCFyb3dzIHx8IHJvd3MubGVuZ3RoIDwgMikgdGhyb3cgbmV3IEVycm9yKCJFbXB0eSBzaGVldCIpOwoKICAgIGNvbnN0IGhlYWRlciA9IHJvd3NbMF0ubWFwKHggPT4gU3RyaW5nKHggPz8gIiIpKTsKICAgIGNvbnN0IGhlYWRlck4gPSBoZWFkZXIubWFwKG5vcm0pOwoKICAgIGxldCBjYXRJZHggPSBoZWFkZXJOLmZpbmRJbmRleChoID0+IGggPT09ICLOus6xz4TOt86zzr/Pgc6vzrEiIHx8IGggPT09ICJjYXRlZ29yeSIpOwogICAgbGV0IHBvc0lkeCA9IGhlYWRlck4uZmluZEluZGV4KGggPT4gaCA9PT0gIs64zq3Pg863IiB8fCBoID09PSAizrjOtc+DzrciIHx8IGggPT09ICJwb3NpdGlvbiIgfHwgaCA9PT0gInJhbmsiKTsKICAgIGlmIChjYXRJZHggPCAwKSBjYXRJZHggPSAwOwogICAgaWYgKHBvc0lkeCA8IDApIHBvc0lkeCA9IDE7CgogICAgbGV0IHBlcnNvbklkeCA9IC0xOwogICAgY29uc3QgbGFiZWxOID0gbm9ybShwZXJzb24ubGFiZWwpOwogICAgZm9yIChsZXQgaT0wO2k8aGVhZGVyTi5sZW5ndGg7aSsrKXsKICAgICAgaWYgKGhlYWRlck5baV0gPT09IGxhYmVsTikgeyBwZXJzb25JZHggPSBpOyBicmVhazsgfQogICAgfQogICAgaWYgKHBlcnNvbklkeCA8IDApewogICAgICBpZiAoaGVhZGVyLmxlbmd0aCA9PT0gMykgcGVyc29uSWR4ID0gMjsKICAgICAgZWxzZSBwZXJzb25JZHggPSBNYXRoLm1heChwb3NJZHggKyAxLCAyKTsKICAgIH0KCiAgICBjb25zdCBpbXBvcnRlZFN0YXRlID0gbG9hZFN0YXRlKHBlcnNvbi5zbHVnKTsKCiAgICBsZXQgY3VycmVudENhdFJhdyA9ICIiOwogICAgZm9yIChsZXQgciA9IDE7IHIgPCByb3dzLmxlbmd0aDsgcisrKXsKICAgICAgY29uc3Qgcm93ID0gcm93c1tyXTsKICAgICAgY29uc3QgY2F0Q2VsbCA9IHJvd1tjYXRJZHhdOwogICAgICBpZiAoU3RyaW5nKGNhdENlbGwgPz8gIiIpLnRyaW0oKS5sZW5ndGggPiAwKXsKICAgICAgICBjdXJyZW50Q2F0UmF3ID0gU3RyaW5nKGNhdENlbGwpLnRyaW0oKTsKICAgICAgfQogICAgICBjb25zdCBtYXBwZWRDYXQgPSBtYXBFeGNlbENhdGVnb3J5KGN1cnJlbnRDYXRSYXcpOwogICAgICBpZiAoIW1hcHBlZENhdCkgY29udGludWU7CgogICAgICBjb25zdCBwb3MgPSBOdW1iZXIocm93W3Bvc0lkeF0pOwogICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZShwb3MpIHx8IHBvcyA8IDEpIGNvbnRpbnVlOwoKICAgICAgZW5zdXJlQ2F0ZWdvcnlMZW5ndGgoaW1wb3J0ZWRTdGF0ZSwgbWFwcGVkQ2F0LCBNYXRoLm1heChpbXBvcnRlZFN0YXRlW21hcHBlZENhdF0ubGVuZ3RoLCBwb3MpKTsKCiAgICAgIGNvbnN0IHZhbHVlID0gU3RyaW5nKHJvd1twZXJzb25JZHhdID8/ICIiKS50cmltKCk7CiAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAwKXsKICAgICAgICBpbXBvcnRlZFN0YXRlW21hcHBlZENhdF1bcG9zLTFdLnRleHQgPSB2YWx1ZTsKICAgICAgfQogICAgfQoKICAgIHRyeXsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oc3RvcmFnZUtleShwZXJzb24uc2x1ZyksIEpTT04uc3RyaW5naWZ5KGltcG9ydGVkU3RhdGUpKTsKICAgIH1jYXRjaHt9CgogICAgaWYgKGN1cnJlbnRQZXJzb24/LnNsdWcgPT09IHBlcnNvbi5zbHVnKXsKICAgICAgc3RhdGUgPSBpbXBvcnRlZFN0YXRlOwogICAgICByZW5kZXJDYXRlZ29yaWVzKCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzaG93SG9tZSgpewogICAgY3VycmVudFBlcnNvbiA9IG51bGw7CiAgICBzdGF0ZSA9IG51bGw7CiAgICBwZXJzb25WaWV3LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgaG9tZVZpZXcuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShudWxsLCAiIiwgbG9jYXRpb24ucGF0aG5hbWUgKyBsb2NhdGlvbi5zZWFyY2ggKyAiIy8iKTsKICB9CgogIGZ1bmN0aW9uIHNob3dQZXJzb24oc2x1Zyl7CiAgICBjb25zdCBwID0gUEVPUExFLmZpbmQoeCA9PiB4LnNsdWcgPT09IHNsdWcpOwogICAgaWYgKCFwKSByZXR1cm4gc2hvd0hvbWUoKTsKICAgIGN1cnJlbnRQZXJzb24gPSBwOwogICAgc3RhdGUgPSBsb2FkU3RhdGUoc2x1Zyk7CiAgICBob21lVmlldy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgIHBlcnNvblZpZXcuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgICBwZXJzb25UaXRsZS50ZXh0Q29udGVudCA9IHAubGFiZWw7CiAgICByZW5kZXJDYXRlZ29yaWVzKCk7CiAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShudWxsLCAiIiwgbG9jYXRpb24ucGF0aG5hbWUgKyBsb2NhdGlvbi5zZWFyY2ggKyAiIy8iICsgc2x1Zyk7CiAgfQoKICBmdW5jdGlvbiByZW5kZXJIb21lQnV0dG9ucygpewogICAgcGVvcGxlR3JpZC5pbm5lckhUTUwgPSAiIjsKCiAgICBmb3IgKGNvbnN0IHAgb2YgUEVPUExFKXsKICAgICAgY29uc3QgdGlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICB0aWxlLmNsYXNzTmFtZSA9ICJwZXJzb24tdGlsZSI7CgogICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgYnRuLmNsYXNzTmFtZSA9ICJwZXJzb24tYnRuIjsKICAgICAgYnRuLnR5cGUgPSAiYnV0dG9uIjsKICAgICAgYnRuLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJwZXJzb24tdGl0bGUiPiR7ZXNjYXBlSHRtbChwLmxhYmVsKX08L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJwZXJzb24tc3ViIj7Ohs69zr/Ouc6zzrzOsSDPg861zrvOr860zrHPgjwvZGl2PgogICAgICBgOwogICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgY29uc3QgUElOUyA9IHsKICAgICAgICAgICJ0ZXJpLXZpLXNlbnRpbyI6ICIxNDc4IiwKICAgICAgICAgICJtb25oaWEiOiAiOTYzMiIsCiAgICAgICAgICAibGlzamFuc2kiOiAiMjM2NSIKICAgICAgICB9OwogICAgICAgIGNvbnN0IGV4cGVjdGVkID0gUElOU1twLnNsdWddOwogICAgICAgIGlmIChleHBlY3RlZCl7CiAgICAgICAgICBjb25zdCBwaW4gPSBwcm9tcHQoIs6VzrnPg86szrPOtc+EzrUgUElOIM6zzrnOsSDPgM+Bz4zPg86yzrHPg863OiIpOwogICAgICAgICAgaWYgKHBpbiAhPT0gZXhwZWN0ZWQpewogICAgICAgICAgICBhbGVydCgizpvOrM64zr/PgiBQSU4uIM6UzrXOvSDOtc+AzrnPhM+Bzq3PgM61z4TOsc65IM63IM+Az4HPjM+DzrLOsc+DzrcuIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc2hvd1BlcnNvbihwLnNsdWcpOwogICAgICB9KTtjb25zdCBzeW5jID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICAgIHN5bmMuY2xhc3NOYW1lID0gInN5bmMtbWluaSI7CiAgICAgIHN5bmMudHlwZSA9ICJidXR0b24iOwogICAgICBzeW5jLnRpdGxlID0gIs6jz4XOs8+Hz4HOv869zrnPg868z4zPgiDOsc+Az4wgRXhjZWwgKC54bHN4KSI7CiAgICAgIHN5bmMudGV4dENvbnRlbnQgPSAi4p+zIEV4Y2VsIjsKICAgICAgc3luYy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIChlKSA9PiB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgc3RhcnRFeGNlbEltcG9ydEZvcihwKTsKICAgICAgfSk7CgogICAgICB0aWxlLmFwcGVuZENoaWxkKGJ0bik7CiAgICAgIHRpbGUuYXBwZW5kQ2hpbGQoc3luYyk7CiAgICAgIHBlb3BsZUdyaWQuYXBwZW5kQ2hpbGQodGlsZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiByZW5kZXJDYXRlZ29yaWVzKCl7CiAgICBjYXRlZ29yaWVzRWwuaW5uZXJIVE1MID0gIiI7CgogICAgZm9yIChjb25zdCBjYXQgb2YgQ0FURUdPUklFUyl7CiAgICAgIGNvbnN0IGNvdW50ID0gZmlsbGVkQ291bnQoY2F0KTsKICAgICAgY29uc3QgZHJhZ09uID0gaXNEcmFnRW5hYmxlZChjYXQpOwoKICAgICAgc3RhdGVbY2F0XSA9IFsuLi5zdGF0ZVtjYXRdLmZpbHRlcihoYXNUZXh0Um93KSwgLi4uc3RhdGVbY2F0XS5maWx0ZXIociA9PiAhaGFzVGV4dFJvdyhyKSldOwoKICAgICAgY29uc3QgY2F0Q2FyZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBjYXRDYXJkLmNsYXNzTmFtZSA9ICJjYXQiOwogICAgICBjYXRDYXJkLmRhdGFzZXQuY2F0ID0gY2F0OwoKICAgICAgY29uc3QgaGVhZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBoZWFkLmNsYXNzTmFtZSA9ICJjYXQtaGVhZCI7CiAgICAgIGhlYWQuaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXY+CiAgICAgICAgICA8aDI+JHtlc2NhcGVIdG1sKGNhdCl9PC9oMj4KICAgICAgICAgIDxkaXYgY2xhc3M9InN0YXR1cyAke2RyYWdPbiA/ICJvbiIgOiAiIn0iPgogICAgICAgICAgICAke2RyYWdPbiA/IGBEcmFnICYgZHJvcDogT04gKCR7Y291bnR9IM+Ezq/PhM67zr/OuSlgIDogYERyYWcgJiBkcm9wOiBPRkYgKM6yzqzOu861IM+Ezr/Phc67zqzPh865z4PPhM6/zr0gMiDPhM6vz4TOu86/z4XPgiDigJQgz4TPjs+BzrEgzq3Ph861zrkgJHtjb3VudH0pYH0KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICBgOwoKICAgICAgY29uc3QgY2xlYXJCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgY2xlYXJCdG4uY2xhc3NOYW1lID0gIm1pbmkiOwogICAgICBjbGVhckJ0bi50eXBlID0gImJ1dHRvbiI7CiAgICAgIGNsZWFyQnRuLnRleHRDb250ZW50ID0gIkNsZWFyIjsKICAgICAgY2xlYXJCdG4udGl0bGUgPSAizprOsc64zqzPgc65z4POvM6xIM68z4zOvc6/IM6xz4XPhM6uz4Igz4TOt8+CIM66zrHPhM63zrPOv8+Bzq/Osc+CIjsKICAgICAgY2xlYXJCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgc3RhdGVbY2F0XSA9IHN0YXRlW2NhdF0ubWFwKHIgPT4gKHsuLi5yLCB0ZXh0OiIifSkpOwogICAgICAgIHNhdmVTdGF0ZSgpOwogICAgICAgIHJlbmRlckNhdGVnb3JpZXMoKTsKICAgICAgfSk7CiAgICAgIGhlYWQuYXBwZW5kQ2hpbGQoY2xlYXJCdG4pOwoKICAgICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBsaXN0LmNsYXNzTmFtZSA9ICJsaXN0IjsKICAgICAgbGlzdC5kYXRhc2V0LmNhdCA9IGNhdDsKCiAgICAgIHN0YXRlW2NhdF0uZm9yRWFjaCgocm93LCBpZHgpID0+IHsKICAgICAgICBjb25zdCByb3dFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIGNvbnN0IHJvd0ZpbGxlZCA9IGhhc1RleHRSb3cocm93KTsKICAgICAgICByb3dFbC5jbGFzc05hbWUgPSAicm93IiArIChkcmFnT24gPyAiIGRyYWctZW5hYmxlZCIgOiAiIik7CiAgICAgICAgcm93RWwuZGF0YXNldC5pZCA9IHJvdy5pZDsKICAgICAgICByb3dFbC5kcmFnZ2FibGUgPSBkcmFnT24gJiYgcm93RmlsbGVkOwoKICAgICAgICBjb25zdCBoYW5kbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBoYW5kbGUuY2xhc3NOYW1lID0gImhhbmRsZSIgKyAoZHJhZ09uICYmIHJvd0ZpbGxlZCA/ICIiIDogIiBvZmYiKTsKICAgICAgICBoYW5kbGUudGV4dENvbnRlbnQgPSAi4piwIjsKICAgICAgICBoYW5kbGUudGl0bGUgPSAoZHJhZ09uICYmIHJvd0ZpbGxlZCkKICAgICAgICAgID8gIkRyYWciCiAgICAgICAgICA6ICLOp8+BzrXOuc6szrbOv869z4TOsc65IM+Ezr/Phc67zqzPh865z4PPhM6/zr0gMiDPg8+FzrzPgM67zrfPgc+JzrzOrc69zr/OuSDPhM6vz4TOu86/zrkgKM66zrHOuSDPhM6/IM+Dz4XOs866zrXOus+BzrnOvM6tzr3OvyDPgM61zrTOr86/IM69zrEgzrXOr869zrHOuSDPg8+FzrzPgM67zrfPgc+JzrzOrc69zr8pIjsKCiAgICAgICAgY29uc3QgbnVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgbnVtLmNsYXNzTmFtZSA9ICJudW0iOwogICAgICAgIG51bS50ZXh0Q29udGVudCA9IFN0cmluZyhpZHggKyAxKTsKCiAgICAgICAgY29uc3Qgc2NvcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBzY29yZS5jbGFzc05hbWUgPSAic2NvcmUiOwogICAgICAgIGNvbnN0IGJhZGdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgYmFkZ2UuY2xhc3NOYW1lID0gImJhZGdlIjsKICAgICAgICBiYWRnZS50ZXh0Q29udGVudCA9IHJvd0ZpbGxlZCA/IFN0cmluZygoU0NPUkVTW2lkeF0gPz8gMCkpIDogIiI7CiAgICAgICAgc2NvcmUuYXBwZW5kQ2hpbGQoYmFkZ2UpOwoKICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICAgICAgaW5wdXQuY2xhc3NOYW1lID0gInRleHQiOwogICAgICAgIGlucHV0LnR5cGUgPSAidGV4dCI7CiAgICAgICAgaW5wdXQucGxhY2Vob2xkZXIgPSAizpPPgc6sz4jOtSDOtc60z44uLi4iOwogICAgICAgIGlucHV0LnZhbHVlID0gcm93LnRleHQgfHwgIiI7CiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAoZSkgPT4gewogICAgICAgICAgcm93LnRleHQgPSBlLnRhcmdldC52YWx1ZTsKICAgICAgICAgIHNhdmVTdGF0ZSgpOwogICAgICAgICAgcmVuZGVyQ2F0ZWdvcmllcygpOwogICAgICAgIH0pOwoKICAgICAgICByb3dFbC5hZGRFdmVudExpc3RlbmVyKCJkcmFnc3RhcnQiLCAoZSkgPT4gewogICAgICAgICAgaWYgKCFpc0RyYWdFbmFibGVkKGNhdCkgfHwgIWhhc1RleHRSb3cocm93KSkgeyBlLnByZXZlbnREZWZhdWx0KCk7IHJldHVybjsgfQogICAgICAgICAgZHJhZ0N0eC5jYXQgPSBjYXQ7CiAgICAgICAgICBkcmFnQ3R4LmRyYWdnaW5nSWQgPSByb3cuaWQ7CiAgICAgICAgICByb3dFbC5jbGFzc0xpc3QuYWRkKCJkcmFnZ2luZyIpOwogICAgICAgICAgZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICJtb3ZlIjsKICAgICAgICAgIGUuZGF0YVRyYW5zZmVyLnNldERhdGEoInRleHQvcGxhaW4iLCByb3cuaWQpOwogICAgICAgIH0pOwoKICAgICAgICByb3dFbC5hZGRFdmVudExpc3RlbmVyKCJkcmFnZW5kIiwgKCkgPT4gewogICAgICAgICAgcm93RWwuY2xhc3NMaXN0LnJlbW92ZSgiZHJhZ2dpbmciKTsKICAgICAgICAgIGRyYWdDdHguY2F0ID0gbnVsbDsKICAgICAgICAgIGRyYWdDdHguZHJhZ2dpbmdJZCA9IG51bGw7CiAgICAgICAgfSk7CgogICAgICAgIHJvd0VsLmFkZEV2ZW50TGlzdGVuZXIoImRyYWdvdmVyIiwgKGUpID0+IHsKICAgICAgICAgIGlmICghaXNEcmFnRW5hYmxlZChjYXQpKSByZXR1cm47CiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gIm1vdmUiOwogICAgICAgIH0pOwoKICAgICAgICByb3dFbC5hZGRFdmVudExpc3RlbmVyKCJkcm9wIiwgKGUpID0+IHsKICAgICAgICAgIGlmICghaXNEcmFnRW5hYmxlZChjYXQpKSByZXR1cm47CiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgY29uc3QgZnJvbUlkID0gZS5kYXRhVHJhbnNmZXIuZ2V0RGF0YSgidGV4dC9wbGFpbiIpOwogICAgICAgICAgY29uc3QgdG9JZCA9IHJvdy5pZDsKICAgICAgICAgIGlmICghZnJvbUlkIHx8IGZyb21JZCA9PT0gdG9JZCkgcmV0dXJuOwogICAgICAgICAgaWYgKGRyYWdDdHguY2F0ICE9PSBjYXQpIHJldHVybjsKCiAgICAgICAgICBjb25zdCB0b1JvdyA9IHN0YXRlW2NhdF0uZmluZCh4ID0+IHguaWQgPT09IHRvSWQpOwogICAgICAgICAgaWYgKCF0b1JvdyB8fCAhaGFzVGV4dFJvdyh0b1JvdykpIHJldHVybjsKCiAgICAgICAgICBjb25zdCBhcnIgPSBzdGF0ZVtjYXRdOwogICAgICAgICAgY29uc3QgZnJvbUlkeCA9IGFyci5maW5kSW5kZXgoeCA9PiB4LmlkID09PSBmcm9tSWQpOwogICAgICAgICAgY29uc3QgdG9JZHggPSBhcnIuZmluZEluZGV4KHggPT4geC5pZCA9PT0gdG9JZCk7CiAgICAgICAgICBpZiAoZnJvbUlkeCA8IDAgfHwgdG9JZHggPCAwKSByZXR1cm47CgogICAgICAgICAgY29uc3QgW2l0ZW1dID0gYXJyLnNwbGljZShmcm9tSWR4LCAxKTsKICAgICAgICAgIGFyci5zcGxpY2UodG9JZHgsIDAsIGl0ZW0pOwoKICAgICAgICAgIHNhdmVTdGF0ZSgpOwogICAgICAgICAgcmVuZGVyQ2F0ZWdvcmllcygpOwogICAgICAgIH0pOwoKICAgICAgICByb3dFbC5hcHBlbmRDaGlsZChoYW5kbGUpOwogICAgICAgIHJvd0VsLmFwcGVuZENoaWxkKG51bSk7CiAgICAgICAgcm93RWwuYXBwZW5kQ2hpbGQoaW5wdXQpOwogICAgICAgIHJvd0VsLmFwcGVuZENoaWxkKHNjb3JlKTsKICAgICAgICBsaXN0LmFwcGVuZENoaWxkKHJvd0VsKTsKICAgICAgfSk7CgogICAgICBjYXRDYXJkLmFwcGVuZENoaWxkKGhlYWQpOwogICAgICBjYXRDYXJkLmFwcGVuZENoaWxkKGxpc3QpOwogICAgICBjYXRlZ29yaWVzRWwuYXBwZW5kQ2hpbGQoY2F0Q2FyZCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBlc2NhcGVIdG1sKHN0cil7CiAgICByZXR1cm4gU3RyaW5nKHN0cikKICAgICAgLnJlcGxhY2VBbGwoIiYiLCImYW1wOyIpCiAgICAgIC5yZXBsYWNlQWxsKCI8IiwiJmx0OyIpCiAgICAgIC5yZXBsYWNlQWxsKCI+IiwiJmd0OyIpCiAgICAgIC5yZXBsYWNlQWxsKCciJywiJnF1b3Q7IikKICAgICAgLnJlcGxhY2VBbGwoIiciLCImIzAzOTsiKTsKICB9CgogIGJhY2tCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBzaG93SG9tZSk7CgogIHJlc2V0QWxsQnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgaWYgKCFjdXJyZW50UGVyc29uKSByZXR1cm47CiAgICBzdGF0ZSA9IG1ha2VEZWZhdWx0U3RhdGUoKTsKICAgIHNhdmVTdGF0ZSgpOwogICAgcmVuZGVyQ2F0ZWdvcmllcygpOwogIH0pOwoKICBmdW5jdGlvbiByb3V0ZSgpewogICAgY29uc3QgaCA9IGxvY2F0aW9uLmhhc2ggfHwgIiMvIjsKICAgIGNvbnN0IHBhcnRzID0gaC5yZXBsYWNlKC9eI1wvPy8sICIiKS5zcGxpdCgiLyIpLmZpbHRlcihCb29sZWFuKTsKICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDApIHNob3dIb21lKCk7CiAgICBlbHNlIHNob3dQZXJzb24ocGFydHNbMF0pOwogIH0KCiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImhhc2hjaGFuZ2UiLCByb3V0ZSk7CgogIHJlbmRlckhvbWVCdXR0b25zKCk7CiAgcm91dGUoKTsKCiAgLy8gPT09PT0gSmFtZXMgUmlnYXM6IFN0YXRpc3RpY3MgJiBFeGNlbCBFeHBvcnQgPT09PT0KICBjb25zdCBzdGF0c0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzdGF0c0J0biIpOwoKICBmdW5jdGlvbiBjb2xsZWN0U3RhdGlzdGljcygpewogICAgY29uc3QgcmVzdWx0cyA9IFtdOwogICAgZm9yIChjb25zdCBwIG9mIFBFT1BMRSl7CiAgICAgIGNvbnN0IHN0ID0gbG9hZFN0YXRlKHAuc2x1Zyk7CiAgICAgIGZvciAoY29uc3QgY2F0IG9mIENBVEVHT1JJRVMpewogICAgICAgIGNvbnN0IHJvd3MgPSBzdFtjYXRdIHx8IFtdOwogICAgICAgIHJvd3MuZm9yRWFjaCgociwgaWR4KSA9PiB7CiAgICAgICAgICBpZiAoKHIudGV4dCB8fCAiIikudHJpbSgpLmxlbmd0aCA+IDApewogICAgICAgICAgICByZXN1bHRzLnB1c2goewogICAgICAgICAgICAgIHBlcnNvbjogcC5sYWJlbCwKICAgICAgICAgICAgICBjYXRlZ29yeTogY2F0LAogICAgICAgICAgICAgIHJhbms6IGlkeCArIDEsCiAgICAgICAgICAgICAgc2NvcmU6IFNDT1JFU1tpZHhdID8/IDAsCiAgICAgICAgICAgICAgdmFsdWU6IHIudGV4dAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBleHBvcnRTdGF0c1RvRXhjZWwoKXsKICAgIGNvbnN0IHBpbiA9IHByb21wdCgizpXOuc+DzqzOs861z4TOtSDPhM6/zr0gzrrPic60zrnOus+MIM6zzrnOsSDOtc6+zrHOs8+JzrPOriBFeGNlbDoiKTsKICAgIGlmIChwaW4gIT09ICI3NDU2Iil7CiAgICAgIGFsZXJ0KCLOm86szrjOv8+CIM66z4nOtM65zrrPjM+CLiDOlyDOtc6+zrHOs8+JzrPOriDOsc66z4XPgc+OzrjOt866zrUuIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBkYXRhID0gY29sbGVjdFN0YXRpc3RpY3MoKTsKICAgIGlmICghZGF0YS5sZW5ndGgpewogICAgICBhbGVydCgizpTOtc69IM+Fz4DOrM+Bz4fOv8+Fzr0gzrTOtc60zr/OvM6tzr3OsSDOs865zrEgzrXOvs6xzrPPic6zzq4uIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCB3c0RhdGEgPSBbCiAgICAgIFsiUGVyc29uIiwgIkNhdGVnb3J5IiwgIlJhbmsiLCAiU2NvcmUiLCAiQW5zd2VyIl0KICAgIF07CiAgICBkYXRhLmZvckVhY2goZCA9PiB7CiAgICAgIHdzRGF0YS5wdXNoKFtkLnBlcnNvbiwgZC5jYXRlZ29yeSwgZC5yYW5rLCBkLnNjb3JlLCBkLnZhbHVlXSk7CiAgICB9KTsKCiAgICBjb25zdCB3cyA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KHdzRGF0YSk7CiAgICBjb25zdCB3YiA9IFhMU1gudXRpbHMuYm9va19uZXcoKTsKICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2IsIHdzLCAiU3RhdGlzdGljcyIpOwoKICAgIFhMU1gud3JpdGVGaWxlKHdiLCAiSmFtZXNfUmlnYXNfU3RhdGlzdGljcy54bHN4Iik7CiAgfQoKICBpZiAoc3RhdHNCdG4pewogICAgc3RhdHNCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBleHBvcnRTdGF0c1RvRXhjZWwpOwogIH0KCgogIC8vIEV4cG9zZSBpbnRlcm5hbHMgZm9yIGNvbXBhdGliaWxpdHkgKGZpbGU6Ly8gLyBpZnJhbWUgd3JhcHBlcnMpCiAgdHJ5ewogICAgd2luZG93LlBFT1BMRSA9IFBFT1BMRTsKICAgIHdpbmRvdy5DQVRFR09SSUVTID0gQ0FURUdPUklFUzsKICAgIHdpbmRvdy5sb2FkU3RhdGUgPSBsb2FkU3RhdGU7CiAgICB3aW5kb3cuc2F2ZVN0YXRlID0gc2F2ZVN0YXRlOwogIH1jYXRjaChlKXt9Cn0pKCk7Cjwvc2NyaXB0PgoKPHNjcmlwdD4KLy8gPT09PT0gSmFtZXMgUmlnYXM6IFBlci1wZXJzb24gUElOIEV4cG9ydCA9PT09PQpjb25zdCBQRVJTT05fUElOUyA9IHsKICAidGVyaS12aS1zZW50aW8iOiAiMTQ3OCIsCiAgIm1vbmhpYSI6ICI5NjMyIiwKICAibGlzamFuc2kiOiAiMjM2NSIKfTsKCmZ1bmN0aW9uIGV4cG9ydFN0YXRzVG9FeGNlbCgpewogIGNvbnN0IHBlcnNvblNsdWcgPSBwcm9tcHQoCiAgICAizqDOu863zrrPhM+Bzr/Ou8+MzrPOt8+DzrUgzqzPhM6/zrzOvyDOs865zrEgZXhwb3J0OlxuIiArCiAgICAidGVyaS12aS1zZW50aW9cbm1vbmhpYVxubGlzamFuc2kiCiAgKTsKCiAgaWYgKCFwZXJzb25TbHVnIHx8ICFQRVJTT05fUElOU1twZXJzb25TbHVnXSl7CiAgICBhbGVydCgizpzOtyDOrc6zzrrPhc+Bzr8gzqzPhM6/zrzOvy4gzpcgzrXOvs6xzrPPic6zzq4gzrHOus+Fz4HPjs64zrfOus61LiIpOwogICAgcmV0dXJuOwogIH0KCiAgY29uc3QgcGluID0gcHJvbXB0KCLOlc65z4POrM6zzrXPhM61IFBJTjoiKTsKICBpZiAocGluICE9PSBQRVJTT05fUElOU1twZXJzb25TbHVnXSl7CiAgICBhbGVydCgizpvOrM64zr/PgiBQSU4uIM6XIM61zr7Osc6zz4nOs86uIM6xzrrPhc+Bz47OuM63zrrOtS4iKTsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHN0ID0gbG9hZFN0YXRlKHBlcnNvblNsdWcpOwogIGNvbnN0IHBlcnNvbiA9IFBFT1BMRS5maW5kKHAgPT4gcC5zbHVnID09PSBwZXJzb25TbHVnKTsKCiAgY29uc3Qgcm93c091dCA9IFtdOwogIGZvciAoY29uc3QgY2F0IG9mIENBVEVHT1JJRVMpewogICAgY29uc3Qgcm93cyA9IHN0W2NhdF0gfHwgW107CiAgICByb3dzLmZvckVhY2goKHIsIGlkeCkgPT4gewogICAgICBpZiAoKHIudGV4dCB8fCAiIikudHJpbSgpLmxlbmd0aCA+IDApewogICAgICAgIHJvd3NPdXQucHVzaChbCiAgICAgICAgICBwZXJzb24ubGFiZWwsCiAgICAgICAgICBjYXQsCiAgICAgICAgICBpZHggKyAxLAogICAgICAgICAgU0NPUkVTW2lkeF0gPz8gMCwKICAgICAgICAgIHIudGV4dAogICAgICAgIF0pOwogICAgICB9CiAgICB9KTsKICB9CgogIGlmICghcm93c091dC5sZW5ndGgpewogICAgYWxlcnQoIs6UzrXOvSDPhc+AzqzPgc+Hzr/Phc69IM60zrXOtM6/zrzOrc69zrEgzrPOuc6xIM61zr7Osc6zz4nOs86uLiIpOwogICAgcmV0dXJuOwogIH0KCiAgY29uc3Qgd3NEYXRhID0gWwogICAgWyJQZXJzb24iLCAiQ2F0ZWdvcnkiLCAiUmFuayIsICJTY29yZSIsICJBbnN3ZXIiXSwKICAgIC4uLnJvd3NPdXQKICBdOwoKICBjb25zdCB3cyA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KHdzRGF0YSk7CiAgY29uc3Qgd2IgPSBYTFNYLnV0aWxzLmJvb2tfbmV3KCk7CiAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yiwgd3MsIHBlcnNvbi5sYWJlbCk7CgogIFhMU1gud3JpdGVGaWxlKAogICAgd2IsCiAgICBwZXJzb24ubGFiZWwucmVwbGFjZSgvXHMrL2csICJfIikgKyAiX1N0YXRpc3RpY3MueGxzeCIKICApOwp9CgovLyByZWJpbmQgYnV0dG9uCmNvbnN0IHN0YXRzQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN0YXRzQnRuIik7CmlmIChzdGF0c0J0bil7CiAgc3RhdHNCdG4ub25jbGljayA9IGV4cG9ydFN0YXRzVG9FeGNlbDsKfQo8L3NjcmlwdD4KCjxzY3JpcHQ+CihmdW5jdGlvbigpewogIGNvbnN0IFBJTl9PSyA9ICIwODI1IjsKCiAgZnVuY3Rpb24gcG9pbnRzKHJhbmspewogICAgcmFuayA9IE51bWJlcihyYW5rKTsKICAgIGlmICghTnVtYmVyLmlzRmluaXRlKHJhbmspKSByZXR1cm4gIiI7CiAgICBpZiAocmFuayA9PT0gMSkgcmV0dXJuIDEyOwogICAgaWYgKHJhbmsgPT09IDIpIHJldHVybiAxMDsKICAgIHJldHVybiBNYXRoLm1heCgxLCAxMSAtIHJhbmspOwogIH0KCiAgZnVuY3Rpb24gZXhwb3J0QWxsVG9FeGNlbCgpewogICAgY29uc3QgcGluID0gcHJvbXB0KCLOlc65z4POrM6zzrXPhM61IFBJTjoiKTsKICAgIGlmIChwaW4gIT09IFBJTl9PSyl7CiAgICAgIGFsZXJ0KCLOm86szrjOv8+CIFBJTiIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gMSkgR2F0aGVyIHJhdyBhbnN3ZXJzIGZyb20gQUxMIHBlb3BsZSAoz4zOu86/zrkgzr/OuSDOtc+Bz4nPhM63zrzOrc69zr/OuSkKICAgIGNvbnN0IHJhdyA9IFtdOyAvLyB7cGVyc29uLCBjYXRlZ29yeSwgcmFuaywgc2NvcmUsIGFuc3dlcn0KICAgIGNvbnN0IHBlb3BsZUxpc3QgPSAod2luZG93LlBFT1BMRSB8fCBbCiAgICAgIHsgbGFiZWw6ICJUZXJpIFZpIFNlbnRpbyIsIHNsdWc6ICJ0ZXJpLXZpLXNlbnRpbyIgfSwKICAgICAgeyBsYWJlbDogIk1vbmhpYSIsIHNsdWc6ICJtb25oaWEiIH0sCiAgICAgIHsgbGFiZWw6ICJMaXNqYW5zaSIsIHNsdWc6ICJsaXNqYW5zaSIgfQogICAgXSk7CgogICAgZm9yIChjb25zdCBwZXJzb24gb2YgcGVvcGxlTGlzdCl7CiAgICAgIGNvbnN0IHN0ID0gbG9hZFN0YXRlKHBlcnNvbi5zbHVnKTsKICAgICAgaWYgKCFzdCkgY29udGludWU7CiAgICAgIGZvciAoY29uc3QgY2F0IG9mIENBVEVHT1JJRVMpewogICAgICAgIGNvbnN0IGFyciA9IHN0ICYmIHN0W2NhdF0gPyBzdFtjYXRdIDogW107CiAgICAgICAgZm9yIChsZXQgaT0wO2k8YXJyLmxlbmd0aDtpKyspewogICAgICAgICAgY29uc3QgYW5zID0gU3RyaW5nKGFycltpXSAmJiBhcnJbaV0udGV4dCA/IGFycltpXS50ZXh0IDogIiIpLnRyaW0oKTsKICAgICAgICAgIGlmICghYW5zKSBjb250aW51ZTsKICAgICAgICAgIGNvbnN0IHJhbmsgPSBpKzE7CiAgICAgICAgICByYXcucHVzaCh7CiAgICAgICAgICAgIHBlcnNvbjogcGVyc29uLmxhYmVsIHx8IHBlcnNvbi5uYW1lIHx8IHBlcnNvbi5zbHVnLAogICAgICAgICAgICBjYXRlZ29yeTogY2F0LAogICAgICAgICAgICByYW5rLAogICAgICAgICAgICBzY29yZTogcG9pbnRzKHJhbmspLAogICAgICAgICAgICBhbnN3ZXI6IGFucwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKCFyYXcubGVuZ3RoKXsKICAgICAgYWxlcnQoIs6UzrXOvSDOss+Bzq3OuM63zrrOsc69IM6xz4DOsc69z4TOrs+DzrXOuc+CIM6zzrnOsSBleHBvcnQuIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyAyKSBBZ2dyZWdhdGUgc3RhdGlzdGljcyAoz4PPhc6zzrrOtc69z4TPgc+Jz4TOuc66zqwpCiAgICAvLyBLZXk6IGNhdGVnb3J5fGFuc3dlcgogICAgY29uc3QgYnlBbnN3ZXIgPSBuZXcgTWFwKCk7CiAgICAvLyBLZXk6IGNhdGVnb3J5fHJhbmt8YW5zd2VyCiAgICBjb25zdCBieVJhbmsgPSBuZXcgTWFwKCk7CiAgICAvLyBLZXk6IGNhdGVnb3J5IC0+IHRvdGFsIGFuc3dlcnMKICAgIGNvbnN0IGJ5Q2F0ZWdvcnkgPSBuZXcgTWFwKCk7CgogICAgZm9yIChjb25zdCByIG9mIHJhdyl7CiAgICAgIC8vIGJ5IGNhdGVnb3J5CiAgICAgIGJ5Q2F0ZWdvcnkuc2V0KHIuY2F0ZWdvcnksIChieUNhdGVnb3J5LmdldChyLmNhdGVnb3J5KSB8fCAwKSArIDEpOwoKICAgICAgLy8gYnkgYW5zd2VyCiAgICAgIGNvbnN0IGsxID0gci5jYXRlZ29yeSArICJ8fCIgKyByLmFuc3dlci50b0xvd2VyQ2FzZSgpOwogICAgICBjb25zdCBjdXIxID0gYnlBbnN3ZXIuZ2V0KGsxKSB8fCB7IGNhdGVnb3J5OiByLmNhdGVnb3J5LCBhbnN3ZXI6IHIuYW5zd2VyLCBjb3VudDowLCB0b3RhbFNjb3JlOjAgfTsKICAgICAgY3VyMS5jb3VudCArPSAxOwogICAgICBjdXIxLnRvdGFsU2NvcmUgKz0gKE51bWJlcihyLnNjb3JlKSB8fCAwKTsKICAgICAgYnlBbnN3ZXIuc2V0KGsxLCBjdXIxKTsKCiAgICAgIC8vIGJ5IHJhbmsKICAgICAgY29uc3QgazIgPSByLmNhdGVnb3J5ICsgInx8IiArIHIucmFuayArICJ8fCIgKyByLmFuc3dlci50b0xvd2VyQ2FzZSgpOwogICAgICBjb25zdCBjdXIyID0gYnlSYW5rLmdldChrMikgfHwgeyBjYXRlZ29yeTogci5jYXRlZ29yeSwgcmFuazogci5yYW5rLCBhbnN3ZXI6IHIuYW5zd2VyLCBjb3VudDowLCB0b3RhbFNjb3JlOjAgfTsKICAgICAgY3VyMi5jb3VudCArPSAxOwogICAgICBjdXIyLnRvdGFsU2NvcmUgKz0gKE51bWJlcihyLnNjb3JlKSB8fCAwKTsKICAgICAgYnlSYW5rLnNldChrMiwgY3VyMik7CiAgICB9CgogICAgY29uc3Qgc3RhdHNSb3dzID0gQXJyYXkuZnJvbShieUFuc3dlci52YWx1ZXMoKSkKICAgICAgLm1hcCh4ID0+ICh7Li4ueCwgYXZnU2NvcmU6IHguY291bnQgPyAoeC50b3RhbFNjb3JlIC8geC5jb3VudCkgOiAwfSkpCiAgICAgIC5zb3J0KChhLGIpID0+IChiLnRvdGFsU2NvcmUgLSBhLnRvdGFsU2NvcmUpIHx8IChiLmNvdW50IC0gYS5jb3VudCkgfHwgYS5jYXRlZ29yeS5sb2NhbGVDb21wYXJlKGIuY2F0ZWdvcnkpIHx8IGEuYW5zd2VyLmxvY2FsZUNvbXBhcmUoYi5hbnN3ZXIpKTsKCiAgICBjb25zdCByYW5rUm93cyA9IEFycmF5LmZyb20oYnlSYW5rLnZhbHVlcygpKQogICAgICAubWFwKHggPT4gKHsuLi54LCBhdmdTY29yZTogeC5jb3VudCA/ICh4LnRvdGFsU2NvcmUgLyB4LmNvdW50KSA6IDB9KSkKICAgICAgLnNvcnQoKGEsYikgPT4gYS5jYXRlZ29yeS5sb2NhbGVDb21wYXJlKGIuY2F0ZWdvcnkpIHx8IChhLnJhbmsgLSBiLnJhbmspIHx8IChiLnRvdGFsU2NvcmUgLSBhLnRvdGFsU2NvcmUpIHx8IChiLmNvdW50IC0gYS5jb3VudCkpOwoKICAgIGNvbnN0IGNhdFJvd3MgPSBBcnJheS5mcm9tKGJ5Q2F0ZWdvcnkuZW50cmllcygpKQogICAgICAubWFwKChbY2F0ZWdvcnksIHRvdGFsQW5zd2Vyc10pID0+ICh7IGNhdGVnb3J5LCB0b3RhbEFuc3dlcnMgfSkpCiAgICAgIC5zb3J0KChhLGIpID0+IGIudG90YWxBbnN3ZXJzIC0gYS50b3RhbEFuc3dlcnMpOwoKICAgIC8vIDMpIEJ1aWxkIHdvcmtib29rCiAgICBjb25zdCB3YiA9IFhMU1gudXRpbHMuYm9va19uZXcoKTsKCiAgICAvLyBTaGVldDogUkFXCiAgICBjb25zdCByYXdBb2EgPSBbWyJQZXJzb24iLCJDYXRlZ29yeSIsIlJhbmsiLCJTY29yZSIsIkFuc3dlciJdXTsKICAgIHJhdy5mb3JFYWNoKHIgPT4gcmF3QW9hLnB1c2goW3IucGVyc29uLCByLmNhdGVnb3J5LCByLnJhbmssIHIuc2NvcmUsIHIuYW5zd2VyXSkpOwogICAgY29uc3Qgd3NSYXcgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChyYXdBb2EpOwogICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yiwgd3NSYXcsICJSQVciKTsKCiAgICAvLyBTaGVldDogU1RBVFMgKGJ5IEFuc3dlcikKICAgIGNvbnN0IHN0YXRzQW9hID0gW1siQ2F0ZWdvcnkiLCJBbnN3ZXIiLCJDb3VudCIsIlRvdGFsIFNjb3JlIiwiQXZnIFNjb3JlIl1dOwogICAgc3RhdHNSb3dzLmZvckVhY2gocyA9PiBzdGF0c0FvYS5wdXNoKFtzLmNhdGVnb3J5LCBzLmFuc3dlciwgcy5jb3VudCwgcy50b3RhbFNjb3JlLCBNYXRoLnJvdW5kKHMuYXZnU2NvcmUqMTAwKS8xMDBdKSk7CiAgICBjb25zdCB3c1N0YXRzID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQoc3RhdHNBb2EpOwogICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yiwgd3NTdGF0cywgIlNUQVRTIik7CgogICAgLy8gU2hlZXQ6IEJZX1JBTksKICAgIGNvbnN0IHJhbmtBb2EgPSBbWyJDYXRlZ29yeSIsIlJhbmsiLCJBbnN3ZXIiLCJDb3VudCIsIlRvdGFsIFNjb3JlIiwiQXZnIFNjb3JlIl1dOwogICAgcmFua1Jvd3MuZm9yRWFjaChzID0+IHJhbmtBb2EucHVzaChbcy5jYXRlZ29yeSwgcy5yYW5rLCBzLmFuc3dlciwgcy5jb3VudCwgcy50b3RhbFNjb3JlLCBNYXRoLnJvdW5kKHMuYXZnU2NvcmUqMTAwKS8xMDBdKSk7CiAgICBjb25zdCB3c1JhbmsgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChyYW5rQW9hKTsKICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2IsIHdzUmFuaywgIkJZX1JBTksiKTsKCiAgICAvLyBTaGVldDogQ0FURUdPUklFUwogICAgY29uc3QgY2F0QW9hID0gW1siQ2F0ZWdvcnkiLCJUb3RhbCBBbnN3ZXJzIl1dOwogICAgY2F0Um93cy5mb3JFYWNoKGMgPT4gY2F0QW9hLnB1c2goW2MuY2F0ZWdvcnksIGMudG90YWxBbnN3ZXJzXSkpOwogICAgY29uc3Qgd3NDYXQgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChjYXRBb2EpOwogICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yiwgd3NDYXQsICJDQVRFR09SSUVTIik7CgogICAgLy8gTmljZSBjb2x1bW4gd2lkdGhzCiAgICBmdW5jdGlvbiBzZXRDb2xzKHdzLCB3aWR0aHMpewogICAgICB3c1siIWNvbHMiXSA9IHdpZHRocy5tYXAodyA9PiAoeyB3Y2g6dyB9KSk7CiAgICB9CiAgICBzZXRDb2xzKHdzUmF3LCAgIFsxOCwgMjYsIDYsIDcsIDQ2XSk7CiAgICBzZXRDb2xzKHdzU3RhdHMsIFsyNiwgNDYsIDgsIDEyLCAxMF0pOwogICAgc2V0Q29scyh3c1JhbmssICBbMjYsIDYsIDQ2LCA4LCAxMiwgMTBdKTsKICAgIHNldENvbHMod3NDYXQsICAgWzI2LCAxNF0pOwoKICAgIFhMU1gud3JpdGVGaWxlKHdiLCAiSmFtZXNSaWdhc19TdGF0c19PTEEueGxzeCIpOwogIH0KCiAgY29uc3Qgc3RhdHNCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3RhdHNCdG4iKTsKICBpZiAoc3RhdHNCdG4pewogICAgc3RhdHNCdG4ub25jbGljayA9IGV4cG9ydEFsbFRvRXhjZWw7CiAgfQp9KSgpOwo8L3NjcmlwdD4KCjwvYm9keT4KPC9odG1sPgo=";

  const introFrame = document.getElementById('introFrame');
  const mainFrame  = document.getElementById('mainFrame');

  function b64ToText(b64){ 
    try{ return decodeURIComponent(escape(atob(b64))); }catch(e){ return atob(b64); } 
  }

  introFrame.srcdoc = b64ToText(INTRO_B64);
  mainFrame.srcdoc  = b64ToText(MAIN_B64);

  const INTRO_MS = 10000;
  const FX_MS = 1200;

  function switchToMain(){
    document.body.classList.add('fx-on');
    setTimeout(() => {
      document.body.classList.add('main-on');
      setTimeout(() => { try{ introFrame.srcdoc = ""; }catch(e){} }, 900);
    }, Math.min(900, FX_MS - 200));
    setTimeout(() => document.body.classList.remove('fx-on'), FX_MS);
  }

  const isTouch = matchMedia('(pointer:coarse)').matches || 'ontouchstart' in window;
  const overlay = document.getElementById('startOverlay');
  let started=false, introTimer=null;

  function begin(){
    if (started) return;
    started=true;
    if (overlay) overlay.classList.add('hidden');
    introTimer=setTimeout(switchToMain, INTRO_MS);
  }

  if (isTouch && overlay){
    const tap=()=>begin();
    overlay.addEventListener('click', tap, { once:true });
    overlay.addEventListener('touchstart', tap, { once:true, passive:true });
    overlay.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' ') begin(); }, { once:true });
  } else {
    begin();
  }
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, doc, setDoc, onSnapshot, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // Firebase config (from your Firebase console)
  const firebaseConfig = {
  "apiKey": "AIzaSyA3j74FN_DIrsZclq09lIY62eenSOzP0yQ",
  "authDomain": "euphoria-2026.firebaseapp.com",
  "projectId": "euphoria-2026",
  "storageBucket": "euphoria-2026.firebasestorage.app",
  "messagingSenderId": "259023927428",
  "appId": "1:259023927428:web:74099e69bea7b07a7b2ad1",
  "measurementId": "G-JEVRCV89WB"
};

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  const mainFrame = document.getElementById('mainFrame');

  // --- Touch scroll fallback for mobile if iframe content doesn't scroll naturally ---
  function attachTouchScrollFallback(){
    if (!mainFrame) return;
    const tryAttach = () => {
      let doc;
      try { doc = mainFrame.contentDocument; } catch(e){ return; }
      if (!doc) return;

      // Find the first scrollable container inside the iframe
      const isScrollable = (el) => {
        if (!el) return false;
        const sh = el.scrollHeight, ch = el.clientHeight;
        if (sh <= ch + 2) return false;
        const cs = doc.defaultView.getComputedStyle(el);
        const oy = cs.overflowY;
        return (oy === 'auto' || oy === 'scroll');
      };

      let target = null;
      // Prefer an explicit scroll container if any
      const candidates = Array.from(doc.querySelectorAll('body *')).slice(0, 4000); // cap for perf
      for (const el of candidates){
        if (isScrollable(el)) { target = el; break; }
      }
      // Fallbacks
      if (!target) target = doc.scrollingElement || doc.documentElement || doc.body;

      let lastY = null;
      let lastX = null;

      // If the target can't scroll, just don't attach.
      const canScroll = () => (target && target.scrollHeight > target.clientHeight + 2);
      if (!canScroll()) return;

      doc.addEventListener('touchstart', (e)=>{
        if (e.touches && e.touches.length===1){
          lastY = e.touches[0].clientY;
          lastX = e.touches[0].clientX;
        }
      }, {passive:true});

      doc.addEventListener('touchmove', (e)=>{
        if (lastY==null || !e.touches || e.touches.length!==1) return;
        const y = e.touches[0].clientY;
        const x = e.touches[0].clientX;
        const dy = lastY - y;
        const dx = lastX - x;

        // Only handle mostly-vertical gestures
        if (Math.abs(dy) > Math.abs(dx)){
          // Try to scroll target
          const before = target.scrollTop;
          target.scrollTop = before + dy;

          // If it moved, stop the browser from treating it as a swipe
          if (target.scrollTop !== before){
            e.preventDefault();
          }
          lastY = y; lastX = x;
        }
      }, {passive:false});

      doc.addEventListener('touchend', ()=>{ lastY=null; lastX=null; }, {passive:true});
      doc.addEventListener('touchcancel', ()=>{ lastY=null; lastX=null; }, {passive:true});
    };

    // Attach once on load, and also retry shortly after (some apps render late)
    mainFrame.addEventListener('load', ()=>{
      tryAttach();
      setTimeout(tryAttach, 600);
      setTimeout(tryAttach, 1500);
    }, {once:true});
  }
  attachTouchScrollFallback();


  // "room" decides which shared state you sync (default matches your seed key)
  const room = new URLSearchParams(location.search).get('room') || 'teri-vi-sentio';
  const docRef = doc(db, 'neon-awards', room);

  let applyingRemote = false;

  function postToIframe(type, payload) {
    try {
      mainFrame.contentWindow?.postMessage({ __neonSync: 1, type, payload }, '*');
    } catch (e) {}
  }

  async function ensureDocFromIframe(kv) {
    try {
      const snap = await getDoc(docRef);
      if (!snap.exists()) {
        await setDoc(docRef, { kv, updatedAt: serverTimestamp() }, { merge: true });
      }
    } catch (e) {
      console.warn('Firestore init failed:', e);
    }
  }

  function injectBridge() {
    try {
      const w = mainFrame.contentWindow;
      const d = mainFrame.contentDocument;
      if (!w || !d) return;
      if (w.__neonBridgeInstalled) return;
      w.__neonBridgeInstalled = true;

      const s = d.createElement('script');
      s.textContent = `
(() => {
  const PREFIX = 'neon-awards:';
  const send = (type, payload) => {
    try { parent.postMessage({ __neonSync: 1, type, payload }, '*'); } catch(e) {}
  };

  const ls = window.localStorage;
  const _set = ls.setItem.bind(ls);
  const _rem = ls.removeItem.bind(ls);

  // patch writes so parent can sync to Firestore
  ls.setItem = (k, v) => {
    _set(k, v);
    if (window.__neonApplyingRemote) return;
    if (String(k).startsWith(PREFIX)) send('localChange', { key: String(k), value: String(v) });
  };
  ls.removeItem = (k) => {
    _rem(k);
    if (window.__neonApplyingRemote) return;
    if (String(k).startsWith(PREFIX)) send('localChange', { key: String(k), value: null });
  };

  // receive updates from parent (Firestore -> localStorage)
  window.addEventListener('message', (ev) => {
    const msg = ev.data;
    if (!msg || !msg.__neonSync) return;

    if (msg.type === 'applyRemote') {
      const kv = (msg.payload && msg.payload.kv) ? msg.payload.kv : {};
      window.__neonApplyingRemote = true;
      try {
        for (const [k, v] of Object.entries(kv)) {
          if (!String(k).startsWith(PREFIX)) continue;
          if (v === null || v === undefined) _rem(k);
          else _set(k, String(v));
        }
      } finally {
        window.__neonApplyingRemote = false;
      }
    }
  });

  // send current state once (for first-time Firestore init)
  try {
    const kv = {};
    for (let i=0; i<ls.length; i++) {
      const k = ls.key(i);
      if (k && String(k).startsWith(PREFIX)) kv[String(k)] = ls.getItem(k);
    }
    send('hello', { kv });
  } catch(e) {}
})();
      `;
      d.documentElement.appendChild(s);
    } catch (e) {
      console.warn('Bridge inject failed:', e);
    }
  }

  mainFrame.addEventListener('load', () => {
    injectBridge();
  });

  // In case it loads instantly
  setTimeout(injectBridge, 500);

  // Listen to iframe -> parent events
  window.addEventListener('message', async (ev) => {
    const msg = ev.data;
    if (!msg || !msg.__neonSync) return;

    if (msg.type === 'hello') {
      // If Firestore is empty, seed it from this client
      const kv = msg.payload?.kv || {};
      await ensureDocFromIframe(kv);
      return;
    }

    if (msg.type === 'localChange') {
      if (applyingRemote) return;
      const { key, value } = msg.payload || {};
      if (!key) return;

      try {
        await setDoc(docRef, {
          kv: { [key]: value },
          updatedAt: serverTimestamp()
        }, { merge: true });
      } catch (e) {
        console.warn('Firestore write failed:', e);
      }
    }
  });

  // Firestore -> iframe live updates
  onSnapshot(docRef, (snap) => {
    if (!snap.exists()) return;
    const data = snap.data() || {};
    const kv = data.kv || {};

    applyingRemote = true;
    postToIframe('applyRemote', { kv });
    // allow local edits again on next tick
    setTimeout(() => (applyingRemote = false), 0);
  });
</script>
</body>
</html>
